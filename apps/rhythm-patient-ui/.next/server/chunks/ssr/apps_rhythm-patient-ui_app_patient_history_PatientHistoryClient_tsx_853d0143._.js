module.exports=[7961,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);a.i(53547);var e=a.i(28914),f=a.i(35958);function g(a,b){if(void 0===a)return b;let c=a.toLowerCase().trim();return"true"===c||"1"===c||"yes"===c}let h={AMY_ENABLED:g(f.env.NEXT_PUBLIC_FEATURE_AMY_ENABLED,!0),CLINICIAN_DASHBOARD_ENABLED:g(f.env.NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED,!0),CHARTS_ENABLED:g(f.env.NEXT_PUBLIC_FEATURE_CHARTS_ENABLED,!0)};function i(){let a=(0,d.useRouter)(),[f,g]=(0,c.useState)({status:"idle"}),[i,j]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{let{data:{user:b},error:c}=await e.supabase.auth.getUser();if(c||!b){console.error("Fehler bei getUser:",c),a.push("/");return}let{data:d,error:f}=await e.supabase.from("patient_profiles").select("id").eq("user_id",b.id).single();if(f||!d){console.error("Fehler beim Laden des Patientenprofils:",f),g({status:"error",message:"Ihr Profil konnte nicht geladen werden. Bitte versuchen Sie es spÃ¤ter erneut."});return}try{g({status:"loading"});let a=await fetch(`/api/patient-measures/history?patientId=${d.id}`);if(!a.ok)throw Error("Fehler beim Laden der Verlaufsdaten.");let b=await a.json();g({status:"success",measures:b.measures||[]})}catch(a){console.error("Fehler beim Laden der Verlaufsdaten:",a),g({status:"error",message:"Die Verlaufsdaten konnten nicht geladen werden. Bitte versuchen Sie es spÃ¤ter erneut."})}})()},[a]);let k=a=>{if(!a)return"Datum unbekannt";try{let b=new Date(a);return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(b)}catch{return"Datum unbekannt"}},l=async()=>{try{j(!0);let{data:{session:a},error:b}=await e.supabase.auth.getSession();if(b||!a){console.error("Fehler beim Abrufen der Session:",b),alert("Fehler: Sie sind nicht angemeldet.");return}let c=await fetch("/api/patient-measures/export",{headers:{Authorization:`Bearer ${a.access_token}`}});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(a.error||"Fehler beim Exportieren der Daten.")}let d=await c.json(),f=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),g=window.URL.createObjectURL(f),h=document.createElement("a");h.href=g,h.download=`verlaufsdaten-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(g)}catch(a){console.error("Fehler beim Exportieren:",a),alert("Fehler beim Exportieren der Daten. Bitte versuchen Sie es spÃ¤ter erneut.")}finally{j(!1)}};if("loading"===f.status||"idle"===f.status)return(0,b.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10",children:[(0,b.jsxs)("section",{children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl",children:"Ihr Verlauf"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"Ihre bisherigen Stress- und Schlaf-Messungen"})]}),(0,b.jsxs)("section",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"h-6 w-40 animate-pulse rounded bg-slate-200"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"h-32 animate-pulse rounded-xl bg-slate-200"}),(0,b.jsx)("div",{className:"h-32 animate-pulse rounded-xl bg-slate-200"}),(0,b.jsx)("div",{className:"h-32 animate-pulse rounded-xl bg-slate-200"})]})]})]});if("error"===f.status)return(0,b.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10",children:[(0,b.jsxs)("button",{type:"button",onClick:()=>a.push("/patient/dashboard"),className:"self-start inline-flex items-center gap-2 text-sm font-medium text-sky-700 hover:text-sky-900 hover:underline transition-colors","aria-label":"ZurÃ¼ck zum Dashboard",children:[(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"ZurÃ¼ck zum Dashboard"]}),(0,b.jsx)("section",{children:(0,b.jsx)("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl",children:"Ihr Verlauf"})}),(0,b.jsxs)("section",{className:"rounded-xl border border-red-100 bg-red-50 px-4 py-4 text-sm text-red-800",children:[(0,b.jsx)("p",{className:"font-medium",children:"Fehler beim Laden der Daten"}),(0,b.jsx)("p",{className:"mt-1",children:f.message}),(0,b.jsxs)("div",{className:"mt-3 flex gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>a.refresh(),className:"inline-flex items-center rounded-md border border-red-300 bg-white px-3 py-1.5 text-xs font-medium text-red-800 shadow-sm hover:bg-red-50",children:"Noch einmal versuchen"}),(0,b.jsx)("button",{type:"button",onClick:()=>a.push("/patient/dashboard"),className:"inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50",children:"Zum Dashboard"})]})]})]});let{measures:m}=f;if(0===m.length)return(0,b.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10",children:[(0,b.jsxs)("button",{type:"button",onClick:()=>a.push("/patient/dashboard"),className:"self-start inline-flex items-center gap-2 text-sm font-medium text-sky-700 hover:text-sky-900 hover:underline transition-colors","aria-label":"ZurÃ¼ck zum Dashboard",children:[(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"ZurÃ¼ck zum Dashboard"]}),(0,b.jsxs)("section",{children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl",children:"Ihr Verlauf"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"Ihre bisherigen Stress- und Schlaf-Messungen"})]}),(0,b.jsx)("section",{className:"rounded-xl border border-slate-200 bg-white px-6 py-12 text-center",children:(0,b.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,b.jsx)("p",{className:"text-4xl mb-4","aria-label":"Verlaufsdiagramm-Symbol",children:"ðŸ“Š"}),(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Noch keine Messungen vorhanden"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-slate-600 leading-relaxed",children:"Sie haben bisher noch keine Stress- oder Schlaf-Messungen durchgefÃ¼hrt. Starten Sie jetzt mit Ihrer ersten Messung, um Ihren Verlauf zu dokumentieren."}),(0,b.jsx)("button",{type:"button",onClick:()=>a.push("/patient/dashboard"),className:"mt-6 inline-flex items-center rounded-lg px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:opacity-90 transition-opacity",style:{backgroundColor:"var(--color-primary-600)"},children:"Zum Dashboard"})]})})]});let n=m[0],o=n?.report?.score_numeric??n?.stress_score??null,p=n?.report?.sleep_score??n?.sleep_score??null;return(0,b.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10",children:[(0,b.jsx)("section",{children:(0,b.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,b.jsxs)("button",{type:"button",onClick:()=>a.push("/patient/dashboard"),className:"self-start inline-flex items-center gap-2 text-sm font-medium text-sky-700 hover:text-sky-900 hover:underline transition-colors","aria-label":"ZurÃ¼ck zum Dashboard",children:[(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"ZurÃ¼ck zum Dashboard"]}),(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl",children:"Ihr Verlauf"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"Ihre bisherigen Stress- und Schlaf-Messungen im Ãœberblick"})]}),(0,b.jsx)("button",{type:"button",onClick:l,disabled:i,className:"inline-flex items-center gap-2 rounded-lg border px-4 py-2.5 text-sm font-semibold shadow-sm hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed transition-opacity",style:{borderColor:"var(--color-neutral-200)",backgroundColor:"var(--background)",color:"var(--color-neutral-700)"},children:i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-slate-300 border-t-slate-600"}),"Exportiere..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Als JSON exportieren"]})})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>a.push("/patient/assessment"),className:"w-full inline-flex justify-center items-center gap-2 px-5 py-3 rounded-lg text-white text-sm font-semibold shadow-sm hover:opacity-90 transition-opacity",style:{backgroundColor:"var(--color-primary-600)"},"aria-label":"Neue Messung durchfÃ¼hren",children:[(0,b.jsx)("span",{className:"text-base","aria-hidden":"true",children:"âœ“"}),"Neue Messung durchfÃ¼hren"]})]})}),(0,b.jsxs)("section",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,b.jsx)("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-500",children:"Messungen gesamt"}),(0,b.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:m.length}),(0,b.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:["Erste Messung: ",k(m[m.length-1]?.created_at)]})]}),(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,b.jsx)("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-500",children:"Letzter Stress-Score"}),null!=o?(0,b.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:Math.round(o)}):(0,b.jsx)("p",{className:"mt-2 text-sm text-slate-400",children:"Keine Daten"}),(0,b.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:["Von ",k(m[0]?.created_at)]})]}),(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,b.jsx)("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-500",children:"Letzter Schlaf-Score"}),null!=p?(0,b.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:Math.round(p)}):(0,b.jsx)("p",{className:"mt-2 text-sm text-slate-400",children:"Keine Daten"}),(0,b.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:["Von ",k(m[0]?.created_at)]})]})]}),(0,b.jsxs)("section",{children:[(0,b.jsx)("h2",{className:"mb-4 text-base font-semibold text-slate-800",children:"Chronologischer Verlauf"}),(0,b.jsx)("div",{className:"space-y-4",children:m.map((a,c)=>{let d=a.report,e=!!d,f=d?.score_numeric??a.stress_score??null,g=d?.sleep_score??a.sleep_score??null,i=d?.risk_level??a.risk_level??null,j=d?.report_text_short??null;return(0,b.jsxs)("article",{className:"rounded-xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,b.jsxs)("div",{className:"mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-slate-900",children:0===c?"Neueste Messung":`Messung vom ${k(a.created_at)}`}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:(a=>{if(!a)return"Datum unbekannt";try{let b=new Date(a);return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(b)}catch{return"Datum unbekannt"}})(a.created_at)})]}),i&&(0,b.jsx)("span",{className:`inline-flex items-center self-start rounded-full border px-2.5 py-1 text-xs font-medium ${(a=>{switch(a){case"low":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"moderate":return"bg-amber-100 text-amber-800 border-amber-200";case"high":return"bg-red-100 text-red-800 border-red-200";case"pending":return"bg-slate-100 text-slate-600 border-slate-200";default:return"bg-slate-100 text-slate-700 border-slate-200"}})(i)}`,children:(a=>{if(!a)return"Nicht klassifiziert";switch(a){case"low":return"Niedriges Risiko";case"moderate":return"Moderates Risiko";case"high":return"ErhÃ¶htes Risiko";case"pending":return"Wird ermittelt";default:return"Nicht klassifiziert"}})(i)})]}),(0,b.jsxs)("div",{className:"mb-4 grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"rounded-lg border border-slate-100 bg-slate-50 p-3",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-slate-600",children:"Stress-Score"}),null!=f?(0,b.jsx)("p",{className:"mt-1 text-xl font-semibold text-slate-900",children:Math.round(f)}):(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"â€”"})]}),(0,b.jsxs)("div",{className:"rounded-lg border border-slate-100 bg-slate-50 p-3",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-slate-600",children:"Schlaf-Score"}),null!=g?(0,b.jsx)("p",{className:"mt-1 text-xl font-semibold text-slate-900",children:Math.round(g)}):(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"â€”"})]})]}),h.AMY_ENABLED&&j&&(0,b.jsxs)("div",{className:"rounded-lg border border-sky-100 bg-sky-50/50 px-4 py-3",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-sky-900",children:"Einordnung von AMY"}),(0,b.jsx)("span",{className:"inline-flex items-center rounded-full bg-sky-100 px-2 py-0.5 text-[10px] font-medium text-sky-700",children:"KI-Assistenz"})]}),(0,b.jsx)("p",{className:"text-sm leading-6 text-sky-900 whitespace-pre-line",children:j})]}),h.AMY_ENABLED&&e&&!j&&(0,b.jsx)("div",{className:"rounded-lg border border-slate-100 bg-slate-50 px-4 py-3",children:(0,b.jsx)("p",{className:"text-xs text-slate-600",children:"FÃ¼r diese Messung liegt noch kein AMY-Text vor."})}),h.AMY_ENABLED&&!e&&(0,b.jsx)("div",{className:"rounded-lg border border-amber-100 bg-amber-50 px-4 py-3",children:(0,b.jsx)("p",{className:"text-xs text-amber-800",children:"Die Auswertung fÃ¼r diese Messung wird noch erstellt."})})]},a.id)})})]})]})}a.s(["default",()=>i],7961)}];

//# sourceMappingURL=apps_rhythm-patient-ui_app_patient_history_PatientHistoryClient_tsx_853d0143._.js.map