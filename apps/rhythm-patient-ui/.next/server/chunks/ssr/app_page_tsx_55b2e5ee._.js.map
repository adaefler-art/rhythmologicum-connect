{"version":3,"sources":["../../../../../../app/page.tsx","../../../../../../lib/utils/roleLanding.ts","../../../../../../lib/utils/authRedirect.ts"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport { supabase } from '../lib/supabaseClient'\nimport { useRouter } from 'next/navigation'\nimport { ThemeToggle, Input } from '@/lib/ui'\nimport type { ResolvedUserRole } from '@/lib/utils/roleLanding'\nimport { getPostLoginRedirect } from '@/lib/utils/authRedirect'\n\nasync function syncServerSession() {\n  const { data } = await supabase.auth.getSession()\n  const session = data.session\n  if (!session) return\n\n  await fetch('/api/auth/callback', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ event: 'SIGNED_IN', session }),\n  })\n}\n\ntype ResolveRoleResult = {\n  role: ResolvedUserRole\n  requiresOnboarding: boolean\n  reason?: string\n}\n\ntype ResolveRoleOutcome =\n  | { kind: 'ok'; value: ResolveRoleResult }\n  | { kind: 'unauthenticated' }\n  | { kind: 'fallback_patient' }\n\nasync function resolveRole(): Promise<ResolveRoleOutcome> {\n  try {\n    const res = await fetch('/api/auth/resolve-role', { method: 'GET' })\n    if (res.status === 401) return { kind: 'unauthenticated' }\n    if (!res.ok) return { kind: 'fallback_patient' }\n    const json: unknown = await res.json()\n    if (!json || typeof json !== 'object') return { kind: 'fallback_patient' }\n    const data = (json as { data?: unknown }).data\n    if (!data || typeof data !== 'object') return { kind: 'fallback_patient' }\n\n    const role = (data as { role?: string }).role\n    const requiresOnboarding = (data as { requiresOnboarding?: boolean }).requiresOnboarding\n    const reason = (data as { reason?: string }).reason\n    if (role === 'patient' || role === 'clinician' || role === 'admin' || role === 'nurse') {\n      return { kind: 'ok', value: { role, requiresOnboarding: requiresOnboarding === true, reason } }\n    }\n\n    // If the API returns an unexpected role, don't block UX.\n    return { kind: 'fallback_patient' }\n  } catch {\n    return { kind: 'fallback_patient' }\n  }\n}\n\ntype OnboardingStatusResponse =\n  | {\n      success: true\n      data: { needsConsent: boolean; needsProfile: boolean; completed: boolean }\n    }\n  | { success: false; error: { code: string; message: string } }\n\nasync function getPatientRedirectFromOnboardingStatus(): Promise<\n  | { kind: 'ok'; path: string }\n  | { kind: 'unauthenticated' }\n  | { kind: 'fallback' }\n> {\n  try {\n    const res = await fetch('/api/patient/onboarding-status', { method: 'GET', cache: 'no-store' })\n    if (res.status === 401) return { kind: 'unauthenticated' }\n    if (!res.ok) return { kind: 'fallback' }\n\n    const json: unknown = await res.json()\n    if (!json || typeof json !== 'object') return { kind: 'fallback' }\n    const parsed = json as OnboardingStatusResponse\n    if (!('success' in parsed) || parsed.success !== true) return { kind: 'fallback' }\n\n    if (parsed.data.needsConsent) return { kind: 'ok', path: '/patient/onboarding/consent' }\n    if (parsed.data.needsProfile) return { kind: 'ok', path: '/patient/onboarding/profile' }\n    return { kind: 'fallback' }\n  } catch {\n    return { kind: 'fallback' }\n  }\n}\n\nasync function resolvePostLoginRedirect(role: ResolvedUserRole): Promise<string | null> {\n  if (role === 'patient') {\n    const onboarding = await getPatientRedirectFromOnboardingStatus()\n    if (onboarding.kind === 'unauthenticated') return null\n    if (onboarding.kind === 'ok') {\n      return getPostLoginRedirect({ role, patientOnboardingPath: onboarding.path })\n    }\n  }\n\n  return getPostLoginRedirect({ role })\n}\n\n\ntype Mode = 'login' | 'signup'\n\ninterface VersionInfo {\n  commitHash: string\n  commitHashShort: string\n  commitDate: string\n  buildDate: string\n}\n\nexport default function LoginPage() {\n  const router = useRouter()\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [mode, setMode] = useState<Mode>('login')\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [info, setInfo] = useState<string | null>(null) // neu: Erfolgsmeldungen\n  const [versionInfo, setVersionInfo] = useState<VersionInfo | null>(null)\n\n  // Check if user is already authenticated and redirect to appropriate landing page\n  useEffect(() => {\n    const checkAuthAndRedirect = async () => {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n\n      if (user) {\n        await syncServerSession()\n\n        const resolved = await resolveRole()\n\n        if (resolved.kind === 'unauthenticated') {\n          return\n        }\n\n        const role = resolved.kind === 'fallback_patient' ? 'patient' : resolved.value.role\n\n        const target = await resolvePostLoginRedirect(role)\n        if (target) {\n          router.replace(target)\n        }\n      }\n    }\n\n    checkAuthAndRedirect()\n  }, [router])\n\n  useEffect(() => {\n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange(async (event, session) => {\n      await fetch('/api/auth/callback', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ event, session }),\n      })\n    })\n\n    return () => subscription.unsubscribe()\n  }, [])\n\n  // Fetch version info on component mount\n  useEffect(() => {\n    fetch('/version.json')\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(`HTTP error! status: ${res.status}`)\n        }\n        return res.json()\n      })\n      .then((data) => {\n        // Basic validation of the response structure\n        if (data && typeof data.commitHashShort === 'string' && typeof data.commitDate === 'string') {\n          setVersionInfo(data)\n        }\n      })\n      .catch((err) => console.error('Failed to load version info:', err))\n  }, [])\n\n  // Check for error/message query parameters from middleware redirect\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search)\n    const errorParam = params.get('error')\n    const messageParam = params.get('message')\n    \n    if (errorParam && messageParam) {\n      setError(messageParam)\n      // Clean up URL\n      window.history.replaceState({}, '', '/')\n    }\n  }, [])\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError(null)\n    setInfo(null)\n\n    const trimmedEmail = email.trim()\n    const trimmedPassword = password.trim()\n\n    if (!trimmedEmail || !trimmedPassword) {\n      setError('Bitte E-Mail und Passwort eingeben.')\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      if (mode === 'signup') {\n        const { error: signUpError } = await supabase.auth.signUp({\n          email: trimmedEmail,\n          password: trimmedPassword,\n        })\n\n        if (signUpError) throw signUpError\n\n        // Erfolgsmeldung für Signup\n        setInfo(\n          'Ihr Konto wurde angelegt. Bitte prüfen Sie Ihre E-Mails, um Ihre Adresse zu bestätigen.'\n        )\n\n        return // kein sofortiger Login → User soll Mail bestätigen\n      } else {\n        const { error: signInError } = await supabase.auth.signInWithPassword({\n          email: trimmedEmail,\n          password: trimmedPassword,\n        })\n\n        if (signInError) throw signInError\n      }\n\n      // Ensure the server-side cookie session exists before any SSR pages run.\n      await syncServerSession()\n\n      // aktuellen User holen\n      const {\n        data: { user },\n        error: userError,\n      } = await supabase.auth.getUser()\n\n      if (userError) throw userError\n      if (!user) throw new Error('Kein Benutzerprofil gefunden.')\n\n      // Resolve role from auth metadata (metadata-only; no DB/RLS dependency)\n      const resolved = await resolveRole()\n      if (resolved.kind === 'unauthenticated') {\n        setError('Bitte einloggen.')\n        return\n      }\n\n      const role = resolved.kind === 'fallback_patient' ? 'patient' : resolved.value.role\n\n      const target = await resolvePostLoginRedirect(role)\n      if (!target) {\n        setError('Bitte einloggen.')\n        return\n      }\n\n      router.replace(target)\n    } catch (err: unknown) {\n      console.error(err)\n      const error = err as { message?: string; error_description?: string }\n      const message =\n        error?.message ??\n        error?.error_description ??\n        'Es ist ein unerwarteter Fehler aufgetreten.'\n      setError(message)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const canSubmit =\n    email.trim() !== '' && password.trim() !== '' && !loading\n\n  return (\n    <main className=\"min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-900 px-4 py-10 transition-colors duration-150 relative\">\n      {/* Theme Toggle - Top Right */}\n      <div className=\"absolute top-4 right-4\">\n        <ThemeToggle size=\"md\" />\n      </div>\n      \n      <div className=\"w-full max-w-5xl flex flex-col md:flex-row items-stretch gap-8\">\n        {/* Left column: brand + copy */}\n        <div className=\"w-full md:w-[420px] rounded-3xl bg-white/80 dark:bg-slate-800/80 backdrop-blur p-8 shadow-lg transition-colors duration-150\">\n          <div className=\"space-y-4\">\n            <div>\n              <h1 className=\"text-4xl sm:text-5xl font-bold tracking-tight text-sky-600 dark:text-sky-400\">RHYTHM</h1>\n              <h2 className=\"text-xl sm:text-2xl font-semibold tracking-tight text-slate-900 dark:text-slate-100\">\n                Rhythmologicum Connect\n              </h2>\n            </div>\n            <p className=\"text-sm text-slate-600 dark:text-slate-300 leading-relaxed\">\n              Willkommen! Dieser Bereich dient dem sicheren Zugang zu Ihrem persönlichen\n              Stress- & Resilienz-Programm.\n            </p>\n            <p className=\"text-sm text-slate-600 dark:text-slate-300 leading-relaxed\">\n              Ihre Angaben werden vertraulich behandelt und ausschließlich zur Durchführung Ihrer\n              Stress- & Resilienz-Analyse genutzt.\n            </p>\n            <a\n              href=\"/datenschutz\"\n              className=\"inline-flex text-sm font-medium text-sky-700 dark:text-sky-400 hover:text-sky-800 dark:hover:text-sky-300\"\n            >\n              Datenschutz & Datennutzung\n            </a>\n          </div>\n          {versionInfo && (\n            <div className=\"mt-6 pt-4 border-t border-slate-100 dark:border-slate-700 text-sm text-slate-500 dark:text-slate-400 space-y-1\">\n              <p>\n                Version: <span className=\"font-mono\">{versionInfo.commitHashShort}</span>\n              </p>\n              <p>\n                {new Date(versionInfo.commitDate).toLocaleString('de-DE', {\n                  year: 'numeric',\n                  month: '2-digit',\n                  day: '2-digit',\n                  hour: '2-digit',\n                  minute: '2-digit',\n                })}\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* Right column: auth form */}\n        <div className=\"flex-1 rounded-3xl bg-white dark:bg-slate-800 p-8 shadow-lg transition-colors duration-150\">\n          {/* Tabs */}\n          <div className=\"mb-6 grid grid-cols-2 rounded-full bg-slate-100 dark:bg-slate-700 p-1 text-sm font-medium\">\n            <button\n              type=\"button\"\n              onClick={() => setMode('login')}\n              className={`rounded-full py-2 transition ${\n                mode === 'login'\n                  ? 'bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-slate-100'\n                  : 'text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200'\n              }`}\n            >\n              Einloggen\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setMode('signup')}\n              className={`rounded-full py-2 transition ${\n                mode === 'signup'\n                  ? 'bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-slate-100'\n                  : 'text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200'\n              }`}\n            >\n              Registrieren\n            </button>\n          </div>\n\n          {/* Formular */}\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {/* E-Mail */}\n            <div>\n              <label htmlFor=\"email\" className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">E-Mail</label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                required\n                autoComplete=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                inputSize=\"md\"\n              />\n            </div>\n\n            {/* Passwort */}\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Passwort</label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                required\n                minLength={6}\n                autoComplete={mode === 'login' ? 'current-password' : 'new-password'}\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                inputSize=\"md\"\n                helperText=\"Mindestens 6 Zeichen.\"\n              />\n            </div>\n\n            {/* Fehlermeldung */}\n            {error && (\n              <p className=\"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2\">\n                {error}\n              </p>\n            )}\n\n            {/* Erfolgsmeldung (nur Signup) */}\n            {info && (\n              <p className=\"text-sm text-green-600 bg-green-50 border border-green-100 rounded-lg px-3 py-2\">\n                {info}\n              </p>\n            )}\n\n            {/* Submit */}\n            <button\n              type=\"submit\"\n              disabled={!canSubmit}\n              className=\"w-full rounded-xl bg-sky-600 dark:bg-sky-500 text-white px-4 py-2 font-semibold shadow-sm hover:bg-sky-700 dark:hover:bg-sky-600 disabled:opacity-60 transition\"\n            >\n              {loading\n                ? 'Bitte warten…'\n                : mode === 'signup'\n                ? 'Konto anlegen'\n                : 'Einloggen'}\n            </button>\n          </form>\n        </div>\n      </div>\n    </main>\n  )\n}\n","export type ResolvedUserRole = 'patient' | 'clinician' | 'admin' | 'nurse'\n\nexport function getLandingForRole(role: ResolvedUserRole): string {\n  switch (role) {\n    case 'patient':\n      return '/patient'\n    case 'clinician':\n    case 'nurse':\n      return '/clinician'\n    case 'admin':\n      return '/admin'\n  }\n}\n","import type { ResolvedUserRole } from './roleLanding'\nimport { getLandingForRole } from './roleLanding'\n\nexport type PostLoginRole = ResolvedUserRole | 'unknown'\n\ntype PostLoginRedirectInput = {\n  role: PostLoginRole\n  patientOnboardingPath?: string\n}\n\nexport function getPostLoginRedirect({\n  role,\n  patientOnboardingPath,\n}: PostLoginRedirectInput): string {\n  let target = '/'\n\n  if (role === 'patient') {\n    target = patientOnboardingPath ?? getLandingForRole('patient')\n  } else if (role === 'clinician' || role === 'admin' || role === 'nurse') {\n    target = getLandingForRole(role)\n  }\n\n  console.log(`[AUTH_LANDING] role=${role} target=${target}`)\n\n  return target\n}"],"names":[],"mappings":"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"}