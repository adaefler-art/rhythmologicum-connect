module.exports=[93457,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(5050);let f=(0,e.createServerReference)("4065c67e4958cf201c3bb8de8d8f1709976fb255dc",e.callServer,void 0,e.findSourceMapURL,"saveDocumentConfirmation");var g=a.i(56757);let h=g.z.object({page:g.z.number().optional(),section:g.z.string().optional(),confidence_score:g.z.number().min(0).max(1)}),i=g.z.object({test_name:g.z.string(),value:g.z.union([g.z.number(),g.z.string()]),unit:g.z.string().optional(),reference_range:g.z.string().optional(),date:g.z.string().optional()}),j=g.z.object({name:g.z.string(),dosage:g.z.string().optional(),frequency:g.z.string().optional(),route:g.z.string().optional()}),k=g.z.object({lab_values:g.z.array(i).optional(),medications:g.z.array(j).optional(),vital_signs:g.z.record(g.z.string(),g.z.union([g.z.number(),g.z.string()])).optional(),diagnoses:g.z.array(g.z.string()).optional(),notes:g.z.string().optional()}),l=g.z.object({overall_confidence:g.z.number().min(0).max(1),field_confidence:g.z.record(g.z.string(),g.z.number().min(0).max(1)),evidence:g.z.record(g.z.string(),h),extraction_timestamp:g.z.string()});g.z.object({extractor_version:g.z.string(),input_hash:g.z.string(),extracted_data:k,confidence:l,extracted_at:g.z.string()}),g.z.object({document_id:g.z.string().uuid(),force_reextract:g.z.boolean().optional().default(!1)}),g.z.object({success:g.z.boolean(),data:g.z.object({document_id:g.z.string().uuid(),extractor_version:g.z.string(),input_hash:g.z.string(),extraction_created:g.z.boolean(),extracted_data:k.optional(),confidence:l.optional()}).optional(),error:g.z.object({code:g.z.string(),message:g.z.string()}).optional()});let m="accepted",n=g.z.object({status:g.z.enum(["accepted","edited","rejected"]),original_value:g.z.any().optional(),confirmed_value:g.z.any().optional(),confirmed_at:g.z.string()}),o=g.z.object({lab_values:g.z.array(i).optional(),medications:g.z.array(j).optional(),vital_signs:g.z.record(g.z.string(),g.z.union([g.z.number(),g.z.string()])).optional(),diagnoses:g.z.array(g.z.string()).optional(),notes:g.z.string().optional(),field_confirmations:g.z.record(g.z.string(),n)});function p(a,b=.7){return a<b}function q({documentId:a,initialData:e}){let g=(0,d.useRouter)(),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(null),[l,n]=(0,c.useState)(()=>e.confirmed_data?.field_confirmations?e.confirmed_data.field_confirmations:{}),[o,p]=(0,c.useState)(()=>e.confirmed_data?{lab_values:e.confirmed_data.lab_values,medications:e.confirmed_data.medications,vital_signs:e.confirmed_data.vital_signs,diagnoses:e.confirmed_data.diagnoses,notes:e.confirmed_data.notes}:e.extracted_data),q=(0,c.useCallback)((a,b)=>{n(c=>({...c,[a]:{status:m,original_value:b,confirmed_value:b,confirmed_at:new Date().toISOString()}}))},[]),w=(0,c.useCallback)((a,b,c)=>{n(d=>({...d,[a]:{status:"edited",original_value:b,confirmed_value:c,confirmed_at:new Date().toISOString()}}))},[]),x=(0,c.useCallback)((a,b)=>{n(c=>({...c,[a]:{status:"rejected",original_value:b,confirmed_at:new Date().toISOString()}}))},[]),y=(0,c.useCallback)(()=>{let a={};e.extracted_data.lab_values?.forEach((b,c)=>{a[`lab_values[${c}]`]={status:m,original_value:b,confirmed_value:b,confirmed_at:new Date().toISOString()}}),e.extracted_data.medications?.forEach((b,c)=>{a[`medications[${c}]`]={status:m,original_value:b,confirmed_value:b,confirmed_at:new Date().toISOString()}}),e.extracted_data.vital_signs&&Object.entries(e.extracted_data.vital_signs).sort(([a],[b])=>a.localeCompare(b)).forEach(([b,c])=>{a[`vital_signs.${b}`]={status:m,original_value:c,confirmed_value:c,confirmed_at:new Date().toISOString()}}),e.extracted_data.diagnoses?.forEach((b,c)=>{a[`diagnoses[${c}]`]={status:m,original_value:b,confirmed_value:b,confirmed_at:new Date().toISOString()}}),e.extracted_data.notes&&(a.notes={status:m,original_value:e.extracted_data.notes,confirmed_value:e.extracted_data.notes,confirmed_at:new Date().toISOString()}),n(a)},[e.extracted_data]),z=(0,c.useCallback)(async()=>{i(!0),k(null);try{let b=await f({document_id:a,confirmed_data:{...o,field_confirmations:l}});if(!b.success){k(b.error?.message||"Failed to save confirmation"),i(!1);return}g.push("/patient?confirmation=success")}catch(a){k("An unexpected error occurred"),i(!1)}},[a,o,l,g]),A=a=>e.confidence.field_confidence?.[a],B=Object.keys(l).length>0,C=B&&(e.extracted_data.lab_values?.length||0)+(e.extracted_data.medications?.length||0)+(Object.keys(e.extracted_data.vital_signs||{}).length||0)+(e.extracted_data.diagnoses?.length||0)+ +!!e.extracted_data.notes===Object.keys(l).length;return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"border-b pb-4",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Review Extracted Values"}),(0,b.jsx)("p",{className:"text-gray-600 mt-2",children:"Please review the information extracted from your document and confirm or correct it."}),e.confirmed_at&&(0,b.jsxs)("p",{className:"text-sm text-green-600 mt-2",children:["Last confirmed on ",new Date(e.confirmed_at).toLocaleString()]})]}),j&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:j}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:y,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",disabled:h,children:"Accept All"}),(0,b.jsx)("button",{onClick:z,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",disabled:h||!B,children:h?"Saving...":"Save Confirmations"})]}),e.extracted_data.lab_values&&e.extracted_data.lab_values.length>0&&(0,b.jsx)(r,{labValues:e.extracted_data.lab_values,confirmations:l,getConfidenceScore:A,onAccept:q,onEdit:w,onReject:x}),e.extracted_data.medications&&e.extracted_data.medications.length>0&&(0,b.jsx)(s,{medications:e.extracted_data.medications,confirmations:l,getConfidenceScore:A,onAccept:q,onEdit:w,onReject:x}),e.extracted_data.vital_signs&&Object.keys(e.extracted_data.vital_signs).length>0&&(0,b.jsx)(t,{vitalSigns:e.extracted_data.vital_signs,confirmations:l,getConfidenceScore:A,onAccept:q,onEdit:w,onReject:x}),e.extracted_data.diagnoses&&e.extracted_data.diagnoses.length>0&&(0,b.jsx)(u,{diagnoses:e.extracted_data.diagnoses,confirmations:l,getConfidenceScore:A,onAccept:q,onEdit:w,onReject:x}),e.extracted_data.notes&&(0,b.jsx)(v,{notes:e.extracted_data.notes,confirmations:l,getConfidenceScore:A,onAccept:q,onEdit:w,onReject:x}),B&&(0,b.jsx)("div",{className:"bg-blue-50 border border-blue-200 px-4 py-3 rounded",children:(0,b.jsxs)("p",{className:"text-sm text-blue-700",children:[Object.keys(l).length," field(s) confirmed",C&&" - All fields confirmed!"]})})]})}function r({labValues:a,confirmations:c,getConfidenceScore:d,onAccept:e,onEdit:f,onReject:g}){return(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Lab Values"}),(0,b.jsx)("div",{className:"space-y-3",children:a.map((a,h)=>{let i=`lab_values[${h}]`,j=d(i),k=void 0!==j&&p(j),l=c[i];return(0,b.jsx)(w,{fieldKey:i,label:a.test_name,value:`${a.value}${a.unit?" "+a.unit:""}`,isLowConfidence:k,confidence:j,confirmation:l,onAccept:()=>e(i,a),onEdit:b=>f(i,a,b),onReject:()=>g(i,a)},i)})})]})}function s({medications:a,confirmations:c,getConfidenceScore:d,onAccept:e,onEdit:f,onReject:g}){return(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Medications"}),(0,b.jsx)("div",{className:"space-y-3",children:a.map((a,h)=>{let i=`medications[${h}]`,j=d(i),k=void 0!==j&&p(j),l=c[i],m=`${a.name}${a.dosage?" - "+a.dosage:""}${a.frequency?" ("+a.frequency+")":""}`;return(0,b.jsx)(w,{fieldKey:i,label:"Medication",value:m,isLowConfidence:k,confidence:j,confirmation:l,onAccept:()=>e(i,a),onEdit:b=>f(i,a,b),onReject:()=>g(i,a)},i)})})]})}function t({vitalSigns:a,confirmations:c,getConfidenceScore:d,onAccept:e,onEdit:f,onReject:g}){let h=Object.entries(a).sort(([a],[b])=>a.localeCompare(b));return(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Vital Signs"}),(0,b.jsx)("div",{className:"space-y-3",children:h.map(([a,h])=>{let i=`vital_signs.${a}`,j=d(i),k=void 0!==j&&p(j),l=c[i];return(0,b.jsx)(w,{fieldKey:i,label:a.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),value:String(h),isLowConfidence:k,confidence:j,confirmation:l,onAccept:()=>e(i,h),onEdit:a=>f(i,h,a),onReject:()=>g(i,h)},i)})})]})}function u({diagnoses:a,confirmations:c,getConfidenceScore:d,onAccept:e,onEdit:f,onReject:g}){return(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Diagnoses"}),(0,b.jsx)("div",{className:"space-y-3",children:a.map((a,h)=>{let i=`diagnoses[${h}]`,j=d(i),k=void 0!==j&&p(j),l=c[i];return(0,b.jsx)(w,{fieldKey:i,label:"Diagnosis",value:a,isLowConfidence:k,confidence:j,confirmation:l,onAccept:()=>e(i,a),onEdit:b=>f(i,a,b),onReject:()=>g(i,a)},i)})})]})}function v({notes:a,confirmations:c,getConfidenceScore:d,onAccept:e,onEdit:f,onReject:g}){let h="notes",i=d(h),j=void 0!==i&&p(i),k=c[h];return(0,b.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Notes"}),(0,b.jsx)(w,{fieldKey:h,label:"Additional Notes",value:a,isLowConfidence:j,confidence:i,confirmation:k,onAccept:()=>e(h,a),onEdit:b=>f(h,a,b),onReject:()=>g(h,a),multiline:!0})]})}function w({fieldKey:a,label:d,value:e,isLowConfidence:f,confidence:g,confirmation:h,onAccept:i,onEdit:j,onReject:k,multiline:l=!1}){let[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(e),q=h?.status,r=f?"bg-yellow-50 border-yellow-300":"accepted"===q?"bg-green-50 border-green-300":"edited"===q?"bg-blue-50 border-blue-300":"rejected"===q?"bg-red-50 border-red-300":"bg-white border-gray-300";return(0,b.jsxs)("div",{className:`border rounded p-3 ${r}`,children:[(0,b.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium text-sm text-gray-700",children:d}),void 0!==g&&(0,b.jsxs)("span",{className:`text-xs px-2 py-0.5 rounded ${f?"bg-yellow-200 text-yellow-800":"bg-green-200 text-green-800"}`,children:[Math.round(100*g),"% confidence"]})]}),!m&&(0,b.jsx)("div",{className:"mt-1 text-gray-900",children:l?(0,b.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-sm",children:e}):(0,b.jsx)("span",{className:"text-sm",children:e})}),m&&(0,b.jsxs)("div",{className:"mt-2",children:[l?(0,b.jsx)("textarea",{value:o,onChange:a=>p(a.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",rows:4}):(0,b.jsx)("input",{type:"text",value:o,onChange:a=>p(a.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"}),(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)("button",{onClick:()=>{j(o),n(!1)},className:"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Save"}),(0,b.jsx)("button",{onClick:()=>{p(e),n(!1)},className:"px-3 py-1 bg-gray-300 text-gray-700 text-xs rounded hover:bg-gray-400",children:"Cancel"})]})]}),q&&!m&&(0,b.jsxs)("div",{className:"mt-1 text-xs text-gray-600",children:["Status: ",q.charAt(0).toUpperCase()+q.slice(1)]})]})}),!m&&!q&&(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)("button",{onClick:i,className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"Accept"}),(0,b.jsx)("button",{onClick:()=>n(!0),className:"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Edit"}),(0,b.jsx)("button",{onClick:k,className:"px-3 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700",children:"Not Applicable"})]})]})}g.z.object({document_id:g.z.string().uuid(),confirmed_data:o}),g.z.object({success:g.z.boolean(),data:g.z.object({document_id:g.z.string().uuid(),confirmed_at:g.z.string()}).optional(),error:g.z.object({code:g.z.string(),message:g.z.string()}).optional()}),a.s(["default",()=>q],93457)}];

//# sourceMappingURL=apps_rhythm-patient-ui_app_patient_documents_%5Bid%5D_confirm_client_tsx_ef25dc61._.js.map