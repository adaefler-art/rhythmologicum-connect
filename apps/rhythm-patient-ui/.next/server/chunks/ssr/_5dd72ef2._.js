module.exports=[77598,a=>{"use strict";let b={STRESS_ASSESSMENT:"stress-assessment",CARDIOVASCULAR_AGE:"cardiovascular-age",SLEEP_QUALITY:"sleep-quality",HEART_HEALTH_NUTRITION:"heart-health-nutrition",STRESS:"stress",STRESS_CHECK:"stress-check",STRESS_CHECK_V2:"stress-check-v2"},c={stress:b.STRESS_ASSESSMENT,"stress-check":b.STRESS_ASSESSMENT,"stress-check-v2":b.STRESS_ASSESSMENT};function d(a){let b=a.toLowerCase().trim();return c[b]||b}function e(a){let c=d(a);return Object.values(b).includes(c)}a.s(["AUDIT_ACTION",0,{CREATE:"create",UPDATE:"update",DELETE:"delete",APPROVE:"approve",REJECT:"reject",REQUEST_CHANGES:"request_changes",GENERATE:"generate",FLAG:"flag",ASSIGN:"assign",ACTIVATE:"activate",DEACTIVATE:"deactivate",ROLLOUT:"rollout",COMPLETE:"complete",ESCALATE:"escalate",DELETION_REQUEST:"deletion_request",DELETION_CANCEL:"deletion_cancel",DELETION_EXECUTE:"deletion_execute",ANONYMIZE:"anonymize"},"AUDIT_ENTITY_TYPE",0,{ASSESSMENT:"assessment",REPORT:"report",TASK:"task",FUNNEL_VERSION:"funnel_version",FUNNEL_CATALOG:"funnel_catalog",CONFIG:"config",CONSENT:"consent",ORGANIZATION:"organization",USER_ORG_MEMBERSHIP:"user_org_membership",CLINICIAN_ASSIGNMENT:"clinician_assignment",DOCUMENT:"document",PROCESSING_JOB:"processing_job",REVIEW_RECORD:"review_record",PRE_SCREENING_CALL:"pre_screening_call",DEVICE_SHIPMENT:"device_shipment",SUPPORT_CASE:"support_case",ACCOUNT:"account"},"AUDIT_SOURCE",0,{API:"api",JOB:"job",ADMIN_UI:"admin-ui",SYSTEM:"system"},"FUNNEL_SLUG_ALIASES",0,c,"PATIENT_SEX",0,{MALE:"male",FEMALE:"female",OTHER:"other",PREFER_NOT_TO_SAY:"prefer_not_to_say"},"QUESTION_TYPE",0,{RADIO:"radio",CHECKBOX:"checkbox",TEXT:"text",TEXTAREA:"textarea",NUMBER:"number",SCALE:"scale",SLIDER:"slider"},"getCanonicalFunnelSlug",()=>d,"isKnownFunnelSlug",()=>e])},37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},28916,30382,a=>{"use strict";var b=a.i(45618),c=a.i(7779);let d=["request_id","correlation_id","algorithm_version","prompt_version","report_version","version","safety_score","finding_count","status_from","status_to","assigned_to_role","reason","consent_type","granted","rollout_percent","rollout_percent_from","rollout_percent_to","is_active","assessment_id","report_id","task_id","funnel_id","version_id","consent_id","config_key","consent_version","profile_updated","review_id","job_id","decision_reason","has_notes","deletion_reason","scheduled_for","retention_period_days","records_deleted","records_anonymized","executed_by","anonymization_reason","kpi_event","funnel_slug","drop_off_reason","current_step_id","step_order_index","duration_seconds","duration_before_drop_seconds","started_at","completed_at","time_to_report_seconds","report_created_at","error_type"],e=["content","text","notes","answers","answer","response","extracted_data","clinical_notes","patient_notes","observation","diagnosis","medication","name","email","phone","address","ssn","dob","date_of_birth"];function f(a,b=5e3){if(!a||"object"!=typeof a)return{};let c={},g=0;for(let[h,i]of Object.entries(a)){let a=h.toLowerCase();if(e.some(b=>a.includes(b))){c[h]="[REDACTED]";continue}let j=d.includes(h);if("number"==typeof i||"boolean"==typeof i)c[h]=i,g+=String(i).length;else if("string"==typeof i){let b=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(i),d=i.length<=100&&!/[<>{}]/.test(i);j||b||d&&a.includes("id")?(c[h]=i,g+=i.length):c[h]="[REDACTED]"}else null==i?c[h]=i:"object"!=typeof i||Array.isArray(i)?c[h]="[REDACTED]":(c[h]=f(i,b-g),g+=JSON.stringify(c[h]).length);if(g>b){console.warn("[audit/log] Metadata/diff size exceeded limit, truncating");break}}return c}async function g(a){Date.now();try{let d,e;if(!a.entity_type)return{success:!1,error:"entity_type is required"};if(!a.entity_id)return{success:!1,error:"entity_id is required"};if(!a.action)return{success:!1,error:"action is required"};if(!a.source)return{success:!1,error:"source is required"};let g=(d=c.env.NEXT_PUBLIC_SUPABASE_URL||c.env.SUPABASE_URL,e=c.env.SUPABASE_SERVICE_ROLE_KEY||c.env.SUPABASE_SERVICE_KEY,d&&e?(0,b.createClient)(d,e,{auth:{persistSession:!1}}):(console.error("[audit/log] Missing Supabase credentials"),null));if(!g)return console.error("[audit/log] Cannot create Supabase client"),{success:!1,error:"Supabase client unavailable"};let h=f(a.metadata||{}),i={};a.diff?.before&&(i.before=f(a.diff.before)),a.diff?.after&&(i.after=f(a.diff.after)),a.diff?.changes&&(i.changes=f(a.diff.changes));let j={org_id:a.org_id||null,actor_user_id:a.actor_user_id||null,actor_role:a.actor_role||null,source:a.source,entity_type:a.entity_type,entity_id:a.entity_id,action:a.action,diff:i||{},metadata:h||{}},{data:k,error:l}=await g.from("audit_log").insert(j).select("id").single();if(l)return console.error("[audit/log] Failed to insert audit event",{error:l,entity_type:a.entity_type,entity_id:a.entity_id,action:a.action}),{success:!1,error:l.message};return Date.now(),{success:!0,audit_id:k.id}}catch(a){return console.error("[audit/log] Unexpected error logging audit event",a),{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}a.s(["logAuditEvent",()=>g],30382),a.s([],28916)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},64768,a=>{"use strict";var b=a.i(37936),c=a.i(91896),d=a.i(53112);let e=d.z.object({page:d.z.number().optional(),section:d.z.string().optional(),confidence_score:d.z.number().min(0).max(1)}),f=d.z.object({test_name:d.z.string(),value:d.z.union([d.z.number(),d.z.string()]),unit:d.z.string().optional(),reference_range:d.z.string().optional(),date:d.z.string().optional()}),g=d.z.object({name:d.z.string(),dosage:d.z.string().optional(),frequency:d.z.string().optional(),route:d.z.string().optional()}),h=d.z.object({lab_values:d.z.array(f).optional(),medications:d.z.array(g).optional(),vital_signs:d.z.record(d.z.string(),d.z.union([d.z.number(),d.z.string()])).optional(),diagnoses:d.z.array(d.z.string()).optional(),notes:d.z.string().optional()}),i=d.z.object({overall_confidence:d.z.number().min(0).max(1),field_confidence:d.z.record(d.z.string(),d.z.number().min(0).max(1)),evidence:d.z.record(d.z.string(),e),extraction_timestamp:d.z.string()});d.z.object({extractor_version:d.z.string(),input_hash:d.z.string(),extracted_data:h,confidence:i,extracted_at:d.z.string()}),d.z.object({document_id:d.z.string().uuid(),force_reextract:d.z.boolean().optional().default(!1)}),d.z.object({success:d.z.boolean(),data:d.z.object({document_id:d.z.string().uuid(),extractor_version:d.z.string(),input_hash:d.z.string(),extraction_created:d.z.boolean(),extracted_data:h.optional(),confidence:i.optional()}).optional(),error:d.z.object({code:d.z.string(),message:d.z.string()}).optional()});let j=d.z.object({status:d.z.enum(["accepted","edited","rejected"]),original_value:d.z.any().optional(),confirmed_value:d.z.any().optional(),confirmed_at:d.z.string()}),k=d.z.object({lab_values:d.z.array(f).optional(),medications:d.z.array(g).optional(),vital_signs:d.z.record(d.z.string(),d.z.union([d.z.number(),d.z.string()])).optional(),diagnoses:d.z.array(d.z.string()).optional(),notes:d.z.string().optional(),field_confirmations:d.z.record(d.z.string(),j)}),l=d.z.object({document_id:d.z.string().uuid(),confirmed_data:k});d.z.object({success:d.z.boolean(),data:d.z.object({document_id:d.z.string().uuid(),confirmed_at:d.z.string()}).optional(),error:d.z.object({code:d.z.string(),message:d.z.string()}).optional()}),a.i(28916);var m=a.i(30382),n=a.i(77598);async function o(){let a=await (0,c.createServerSupabaseClient)(),{data:{user:b},error:d}=await a.auth.getUser();return d||!b?{supabase:null,user:null,error:"Not authenticated"}:{supabase:a,user:b,error:null}}async function p(a,b,c){let{data:d,error:e}=await a.from("documents").select(`
      id,
      assessment_id,
      assessments:assessment_id (
        id,
        patient_id
      )
    `).eq("id",b).single();if(e||!d)return{valid:!1,error:"Document not found"};let f=d.assessments;return f&&f.patient_id===c?{valid:!0}:{valid:!1,error:"Not authorized to confirm this document"}}async function q(a){try{let{supabase:b,user:c,error:d}=await o();if(d||!b||!c)return{success:!1,error:{code:"AUTHENTICATION_REQUIRED",message:"You must be logged in to confirm documents"}};let e=l.safeParse(a);if(!e.success){let a=e.error.issues[0];return{success:!1,error:{code:"VALIDATION_ERROR",message:a?.message||"Invalid confirmation data"}}}let{document_id:f,confirmed_data:g}=e.data,h=await p(b,f,c.id);if(!h.valid)return{success:!1,error:{code:"AUTHORIZATION_FAILED",message:h.error||"Not authorized"}};let{data:i,error:j}=await b.from("documents").update({confirmed_data:g,confirmed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",f).select("id, confirmed_at").single();if(j||!i)return console.error("[saveDocumentConfirmation] Update failed",{documentId:f,errorCode:j?.code}),{success:!1,error:{code:"UPDATE_FAILED",message:"Failed to save confirmation"}};return await (0,m.logAuditEvent)({source:n.AUDIT_SOURCE.API,entity_type:n.AUDIT_ENTITY_TYPE.DOCUMENT,entity_id:f,action:n.AUDIT_ACTION.UPDATE,actor_user_id:c.id,metadata:{operation:"confirmation_saved",field_count:Object.keys(g.field_confirmations||{}).length,has_edits:Object.values(g.field_confirmations||{}).some(a=>"edited"===a.status),has_rejections:Object.values(g.field_confirmations||{}).some(a=>"rejected"===a.status)}}),{success:!0,data:{document_id:i.id,confirmed_at:i.confirmed_at||new Date().toISOString()}}}catch(a){return console.error("[saveDocumentConfirmation] Unexpected error",{operation:"confirmation_save"}),{success:!1,error:{code:"INTERNAL_ERROR",message:"An unexpected error occurred"}}}}async function r(a){try{let{supabase:b,user:c,error:d}=await o();if(d||!b||!c)return{success:!1,error:{code:"AUTHENTICATION_REQUIRED",message:"You must be logged in to view documents"}};let e=await p(b,a,c.id);if(!e.valid)return{success:!1,error:{code:"AUTHORIZATION_FAILED",message:e.error||"Not authorized"}};let{data:f,error:g}=await b.from("documents").select("id, extracted_json, confidence_json, confirmed_data, confirmed_at").eq("id",a).single();if(g||!f)return{success:!1,error:{code:"NOT_FOUND",message:"Document not found"}};return{success:!0,data:{id:f.id,extracted_data:f.extracted_json||{},confidence:f.confidence_json||{},confirmed_data:f.confirmed_data||{},confirmed_at:f.confirmed_at}}}catch(a){return console.error("[getDocumentForConfirmation] Unexpected error",{operation:"fetch_document"}),{success:!1,error:{code:"INTERNAL_ERROR",message:"An unexpected error occurred"}}}}(0,a.i(13095).ensureServerEntryExports)([q,r]),(0,b.registerServerReference)(q,"4065c67e4958cf201c3bb8de8d8f1709976fb255dc",null),(0,b.registerServerReference)(r,"40526a4f570ee7fdba825413bab4ff94dd11505ebc",null),a.s(["getDocumentForConfirmation",()=>r,"saveDocumentConfirmation",()=>q],64768)},88779,a=>{"use strict";var b=a.i(64768);a.s([],40136),a.i(40136),a.s(["40526a4f570ee7fdba825413bab4ff94dd11505ebc",()=>b.getDocumentForConfirmation,"4065c67e4958cf201c3bb8de8d8f1709976fb255dc",()=>b.saveDocumentConfirmation],88779)}];

//# sourceMappingURL=_5dd72ef2._.js.map