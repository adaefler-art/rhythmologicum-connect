module.exports=[60350,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(53547);var d=a.i(28914),e=a.i(50944);a.i(59620);var f=a.i(92118),g=a.i(98595);function h(a){switch(a){case"patient":return"/patient";case"clinician":case"nurse":return"/clinician";case"admin":return"/admin"}}function i({role:a,patientOnboardingPath:b}){let c="/";return"patient"===a?c=b??h("patient"):("clinician"===a||"admin"===a||"nurse"===a)&&(c=h(a)),c}async function j(){let{data:a}=await d.supabase.auth.getSession(),b=a.session;b&&await fetch("/api/auth/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"SIGNED_IN",session:b})})}async function k(){try{let a=await fetch("/api/auth/resolve-role",{method:"GET"});if(401===a.status)return{kind:"unauthenticated"};if(!a.ok)return{kind:"fallback_patient"};let b=await a.json();if(!b||"object"!=typeof b)return{kind:"fallback_patient"};let c=b.data;if(!c||"object"!=typeof c)return{kind:"fallback_patient"};let d=c.role,e=c.requiresOnboarding,f=c.reason;if("patient"===d||"clinician"===d||"admin"===d||"nurse"===d)return{kind:"ok",value:{role:d,requiresOnboarding:!0===e,reason:f}};return{kind:"fallback_patient"}}catch{return{kind:"fallback_patient"}}}async function l(){try{let a=await fetch("/api/patient/onboarding-status",{method:"GET",cache:"no-store"});if(401===a.status)return{kind:"unauthenticated"};if(!a.ok)return{kind:"fallback"};let b=await a.json();if(!b||"object"!=typeof b||!("success"in b)||!0!==b.success)return{kind:"fallback"};if(b.data.needsConsent)return{kind:"ok",path:"/patient/onboarding/consent"};if(b.data.needsProfile)return{kind:"ok",path:"/patient/onboarding/profile"};return{kind:"fallback"}}catch{return{kind:"fallback"}}}async function m(a){if("patient"===a){let b=await l();if("unauthenticated"===b.kind)return null;if("ok"===b.kind)return i({role:a,patientOnboardingPath:b.path})}return i({role:a})}function n(){let a=(0,e.useRouter)(),[h,i]=(0,c.useState)(""),[l,n]=(0,c.useState)(""),[o,p]=(0,c.useState)("login"),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(null);(0,c.useEffect)(()=>{(async()=>{let{data:{user:b}}=await d.supabase.auth.getUser();if(b){await j();let b=await k();if("unauthenticated"===b.kind)return;let c="fallback_patient"===b.kind?"patient":b.value.role,d=await m(c);d&&a.replace(d)}})()},[a]),(0,c.useEffect)(()=>{let{data:{subscription:a}}=d.supabase.auth.onAuthStateChange(async(a,b)=>{await fetch("/api/auth/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:a,session:b})})});return()=>a.unsubscribe()},[]),(0,c.useEffect)(()=>{fetch("/version.json").then(a=>{if(!a.ok)throw Error(`HTTP error! status: ${a.status}`);return a.json()}).then(a=>{a&&"string"==typeof a.commitHashShort&&"string"==typeof a.commitDate&&x(a)}).catch(a=>console.error("Failed to load version info:",a))},[]),(0,c.useEffect)(()=>{let a=new URLSearchParams(window.location.search),b=a.get("error"),c=a.get("message");b&&c&&(t(c),window.history.replaceState({},"","/"))},[]);let y=async b=>{b.preventDefault(),t(null),v(null);let c=h.trim(),e=l.trim();if(!c||!e)return void t("Bitte E-Mail und Passwort eingeben.");r(!0);try{if("signup"===o){let{error:a}=await d.supabase.auth.signUp({email:c,password:e});if(a)throw a;v("Ihr Konto wurde angelegt. Bitte prüfen Sie Ihre E-Mails, um Ihre Adresse zu bestätigen.");return}{let{error:a}=await d.supabase.auth.signInWithPassword({email:c,password:e});if(a)throw a}await j();let{data:{user:b},error:f}=await d.supabase.auth.getUser();if(f)throw f;if(!b)throw Error("Kein Benutzerprofil gefunden.");let g=await k();if("unauthenticated"===g.kind)return void t("Bitte einloggen.");let h="fallback_patient"===g.kind?"patient":g.value.role,i=await m(h);if(!i)return void t("Bitte einloggen.");a.replace(i)}catch(a){console.error(a),t(a?.message??a?.error_description??"Es ist ein unerwarteter Fehler aufgetreten.")}finally{r(!1)}},z=""!==h.trim()&&""!==l.trim()&&!q;return(0,b.jsxs)("main",{className:"min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-900 px-4 py-10 transition-colors duration-150 relative",children:[(0,b.jsx)("div",{className:"absolute top-4 right-4",children:(0,b.jsx)(f.ThemeToggle,{size:"md"})}),(0,b.jsxs)("div",{className:"w-full max-w-5xl flex flex-col md:flex-row items-stretch gap-8",children:[(0,b.jsxs)("div",{className:"w-full md:w-[420px] rounded-3xl bg-white/80 dark:bg-slate-800/80 backdrop-blur p-8 shadow-lg transition-colors duration-150",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl sm:text-5xl font-bold tracking-tight text-sky-600 dark:text-sky-400",children:"RHYTHM"}),(0,b.jsx)("h2",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-slate-900 dark:text-slate-100",children:"Rhythmologicum Connect"})]}),(0,b.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed",children:"Willkommen! Dieser Bereich dient dem sicheren Zugang zu Ihrem persönlichen Stress- & Resilienz-Programm."}),(0,b.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed",children:"Ihre Angaben werden vertraulich behandelt und ausschließlich zur Durchführung Ihrer Stress- & Resilienz-Analyse genutzt."}),(0,b.jsx)("a",{href:"/datenschutz",className:"inline-flex text-sm font-medium text-sky-700 dark:text-sky-400 hover:text-sky-800 dark:hover:text-sky-300",children:"Datenschutz & Datennutzung"})]}),w&&(0,b.jsxs)("div",{className:"mt-6 pt-4 border-t border-slate-100 dark:border-slate-700 text-sm text-slate-500 dark:text-slate-400 space-y-1",children:[(0,b.jsxs)("p",{children:["Version: ",(0,b.jsx)("span",{className:"font-mono",children:w.commitHashShort})]}),(0,b.jsx)("p",{children:new Date(w.commitDate).toLocaleString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]})]}),(0,b.jsxs)("div",{className:"flex-1 rounded-3xl bg-white dark:bg-slate-800 p-8 shadow-lg transition-colors duration-150",children:[(0,b.jsxs)("div",{className:"mb-6 grid grid-cols-2 rounded-full bg-slate-100 dark:bg-slate-700 p-1 text-sm font-medium",children:[(0,b.jsx)("button",{type:"button",onClick:()=>p("login"),className:`rounded-full py-2 transition ${"login"===o?"bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-slate-100":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:"Einloggen"}),(0,b.jsx)("button",{type:"button",onClick:()=>p("signup"),className:`rounded-full py-2 transition ${"signup"===o?"bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-slate-100":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:"Registrieren"})]}),(0,b.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"E-Mail"}),(0,b.jsx)(g.Input,{id:"email",type:"email",required:!0,autoComplete:"email",value:h,onChange:a=>i(a.target.value),inputSize:"md"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Passwort"}),(0,b.jsx)(g.Input,{id:"password",type:"password",required:!0,minLength:6,autoComplete:"login"===o?"current-password":"new-password",value:l,onChange:a=>n(a.target.value),inputSize:"md",helperText:"Mindestens 6 Zeichen."})]}),s&&(0,b.jsx)("p",{className:"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2",children:s}),u&&(0,b.jsx)("p",{className:"text-sm text-green-600 bg-green-50 border border-green-100 rounded-lg px-3 py-2",children:u}),(0,b.jsx)("button",{type:"submit",disabled:!z,className:"w-full rounded-xl bg-sky-600 dark:bg-sky-500 text-white px-4 py-2 font-semibold shadow-sm hover:bg-sky-700 dark:hover:bg-sky-600 disabled:opacity-60 transition",children:q?"Bitte warten…":"signup"===o?"Konto anlegen":"Einloggen"})]})]})]})]})}a.s(["default",()=>n],60350)}];

//# sourceMappingURL=app_page_tsx_55b2e5ee._.js.map