module.exports=[23174,a=>{a.n(a.i(6429))},4344,a=>{a.n(a.i(92184))},69572,a=>{a.n(a.i(70457))},91050,a=>{a.n(a.i(13800))},13718,a=>{a.n(a.i(85523))},18198,a=>{a.n(a.i(45518))},68297,a=>{a.n(a.i(10871))},19349,a=>{a.n(a.i(21496))},38650,a=>{a.n(a.i(5617))},77598,a=>{"use strict";let b={STRESS_ASSESSMENT:"stress-assessment",CARDIOVASCULAR_AGE:"cardiovascular-age",SLEEP_QUALITY:"sleep-quality",HEART_HEALTH_NUTRITION:"heart-health-nutrition",STRESS:"stress",STRESS_CHECK:"stress-check",STRESS_CHECK_V2:"stress-check-v2"},c={stress:b.STRESS_ASSESSMENT,"stress-check":b.STRESS_ASSESSMENT,"stress-check-v2":b.STRESS_ASSESSMENT};function d(a){let b=a.toLowerCase().trim();return c[b]||b}function e(a){let c=d(a);return Object.values(b).includes(c)}a.s(["AUDIT_ACTION",0,{CREATE:"create",UPDATE:"update",DELETE:"delete",APPROVE:"approve",REJECT:"reject",REQUEST_CHANGES:"request_changes",GENERATE:"generate",FLAG:"flag",ASSIGN:"assign",ACTIVATE:"activate",DEACTIVATE:"deactivate",ROLLOUT:"rollout",COMPLETE:"complete",ESCALATE:"escalate",DELETION_REQUEST:"deletion_request",DELETION_CANCEL:"deletion_cancel",DELETION_EXECUTE:"deletion_execute",ANONYMIZE:"anonymize"},"AUDIT_ENTITY_TYPE",0,{ASSESSMENT:"assessment",REPORT:"report",TASK:"task",FUNNEL_VERSION:"funnel_version",FUNNEL_CATALOG:"funnel_catalog",CONFIG:"config",CONSENT:"consent",ORGANIZATION:"organization",USER_ORG_MEMBERSHIP:"user_org_membership",CLINICIAN_ASSIGNMENT:"clinician_assignment",DOCUMENT:"document",PROCESSING_JOB:"processing_job",REVIEW_RECORD:"review_record",PRE_SCREENING_CALL:"pre_screening_call",DEVICE_SHIPMENT:"device_shipment",SUPPORT_CASE:"support_case",ACCOUNT:"account"},"AUDIT_SOURCE",0,{API:"api",JOB:"job",ADMIN_UI:"admin-ui",SYSTEM:"system"},"FUNNEL_SLUG_ALIASES",0,c,"PATIENT_SEX",0,{MALE:"male",FEMALE:"female",OTHER:"other",PREFER_NOT_TO_SAY:"prefer_not_to_say"},"QUESTION_TYPE",0,{RADIO:"radio",CHECKBOX:"checkbox",TEXT:"text",TEXTAREA:"textarea",NUMBER:"number",SCALE:"scale",SLIDER:"slider"},"getCanonicalFunnelSlug",()=>d,"isKnownFunnelSlug",()=>e])},53196,a=>{"use strict";var b=a.i(45618),c=a.i(7779);let d=null;new Proxy({},{get:(a,e)=>(!d&&(d=function(){let a=c.env.NEXT_PUBLIC_SUPABASE_URL,d=c.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!a||!d)throw Error("Missing env: NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY");return(0,b.createClient)(a,d,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}()),d)[e]});var e=a.i(53112),f=a.i(77598);let g=["http:","https:","mailto:","tel:"];function h(a,b=!1){if(!a||"string"!=typeof a||a.length>2048)return!1;let c=a.trim().toLowerCase();if(0===c.length)return!1;for(let a of["javascript:","vbscript:","file:","about:"])if(c.startsWith(a))return!1;if(c.startsWith("data:"))return b;if(c.startsWith("/")||c.startsWith("./")||c.startsWith("../"))return!0;try{let b=new URL(a);return g.includes(b.protocol)}catch{return!c.includes(":")}}let i=e.z.preprocess(a=>null===a?void 0:a,e.z.string().optional()).optional(),j=e.z.string().refine(a=>!a||""===a.trim()||h(a,!1),{message:"URL must use http:, https:, mailto:, tel:, or be a relative path. Dangerous protocols (javascript:, data:, vbscript:, file:) are not allowed."}),k=e.z.object({required:e.z.boolean().optional(),min:e.z.number().optional(),max:e.z.number().optional(),pattern:e.z.string().optional(),message:e.z.string().optional()}),l=e.z.object({value:e.z.string(),label:e.z.string(),helpText:i}),m=e.z.object({id:e.z.string(),key:e.z.string(),type:e.z.preprocess(function(a){if("string"!=typeof a)return a;let b=a.toLowerCase().trim();return Object.values(f.QUESTION_TYPE).includes(b)?b:({single_choice:f.QUESTION_TYPE.RADIO,"single-choice":f.QUESTION_TYPE.RADIO,select_one:f.QUESTION_TYPE.RADIO,"select-one":f.QUESTION_TYPE.RADIO,multiple_choice:f.QUESTION_TYPE.RADIO,multi_choice:f.QUESTION_TYPE.CHECKBOX,"multi-choice":f.QUESTION_TYPE.CHECKBOX,select_many:f.QUESTION_TYPE.CHECKBOX,"select-many":f.QUESTION_TYPE.CHECKBOX,multiple_select:f.QUESTION_TYPE.CHECKBOX,"multiple-select":f.QUESTION_TYPE.CHECKBOX,short_text:f.QUESTION_TYPE.TEXT,"short-text":f.QUESTION_TYPE.TEXT,string:f.QUESTION_TYPE.TEXT,long_text:f.QUESTION_TYPE.TEXTAREA,"long-text":f.QUESTION_TYPE.TEXTAREA,paragraph:f.QUESTION_TYPE.TEXTAREA,integer:f.QUESTION_TYPE.NUMBER,float:f.QUESTION_TYPE.NUMBER,decimal:f.QUESTION_TYPE.NUMBER,likert:f.QUESTION_TYPE.SCALE,likert_scale:f.QUESTION_TYPE.SCALE,"likert-scale":f.QUESTION_TYPE.SCALE,rating:f.QUESTION_TYPE.SCALE,range:f.QUESTION_TYPE.SLIDER})[b]??b},e.z.enum([f.QUESTION_TYPE.RADIO,f.QUESTION_TYPE.CHECKBOX,f.QUESTION_TYPE.TEXT,f.QUESTION_TYPE.TEXTAREA,f.QUESTION_TYPE.NUMBER,f.QUESTION_TYPE.SCALE,f.QUESTION_TYPE.SLIDER])),label:e.z.string(),helpText:i,required:e.z.boolean().default(!1),options:e.z.array(l).optional(),validation:k.optional(),minValue:e.z.number().optional(),maxValue:e.z.number().optional()}),n=e.z.object({type:e.z.enum(["show","hide","skip"]),conditions:e.z.array(e.z.object({questionId:e.z.string(),operator:e.z.enum(["eq","neq","gt","gte","lt","lte","in","notIn"]),value:e.z.union([e.z.string(),e.z.number(),e.z.boolean(),e.z.array(e.z.string())])})),logic:e.z.enum(["and","or"]).default("and")}),o=e.z.object({id:e.z.string(),title:e.z.string(),description:e.z.string().optional(),questions:e.z.array(m),conditionalLogic:n.optional()}),p=e.z.object({version:e.z.string().default("1.0"),steps:e.z.array(o),conditionalLogic:e.z.array(n).optional(),metadata:e.z.record(e.z.string(),e.z.any()).optional()}),q=e.z.object({key:e.z.string().min(1).max(200),type:e.z.enum(["hero","text","image","video","markdown","cta","divider"]),contentRef:e.z.string().max(2048).optional(),content:e.z.record(e.z.string(),e.z.any()).optional(),orderIndex:e.z.number().int().nonnegative().optional()}).strict().refine(a=>!a.content||(!("href"in a.content)||"string"!=typeof a.content.href||!!h(a.content.href,!1))&&(!("url"in a.content)||"string"!=typeof a.content.url||!!h(a.content.url,!1))&&(!("backgroundImage"in a.content)||"string"!=typeof a.content.backgroundImage||!a.content.backgroundImage||!!h(a.content.backgroundImage,!1)),{message:"Content URLs must use safe protocols (http:, https:, mailto:, tel:, or relative paths). Dangerous protocols (javascript:, data:, vbscript:, file:) are not allowed."}),r=e.z.object({slug:e.z.string().min(1).max(200).regex(/^[a-z0-9-]+$/,"Slug must be lowercase alphanumeric with hyphens"),title:e.z.string().min(1).max(500),description:e.z.string().max(2e3).optional(),sections:e.z.array(q).max(100),metadata:e.z.record(e.z.string(),e.z.any()).optional()}).strict(),s=e.z.object({version:e.z.string().max(20).default("1.0"),pages:e.z.array(r).max(50),assets:e.z.array(e.z.object({key:e.z.string().min(1).max(200),type:e.z.enum(["image","video","audio","document"]),url:j.min(1).max(2048),metadata:e.z.record(e.z.string(),e.z.any()).optional()}).strict()).max(200).optional(),metadata:e.z.record(e.z.string(),e.z.any()).optional()}).strict(),t=e.z.object({questionnaire_config:p,content_manifest:s,algorithm_bundle_version:e.z.string(),prompt_version:e.z.string()});class u extends Error{constructor(a){super(`Funnel not found: ${a}`),this.name="FunnelNotFoundError"}}class v extends Error{constructor(a,b){super(b?`Funnel version not found: ${a}@${b}`:`No default version found for funnel: ${a}`),this.name="FunnelVersionNotFoundError"}}class w extends Error{cause;constructor(a,b){super(`Manifest validation failed: ${a}`),this.cause=b,this.name="ManifestValidationError"}}async function x(a,b){try{let{data:{user:c}}=await a.auth.getUser();if(!c)return null;let{data:d,error:e}=await a.from("patient_profiles").select("id").eq("user_id",c.id).single();if(e||!d)return null;let{data:f}=await a.from("patient_funnels").select("active_version_id").eq("patient_id",d.id).eq("funnel_id",b).order("updated_at",{ascending:!1}).order("created_at",{ascending:!1}).limit(1).maybeSingle();return f?.active_version_id??null}catch{return null}}async function y(a,b){let c=(0,f.getCanonicalFunnelSlug)(b),{data:d,error:e}=await a.from("funnels_catalog").select("id, slug, title, pillar_id, description, is_active, default_version_id").eq("slug",c).single();return e||!d?null:{id:d.id,slug:d.slug,title:d.title,pillarId:d.pillar_id,description:d.description,isActive:d.is_active,defaultVersionId:d.default_version_id}}async function z(a,b){let{data:c,error:d}=await a.from("funnel_versions").select("*").eq("id",b).single();if(d||!c)throw new v(b);return function(a){try{var b,c;let d=(b=a.questionnaire_config,p.parse(b)),e=(c=a.content_manifest,s.parse(c)),f={questionnaire_config:d,content_manifest:e,algorithm_bundle_version:a.algorithm_bundle_version,prompt_version:a.prompt_version};return t.parse(f),{id:a.id,funnelId:a.funnel_id,version:a.version,manifest:f,isDefault:a.is_default,rolloutPercent:a.rollout_percent,createdAt:a.created_at,updatedAt:a.updated_at}}catch(a){if(a instanceof Error)throw new w(a.message,a);throw new w("Unknown validation error",a)}}(c)}async function A(a,b){let c=await y(a,b);if(!c)throw new u(b);let d=await x(a,c.id)??c.defaultVersionId;if(!d)throw new v(c.id);return z(a,d)}a.s(["FunnelNotFoundError",()=>u,"FunnelVersionNotFoundError",()=>v,"ManifestValidationError",()=>w,"loadFunnelVersionWithClient",()=>A],53196)},43723,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/apps/rhythm-patient-ui/app/patient/funnel/[slug]/content/[pageSlug]/client.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/rhythm-patient-ui/app/patient/funnel/[slug]/content/[pageSlug]/client.tsx <module evaluation>","default")},27078,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/apps/rhythm-patient-ui/app/patient/funnel/[slug]/content/[pageSlug]/client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/apps/rhythm-patient-ui/app/patient/funnel/[slug]/content/[pageSlug]/client.tsx","default")},72221,a=>{"use strict";a.i(43723);var b=a.i(27078);a.n(b)},81118,a=>{"use strict";var b=a.i(7997);a.i(70396);var c=a.i(73727),d=a.i(91896),e=a.i(45259),f=a.i(72221),g=a.i(53196);async function h({params:a}){let{slug:h,pageSlug:i}=await a,j=await (0,d.createServerSupabaseClient)(),{data:{user:k}}=await j.auth.getUser();k||(0,c.redirect)("/");let l=`/patient/funnel/${h}/content/${i}`,m=await (0,e.enforceDashboardFirst)(l);m&&(0,c.redirect)(m);let n=null,o=null;try{let a=await (0,g.loadFunnelVersionWithClient)(j,h);a.manifest.content_manifest.pages.find(a=>a.slug===i)||(console.error(`[CONTENT_PAGE] Page ${i} not found in funnel ${h} manifest`),(0,c.notFound)()),n=a.manifest.content_manifest}catch(a){if(a instanceof g.FunnelNotFoundError)console.error(`[CONTENT_PAGE] Funnel not found: ${h}`),(0,c.notFound)();else if(a instanceof g.FunnelVersionNotFoundError)console.error(`[CONTENT_PAGE] No effective funnel version resolved for ${h}`),n=null,o="Kein aktives Funnel-Manifest verfügbar";else if(a instanceof g.ManifestValidationError)console.error(`[CONTENT_PAGE] Manifest validation failed for ${h}:`,a.message),n=null,o="Manifest-Validierung fehlgeschlagen: Ungültige Konfiguration";else throw console.error(`[CONTENT_PAGE] Unexpected error loading funnel ${h}:`,a),a}return(0,b.jsx)(f.default,{funnelSlug:h,pageSlug:i,contentManifest:n,manifestError:o})}a.s(["default",()=>h])}];

//# sourceMappingURL=_423187e3._.js.map