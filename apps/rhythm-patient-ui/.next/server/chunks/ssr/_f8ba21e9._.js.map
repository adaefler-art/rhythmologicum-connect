{"version":3,"sources":["../../../../../../apps/rhythm-patient-ui/app/patient/dashboard/client.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/rhythm-patient-ui/app/patient/dashboard/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/apps/rhythm-patient-ui/app/patient/dashboard/client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/rhythm-patient-ui/app/patient/dashboard/client.tsx\",\n    \"default\",\n);\n","import { redirect } from 'next/navigation'\nimport { createServerSupabaseClient } from '@/lib/db/supabase.server'\nimport { markDashboardVisited } from '@/lib/utils/dashboardFirstPolicy'\nimport DashboardClient from './client'\n\nexport const dynamic = 'force-dynamic'\n\n/**\n * Patient Dashboard Page (E6.4.2, E6.5.1)\n * \n * Landing page after onboarding completion.\n * Shows next steps for patient (start/continue assessments).\n * \n * E6.5.1: Dashboard-first entry point - marks dashboard as visited\n * V061-I04: Crash-proof hardening - all operations guarded with try-catch\n * \n * Route: /patient/dashboard\n */\nexport default async function PatientDashboardPage() {\n  // V061-I04: Deterministic logging - no PHI, only step markers\n  console.log('[PATIENT_DASHBOARD] STEP=pageRender start=true')\n  \n  // STEP 1: Create Supabase server client\n  // V061-I04: Already has try-catch with deterministic redirect\n  let supabase\n  try {\n    supabase = await createServerSupabaseClient()\n    console.log('[PATIENT_DASHBOARD] STEP=createSupabaseClient success=true')\n  } catch (err) {\n    // Fail-closed: configuration error → redirect to login with error marker\n    console.error('[PATIENT_DASHBOARD] STEP=createSupabaseClient success=false', {\n      errorType: err instanceof Error ? err.name : 'unknown',\n      errorMessage: err instanceof Error ? err.message : String(err),\n    })\n    redirect('/?error=configuration_error')\n  }\n\n  // STEP 2: Check authentication (AC3: 401-first, no DB calls before auth)\n  // V061-I04: Already has try-catch with deterministic redirect\n  let user\n  try {\n    const { data, error } = await supabase.auth.getUser()\n    user = data?.user\n    console.log('[PATIENT_DASHBOARD] STEP=getUser success=true', {\n      hasUser: !!user,\n      hasError: !!error,\n    })\n    if (error) {\n      console.error('[PATIENT_DASHBOARD] STEP=getUser authError', {\n        errorMessage: error.message,\n      })\n    }\n  } catch (err) {\n    // Auth service error → redirect to login\n    console.error('[PATIENT_DASHBOARD] STEP=getUser success=false', {\n      errorType: err instanceof Error ? err.name : 'unknown',\n      errorMessage: err instanceof Error ? err.message : String(err),\n    })\n    redirect('/?error=auth_error')\n  }\n\n  if (!user) {\n    console.log('[PATIENT_DASHBOARD] STEP=redirect reason=noUser')\n    redirect('/')\n  }\n\n  // STEP 3: E6.5.1 AC1: Mark dashboard as visited for this session\n  // This allows subsequent navigation to funnels/results\n  // V061-I04: Already has try-catch - cookie error is non-fatal\n  try {\n    await markDashboardVisited()\n    console.log('[PATIENT_DASHBOARD] STEP=markDashboardVisited success=true')\n  } catch (err) {\n    // Cookie error is non-fatal: log but continue\n    console.error('[PATIENT_DASHBOARD] STEP=markDashboardVisited success=false', {\n      errorType: err instanceof Error ? err.name : 'unknown',\n      errorMessage: err instanceof Error ? err.message : String(err),\n    })\n    // Continue rendering - dashboard visit tracking is not critical\n  }\n\n  // STEP 4: Render client component\n  // V061-I04: Client component handles its own errors via useDashboardData hook\n  console.log('[PATIENT_DASHBOARD] STEP=render success=true')\n  return <DashboardClient />\n}\n"],"names":[],"mappings":"oTAEe,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,yTAA2T,EACxV,wFACA,gEAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,qSAAuS,EACpU,oEACA,4GCLJ,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,KAee,eAAe,QAMxB,EAeA,EAdJ,GAAI,CACF,EAAW,MAAM,CAAA,EAAA,EAAA,0BAAA,AAA0B,GAE7C,CAAE,MAAO,EAAK,CAEZ,QAAQ,KAAK,CAAC,8DAA+D,CAC3E,UAAW,aAAe,MAAQ,EAAI,IAAI,CAAG,UAC7C,aAAc,aAAe,MAAQ,EAAI,OAAO,CAAG,OAAO,EAC5D,GACA,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,8BACX,CAKA,GAAI,CACF,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAS,IAAI,CAAC,OAAO,GACnD,EAAO,GAAM,KAKT,GACF,IADS,IACD,KAAK,CAAC,6CAA8C,CAC1D,aAAc,EAAM,OAAO,AAC7B,EAEJ,CAAE,MAAO,EAAK,CAEZ,QAAQ,KAAK,CAAC,iDAAkD,CAC9D,UAAW,aAAe,MAAQ,EAAI,IAAI,CAAG,UAC7C,aAAc,aAAe,MAAQ,EAAI,OAAO,CAAG,OAAO,EAC5D,GACA,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,qBACX,CAEI,AAAC,GAEH,CAAA,EAFS,AAET,EAAA,QAAQ,AAAR,EAAS,KAMX,GAAI,CACF,MAAM,CAAA,EAAA,EAAA,oBAAA,AAAoB,GAE5B,CAAE,MAAO,EAAK,CAEZ,QAAQ,KAAK,CAAC,8DAA+D,CAC3E,UAAW,aAAe,MAAQ,EAAI,IAAI,CAAG,UAC7C,aAAc,aAAe,MAAQ,EAAI,OAAO,CAAG,OAAO,EAC5D,EAEF,CAKA,MAAO,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAe,CAAA,CAAA,EACzB,kCAhFuB","ignoreList":[0]}