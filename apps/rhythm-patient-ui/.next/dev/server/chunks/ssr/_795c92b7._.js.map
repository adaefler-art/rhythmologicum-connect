{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/rhythmologicum-connect/rhythmologicum-connect/lib/env.ts"],"sourcesContent":["/**\n * Environment Variables Schema and Validation\n * \n * This file provides type-safe access to environment variables using Zod validation.\n * All environment variables MUST be accessed through this module to ensure:\n * 1. Type safety\n * 2. Runtime validation\n * 3. Clear documentation of required vs. optional variables\n * 4. Fail-fast behavior for missing required variables\n * \n * **IMPORTANT**: This file is protected by CODEOWNERS. Any changes require review.\n * \n * Usage:\n * ```typescript\n * import { env } from '@/lib/env'\n * \n * const supabaseUrl = env.NEXT_PUBLIC_SUPABASE_URL\n * const apiKey = env.ANTHROPIC_API_KEY // Can be undefined\n * ```\n */\n\nimport { z } from 'zod'\n\n// ============================================================\n// Environment Schema Definition\n// ============================================================\n\n// IMPORTANT:\n// - NEXT_PUBLIC_* vars can be read in both server + client bundles.\n// - Server-only secrets (e.g. SUPABASE_SERVICE_ROLE_KEY) must never be\n//   required/validated in the browser, otherwise production will crash.\nconst isServerRuntime = typeof window === 'undefined'\nconst isBuildTime = process.env.NEXT_PHASE === 'phase-production-build'\nconst isProdRuntime = process.env.NODE_ENV === 'production'\nconst requireServerSecrets = isServerRuntime && isProdRuntime && !isBuildTime\n\nfunction sanitizeEnvString(value: unknown) {\n  if (typeof value !== 'string') return value\n\n  let v = value.trim()\n\n  // Common deployment UI pitfall: values pasted with wrapping quotes/backticks.\n  // Remove exactly one wrapping pair to avoid breaking legitimate inner quotes.\n  const first = v[0]\n  const last = v[v.length - 1]\n  const isWrapped =\n    (first === '\"' && last === '\"') ||\n    (first === \"'\" && last === \"'\") ||\n    (first === '`' && last === '`')\n\n  if (isWrapped && v.length >= 2) {\n    v = v.slice(1, -1).trim()\n  }\n\n  return v\n}\n\nconst baseEnvSchema = z.object({\n  // Client-safe vars (may be inlined at build time by Next.js)\n  NEXT_PUBLIC_SUPABASE_URL: z.preprocess(sanitizeEnvString, z.string().url().optional()),\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: z.preprocess(sanitizeEnvString, z.string().optional()),\n\n  // OPTIONAL: Review Queue Sampling\n  REVIEW_SAMPLING_PERCENTAGE: z.string().optional(),\n  REVIEW_SAMPLING_SALT: z.string().optional(),\n\n  // OPTIONAL: Feature Flags\n  NEXT_PUBLIC_FEATURE_AMY_ENABLED: z.string().optional(),\n  NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED: z.string().optional(),\n  NEXT_PUBLIC_FEATURE_CHARTS_ENABLED: z.string().optional(),\n\n  // OPTIONAL: E6.4.1 Pilot Feature Flags\n  NEXT_PUBLIC_PILOT_ENABLED: z.string().optional(),\n  NEXT_PUBLIC_PILOT_ENV: z.string().optional(),\n\n  // Node Environment\n  NODE_ENV: z.enum(['development', 'production', 'test']).optional(),\n  NEXT_PHASE: z.string().optional(),\n\n  // Hosting provider (optional)\n  VERCEL_ENV: z.string().optional(),\n\n  // OPTIONAL: Usage Telemetry Toggle\n  USAGE_TELEMETRY_ENABLED: z.string().optional(),\n})\n\nconst serverOnlyEnvSchema = baseEnvSchema.extend({\n  // OPTIONAL: Dev/Admin tooling feature flags\n  DEV_ENDPOINT_CATALOG: z.string().optional(),\n\n  // OPTIONAL: UI split routing (Package 2)\n  STUDIO_BASE_URL: z.preprocess(sanitizeEnvString, z.string().url().optional()),\n  PATIENT_BASE_URL: z.preprocess(sanitizeEnvString, z.string().url().optional()),\n  ENGINE_BASE_URL: z.preprocess(sanitizeEnvString, z.string().url().optional()),\n\n  // OPTIONAL: E6.4.1 Pilot Allowlists (server-only)\n  PILOT_ORG_ALLOWLIST: z.string().optional(),\n  PILOT_USER_ALLOWLIST: z.string().optional(),\n\n  // REQUIRED (server runtime only): Supabase Admin\n  SUPABASE_SERVICE_ROLE_KEY: requireServerSecrets\n    ? z.preprocess(\n        sanitizeEnvString,\n        z.string().min(1, 'SUPABASE_SERVICE_ROLE_KEY is required'),\n      )\n    : z.preprocess(sanitizeEnvString, z.string().optional()),\n\n  // OPTIONAL: Anthropic AI Configuration\n  ANTHROPIC_API_KEY: z.string().optional(),\n  ANTHROPIC_API_TOKEN: z.string().optional(), // Legacy support\n  ANTHROPIC_MODEL: z.string().optional(),\n\n  // OPTIONAL: Legacy/Alternative Variable Names\n  SUPABASE_URL: z.preprocess(sanitizeEnvString, z.string().url().optional()), // Alternative to NEXT_PUBLIC_SUPABASE_URL\n  SUPABASE_SERVICE_KEY: z.preprocess(sanitizeEnvString, z.string().optional()), // Alternative to SUPABASE_SERVICE_ROLE_KEY\n})\n\nconst patientEnvSchema = baseEnvSchema.extend({\n  NEXT_PUBLIC_SUPABASE_URL: z.preprocess(\n    sanitizeEnvString,\n    z.string().url('NEXT_PUBLIC_SUPABASE_URL is required'),\n  ),\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: z.preprocess(\n    sanitizeEnvString,\n    z.string().min(1, 'NEXT_PUBLIC_SUPABASE_ANON_KEY is required'),\n  ),\n  ENGINE_BASE_URL: z.preprocess(sanitizeEnvString, z.string().url('ENGINE_BASE_URL is required')),\n})\n\nconst studioEnvSchema = baseEnvSchema.extend({\n  NEXT_PUBLIC_SUPABASE_URL: z.preprocess(\n    sanitizeEnvString,\n    z.string().url('NEXT_PUBLIC_SUPABASE_URL is required'),\n  ),\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: z.preprocess(\n    sanitizeEnvString,\n    z.string().min(1, 'NEXT_PUBLIC_SUPABASE_ANON_KEY is required'),\n  ),\n})\n\nconst engineEnvSchema = serverOnlyEnvSchema.extend({\n  NEXT_PUBLIC_SUPABASE_URL: z.preprocess(\n    sanitizeEnvString,\n    z.string().url('NEXT_PUBLIC_SUPABASE_URL is required'),\n  ),\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: z.preprocess(\n    sanitizeEnvString,\n    z.string().min(1, 'NEXT_PUBLIC_SUPABASE_ANON_KEY is required'),\n  ),\n})\n\nexport type PatientEnv = z.infer<typeof patientEnvSchema>\nexport type StudioEnv = z.infer<typeof studioEnvSchema>\nexport type BaseEnv = Partial<Env>\nexport type EngineEnv = z.infer<typeof engineEnvSchema>\n\nfunction getRawClientEnv() {\n  return {\n    NEXT_PUBLIC_SUPABASE_URL: process.env.NEXT_PUBLIC_SUPABASE_URL,\n    NEXT_PUBLIC_SUPABASE_ANON_KEY: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n    REVIEW_SAMPLING_PERCENTAGE: process.env.REVIEW_SAMPLING_PERCENTAGE,\n    REVIEW_SAMPLING_SALT: process.env.REVIEW_SAMPLING_SALT,\n    NEXT_PUBLIC_FEATURE_AMY_ENABLED: process.env.NEXT_PUBLIC_FEATURE_AMY_ENABLED,\n    NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED:\n      process.env.NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED,\n    NEXT_PUBLIC_FEATURE_CHARTS_ENABLED: process.env.NEXT_PUBLIC_FEATURE_CHARTS_ENABLED,\n    NEXT_PUBLIC_PILOT_ENABLED: process.env.NEXT_PUBLIC_PILOT_ENABLED,\n    NEXT_PUBLIC_PILOT_ENV: process.env.NEXT_PUBLIC_PILOT_ENV,\n    NODE_ENV: process.env.NODE_ENV,\n    NEXT_PHASE: process.env.NEXT_PHASE,\n    VERCEL_ENV: process.env.VERCEL_ENV,\n    USAGE_TELEMETRY_ENABLED: process.env.USAGE_TELEMETRY_ENABLED,\n  }\n}\n\nfunction getRawServerEnv() {\n  return {\n    DEV_ENDPOINT_CATALOG: process.env.DEV_ENDPOINT_CATALOG,\n    STUDIO_BASE_URL: process.env.STUDIO_BASE_URL,\n    PATIENT_BASE_URL: process.env.PATIENT_BASE_URL,\n    ENGINE_BASE_URL: process.env.ENGINE_BASE_URL,\n    PILOT_ORG_ALLOWLIST: process.env.PILOT_ORG_ALLOWLIST,\n    PILOT_USER_ALLOWLIST: process.env.PILOT_USER_ALLOWLIST,\n    SUPABASE_SERVICE_ROLE_KEY: process.env.SUPABASE_SERVICE_ROLE_KEY,\n    ANTHROPIC_API_KEY: process.env.ANTHROPIC_API_KEY,\n    ANTHROPIC_API_TOKEN: process.env.ANTHROPIC_API_TOKEN,\n    ANTHROPIC_MODEL: process.env.ANTHROPIC_MODEL,\n    SUPABASE_URL: process.env.SUPABASE_URL,\n    SUPABASE_SERVICE_KEY: process.env.SUPABASE_SERVICE_KEY,\n  }\n}\n\n// ============================================================\n// Validated Environment Variables\n// ============================================================\n\n/**\n * Type of the validated environment object\n * Note: Required fields are guaranteed to be strings (never undefined)\n */\nexport type Env = {\n  NEXT_PUBLIC_SUPABASE_URL: string\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: string\n  SUPABASE_SERVICE_ROLE_KEY: string\n  ANTHROPIC_API_KEY?: string\n  ANTHROPIC_API_TOKEN?: string\n  ANTHROPIC_MODEL?: string\n  REVIEW_SAMPLING_PERCENTAGE?: string\n  REVIEW_SAMPLING_SALT?: string\n  NEXT_PUBLIC_FEATURE_AMY_ENABLED?: string\n  NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED?: string\n  NEXT_PUBLIC_FEATURE_CHARTS_ENABLED?: string\n  NEXT_PUBLIC_PILOT_ENABLED?: string\n  NEXT_PUBLIC_PILOT_ENV?: string\n  PILOT_ORG_ALLOWLIST?: string\n  PILOT_USER_ALLOWLIST?: string\n  SUPABASE_URL?: string\n  SUPABASE_SERVICE_KEY?: string\n  NODE_ENV?: 'development' | 'production' | 'test'\n  NEXT_PHASE?: string\n  VERCEL_ENV?: string\n  USAGE_TELEMETRY_ENABLED?: string\n\n  // Dev/admin tooling\n  DEV_ENDPOINT_CATALOG?: string\n  STUDIO_BASE_URL?: string\n  PATIENT_BASE_URL?: string\n  ENGINE_BASE_URL?: string\n}\n\n/**\n * Get default environment values for development/build time\n */\nfunction getDefaultEnv(): Env {\n  return {\n    NEXT_PUBLIC_SUPABASE_URL: process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL || '',\n    NEXT_PUBLIC_SUPABASE_ANON_KEY: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '',\n    SUPABASE_SERVICE_ROLE_KEY:\n      process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_SERVICE_KEY || '',\n    ANTHROPIC_API_KEY: process.env.ANTHROPIC_API_KEY || process.env.ANTHROPIC_API_TOKEN,\n    ANTHROPIC_API_TOKEN: process.env.ANTHROPIC_API_TOKEN,\n    ANTHROPIC_MODEL: process.env.ANTHROPIC_MODEL,\n    REVIEW_SAMPLING_PERCENTAGE: process.env.REVIEW_SAMPLING_PERCENTAGE,\n    REVIEW_SAMPLING_SALT: process.env.REVIEW_SAMPLING_SALT,\n    NEXT_PUBLIC_FEATURE_AMY_ENABLED: process.env.NEXT_PUBLIC_FEATURE_AMY_ENABLED,\n    NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED: process.env.NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED,\n    NEXT_PUBLIC_FEATURE_CHARTS_ENABLED: process.env.NEXT_PUBLIC_FEATURE_CHARTS_ENABLED,\n    NEXT_PUBLIC_PILOT_ENABLED: process.env.NEXT_PUBLIC_PILOT_ENABLED,\n    NEXT_PUBLIC_PILOT_ENV: process.env.NEXT_PUBLIC_PILOT_ENV,\n    PILOT_ORG_ALLOWLIST: process.env.PILOT_ORG_ALLOWLIST,\n    PILOT_USER_ALLOWLIST: process.env.PILOT_USER_ALLOWLIST,\n    SUPABASE_URL: process.env.SUPABASE_URL,\n    SUPABASE_SERVICE_KEY: process.env.SUPABASE_SERVICE_KEY,\n    NODE_ENV: process.env.NODE_ENV as 'development' | 'production' | 'test' | undefined,\n    NEXT_PHASE: process.env.NEXT_PHASE,\n    VERCEL_ENV: process.env.VERCEL_ENV,\n    USAGE_TELEMETRY_ENABLED: process.env.USAGE_TELEMETRY_ENABLED,\n    DEV_ENDPOINT_CATALOG: process.env.DEV_ENDPOINT_CATALOG,\n    STUDIO_BASE_URL: process.env.STUDIO_BASE_URL,\n    PATIENT_BASE_URL: process.env.PATIENT_BASE_URL,\n    ENGINE_BASE_URL: process.env.ENGINE_BASE_URL,\n  }\n}\n\nfunction getMissingEnvKeys(issues: z.ZodIssue[]): string[] {\n  const keys = new Set<string>()\n  issues.forEach((issue) => {\n    const pathKey = issue.path[0]\n    if (typeof pathKey === 'string') {\n      keys.add(pathKey)\n    }\n  })\n  return Array.from(keys)\n}\n\ntype ParseOptions = {\n  strict?: boolean\n  scope?: string\n}\n\nfunction parseScopedEnv<T extends z.ZodTypeAny>(schema: T, options: ParseOptions = {}): z.infer<T> {\n  const rawEnv = isServerRuntime\n    ? { ...getRawClientEnv(), ...getRawServerEnv() }\n    : getRawClientEnv()\n\n  try {\n    const parsed = schema.parse(rawEnv) as Env\n    return {\n      NEXT_PUBLIC_SUPABASE_URL: parsed.NEXT_PUBLIC_SUPABASE_URL || parsed.SUPABASE_URL || '',\n      NEXT_PUBLIC_SUPABASE_ANON_KEY: parsed.NEXT_PUBLIC_SUPABASE_ANON_KEY || '',\n      SUPABASE_SERVICE_ROLE_KEY: parsed.SUPABASE_SERVICE_ROLE_KEY || parsed.SUPABASE_SERVICE_KEY || '',\n      ANTHROPIC_API_KEY: parsed.ANTHROPIC_API_KEY || parsed.ANTHROPIC_API_TOKEN,\n      ANTHROPIC_API_TOKEN: parsed.ANTHROPIC_API_TOKEN,\n      ANTHROPIC_MODEL: parsed.ANTHROPIC_MODEL,\n      REVIEW_SAMPLING_PERCENTAGE: parsed.REVIEW_SAMPLING_PERCENTAGE,\n      REVIEW_SAMPLING_SALT: parsed.REVIEW_SAMPLING_SALT,\n      NEXT_PUBLIC_FEATURE_AMY_ENABLED: parsed.NEXT_PUBLIC_FEATURE_AMY_ENABLED,\n      NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED:\n        parsed.NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED,\n      NEXT_PUBLIC_FEATURE_CHARTS_ENABLED: parsed.NEXT_PUBLIC_FEATURE_CHARTS_ENABLED,\n      NEXT_PUBLIC_PILOT_ENABLED: parsed.NEXT_PUBLIC_PILOT_ENABLED,\n      NEXT_PUBLIC_PILOT_ENV: parsed.NEXT_PUBLIC_PILOT_ENV,\n      PILOT_ORG_ALLOWLIST: parsed.PILOT_ORG_ALLOWLIST,\n      PILOT_USER_ALLOWLIST: parsed.PILOT_USER_ALLOWLIST,\n      SUPABASE_URL: parsed.SUPABASE_URL,\n      SUPABASE_SERVICE_KEY: parsed.SUPABASE_SERVICE_KEY,\n      NODE_ENV: parsed.NODE_ENV,\n      NEXT_PHASE: parsed.NEXT_PHASE,\n      VERCEL_ENV: parsed.VERCEL_ENV,\n      USAGE_TELEMETRY_ENABLED: parsed.USAGE_TELEMETRY_ENABLED,\n      DEV_ENDPOINT_CATALOG: parsed.DEV_ENDPOINT_CATALOG,\n      STUDIO_BASE_URL: parsed.STUDIO_BASE_URL,\n      PATIENT_BASE_URL: parsed.PATIENT_BASE_URL,\n      ENGINE_BASE_URL: parsed.ENGINE_BASE_URL,\n    } as z.infer<T>\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      const missingKeys = getMissingEnvKeys(error.issues)\n      const message = missingKeys.length\n        ? `Missing env: ${missingKeys.join(', ')}`\n        : 'Invalid environment variables'\n\n      console.error('❌ Environment variable validation failed:')\n      console.error(error.issues.map((e) => `  - ${e.path.join('.')}: ${e.message}`).join('\\n'))\n\n      // During build, allow with defaults\n      if (isBuildTime) {\n        console.warn('⚠️  Build time: Continuing with default values')\n        return getDefaultEnv() as z.infer<T>\n      }\n\n      if (options.strict && isServerRuntime) {\n        throw new Error(message)\n      }\n\n      // In development or non-strict mode, warn but allow build to continue with default values\n      console.warn(\n        `⚠️  Continuing with default values for ${options.scope ?? 'base'} environment`,\n      )\n      return getDefaultEnv() as z.infer<T>\n    }\n    throw error\n  }\n}\n\n/**\n * Parse and validate environment variables\n * This will not throw in base mode to avoid import-time crashes\n */\nfunction parseEnv(): BaseEnv {\n  const schema = isServerRuntime ? serverOnlyEnvSchema : baseEnvSchema\n  return parseScopedEnv(schema, { strict: false, scope: 'base' }) as BaseEnv\n}\n\n/**\n * Validated and type-safe environment variables\n * Access all environment variables through this object\n */\nlet cachedEnv: BaseEnv | null = null\n\nexport function getEnv(): BaseEnv {\n  if (!cachedEnv) {\n    cachedEnv = parseEnv()\n  }\n  return cachedEnv\n}\n\nexport function getPatientEnv(): PatientEnv {\n  return parseScopedEnv(patientEnvSchema, { strict: true, scope: 'patient' })\n}\n\nexport function getStudioEnv(): StudioEnv {\n  return parseScopedEnv(studioEnvSchema, { strict: true, scope: 'studio' })\n}\n\nexport function getEngineEnv(): EngineEnv {\n  return parseScopedEnv(engineEnvSchema, { strict: true, scope: 'engine' })\n}\n\nexport const env = new Proxy({} as BaseEnv, {\n  get(_target, prop) {\n    return getEnv()[prop as keyof Env]\n  },\n  set(_target, prop, value) {\n    const current = getEnv()\n    ;(current as Record<string, unknown>)[prop as string] = value\n    return true\n  },\n})\n\n/**\n * Server-runtime feature flags.\n *\n * Note: Jest runs API route unit tests in a jsdom environment (window defined),\n * but API routes are still server code. Do NOT rely on `env` for server-only\n * flags in those tests.\n */\nexport function isDevEndpointCatalogEnabled(): boolean {\n  return process.env.DEV_ENDPOINT_CATALOG === '1'\n}\n\n/**\n * Helper function to check if we're in production\n */\nexport function isProduction(): boolean {\n  return env.NODE_ENV === 'production'\n}\n\n/**\n * Helper function to check if we're in development\n */\nexport function isDevelopment(): boolean {\n  return env.NODE_ENV === 'development' || !env.NODE_ENV\n}\n\n/**\n * Helper function to check if we're in test mode\n */\nexport function isTest(): boolean {\n  return env.NODE_ENV === 'test'\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 321, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/rhythmologicum-connect/rhythmologicum-connect/lib/db/supabase.server.ts"],"sourcesContent":["/**\n * Server Supabase Client (SSR with User Session)\n * \n * This is the DEFAULT client for server-side code.\n * - Uses anon key + cookie-based authentication\n * - RLS policies are ACTIVE (user context preserved)\n * - Server-only (never bundled to browser)\n * \n * Use this for:\n * - API routes\n * - Server components\n * - Server actions\n * - Any server code that needs user-scoped access\n * \n * @module lib/db/supabase.server\n */\n\nimport { createServerClient as createSsrServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\nimport type { NextRequest, NextResponse } from 'next/server'\nimport { env } from '@/lib/env'\nimport type { Database } from '@/lib/types/supabase'\n\n/**\n * Creates a server-side Supabase client with user session\n * \n * This client:\n * - Uses cookie-based authentication (preserves user context)\n * - Enforces RLS policies based on authenticated user\n * - Automatically handles session refresh\n * - Server-only (safe to use service operations)\n * \n * @returns Promise<SupabaseClient> with user context\n * @throws Error if Supabase URL or anon key is not configured\n * \n * @example\n * ```typescript\n * // In an API route\n * import { createServerSupabaseClient } from '@/lib/db/supabase.server'\n * \n * export async function GET() {\n *   const supabase = await createServerSupabaseClient()\n *   const { data: { user } } = await supabase.auth.getUser()\n *   \n *   if (!user) {\n *     return new Response('Unauthorized', { status: 401 })\n *   }\n *   \n *   // RLS will automatically filter based on user\n *   const { data } = await supabase.from('user_data').select('*')\n *   return Response.json({ data })\n * }\n * ```\n */\nexport async function createServerSupabaseClient() {\n  const url = env.NEXT_PUBLIC_SUPABASE_URL\n  const anonKey = env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\n  if (!url || !anonKey) {\n    throw new Error(\n      'Supabase configuration missing. Ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.'\n    )\n  }\n\n  const cookieStore = await cookies()\n\n  return createSsrServerClient<Database>(url, anonKey, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) =>\n            cookieStore.set(name, value, {\n              ...options,\n              path: options?.path ?? '/',\n            })\n          )\n        } catch {\n          // The `setAll` method was called from a Server Component.\n          // This can be ignored if you have middleware refreshing sessions.\n        }\n      },\n    },\n  })\n}\n\n/**\n * Creates a server-side Supabase client for Route Handlers with cookie sync.\n *\n * This helper collects cookie mutations so they can be applied to a NextResponse.\n * Use applyCookies(response) before returning.\n */\nexport function createRouteSupabaseClient(req: NextRequest) {\n  const url = env.NEXT_PUBLIC_SUPABASE_URL\n  const anonKey = env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\n  if (!url || !anonKey) {\n    throw new Error(\n      'Supabase configuration missing. Ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.'\n    )\n  }\n\n  const pendingCookies: Array<{\n    name: string\n    value: string\n    options?: Parameters<NextResponse['cookies']['set']>[2]\n  }> = []\n\n  const supabase = createSsrServerClient<Database>(url, anonKey, {\n    cookies: {\n      getAll() {\n        return req.cookies.getAll()\n      },\n      setAll(cookiesToSet) {\n        cookiesToSet.forEach(({ name, value, options }) => {\n          pendingCookies.push({ name, value, options })\n        })\n      },\n    },\n  })\n\n  const applyCookies = (response: NextResponse) => {\n    pendingCookies.forEach(({ name, value, options }) => {\n      response.cookies.set(name, value, options)\n    })\n    return response\n  }\n\n  return { supabase, applyCookies }\n}\n\n/**\n * Gets the currently authenticated user\n * \n * @returns Promise<User | null> - The authenticated user or null if not logged in\n * \n * @example\n * ```typescript\n * import { getCurrentUser } from '@/lib/db/supabase.server'\n * \n * export async function GET() {\n *   const user = await getCurrentUser()\n *   if (!user) {\n *     return new Response('Unauthorized', { status: 401 })\n *   }\n *   // ...\n * }\n * ```\n */\nexport async function getCurrentUser() {\n  const supabase = await createServerSupabaseClient()\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n  return user\n}\n\n/**\n * Checks if the current user has clinician role\n * \n * @returns Promise<boolean> - true if user is a clinician or admin\n * \n * @example\n * ```typescript\n * import { hasClinicianRole } from '@/lib/db/supabase.server'\n * \n * export async function GET() {\n *   if (!(await hasClinicianRole())) {\n *     return new Response('Forbidden', { status: 403 })\n *   }\n *   // ...\n * }\n * ```\n */\nexport async function hasClinicianRole(): Promise<boolean> {\n  const user = await getCurrentUser()\n  if (!user) return false\n\n  // Check in app_metadata and user_metadata\n  const role = user.app_metadata?.role || user.user_metadata?.role\n  return role === 'clinician' || role === 'admin'\n}\n\n/**\n * Checks if the current user has admin or clinician role\n * Alias for hasClinicianRole (in this system, clinicians have admin access)\n * \n * @returns Promise<boolean> - true if user is a clinician or admin\n */\nexport async function hasAdminOrClinicianRole(): Promise<boolean> {\n  return hasClinicianRole()\n}\n\n/**\n * Gets user role from app_metadata or user_metadata\n * \n * @returns Promise<string | null> - User role or null if not found\n */\nexport async function getUserRole(): Promise<string | null> {\n  const user = await getCurrentUser()\n  if (!user) return null\n  return user.app_metadata?.role || user.user_metadata?.role || null\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;CAeC,GAED;AAAA;AACA;AAEA;;;;AAkCO,eAAe;IACpB,MAAM,MAAM,iHAAG,CAAC,wBAAwB;IACxC,MAAM,UAAU,iHAAG,CAAC,6BAA6B;IAEjD,IAAI,CAAC,OAAO,CAAC,SAAS;QACpB,MAAM,IAAI,MACR;IAEJ;IAEA,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,OAAO,IAAA,+LAAqB,EAAW,KAAK,SAAS;QACnD,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;4BAC3B,GAAG,OAAO;4BACV,MAAM,SAAS,QAAQ;wBACzB;gBAEJ,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,kEAAkE;gBACpE;YACF;QACF;IACF;AACF;AAQO,SAAS,0BAA0B,GAAgB;IACxD,MAAM,MAAM,iHAAG,CAAC,wBAAwB;IACxC,MAAM,UAAU,iHAAG,CAAC,6BAA6B;IAEjD,IAAI,CAAC,OAAO,CAAC,SAAS;QACpB,MAAM,IAAI,MACR;IAEJ;IAEA,MAAM,iBAID,EAAE;IAEP,MAAM,WAAW,IAAA,+LAAqB,EAAW,KAAK,SAAS;QAC7D,SAAS;YACP;gBACE,OAAO,IAAI,OAAO,CAAC,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;oBAC5C,eAAe,IAAI,CAAC;wBAAE;wBAAM;wBAAO;oBAAQ;gBAC7C;YACF;QACF;IACF;IAEA,MAAM,eAAe,CAAC;QACpB,eAAe,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;YAC9C,SAAS,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;QACpC;QACA,OAAO;IACT;IAEA,OAAO;QAAE;QAAU;IAAa;AAClC;AAoBO,eAAe;IACpB,MAAM,WAAW,MAAM;IACvB,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAC/B,OAAO;AACT;AAmBO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM,OAAO;IAElB,0CAA0C;IAC1C,MAAM,OAAO,KAAK,YAAY,EAAE,QAAQ,KAAK,aAAa,EAAE;IAC5D,OAAO,SAAS,eAAe,SAAS;AAC1C;AAQO,eAAe;IACpB,OAAO;AACT;AAOO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,KAAK,YAAY,EAAE,QAAQ,KAAK,aAAa,EAAE,QAAQ;AAChE"}},
    {"offset": {"line": 441, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/rhythmologicum-connect/rhythmologicum-connect/lib/contracts/registry.ts"],"sourcesContent":["/**\n * Contract Registry - Canonical Identifiers\n * \n * This file serves as the single source of truth for all critical string identifiers\n * used throughout the application. All new identifiers MUST be added here to prevent\n * \"fantasy names\" and ensure consistency.\n * \n * **IMPORTANT**: This file is protected by CODEOWNERS. Any changes require review.\n * \n * Usage:\n * ```typescript\n * import { ASSESSMENT_STATUS, FUNNEL_SLUG, USER_ROLE } from '@/lib/contracts/registry'\n * \n * const status: AssessmentStatus = ASSESSMENT_STATUS.IN_PROGRESS\n * const funnel: FunnelSlug = FUNNEL_SLUG.STRESS_ASSESSMENT\n * ```\n */\n\n// ============================================================\n// Assessment Statuses\n// ============================================================\n\n/**\n * Valid statuses for assessments\n */\nexport const ASSESSMENT_STATUS = {\n  IN_PROGRESS: 'in_progress',\n  COMPLETED: 'completed',\n} as const\n\nexport type AssessmentStatus = typeof ASSESSMENT_STATUS[keyof typeof ASSESSMENT_STATUS]\n\n// ============================================================\n// Content Page Statuses\n// ============================================================\n\n/**\n * Valid statuses for content pages\n */\nexport const CONTENT_STATUS = {\n  DRAFT: 'draft',\n  PUBLISHED: 'published',\n  ARCHIVED: 'archived',\n} as const\n\nexport type ContentStatus = typeof CONTENT_STATUS[keyof typeof CONTENT_STATUS]\n\n// ============================================================\n// Pillar Keys (7-Pillar Model)\n// ============================================================\n\n/**\n * Valid pillar keys for funnel taxonomy (7-Pillar Wellness Model)\n */\nexport const PILLAR_KEY = {\n  NUTRITION: 'nutrition',\n  MOVEMENT: 'movement',\n  SLEEP: 'sleep',\n  MENTAL_HEALTH: 'mental-health',\n  SOCIAL: 'social',\n  MEANING: 'meaning',\n  PREVENTION: 'prevention',\n} as const\n\nexport type PillarKey = typeof PILLAR_KEY[keyof typeof PILLAR_KEY]\n\n// ============================================================\n// Funnel Slugs\n// ============================================================\n\n/**\n * Valid funnel slugs\n * The canonical slug is the primary identifier\n * Legacy aliases are maintained for backward compatibility\n */\nexport const FUNNEL_SLUG = {\n  STRESS_ASSESSMENT: 'stress-assessment',\n  CARDIOVASCULAR_AGE: 'cardiovascular-age',\n  SLEEP_QUALITY: 'sleep-quality',\n  HEART_HEALTH_NUTRITION: 'heart-health-nutrition',\n  // Legacy aliases - deprecated but maintained for compatibility\n  STRESS: 'stress',\n  STRESS_CHECK: 'stress-check',\n  STRESS_CHECK_V2: 'stress-check-v2',\n} as const\n\nexport type FunnelSlug = typeof FUNNEL_SLUG[keyof typeof FUNNEL_SLUG]\n\n/**\n * Maps legacy funnel slugs to their canonical equivalents\n * Uses lowercase keys for case-insensitive matching\n */\nexport const FUNNEL_SLUG_ALIASES: Record<string, string> = {\n  'stress': FUNNEL_SLUG.STRESS_ASSESSMENT,\n  'stress-check': FUNNEL_SLUG.STRESS_ASSESSMENT,\n  'stress-check-v2': FUNNEL_SLUG.STRESS_ASSESSMENT,\n}\n\n/**\n * Resolves a funnel slug to its canonical form\n * Normalizes input by trimming and converting to lowercase for deterministic matching\n * \n * @param slug - The funnel slug to resolve (case-insensitive, whitespace trimmed)\n * @returns The canonical slug or the normalized input if no mapping exists\n */\nexport function getCanonicalFunnelSlug(slug: string): string {\n  const normalized = slug.toLowerCase().trim()\n  return FUNNEL_SLUG_ALIASES[normalized] || normalized\n}\n\n/**\n * Checks if a funnel slug is known in the registry\n * A funnel is \"known\" if it exists in FUNNEL_SLUG values (canonical or legacy)\n * \n * @param slug - The funnel slug to check (case-insensitive, whitespace trimmed)\n * @returns true if the funnel slug is registered, false otherwise\n */\nexport function isKnownFunnelSlug(slug: string): boolean {\n  const canonical = getCanonicalFunnelSlug(slug)\n  const allSlugs = Object.values(FUNNEL_SLUG)\n  return allSlugs.includes(canonical as FunnelSlug)\n}\n\n// ============================================================\n// Node/Step Types\n// ============================================================\n\n/**\n * Valid node/step types for funnel steps\n * These correspond to the 'type' field in the funnel_steps table\n */\nexport const NODE_TYPE = {\n  QUESTION_STEP: 'question_step',\n  FORM: 'form',\n  INFO_STEP: 'info_step',\n  INFO: 'info',\n  CONTENT_PAGE: 'content_page',\n  SUMMARY: 'summary',\n  OTHER: 'other',\n} as const\n\nexport type NodeType = typeof NODE_TYPE[keyof typeof NODE_TYPE]\n\n// ============================================================\n// User Roles\n// ============================================================\n\n/**\n * Valid user roles\n * These are stored in auth.users.raw_app_meta_data.role\n */\nexport const USER_ROLE = {\n  PATIENT: 'patient',\n  CLINICIAN: 'clinician',\n  ADMIN: 'admin',\n  NURSE: 'nurse',\n} as const\n\nexport type UserRole = typeof USER_ROLE[keyof typeof USER_ROLE]\n\n// ============================================================\n// Question Types\n// ============================================================\n\n/**\n * Valid question types\n * These correspond to the 'question_type' field in the questions table\n */\nexport const QUESTION_TYPE = {\n  RADIO: 'radio',\n  CHECKBOX: 'checkbox',\n  TEXT: 'text',\n  TEXTAREA: 'textarea',\n  NUMBER: 'number',\n  SCALE: 'scale',\n  SLIDER: 'slider',\n} as const\n\nexport type QuestionType = typeof QUESTION_TYPE[keyof typeof QUESTION_TYPE]\n\n// ============================================================\n// Patient Demographics\n// ============================================================\n\n/**\n * Valid sex/gender options for patient profiles\n * These correspond to the 'sex' field in the patient_profiles table\n */\nexport const PATIENT_SEX = {\n  MALE: 'male',\n  FEMALE: 'female',\n  OTHER: 'other',\n  PREFER_NOT_TO_SAY: 'prefer_not_to_say',\n} as const\n\nexport type PatientSex = typeof PATIENT_SEX[keyof typeof PATIENT_SEX]\n\n// ============================================================\n// Feature Flag Names\n// ============================================================\n\n/**\n * Valid feature flag names (without NEXT_PUBLIC_FEATURE_ prefix)\n */\nexport const FEATURE_FLAG = {\n  AMY_ENABLED: 'AMY_ENABLED',\n  CLINICIAN_DASHBOARD_ENABLED: 'CLINICIAN_DASHBOARD_ENABLED',\n  CHARTS_ENABLED: 'CHARTS_ENABLED',\n} as const\n\nexport type FeatureFlag = typeof FEATURE_FLAG[keyof typeof FEATURE_FLAG]\n\n// ============================================================\n// Helper Functions\n// ============================================================\n\n/**\n * Type guard to check if a value is a valid assessment status\n */\nexport function isValidAssessmentStatus(value: unknown): value is AssessmentStatus {\n  return typeof value === 'string' && Object.values(ASSESSMENT_STATUS).includes(value as AssessmentStatus)\n}\n\n/**\n * Type guard to check if a value is a valid content status\n */\nexport function isValidContentStatus(value: unknown): value is ContentStatus {\n  return typeof value === 'string' && Object.values(CONTENT_STATUS).includes(value as ContentStatus)\n}\n\n/**\n * Type guard to check if a value is a valid user role\n */\nexport function isValidUserRole(value: unknown): value is UserRole {\n  return typeof value === 'string' && Object.values(USER_ROLE).includes(value as UserRole)\n}\n\n/**\n * Type guard to check if a value is a valid node type\n */\nexport function isValidNodeType(value: unknown): value is NodeType {\n  return typeof value === 'string' && Object.values(NODE_TYPE).includes(value as NodeType)\n}\n\n/**\n * Type guard to check if a value is a valid pillar key\n */\nexport function isValidPillarKey(value: unknown): value is PillarKey {\n  return typeof value === 'string' && Object.values(PILLAR_KEY).includes(value as PillarKey)\n}\n\n/**\n * Type guard to check if a value is a valid patient sex option\n */\nexport function isValidPatientSex(value: unknown): value is PatientSex {\n  return typeof value === 'string' && Object.values(PATIENT_SEX).includes(value as PatientSex)\n}\n\n// ============================================================\n// Audit Log Entity Types\n// ============================================================\n\n/**\n * Valid entity types for audit logging\n * These correspond to the 'entity_type' field in the audit_log table\n */\nexport const AUDIT_ENTITY_TYPE = {\n  ASSESSMENT: 'assessment',\n  REPORT: 'report',\n  TASK: 'task',\n  FUNNEL_VERSION: 'funnel_version',\n  FUNNEL_CATALOG: 'funnel_catalog',\n  CONFIG: 'config',\n  CONSENT: 'consent',\n  ORGANIZATION: 'organization',\n  USER_ORG_MEMBERSHIP: 'user_org_membership',\n  CLINICIAN_ASSIGNMENT: 'clinician_assignment',\n  DOCUMENT: 'document', // V05-I04.3: Document confirmation tracking\n  PROCESSING_JOB: 'processing_job', // V05-I05.1: Processing job orchestration\n  REVIEW_RECORD: 'review_record', // V05-I05.7: Medical review records\n  PRE_SCREENING_CALL: 'pre_screening_call', // V05-I08.2: Pre-screening call records\n  DEVICE_SHIPMENT: 'device_shipment', // V05-I08.3: Shipment tracking\n  SUPPORT_CASE: 'support_case', // V05-I08.4: Support case documentation\n  ACCOUNT: 'account', // V05-I10.2: Account lifecycle (deletion/retention)\n} as const\n\nexport type AuditEntityType = typeof AUDIT_ENTITY_TYPE[keyof typeof AUDIT_ENTITY_TYPE]\n\n// ============================================================\n// Audit Log Actions\n// ============================================================\n\n/**\n * Valid actions for audit logging\n * These correspond to the 'action' field in the audit_log table\n */\nexport const AUDIT_ACTION = {\n  CREATE: 'create',\n  UPDATE: 'update',\n  DELETE: 'delete',\n  APPROVE: 'approve',\n  REJECT: 'reject',\n  REQUEST_CHANGES: 'request_changes', // V05-I05.7: Review workflow\n  GENERATE: 'generate',\n  FLAG: 'flag',\n  ASSIGN: 'assign',\n  ACTIVATE: 'activate',\n  DEACTIVATE: 'deactivate',\n  ROLLOUT: 'rollout',\n  COMPLETE: 'complete',\n  ESCALATE: 'escalate', // V05-I08.4: Support case escalation\n  DELETION_REQUEST: 'deletion_request', // V05-I10.2: User requested account deletion\n  DELETION_CANCEL: 'deletion_cancel', // V05-I10.2: User cancelled deletion request\n  DELETION_EXECUTE: 'deletion_execute', // V05-I10.2: System executed account deletion\n  ANONYMIZE: 'anonymize', // V05-I10.2: Records anonymized instead of deleted\n} as const\n\nexport type AuditAction = typeof AUDIT_ACTION[keyof typeof AUDIT_ACTION]\n\n// ============================================================\n// Audit Log Sources\n// ============================================================\n\n/**\n * Valid sources for audit logging\n * These correspond to the 'source' field in the audit_log table\n */\nexport const AUDIT_SOURCE = {\n  API: 'api',\n  JOB: 'job',\n  ADMIN_UI: 'admin-ui',\n  SYSTEM: 'system',\n} as const\n\nexport type AuditSource = typeof AUDIT_SOURCE[keyof typeof AUDIT_SOURCE]\n\n// ============================================================\n// Audit Type Guards\n// ============================================================\n\n/**\n * Type guard to check if a value is a valid audit entity type\n */\nexport function isValidAuditEntityType(value: unknown): value is AuditEntityType {\n  return typeof value === 'string' && Object.values(AUDIT_ENTITY_TYPE).includes(value as AuditEntityType)\n}\n\n/**\n * Type guard to check if a value is a valid audit action\n */\nexport function isValidAuditAction(value: unknown): value is AuditAction {\n  return typeof value === 'string' && Object.values(AUDIT_ACTION).includes(value as AuditAction)\n}\n\n/**\n * Type guard to check if a value is a valid audit source\n */\nexport function isValidAuditSource(value: unknown): value is AuditSource {\n  return typeof value === 'string' && Object.values(AUDIT_SOURCE).includes(value as AuditSource)\n}\n\n// ============================================================\n// Program Tier Levels (TV05_01D)\n// ============================================================\n\n/**\n * Valid program tier levels based on Thomas' journey model\n * These map the 3-tier patient journey to platform capabilities\n */\nexport const PROGRAM_TIER = {\n  /**\n   * Tier 1 (Essential): Basic stress/resilience assessment\n   * Focus: Initial assessment, baseline data collection\n   */\n  TIER_1_ESSENTIAL: 'tier-1-essential',\n  \n  /**\n   * Tier 2.5 (Enhanced): Extended monitoring with nurse touchpoints\n   * Focus: Regular check-ins, progress tracking\n   */\n  TIER_2_5_ENHANCED: 'tier-2-5-enhanced',\n  \n  /**\n   * Tier 2 (Comprehensive): Full program with intensive support\n   * Focus: Comprehensive care, multiple pillars, frequent touchpoints\n   */\n  TIER_2_COMPREHENSIVE: 'tier-2-comprehensive',\n} as const\n\nexport type ProgramTier = typeof PROGRAM_TIER[keyof typeof PROGRAM_TIER]\n\n/**\n * Type guard to check if a value is a valid program tier\n */\nexport function isValidProgramTier(value: unknown): value is ProgramTier {\n  return typeof value === 'string' && Object.values(PROGRAM_TIER).includes(value as ProgramTier)\n}\n\n// ============================================================\n// Document Extraction Versions (V05-I04.2)\n// ============================================================\n\n/**\n * Valid extractor versions for AI document extraction\n * Format: vMAJOR.MINOR.PATCH\n * Update when extraction logic or prompts change\n */\nexport const EXTRACTOR_VERSION = {\n  /**\n   * v1.0.0: Initial extraction pipeline\n   * - Basic lab value extraction\n   * - Medication list extraction\n   * - Confidence scoring\n   */\n  V1_0_0: 'v1.0.0',\n} as const\n\nexport type ExtractorVersion = typeof EXTRACTOR_VERSION[keyof typeof EXTRACTOR_VERSION]\n\n/**\n * Current extractor version (latest)\n */\nexport const CURRENT_EXTRACTOR_VERSION = EXTRACTOR_VERSION.V1_0_0\n\n/**\n * Type guard to check if a value is a valid extractor version\n */\nexport function isValidExtractorVersion(value: unknown): value is ExtractorVersion {\n  return typeof value === 'string' && Object.values(EXTRACTOR_VERSION).includes(value as ExtractorVersion)\n}\n\n// ============================================================\n// Processing Stages & Status (V05-I05.1)\n// ============================================================\n\n/**\n * Valid processing stages for job orchestrator\n * Jobs progress deterministically through these stages\n */\nexport const PROCESSING_STAGE = {\n  PENDING: 'pending',\n  RISK: 'risk',\n  RANKING: 'ranking',\n  CONTENT: 'content',\n  VALIDATION: 'validation',\n  REVIEW: 'review',\n  PDF: 'pdf',\n  DELIVERY: 'delivery',\n  COMPLETED: 'completed',\n  FAILED: 'failed',\n} as const\n\nexport type ProcessingStage = typeof PROCESSING_STAGE[keyof typeof PROCESSING_STAGE]\n\n/**\n * Valid processing statuses for job orchestrator\n */\nexport const PROCESSING_STATUS = {\n  QUEUED: 'queued',\n  IN_PROGRESS: 'in_progress',\n  COMPLETED: 'completed',\n  FAILED: 'failed',\n} as const\n\nexport type ProcessingStatus = typeof PROCESSING_STATUS[keyof typeof PROCESSING_STATUS]\n\n/**\n * Type guard to check if a value is a valid processing stage\n */\nexport function isValidProcessingStage(value: unknown): value is ProcessingStage {\n  return typeof value === 'string' && Object.values(PROCESSING_STAGE).includes(value as ProcessingStage)\n}\n\n/**\n * Type guard to check if a value is a valid processing status\n */\nexport function isValidProcessingStatus(value: unknown): value is ProcessingStatus {\n  return typeof value === 'string' && Object.values(PROCESSING_STATUS).includes(value as ProcessingStatus)\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 736, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/rhythmologicum-connect/rhythmologicum-connect/lib/contracts/onboarding.ts"],"sourcesContent":["/**\n * Onboarding Contracts\n * \n * Zod schemas and types for patient onboarding flow:\n * - Consent management\n * - Baseline profile collection\n * \n * @module lib/contracts/onboarding\n */\n\nimport { z } from 'zod'\nimport { PATIENT_SEX } from '@/lib/contracts/registry'\n\n// ============================================================\n// Consent Contracts\n// ============================================================\n\n/**\n * Current consent version\n * Must match the version stored in database\n */\nexport const CURRENT_CONSENT_VERSION = '1.0.0'\n\n/**\n * Consent form schema\n */\nexport const ConsentFormSchema = z.object({\n  consentVersion: z.string().min(1, 'Consent version is required'),\n  agreedToTerms: z.boolean().refine(val => val === true, {\n    message: 'You must agree to the terms to continue',\n  }),\n})\n\nexport type ConsentFormData = z.infer<typeof ConsentFormSchema>\n\n/**\n * Consent record from database\n */\nexport const ConsentRecordSchema = z.object({\n  id: z.string().uuid(),\n  user_id: z.string().uuid(),\n  consent_version: z.string(),\n  consented_at: z.string().datetime(),\n  ip_address: z.string().nullable(),\n  user_agent: z.string().nullable(),\n})\n\nexport type ConsentRecord = z.infer<typeof ConsentRecordSchema>\n\n// ============================================================\n// Baseline Profile Contracts\n// ============================================================\n\n/**\n * Baseline profile form schema\n * Minimal set of patient demographic data required before assessments\n */\nexport const BaselineProfileSchema = z.object({\n  full_name: z\n    .string()\n    .min(1, 'Name is required')\n    .max(200, 'Name must be less than 200 characters')\n    .trim(),\n  birth_year: z\n    .number()\n    .int('Birth year must be a whole number')\n    .min(1900, 'Birth year must be 1900 or later')\n    .max(new Date().getFullYear(), 'Birth year cannot be in the future')\n    .optional()\n    .nullable(),\n  sex: z\n    .enum(\n      [PATIENT_SEX.MALE, PATIENT_SEX.FEMALE, PATIENT_SEX.OTHER, PATIENT_SEX.PREFER_NOT_TO_SAY],\n      {\n        message: 'Please select a valid option',\n      },\n    )\n    .optional()\n    .nullable(),\n})\n\nexport type BaselineProfileData = z.infer<typeof BaselineProfileSchema>\n\n/**\n * Onboarding status enum values (E6.4.2)\n */\nexport const ONBOARDING_STATUS = {\n  NOT_STARTED: 'not_started',\n  IN_PROGRESS: 'in_progress',\n  COMPLETED: 'completed',\n} as const\n\nexport type OnboardingStatusValue = (typeof ONBOARDING_STATUS)[keyof typeof ONBOARDING_STATUS]\n\n/**\n * Patient profile record from database\n */\nexport const PatientProfileSchema = z.object({\n  id: z.string().uuid(),\n  user_id: z.string().uuid(),\n  created_at: z.string().datetime(),\n  full_name: z.string().nullable(),\n  birth_year: z.number().nullable(),\n  sex: z.string().nullable(),\n  onboarding_status: z.enum(['not_started', 'in_progress', 'completed']).optional(),\n})\n\nexport type PatientProfile = z.infer<typeof PatientProfileSchema>\n\n// ============================================================\n// Onboarding Status\n// ============================================================\n\n/**\n * Onboarding completion status\n */\nexport const OnboardingStatusSchema = z.object({\n  hasConsent: z.boolean(),\n  hasProfile: z.boolean(),\n  isComplete: z.boolean(),\n  status: z.enum(['not_started', 'in_progress', 'completed']).optional(),\n})\n\nexport type OnboardingStatus = z.infer<typeof OnboardingStatusSchema>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;;;;;;;CAQC,GAED;AACA;;;AAUO,MAAM,0BAA0B;AAKhC,MAAM,oBAAoB,kLAAC,CAAC,MAAM,CAAC;IACxC,gBAAgB,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAClC,eAAe,kLAAC,CAAC,OAAO,GAAG,MAAM,CAAC,CAAA,MAAO,QAAQ,MAAM;QACrD,SAAS;IACX;AACF;AAOO,MAAM,sBAAsB,kLAAC,CAAC,MAAM,CAAC;IAC1C,IAAI,kLAAC,CAAC,MAAM,GAAG,IAAI;IACnB,SAAS,kLAAC,CAAC,MAAM,GAAG,IAAI;IACxB,iBAAiB,kLAAC,CAAC,MAAM;IACzB,cAAc,kLAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,YAAY,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,YAAY,kLAAC,CAAC,MAAM,GAAG,QAAQ;AACjC;AAYO,MAAM,wBAAwB,kLAAC,CAAC,MAAM,CAAC;IAC5C,WAAW,kLAAC,CACT,MAAM,GACN,GAAG,CAAC,GAAG,oBACP,GAAG,CAAC,KAAK,yCACT,IAAI;IACP,YAAY,kLAAC,CACV,MAAM,GACN,GAAG,CAAC,qCACJ,GAAG,CAAC,MAAM,oCACV,GAAG,CAAC,IAAI,OAAO,WAAW,IAAI,sCAC9B,QAAQ,GACR,QAAQ;IACX,KAAK,kLAAC,CACH,IAAI,CACH;QAAC,2IAAW,CAAC,IAAI;QAAE,2IAAW,CAAC,MAAM;QAAE,2IAAW,CAAC,KAAK;QAAE,2IAAW,CAAC,iBAAiB;KAAC,EACxF;QACE,SAAS;IACX,GAED,QAAQ,GACR,QAAQ;AACb;AAOO,MAAM,oBAAoB;IAC/B,aAAa;IACb,aAAa;IACb,WAAW;AACb;AAOO,MAAM,uBAAuB,kLAAC,CAAC,MAAM,CAAC;IAC3C,IAAI,kLAAC,CAAC,MAAM,GAAG,IAAI;IACnB,SAAS,kLAAC,CAAC,MAAM,GAAG,IAAI;IACxB,YAAY,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,WAAW,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC9B,YAAY,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,KAAK,kLAAC,CAAC,MAAM,GAAG,QAAQ;IACxB,mBAAmB,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAe;QAAe;KAAY,EAAE,QAAQ;AACjF;AAWO,MAAM,yBAAyB,kLAAC,CAAC,MAAM,CAAC;IAC7C,YAAY,kLAAC,CAAC,OAAO;IACrB,YAAY,kLAAC,CAAC,OAAO;IACrB,YAAY,kLAAC,CAAC,OAAO;IACrB,QAAQ,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAe;QAAe;KAAY,EAAE,QAAQ;AACtE"}},
    {"offset": {"line": 823, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/rhythmologicum-connect/rhythmologicum-connect/lib/audit/log.ts"],"sourcesContent":["/**\n * Audit Logging Helper\n *\n * Provides type-safe audit logging functionality for decision-relevant events.\n * Ensures no PHI leakage and maintains comprehensive audit trails.\n *\n * @module lib/audit/log\n */\n\nimport { createClient } from '@supabase/supabase-js'\nimport type { Database, Json } from '@/lib/types/supabase'\nimport {\n  type AuditEntityType,\n  type AuditAction,\n  type AuditSource,\n  type UserRole,\n} from '@/lib/contracts/registry'\nimport { env } from '@/lib/env'\n\n// ============================================================\n// Types\n// ============================================================\n\n/**\n * Audit event metadata\n * Contains version information and correlation IDs\n * NO PHI should be stored here\n */\nexport type AuditMetadata = {\n  request_id?: string\n  algorithm_version?: string\n  prompt_version?: string\n  report_version?: string\n  correlation_id?: string\n  safety_score?: number\n  status_from?: string\n  status_to?: string\n  [key: string]: string | number | boolean | undefined\n}\n\n/**\n * Audit diff payload\n * Contains before/after snapshots of changes\n * Should contain IDs and status transitions, NOT raw clinical text\n */\nexport type AuditDiff = {\n  before?: Record<string, unknown>\n  after?: Record<string, unknown>\n  changes?: Record<string, { from: unknown; to: unknown }>\n}\n\n/**\n * Complete audit event structure\n */\nexport type AuditEvent = {\n  // Context\n  org_id?: string\n  actor_user_id?: string\n  actor_role?: UserRole\n  source: AuditSource\n\n  // Entity\n  entity_type: AuditEntityType\n  entity_id: string\n  action: AuditAction\n\n  // Details\n  diff?: AuditDiff\n  metadata?: AuditMetadata\n}\n\n/**\n * Result of logging an audit event\n */\nexport type AuditLogResult = {\n  success: boolean\n  audit_id?: string\n  error?: string\n}\n\n// ============================================================\n// Supabase Client (Service Role)\n// ============================================================\n\n/**\n * Creates a Supabase client with service role key for audit logging\n * Bypasses RLS to ensure audit logs are always written\n */\nfunction getAuditClient() {\n  const supabaseUrl = env.NEXT_PUBLIC_SUPABASE_URL || env.SUPABASE_URL\n  const supabaseServiceKey = env.SUPABASE_SERVICE_ROLE_KEY || env.SUPABASE_SERVICE_KEY\n\n  if (!supabaseUrl || !supabaseServiceKey) {\n    console.error('[audit/log] Missing Supabase credentials')\n    return null\n  }\n\n  return createClient<Database>(supabaseUrl, supabaseServiceKey, {\n    auth: { persistSession: false },\n  })\n}\n\n// ============================================================\n// PHI Protection & Redaction\n// ============================================================\n\n/**\n * List of allowed keys in metadata and diff objects\n * These are safe to store (IDs, versions, statuses, numeric values)\n */\nconst ALLOWED_METADATA_KEYS = [\n  'request_id',\n  'correlation_id',\n  'algorithm_version',\n  'prompt_version',\n  'report_version',\n  'version',\n  'safety_score',\n  'finding_count',\n  'status_from',\n  'status_to',\n  'assigned_to_role',\n  'reason',\n  'consent_type',\n  'granted',\n  'rollout_percent',\n  'rollout_percent_from',\n  'rollout_percent_to',\n  'is_active',\n  'assessment_id',\n  'report_id',\n  'task_id',\n  'funnel_id',\n  'version_id',\n  'consent_id',\n  'config_key',\n  'consent_version',\n  'profile_updated',\n  'review_id',\n  'job_id',\n  'decision_reason',\n  'has_notes',\n  // V05-I10.2: Account deletion/retention metadata\n  'deletion_reason',\n  'scheduled_for',\n  'retention_period_days',\n  'records_deleted',\n  'records_anonymized',\n  'executed_by',\n  'anonymization_reason',\n  // V05-I10.3: KPI/Observability tracking\n  'kpi_event',\n  'funnel_slug',\n  'drop_off_reason',\n  'current_step_id',\n  'step_order_index',\n  'duration_seconds',\n  'duration_before_drop_seconds',\n  'started_at',\n  'completed_at',\n  'time_to_report_seconds',\n  'report_created_at',\n  'error_type',\n] as const\n\n/**\n * List of keys that contain PHI and must be blocked\n */\nconst PHI_KEYS = [\n  'content',\n  'text',\n  'notes',\n  'answers',\n  'answer',\n  'response',\n  'extracted_data',\n  'clinical_notes',\n  'patient_notes',\n  'observation',\n  'diagnosis',\n  'medication',\n  'name',\n  'email',\n  'phone',\n  'address',\n  'ssn',\n  'dob',\n  'date_of_birth',\n] as const\n\n/**\n * Redacts PHI from a data object\n * Only allows specific safe keys and removes PHI-containing fields\n *\n * @param data - Object to redact\n * @param maxSize - Maximum allowed size in characters (default: 5000)\n * @returns Redacted object with only safe fields\n */\nexport function redactPHI(\n  data: Record<string, unknown> | undefined,\n  maxSize = 5000,\n): Record<string, unknown> {\n  if (!data || typeof data !== 'object') {\n    return {}\n  }\n\n  const redacted: Record<string, unknown> = {}\n  let totalSize = 0\n\n  for (const [key, value] of Object.entries(data)) {\n    // Block PHI keys explicitly\n    const lowerKey = key.toLowerCase()\n    if (PHI_KEYS.some((phiKey) => lowerKey.includes(phiKey))) {\n      redacted[key] = '[REDACTED]'\n      continue\n    }\n\n    // Check if key is in allowlist\n    const isAllowed = ALLOWED_METADATA_KEYS.includes(key as (typeof ALLOWED_METADATA_KEYS)[number])\n\n    // Allow numeric values, booleans, and safe strings\n    if (typeof value === 'number' || typeof value === 'boolean') {\n      redacted[key] = value\n      totalSize += String(value).length\n    } else if (typeof value === 'string') {\n      // Only allow strings from allowlist or UUID-like patterns\n      const isUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(value)\n      const isShortSafe = value.length <= 100 && !/[<>{}]/.test(value) // No HTML/JSON\n\n      if (isAllowed || isUUID || (isShortSafe && lowerKey.includes('id'))) {\n        redacted[key] = value\n        totalSize += value.length\n      } else {\n        redacted[key] = '[REDACTED]'\n      }\n    } else if (value === null || value === undefined) {\n      redacted[key] = value\n    } else if (typeof value === 'object' && !Array.isArray(value)) {\n      // Recursively redact nested objects\n      redacted[key] = redactPHI(value as Record<string, unknown>, maxSize - totalSize)\n      totalSize += JSON.stringify(redacted[key]).length\n    } else {\n      // Arrays and other types - redact to be safe\n      redacted[key] = '[REDACTED]'\n    }\n\n    // Enforce size limit\n    if (totalSize > maxSize) {\n      console.warn('[audit/log] Metadata/diff size exceeded limit, truncating')\n      break\n    }\n  }\n\n  return redacted\n}\n\n// ============================================================\n// Core Logging Function\n// ============================================================\n\n/**\n * Logs an audit event to the database\n *\n * This function:\n * - Validates event structure\n * - Ensures no PHI in diff/metadata\n * - Uses service role to bypass RLS\n * - Returns success/failure status\n *\n * @param event - The audit event to log\n * @returns Result indicating success or failure\n *\n * @example\n * ```typescript\n * await logAuditEvent({\n *   org_id: '123e4567-e89b-12d3-a456-426614174000',\n *   actor_user_id: user.id,\n *   actor_role: 'clinician',\n *   source: 'api',\n *   entity_type: 'report',\n *   entity_id: reportId,\n *   action: 'generate',\n *   metadata: {\n *     algorithm_version: '1.0',\n *     prompt_version: '2.0',\n *     report_version: '1.0',\n *   },\n * })\n * ```\n */\nexport async function logAuditEvent(event: AuditEvent): Promise<AuditLogResult> {\n  const startTime = Date.now()\n\n  try {\n    // Validate event\n    if (!event.entity_type) {\n      return { success: false, error: 'entity_type is required' }\n    }\n    if (!event.entity_id) {\n      return { success: false, error: 'entity_id is required' }\n    }\n    if (!event.action) {\n      return { success: false, error: 'action is required' }\n    }\n    if (!event.source) {\n      return { success: false, error: 'source is required' }\n    }\n\n    // Get Supabase client\n    const supabase = getAuditClient()\n    if (!supabase) {\n      console.error('[audit/log] Cannot create Supabase client')\n      return { success: false, error: 'Supabase client unavailable' }\n    }\n\n    // Redact PHI from diff and metadata\n    const safeMetadata = redactPHI(event.metadata || {})\n    const safeDiff: Record<string, unknown> = {}\n\n    if (event.diff?.before) {\n      safeDiff.before = redactPHI(event.diff.before as Record<string, unknown>)\n    }\n    if (event.diff?.after) {\n      safeDiff.after = redactPHI(event.diff.after as Record<string, unknown>)\n    }\n    if (event.diff?.changes) {\n      safeDiff.changes = redactPHI(event.diff.changes as Record<string, unknown>)\n    }\n\n    // Prepare audit log entry\n    const auditEntry: Database['public']['Tables']['audit_log']['Insert'] = {\n      org_id: event.org_id || null,\n      actor_user_id: event.actor_user_id || null,\n      actor_role: event.actor_role || null,\n      source: event.source,\n      entity_type: event.entity_type,\n      entity_id: event.entity_id,\n      action: event.action,\n      diff: (safeDiff as Json) || {},\n      metadata: (safeMetadata as Json) || {},\n    }\n\n    // Insert audit log\n    const { data, error } = await supabase\n      .from('audit_log')\n      .insert(auditEntry)\n      .select('id')\n      .single()\n\n    if (error) {\n      console.error('[audit/log] Failed to insert audit event', {\n        error,\n        entity_type: event.entity_type,\n        entity_id: event.entity_id,\n        action: event.action,\n      })\n      return { success: false, error: error.message }\n    }\n\n    const duration = Date.now() - startTime\n    console.log('[audit/log] Audit event logged successfully', {\n      audit_id: data.id,\n      entity_type: event.entity_type,\n      entity_id: event.entity_id,\n      action: event.action,\n      duration_ms: duration,\n    })\n\n    return { success: true, audit_id: data.id }\n  } catch (err) {\n    console.error('[audit/log] Unexpected error logging audit event', err)\n    return {\n      success: false,\n      error: err instanceof Error ? err.message : 'Unknown error',\n    }\n  }\n}\n\n// ============================================================\n// Helper Functions for Common Audit Scenarios\n// ============================================================\n\n/**\n * Logs a report generation event\n */\nexport async function logReportGenerated(params: {\n  org_id?: string\n  actor_user_id?: string\n  actor_role?: UserRole\n  report_id: string\n  assessment_id: string\n  algorithm_version?: string\n  prompt_version?: string\n  report_version?: string\n  safety_score?: number\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'api',\n    entity_type: 'report',\n    entity_id: params.report_id,\n    action: 'generate',\n    metadata: {\n      assessment_id: params.assessment_id,\n      algorithm_version: params.algorithm_version,\n      prompt_version: params.prompt_version,\n      report_version: params.report_version,\n      safety_score: params.safety_score,\n    },\n  })\n}\n\n/**\n * Logs a report flagged event (safety findings)\n */\nexport async function logReportFlagged(params: {\n  org_id?: string\n  actor_user_id?: string\n  actor_role?: UserRole\n  report_id: string\n  safety_score?: number\n  finding_count?: number\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'system',\n    entity_type: 'report',\n    entity_id: params.report_id,\n    action: 'flag',\n    metadata: {\n      safety_score: params.safety_score,\n      finding_count: params.finding_count,\n    },\n  })\n}\n\n/**\n * Logs a report approval/rejection event\n */\nexport async function logReportReviewed(params: {\n  org_id?: string\n  actor_user_id: string\n  actor_role: UserRole\n  report_id: string\n  action: 'approve' | 'reject'\n  reason?: string\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'api',\n    entity_type: 'report',\n    entity_id: params.report_id,\n    action: params.action,\n    metadata: {\n      reason: params.reason,\n    },\n  })\n}\n\n/**\n * Logs a task lifecycle event\n */\nexport async function logTaskEvent(params: {\n  org_id?: string\n  actor_user_id?: string\n  actor_role?: UserRole\n  task_id: string\n  action: AuditAction\n  status_from?: string\n  status_to?: string\n  assigned_to_role?: UserRole\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'api',\n    entity_type: 'task',\n    entity_id: params.task_id,\n    action: params.action,\n    metadata: {\n      status_from: params.status_from,\n      status_to: params.status_to,\n      assigned_to_role: params.assigned_to_role,\n    },\n  })\n}\n\n/**\n * Logs a funnel activation/deactivation event\n */\nexport async function logFunnelConfigChange(params: {\n  org_id?: string\n  actor_user_id: string\n  actor_role: UserRole\n  funnel_id: string\n  action: 'activate' | 'deactivate'\n  is_active: boolean\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'admin-ui',\n    entity_type: 'funnel_catalog',\n    entity_id: params.funnel_id,\n    action: params.action,\n    diff: {\n      after: { is_active: params.is_active },\n    },\n  })\n}\n\n/**\n * Logs a funnel version rollout change\n */\nexport async function logFunnelVersionRollout(params: {\n  org_id?: string\n  actor_user_id: string\n  actor_role: UserRole\n  version_id: string\n  rollout_percent_from?: number\n  rollout_percent_to: number\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'admin-ui',\n    entity_type: 'funnel_version',\n    entity_id: params.version_id,\n    action: 'rollout',\n    diff: {\n      before: { rollout_percent: params.rollout_percent_from },\n      after: { rollout_percent: params.rollout_percent_to },\n    },\n  })\n}\n\n/**\n * Logs a consent record change\n */\nexport async function logConsentChange(params: {\n  org_id?: string\n  actor_user_id?: string\n  actor_role?: UserRole\n  consent_id: string\n  action: AuditAction\n  consent_type?: string\n  granted?: boolean\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'api',\n    entity_type: 'consent',\n    entity_id: params.consent_id,\n    action: params.action,\n    metadata: {\n      consent_type: params.consent_type,\n      granted: params.granted,\n    },\n  })\n}\n\n/**\n * Logs a support case creation event\n */\nexport async function logSupportCaseCreated(params: {\n  org_id?: string\n  actor_user_id?: string\n  actor_role?: UserRole\n  support_case_id: string\n  category?: string\n  priority?: string\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'api',\n    entity_type: 'support_case',\n    entity_id: params.support_case_id,\n    action: 'create',\n    metadata: {\n      // PHI-safe: NO patient_id, only category/priority metadata\n      has_notes: false,\n    },\n  })\n}\n\n/**\n * Logs a support case escalation event\n * This creates both an audit log entry and updates the support case\n */\nexport async function logSupportCaseEscalated(params: {\n  org_id?: string\n  actor_user_id: string\n  actor_role: UserRole\n  support_case_id: string\n  task_id: string\n  assigned_to_role: UserRole\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'api',\n    entity_type: 'support_case',\n    entity_id: params.support_case_id,\n    action: 'escalate',\n    metadata: {\n      task_id: params.task_id,\n      assigned_to_role: params.assigned_to_role,\n    },\n  })\n}\n\n/**\n * Logs a support case status update event\n */\nexport async function logSupportCaseStatusChanged(params: {\n  org_id?: string\n  actor_user_id: string\n  actor_role: UserRole\n  support_case_id: string\n  status_from: string\n  status_to: string\n  has_notes?: boolean\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'api',\n    entity_type: 'support_case',\n    entity_id: params.support_case_id,\n    action: 'update',\n    metadata: {\n      status_from: params.status_from,\n      status_to: params.status_to,\n      has_notes: params.has_notes ?? false,\n    },\n  })\n}\n\n// ============================================================\n// Account Lifecycle Events (V05-I10.2)\n// ============================================================\n\n/**\n * Logs an account deletion request event\n * User has requested to delete their account (GDPR Article 17)\n */\nexport async function logAccountDeletionRequest(params: {\n  org_id?: string\n  actor_user_id: string\n  actor_role: UserRole\n  account_id: string\n  deletion_reason?: string\n  scheduled_for?: string\n  retention_period_days?: number\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'api',\n    entity_type: 'account',\n    entity_id: params.account_id,\n    action: 'deletion_request',\n    metadata: {\n      deletion_reason: params.deletion_reason,\n      scheduled_for: params.scheduled_for,\n      retention_period_days: params.retention_period_days,\n    },\n  })\n}\n\n/**\n * Logs an account deletion cancellation event\n * User cancelled their deletion request during retention period\n */\nexport async function logAccountDeletionCancel(params: {\n  org_id?: string\n  actor_user_id: string\n  actor_role: UserRole\n  account_id: string\n  cancellation_reason?: string\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'api',\n    entity_type: 'account',\n    entity_id: params.account_id,\n    action: 'deletion_cancel',\n    metadata: {\n      reason: params.cancellation_reason,\n    },\n  })\n}\n\n/**\n * Logs an account deletion execution event\n * System or admin executed the account deletion\n */\nexport async function logAccountDeletionExecute(params: {\n  org_id?: string\n  actor_user_id?: string\n  actor_role?: UserRole\n  account_id: string\n  records_deleted?: number\n  records_anonymized?: number\n  executed_by?: string\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: params.executed_by === 'system' ? 'system' : 'admin-ui',\n    entity_type: 'account',\n    entity_id: params.account_id,\n    action: 'deletion_execute',\n    metadata: {\n      records_deleted: params.records_deleted,\n      records_anonymized: params.records_anonymized,\n      executed_by: params.executed_by,\n    },\n  })\n}\n\n/**\n * Logs an account anonymization event\n * Records were anonymized instead of deleted (retention requirements)\n */\nexport async function logAccountAnonymize(params: {\n  org_id?: string\n  actor_user_id?: string\n  actor_role?: UserRole\n  account_id: string\n  records_anonymized: number\n  anonymization_reason?: string\n}): Promise<AuditLogResult> {\n  return logAuditEvent({\n    org_id: params.org_id,\n    actor_user_id: params.actor_user_id,\n    actor_role: params.actor_role,\n    source: 'system',\n    entity_type: 'account',\n    entity_id: params.account_id,\n    action: 'anonymize',\n    metadata: {\n      records_anonymized: params.records_anonymized,\n      reason: params.anonymization_reason,\n    },\n  })\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1337, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/rhythmologicum-connect/rhythmologicum-connect/lib/audit/index.ts"],"sourcesContent":["/**\n * Audit Module\n * \n * Provides comprehensive audit logging for decision-relevant events.\n * \n * @module lib/audit\n */\n\nexport {\n  logAuditEvent,\n  logReportGenerated,\n  logReportFlagged,\n  logReportReviewed,\n  logTaskEvent,\n  logFunnelConfigChange,\n  logFunnelVersionRollout,\n  logConsentChange,\n  type AuditEvent,\n  type AuditMetadata,\n  type AuditDiff,\n  type AuditLogResult,\n} from './log'\n\n// Export redaction function for testing\nexport { redactPHI } from './log'\n"],"names":[],"mappings":";AAAA;;;;;;CAMC,GAED"}},
    {"offset": {"line": 1351, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/rhythmologicum-connect/rhythmologicum-connect/lib/actions/onboarding.ts"],"sourcesContent":["/**\n * Onboarding Server Actions\n * \n * Server-side handlers for patient onboarding flow.\n * Handles consent recording and baseline profile management with:\n * - Idempotent operations\n * - RLS enforcement\n * - Audit logging\n * \n * @module lib/actions/onboarding\n */\n\n'use server'\n\nimport { createServerSupabaseClient } from '@/lib/db/supabase.server'\nimport {\n  ConsentFormSchema,\n  BaselineProfileSchema,\n  type OnboardingStatus,\n  type ConsentRecord,\n  type PatientProfile,\n  CURRENT_CONSENT_VERSION,\n} from '@/lib/contracts/onboarding'\nimport { logAuditEvent } from '@/lib/audit'\nimport { env } from '@/lib/env'\n\n// PostgreSQL error codes\nconst PG_ERROR_UNIQUE_VIOLATION = '23505'\n\n// ============================================================\n// Types\n// ============================================================\n\ntype ActionResult<T> = {\n  success: boolean\n  data?: T\n  error?: string\n}\n\n// ============================================================\n// Helper: Get Authenticated Supabase Client\n// ============================================================\n\nasync function getAuthenticatedClient() {\n  const supabase = await createServerSupabaseClient()\n\n  const {\n    data: { user },\n    error: authError,\n  } = await supabase.auth.getUser()\n\n  if (authError || !user) {\n    return { supabase: null, user: null, error: 'Not authenticated' }\n  }\n\n  return { supabase, user, error: null }\n}\n\n// ============================================================\n// Consent Actions\n// ============================================================\n\n/**\n * Records user consent to terms and conditions\n * Idempotent: Returns success if consent already recorded for this version\n * \n * @param formData - Consent form data with agreedToTerms flag\n * @returns Result with consent record or error\n */\nexport async function recordConsent(formData: {\n  consentVersion: string\n  agreedToTerms: boolean\n}): Promise<ActionResult<ConsentRecord>> {\n  try {\n    // Validate input\n    const validationResult = ConsentFormSchema.safeParse(formData)\n    if (!validationResult.success) {\n      const firstError = validationResult.error.issues[0]\n      return {\n        success: false,\n        error: firstError?.message || 'Invalid consent data',\n      }\n    }\n\n    // Get authenticated client\n    const { supabase, user, error: authError } = await getAuthenticatedClient()\n    if (authError || !supabase || !user) {\n      return { success: false, error: authError || 'Authentication failed' }\n    }\n\n    // Check if consent already exists (idempotent check)\n    // Use limit(1) instead of maybeSingle() to avoid hard failures if duplicates exist.\n    const { data: existingConsents, error: existingConsentError } = await supabase\n      .from('user_consents')\n      .select('*')\n      .eq('user_id', user.id)\n      .eq('consent_version', formData.consentVersion)\n      .order('consented_at', { ascending: false })\n      .limit(1)\n\n    if (existingConsentError) {\n      console.error('[onboarding/recordConsent] Existing consent check error:', existingConsentError)\n      return {\n        success: false,\n        error: 'Failed to check existing consent',\n      }\n    }\n\n    const existingConsent = existingConsents?.[0]\n\n    if (existingConsent) {\n      // Already consented - idempotent success\n      return {\n        success: true,\n        data: existingConsent as ConsentRecord,\n      }\n    }\n\n    // Insert new consent record\n    const { data, error } = await supabase\n      .from('user_consents')\n      .insert({\n        user_id: user.id,\n        consent_version: formData.consentVersion,\n      })\n      .select()\n      .single()\n\n    if (error) {\n      // Idempotent under races: if another request inserted concurrently, treat as success.\n      if ((error as { code?: string } | null)?.code === PG_ERROR_UNIQUE_VIOLATION) {\n        const { data: retryData, error: retryError } = await supabase\n          .from('user_consents')\n          .select('*')\n          .eq('user_id', user.id)\n          .eq('consent_version', formData.consentVersion)\n          .order('consented_at', { ascending: false })\n          .limit(1)\n\n        if (retryError) {\n          console.error('[onboarding/recordConsent] Retry after conflict failed:', retryError)\n          return { success: false, error: 'Failed to record consent' }\n        }\n\n        const retryConsent = retryData?.[0]\n        if (retryConsent) {\n          return { success: true, data: retryConsent as ConsentRecord }\n        }\n      }\n\n      console.error('[onboarding/recordConsent] Database error:', error)\n      return { success: false, error: 'Failed to record consent' }\n    }\n\n    // Log audit event\n    await logAuditEvent({\n      source: 'api',\n      entity_type: 'consent',\n      entity_id: data.id,\n      action: 'create',\n      actor_user_id: user.id,\n      metadata: {\n        consent_version: formData.consentVersion,\n      },\n    })\n\n    return {\n      success: true,\n      data: data as ConsentRecord,\n    }\n  } catch (err) {\n    console.error('[onboarding/recordConsent] Unexpected error:', err)\n    return {\n      success: false,\n      error: err instanceof Error ? err.message : 'Unexpected error',\n    }\n  }\n}\n\n/**\n * Checks if user has consented to current version\n * \n * @returns Result with boolean indicating consent status\n */\nexport async function hasUserConsented(): Promise<ActionResult<boolean>> {\n  try {\n    const { supabase, user, error: authError } = await getAuthenticatedClient()\n    if (authError || !supabase || !user) {\n      return { success: false, error: authError || 'Authentication failed' }\n    }\n\n    const { data, error } = await supabase\n      .from('user_consents')\n      .select('id')\n      .eq('user_id', user.id)\n      .eq('consent_version', CURRENT_CONSENT_VERSION)\n      .order('consented_at', { ascending: false })\n      .limit(1)\n\n    if (error) {\n      console.error('[onboarding/hasUserConsented] Database error:', error)\n      return { success: false, error: 'Failed to check consent status' }\n    }\n\n    return {\n      success: true,\n      data: (data?.length ?? 0) > 0,\n    }\n  } catch (err) {\n    console.error('[onboarding/hasUserConsented] Unexpected error:', err)\n    return {\n      success: false,\n      error: err instanceof Error ? err.message : 'Unexpected error',\n    }\n  }\n}\n\n// ============================================================\n// Baseline Profile Actions\n// ============================================================\n\n/**\n * Saves or updates patient baseline profile\n * Idempotent: Upserts profile data\n * \n * @param profileData - Baseline profile data\n * @returns Result with patient profile or error\n */\nexport async function saveBaselineProfile(\n  profileData: Partial<{\n    full_name: string\n    birth_year: number | null\n    sex: string | null\n  }>,\n): Promise<ActionResult<PatientProfile>> {\n  try {\n    // Validate input\n    const validationResult = BaselineProfileSchema.safeParse(profileData)\n    if (!validationResult.success) {\n      const firstError = validationResult.error.issues[0]\n      return {\n        success: false,\n        error: firstError?.message || 'Invalid profile data',\n      }\n    }\n\n    // Get authenticated client\n    const { supabase, user, error: authError } = await getAuthenticatedClient()\n    if (authError || !supabase || !user) {\n      return { success: false, error: authError || 'Authentication failed' }\n    }\n\n    // Check if profile exists\n    const { data: existingProfiles, error: existingProfileError } = await supabase\n      .from('patient_profiles')\n      .select('*')\n      .eq('user_id', user.id)\n      .order('created_at', { ascending: false })\n      .limit(1)\n\n    if (existingProfileError) {\n      console.error('[onboarding/saveBaselineProfile] Existing profile check error:', existingProfileError)\n      return { success: false, error: 'Failed to check profile' }\n    }\n\n    const existingProfile = existingProfiles?.[0]\n\n    let result: PatientProfile | null = null\n    let isUpdate = false\n   \n    if (existingProfile) {\n      // Update existing profile and mark onboarding as completed (E6.4.2 AC1)\n      isUpdate = true\n      const { data, error } = await supabase\n        .from('patient_profiles')\n        .update({\n          full_name: validationResult.data.full_name,\n          birth_year: validationResult.data.birth_year,\n          sex: validationResult.data.sex,\n          onboarding_status: 'completed',\n        })\n        .eq('id', (existingProfile as { id: string }).id)\n        .select()\n        .single()\n\n      if (error) {\n        console.error('[onboarding/saveBaselineProfile] Update error:', error)\n        return { success: false, error: 'Failed to update profile' }\n      }\n      result = data as PatientProfile\n    } else {\n      // Insert new profile and mark onboarding as completed (E6.4.2 AC1)\n      const { data, error } = await supabase\n        .from('patient_profiles')\n        .insert({\n          user_id: user.id,\n          full_name: validationResult.data.full_name,\n          birth_year: validationResult.data.birth_year,\n          sex: validationResult.data.sex,\n          onboarding_status: 'completed',\n        })\n        .select()\n        .single()\n\n      if (error) {\n        // Idempotent under races: if a concurrent request inserted a profile, update the latest.\n        if ((error as { code?: string } | null)?.code === PG_ERROR_UNIQUE_VIOLATION) {\n          const { data: retryProfiles, error: retryExistingError } = await supabase\n            .from('patient_profiles')\n            .select('*')\n            .eq('user_id', user.id)\n            .order('created_at', { ascending: false })\n            .limit(1)\n\n          if (retryExistingError) {\n            console.error(\n              '[onboarding/saveBaselineProfile] Retry fetch after conflict failed:',\n              retryExistingError,\n            )\n            return { success: false, error: 'Failed to create profile' }\n          }\n\n          const retryExisting = retryProfiles?.[0]\n          if (!retryExisting) {\n            return { success: false, error: 'Failed to create profile' }\n          }\n\n          isUpdate = true\n          const { data: retryUpdateData, error: retryUpdateError } = await supabase\n            .from('patient_profiles')\n            .update({\n              full_name: validationResult.data.full_name,\n              birth_year: validationResult.data.birth_year,\n              sex: validationResult.data.sex,\n              onboarding_status: 'completed',\n            })\n            .eq('id', (retryExisting as { id: string }).id)\n            .select()\n            .single()\n\n          if (retryUpdateError) {\n            console.error(\n              '[onboarding/saveBaselineProfile] Retry update after conflict failed:',\n              retryUpdateError,\n            )\n            return { success: false, error: 'Failed to update profile' }\n          }\n\n          result = retryUpdateData\n        } else {\n          console.error('[onboarding/saveBaselineProfile] Insert error:', error)\n          return { success: false, error: 'Failed to create profile' }\n        }\n      }\n      if (!result) {\n        result = data as PatientProfile\n      }\n    }\n\n    if (!result) {\n      return { success: false, error: 'Failed to save profile' }\n    }\n\n    // Log audit event\n    await logAuditEvent({\n      source: 'api',\n      entity_type: 'consent', // Using 'consent' as profile entity type not in registry\n      entity_id: result.id,\n      action: isUpdate ? 'update' : 'create',\n      actor_user_id: user.id,\n      metadata: {\n        profile_updated: 'baseline',\n      },\n    })\n\n    return {\n      success: true,\n      data: result,\n    }\n  } catch (err) {\n    console.error('[onboarding/saveBaselineProfile] Unexpected error:', err)\n    return {\n      success: false,\n      error: err instanceof Error ? err.message : 'Unexpected error',\n    }\n  }\n}\n\n/**\n * Gets user's baseline profile\n * \n * @returns Result with patient profile or null if not found\n */\nexport async function getBaselineProfile(): Promise<ActionResult<PatientProfile | null>> {\n  try {\n    const { supabase, user, error: authError } = await getAuthenticatedClient()\n    if (authError || !supabase || !user) {\n      return { success: false, error: authError || 'Authentication failed' }\n    }\n\n    const { data, error } = await supabase\n      .from('patient_profiles')\n      .select('*')\n      .eq('user_id', user.id)\n      .order('created_at', { ascending: false })\n      .limit(1)\n\n    if (error) {\n      console.error('[onboarding/getBaselineProfile] Database error:', error)\n      return { success: false, error: 'Failed to fetch profile' }\n    }\n\n    return {\n      success: true,\n      data: (data?.[0] as PatientProfile | undefined) ?? null,\n    }\n  } catch (err) {\n    console.error('[onboarding/getBaselineProfile] Unexpected error:', err)\n    return {\n      success: false,\n      error: err instanceof Error ? err.message : 'Unexpected error',\n    }\n  }\n}\n\n// ============================================================\n// Onboarding Status\n// ============================================================\n\n/**\n * Gets overall onboarding status\n * Checks if user has completed consent and baseline profile\n * \n * @returns Onboarding completion status\n */\nexport async function getOnboardingStatus(): Promise<ActionResult<OnboardingStatus>> {\n  try {\n    const { supabase, user, error: authError } = await getAuthenticatedClient()\n    if (authError || !supabase || !user) {\n      return { success: false, error: authError || 'Authentication failed' }\n    }\n\n    // Check consent\n    const { data: consentData, error: consentError } = await supabase\n      .from('user_consents')\n      .select('id')\n      .eq('user_id', user.id)\n      .eq('consent_version', CURRENT_CONSENT_VERSION)\n      .order('consented_at', { ascending: false })\n      .limit(1)\n\n    if (consentError) {\n      console.error('[onboarding/getOnboardingStatus] Consent check error:', consentError)\n      return { success: false, error: 'Failed to check onboarding status' }\n    }\n\n    const hasConsent = (consentData?.length ?? 0) > 0\n\n    // Check profile (must have at least full_name) and get onboarding_status (E6.4.2)\n    const { data: profileData, error: profileError } = await supabase\n      .from('patient_profiles')\n      .select('id, full_name, onboarding_status')\n      .eq('user_id', user.id)\n      .order('created_at', { ascending: false })\n      .limit(1)\n\n    if (profileError) {\n      console.error('[onboarding/getOnboardingStatus] Profile check error:', profileError)\n      return { success: false, error: 'Failed to check onboarding status' }\n    }\n\n    const firstProfile = profileData?.[0]\n    const hasProfile = !!(firstProfile && (firstProfile as { full_name?: string | null }).full_name)\n    const onboardingStatus = (firstProfile as { onboarding_status?: string })?.onboarding_status\n\n    return {\n      success: true,\n      data: {\n        hasConsent,\n        hasProfile,\n        isComplete: hasConsent && hasProfile,\n        status: onboardingStatus as 'not_started' | 'in_progress' | 'completed' | undefined,\n      },\n    }\n  } catch (err) {\n    console.error('[onboarding/getOnboardingStatus] Unexpected error:', err)\n    return {\n      success: false,\n      error: err instanceof Error ? err.message : 'Unexpected error',\n    }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1764, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/rhythmologicum-connect/rhythmologicum-connect/apps/rhythm-patient-ui/.next-internal/server/app/patient/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {hasUserConsented as '004ed9cac90fdf834ec1f94940af796d1833666018'} from 'ACTIONS_MODULE0'\nexport {getOnboardingStatus as '006d7e00afcc2588ac5c809edc63b116c82fef896e'} from 'ACTIONS_MODULE0'\nexport {getBaselineProfile as '0089c700a0e4e1138dbdb2e08f18f91a98bca27d8c'} from 'ACTIONS_MODULE0'\nexport {saveBaselineProfile as '4095d5d901dd6b27acd1be17849398125002266397'} from 'ACTIONS_MODULE0'\nexport {recordConsent as '40c1011b8932b09d60aa15b29237df90b5e17d9b7f'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}