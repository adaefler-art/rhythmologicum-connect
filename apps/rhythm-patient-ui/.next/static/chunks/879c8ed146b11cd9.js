(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},85e3,e=>{"use strict";var t=e.i(18050),s=e.i(18566),r=e.i(71689);let a=(0,e.i(75254).default)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var l=e.i(52571);e.i(180);var n=e.i(53012);function i({variant:e="with-title",title:i,subtitle:d,showBack:o=!0,onBack:c,actionIcon:x="settings",onAction:h,className:u=""}){let m=(0,s.useRouter)();return(0,t.jsx)("header",{className:`sticky top-0 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 transition-colors duration-150 ${u}`,style:{zIndex:50,boxShadow:n.shadows.sm},children:(0,t.jsxs)("div",{className:"flex items-center gap-3",style:{padding:`${n.spacing.sm} ${n.spacing.md}`,minHeight:"56px"},children:[o&&(0,t.jsx)("button",{type:"button",onClick:()=>{c?c():m.back()},className:"shrink-0 flex items-center justify-center rounded-full bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 active:bg-slate-300 dark:active:bg-slate-500 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2",style:{width:"44px",height:"44px"},"aria-label":"Zur√ºck",children:(0,t.jsx)(r.ArrowLeft,{size:20,strokeWidth:2,className:"text-slate-700 dark:text-slate-300","aria-hidden":!0})}),("with-title"===e||"with-action"===e)&&(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[d&&(0,t.jsx)("p",{className:"text-xs font-medium text-sky-600 dark:text-sky-400 uppercase tracking-wide truncate",style:{fontSize:n.typography.fontSize.xs},children:d}),i&&(0,t.jsx)("h1",{className:"font-semibold text-slate-900 dark:text-slate-100 truncate",style:{fontSize:n.typography.fontSize.lg,lineHeight:n.typography.lineHeight.tight},children:i})]}),"with-action"===e&&(()=>{if(!h)return null;let e={size:20,strokeWidth:2,"aria-hidden":!0};return(0,t.jsx)("button",{type:"button",onClick:h,className:"shrink-0 flex items-center justify-center rounded-full bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 active:bg-slate-300 dark:active:bg-slate-500 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2",style:{width:"44px",height:"44px"},"aria-label":"settings"===x?"Einstellungen":"Information",children:"settings"===x?(0,t.jsx)(a,{...e,className:"text-slate-700 dark:text-slate-300"}):(0,t.jsx)(l.Info,{...e,className:"text-slate-700 dark:text-slate-300"})})})()]})})}e.s(["default",()=>i],85e3)},16616,e=>{"use strict";var t=e.i(18050),s=e.i(71645),r=e.i(18566),a=e.i(85e3);e.i(47446);var l=e.i(84584),n=e.i(52220);e.i(180);var i=e.i(53012);function d({greeting:e}){return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h1",{className:"font-bold leading-tight text-slate-900 dark:text-slate-100",style:{fontSize:i.typography.fontSize["2xl"],lineHeight:i.typography.lineHeight.tight},children:e?`Willkommen zur\xfcck, ${e}`:"Willkommen zur√ºck"}),(0,t.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"Ihr pers√∂nliches Gesundheits-Dashboard"})]})}var o=e.i(12911),c=e.i(34683),x=e.i(67488),h=e.i(38884),u=e.i(81307);let m={SHOW_CONTENT:"SHOW_CONTENT",START_FUNNEL_A:"START_FUNNEL_A",START_FUNNEL_B:"START_FUNNEL_B",RESUME_FUNNEL:"RESUME_FUNNEL",SHOW_ESCALATION:"SHOW_ESCALATION"},g=["report_risk_level","workup_check","answer_pattern"],p=u.z.object({ageRange:u.z.enum(["UNDER_18","AGE_18_30","AGE_31_50","AGE_51_65","OVER_65"]).optional()}).optional();u.z.object({inputText:u.z.string().min(10,"Input must be at least 10 characters").max(800,"Input must not exceed 800 characters"),locale:u.z.string().optional(),patientContext:p});let f=u.z.object({value:u.z.number().min(0).max(1),label:u.z.enum(["low","medium","high"]).optional()}).optional(),b=u.z.object({tier:u.z.enum(["INFO","ASSESSMENT","ESCALATE"]),nextAction:u.z.enum([m.SHOW_CONTENT,m.START_FUNNEL_A,m.START_FUNNEL_B,m.RESUME_FUNNEL,m.SHOW_ESCALATION]),redFlags:u.z.array(u.z.string()).refine(e=>e.every(e=>g.includes(e)),{message:"All red flags must be from the allowlist"}).default([]),rationale:u.z.string().refine(function(e){let t=/^[\s]*[-*‚Ä¢]\s+/,s=e.split("\n").filter(e=>e.trim().length>0).filter(e=>t.test(e));return s.length>0?!(s.length>3):e.length<=280},{message:`Rationale must be ‚â§280 chars or bullet list with max 3 items`}),confidenceBand:f,version:u.z.literal("v1"),correlationId:u.z.string().optional()}),N=u.z.object({success:u.z.literal(!0),data:b}),j=u.z.object({success:u.z.literal(!1),error:u.z.object({code:u.z.string(),message:u.z.string(),details:u.z.record(u.z.string(),u.z.unknown()).optional()})});u.z.union([N,j]);var k=e.i(27558);let v=["üí§ Schlafprobleme","üò∞ Stress","üíì Herzklopfen","üòü Sorgen"],y=[{label:"üí¨ Info",text:"Was ist Stress und wie wirkt er sich auf meine Gesundheit aus?",tier:"INFO",color:"green"},{label:"üìã Assessment",text:"Ich f√ºhle mich sehr gestresst und ersch√∂pft in letzter Zeit. Es f√§llt mir schwer, mich zu konzentrieren.",tier:"ASSESSMENT",color:"amber"},{label:"üö® Escalate",text:"Ich habe Suizidgedanken und wei√ü nicht mehr weiter. Alles f√ºhlt sich hoffnungslos an.",tier:"ESCALATE",color:"red"}];function S(){let e=(0,r.useRouter)(),[a,l]=(0,s.useState)(""),[n,i]=(0,s.useState)("idle"),[d,u]=(0,s.useState)(null),[g,p]=(0,s.useState)(null),[f,b]=(0,s.useState)(!1),N=a.length,j=N>800,S=N>500&&N<=800,E=a.trim().length>=10&&!j&&"loading"!==n,w=async()=>{if(E){i("loading"),p(null),u(null);try{let e=await fetch("/api/amy/triage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({concern:a.trim()})}),t=await e.json();if(!e.ok)throw Error(t.error||"Triage request failed");if(t.success&&t.data){let e=t.data;u(e),i("success"),function(e){if(!window.sessionStorage)return console.warn("[TriageStorage] sessionStorage not available");try{let t=JSON.stringify(e);window.sessionStorage.setItem("lastTriageResult",t)}catch(e){return console.error("[TriageStorage] Failed to store triage result",e),!1}}(e)}else throw Error("Invalid response format")}catch(e){console.error("[AMYComposer] Triage failed",e),p(e instanceof Error?e.message:"Ein unerwarteter Fehler ist aufgetreten."),i("error")}}};return(0,t.jsx)(o.Card,{padding:"lg",radius:"lg",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0",children:(0,t.jsx)("span",{className:"text-2xl",role:"img","aria-label":"AMY Assistant",children:"ü§ñ"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-1",children:"AMY - Ihr pers√∂nlicher Assistent"}),(0,t.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Beschreiben Sie Ihr Anliegen in 1‚Äì2 S√§tzen"})]})]}),(0,t.jsx)(h.Alert,{variant:"info",children:(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsxs)("strong",{children:[k.NON_EMERGENCY_DISCLAIMER.title,":"]})," ",k.NON_EMERGENCY_DISCLAIMER.text]})}),(()=>{try{let e=localStorage.getItem("devHarnessEnabled");if("true"===e)return!0}catch(e){}let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e||e.includes("preview")||e.includes("dev-")})()&&(0,t.jsxs)("div",{className:"border-2 border-dashed border-purple-300 dark:border-purple-700 rounded-lg p-4 bg-purple-50 dark:bg-purple-950/20",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-lg",role:"img","aria-label":"Developer",children:"üë®‚Äçüíª"}),(0,t.jsx)("h4",{className:"text-sm font-semibold text-purple-900 dark:text-purple-300",children:"Dev Harness - Test Inputs"})]}),(0,t.jsx)("button",{type:"button",onClick:()=>b(!f),className:"text-xs px-2 py-1 rounded bg-purple-200 dark:bg-purple-800 text-purple-900 dark:text-purple-300 hover:bg-purple-300 dark:hover:bg-purple-700 transition-colors",children:f?"Hide":"Show"})]}),f&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-xs text-purple-700 dark:text-purple-400 mb-2",children:"Deterministic test inputs for all router paths (INFO/ASSESSMENT/ESCALATE)"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:y.map(e=>{var s;return(0,t.jsx)("button",{type:"button",onClick:()=>{l(e.text),i("idle"),u(null),p(null)},disabled:"loading"===n,className:(s=e.color,`px-3 py-2 text-xs font-medium rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${({green:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-900/50",amber:"bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300 hover:bg-amber-200 dark:hover:bg-amber-900/50",red:"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-900/50"})[s]}`),children:e.label},e.label)})}),(0,t.jsx)("p",{className:"text-xs text-purple-600 dark:text-purple-400 mt-2",children:"‚ö†Ô∏è Dev-only feature. Hidden in production."})]})]}),("idle"===n||"loading"===n||"error"===n)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:v.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>{let t;return t=e.slice(2).trim(),void(a?l(a+", "+t):l(t))},disabled:"loading"===n,className:"px-3 py-1.5 text-sm rounded-full bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e},e))}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Textarea,{value:a,onChange:e=>l(e.target.value),placeholder:"z.B. Ich habe in letzter Zeit Schlafprobleme und f√ºhle mich gestresst...",rows:4,disabled:"loading"===n,error:j,errorMessage:j?"Maximal 800 Zeichen erlaubt":void 0,helperText:!j&&S?"Empfohlen: bis zu 500 Zeichen":void 0,maxLength:850}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,t.jsxs)("span",{className:`${j?"text-red-600 dark:text-red-400 font-medium":S?"text-amber-600 dark:text-amber-400":"text-slate-500 dark:text-slate-400"}`,children:[N," / ",800," Zeichen"]}),a.trim().length<10&&a.trim().length>0&&(0,t.jsx)("span",{className:"text-slate-500 dark:text-slate-400 text-xs",children:"Mindestens 10 Zeichen erforderlich"})]})]}),g&&(0,t.jsx)(h.Alert,{variant:"error",children:(0,t.jsx)("p",{className:"text-sm",children:g})}),(0,t.jsx)(x.Button,{variant:"primary",fullWidth:!0,onClick:w,disabled:!E,loading:"loading"===n,children:"loading"===n?"Wird analysiert...":"Anliegen einreichen"})]}),"success"===n&&d&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${"ESCALATE"===d.tier?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300":"ASSESSMENT"===d.tier?"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}`,children:"ESCALATE"===d.tier?"üö® Dringend":"ASSESSMENT"===d.tier?"üìã Einsch√§tzung empfohlen":"‚úÖ Information"})}),(0,t.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:(0,t.jsx)("p",{className:"text-slate-700 dark:text-slate-300 leading-relaxed",children:d.rationale})}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)(x.Button,{variant:"primary",fullWidth:!0,onClick:()=>{var t;let s;if(!d)return;if(t=d.nextAction,!Object.values(m).includes(t)){console.error("[AMYComposer] Invalid nextAction",{nextAction:d.nextAction}),p("Ung√ºltige Triage-Aktion. Bitte versuchen Sie es erneut.");return}let{url:r,description:a}={url:function(e){let{path:t,query:s}=e;if(!s||0===Object.keys(s).length)return t;let r=new URLSearchParams(s).toString();return`${t}?${r}`}(s=function(e,t){switch(e){case m.SHOW_CONTENT:return{path:"/patient/dashboard",query:{scrollTo:"content"},state:{highlightContent:!0,triageTier:t.tier},description:"Show content tiles (INFO tier)"};case m.START_FUNNEL_A:return{path:"/patient/funnel/stress-resilience",query:{source:"triage"},state:{triageRationale:t.rationale,triageTier:t.tier},description:"Start Stress & Resilience Assessment (Funnel A)"};case m.START_FUNNEL_B:return{path:"/patient/funnel/sleep",query:{source:"triage"},state:{triageRationale:t.rationale,triageTier:t.tier},description:"Start Sleep Assessment (Funnel B)"};case m.RESUME_FUNNEL:return{path:"/patient/dashboard",query:{action:"resume"},state:{triageRationale:t.rationale},description:"Resume existing funnel from dashboard"};case m.SHOW_ESCALATION:return{path:"/patient/support",query:{source:"triage",tier:t.tier},state:{triageRationale:t.rationale,redFlags:t.redFlags,urgent:!0},description:"Show escalation support (ESCALATE tier)"};default:return console.warn("[TriageRouter] Unknown nextAction, falling back to dashboard",{nextAction:e}),{path:"/patient/dashboard",query:{},state:{},description:"Fallback to dashboard (unknown action)"}}}(d.nextAction,d)),state:s.state||{},description:s.description};e.push(r)},children:["SHOW_CONTENT"===d.nextAction&&"üìö Inhalte ansehen","START_FUNNEL_A"===d.nextAction&&"üìã Fragebogen starten","START_FUNNEL_B"===d.nextAction&&"üí§ Schlaf-Assessment starten","RESUME_FUNNEL"===d.nextAction&&"‚ñ∂Ô∏è Fragebogen fortsetzen","SHOW_ESCALATION"===d.nextAction&&"üÜò Unterst√ºtzung erhalten"]}),(0,t.jsx)(x.Button,{variant:"secondary",fullWidth:!0,onClick:()=>{l(""),i("idle"),u(null),p(null)},children:"Neues Anliegen eingeben"})]}),"ESCALATE"===d.tier&&(0,t.jsx)(h.Alert,{variant:"error",children:(0,t.jsxs)("p",{className:"text-sm font-medium",children:[(0,t.jsxs)("strong",{children:[k.STANDARD_EMERGENCY_GUIDANCE.title,":"]})," ",k.STANDARD_EMERGENCY_GUIDANCE.text]})})]})]})})}function E({nextStep:e,onAction:s}){if("none"===e.type)return null;let r={onboarding:"üìã",funnel:"üéØ",result:"üìä",content:"üìñ",none:""}[e.type];return(0,t.jsx)(o.Card,{padding:"lg",radius:"lg",className:"border-2 border-sky-200 dark:border-sky-800",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-sky-100 dark:bg-sky-900/30 flex items-center justify-center flex-shrink-0",children:(0,t.jsx)("span",{className:"text-2xl",role:"img","aria-label":"Next step",children:r})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"N√§chster Schritt"}),(0,t.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:e.label})]})]}),e.target&&(0,t.jsx)("button",{onClick:s,className:"w-full px-6 py-3 bg-sky-600 hover:bg-sky-700 text-white font-medium rounded-lg transition-colors duration-200",children:e.label})]})})}function w({tiles:e,onTileClick:s}){let r=[...e].sort((e,t)=>t.priority-e.priority),a={info:"üí°",action:"‚ö°",promotion:"üéÅ"};return 0===e.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"text-4xl mb-3",children:"üìö"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-slate-900 dark:text-slate-100 mb-2",children:"Noch keine Inhalte verf√ºgbar"}),(0,t.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Neue Inhalte werden bald hinzugef√ºgt."})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Empfohlene Inhalte"}),(0,t.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:r.map(e=>(0,t.jsx)(o.Card,{padding:"md",radius:"lg",interactive:!!e.actionTarget,onClick:()=>{e.actionTarget&&s&&s(e)},children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("span",{className:"text-2xl flex-shrink-0",role:"img","aria-label":e.type,children:a[e.type]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"font-medium text-slate-900 dark:text-slate-100 mb-1 truncate",children:e.title}),e.description&&(0,t.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2",children:e.description})]})]}),e.actionLabel&&e.actionTarget&&(0,t.jsx)("div",{className:"pt-2 border-t border-slate-200 dark:border-slate-700",children:(0,t.jsxs)("span",{className:"text-sm text-sky-600 dark:text-sky-400 font-medium",children:[e.actionLabel," ‚Üí"]})})]})},e.id))})]})}var A=e.i(32796),T=e.i(51254);function _({funnelSummaries:e,workupSummary:s,onFunnelClick:r}){let a={not_started:"default",in_progress:"warning",completed:"success"},l={not_started:"Nicht begonnen",in_progress:"In Bearbeitung",completed:"Abgeschlossen"};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Ihre Assessments"}),0===e.length?(0,t.jsx)(o.Card,{padding:"lg",radius:"lg",children:(0,t.jsxs)("div",{className:"text-center py-6",children:[(0,t.jsx)("div",{className:"text-4xl mb-3",children:"üìã"}),(0,t.jsx)("h4",{className:"text-base font-medium text-slate-900 dark:text-slate-100 mb-2",children:"Noch keine Assessments"}),(0,t.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Starten Sie Ihr erstes Assessment, um Ihren Fortschritt zu verfolgen."})]})}):(0,t.jsx)("div",{className:"space-y-3",children:e.map(e=>(0,t.jsx)(o.Card,{padding:"md",radius:"lg",interactive:"in_progress"===e.status,onClick:()=>{"in_progress"===e.status&&r&&r(e)},children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"font-medium text-slate-900 dark:text-slate-100 mb-1",children:e.title}),e.description&&(0,t.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2",children:e.description})]}),(0,t.jsx)(A.Badge,{variant:a[e.status],size:"sm",children:l[e.status]})]}),e.progress&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between text-xs text-slate-600 dark:text-slate-400",children:[(0,t.jsx)("span",{children:"Fortschritt"}),(0,t.jsxs)("span",{children:[e.progress.current," / ",e.progress.total]})]}),(0,t.jsx)(T.Progress,{value:e.progress.current/e.progress.total*100,showPercentage:!1,showStepText:!1})]}),e.completedAt&&(0,t.jsxs)("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Abgeschlossen am ",new Date(e.completedAt).toLocaleDateString("de-DE")]})]})},e.slug))})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Workup-Status"}),(0,t.jsx)(o.Card,{padding:"md",radius:"lg",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Status:"}),(0,t.jsx)("span",{className:`text-sm font-semibold ${{no_data:"text-slate-600 dark:text-slate-400",needs_more_data:"text-amber-600 dark:text-amber-400",ready_for_review:"text-green-600 dark:text-green-400"}[s.state]}`,children:{no_data:"Keine Daten",needs_more_data:"Weitere Daten erforderlich",ready_for_review:"Bereit zur √úberpr√ºfung"}[s.state]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 pt-3 border-t border-slate-200 dark:border-slate-700",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:s.counts.total}),(0,t.jsx)("div",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:"Gesamt"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:s.counts.needsMoreData}),(0,t.jsx)("div",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:"Weitere Daten"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:s.counts.readyForReview}),(0,t.jsx)("div",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:"Bereit"})]})]})]})})]})]})}function z(){let e=(0,r.useRouter)(),i=(0,r.useSearchParams)(),{data:o,state:c,error:x,isStale:h,refresh:u,retry:m}=function(e=!0){let[t,r]=(0,s.useState)(null),[a,l]=(0,s.useState)("idle"),[n,i]=(0,s.useState)(null),[d,o]=(0,s.useState)(!1),c=(0,s.useRef)(!1),x=(0,s.useRef)(null),h=(0,s.useCallback)(async(e={})=>{if(c.current)return;x.current&&x.current.abort(),c.current=!0;let s=new AbortController;x.current=s;try{e.isRevalidation&&t?(l("revalidating"),o(!0)):l("loading"),i(null);let a=await fetch("/api/patient/dashboard",{credentials:"include",signal:s.signal});if(!a.ok)throw Error("Failed to load dashboard data");let n=await a.json();if(!n.success)throw Error(n.error?.message||"Failed to load dashboard");r(n.data),l("idle"),o(!1),i(null)}catch(s){if(s instanceof Error&&"AbortError"===s.name)return;console.error("[useDashboardData] Error loading data:",s),t&&e.isRevalidation||r(null),l("error"),i(s instanceof Error?s.message:"Dashboard konnte nicht geladen werden.")}finally{c.current=!1,x.current=null}},[t]);return(0,s.useEffect)(()=>{e&&"idle"===a&&!t&&h()},[e,a,t,h]),(0,s.useEffect)(()=>()=>{x.current&&x.current.abort()},[]),{data:t,state:a,error:n,isStale:d,refresh:(0,s.useCallback)(async()=>{await h({isRevalidation:!0})},[h]),retry:(0,s.useCallback)(async()=>{await h({isRevalidation:!1})},[h])}}();return!function(e,t=!0){let r=(0,s.useRef)(e);(0,s.useEffect)(()=>{r.current=e},[e]),(0,s.useEffect)(()=>{if(!t)return;let e=!document.hidden,s=()=>{let t=!document.hidden;!e&&t&&r.current(),e=t},a=()=>{document.hidden||r.current()};return document.addEventListener("visibilitychange",s),window.addEventListener("focus",a),()=>{document.removeEventListener("visibilitychange",s),window.removeEventListener("focus",a)}},[t])}(()=>{u()}),(0,s.useEffect)(()=>{let t=i.get("refresh"),s=i.get("scrollTo"),r=i.get("action");if("funnel"===t||"followup"===t){let t=new URL(window.location.href);t.searchParams.delete("refresh"),e.replace(t.pathname+t.search,{scroll:!1}),u()}if("content"===s){setTimeout(()=>{let e=document.getElementById("content-tiles");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},300);let t=new URL(window.location.href);t.searchParams.delete("scrollTo"),e.replace(t.pathname+t.search,{scroll:!1})}if("resume"===r&&o?.nextStep?.target){setTimeout(()=>{e.push(o.nextStep.target)},500);let t=new URL(window.location.href);t.searchParams.delete("action"),e.replace(t.pathname+t.search,{scroll:!1})}},[i,e,u,o]),(0,t.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-sky-50 via-slate-50 to-slate-100 dark:from-slate-800 dark:via-slate-900 dark:to-slate-950 transition-colors duration-150",children:[(0,t.jsx)(a.default,{variant:"with-title",title:"Dashboard",subtitle:"Rhythmologicum Connect",showBack:!1}),(0,t.jsx)("main",{className:"flex-1 overflow-y-auto px-4 pt-4 sm:pt-6",style:{paddingBottom:"calc(6rem + env(safe-area-inset-bottom))"},children:(0,t.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:["loading"===c&&!o&&(0,t.jsx)("div",{className:"py-12",children:(0,t.jsx)(l.LoadingSpinner,{size:"lg",text:"Dashboard wird geladen...",centered:!0})}),"revalidating"===c&&h&&o&&(0,t.jsx)("div",{className:"bg-sky-50 border border-sky-200 rounded-lg px-4 py-2 text-sm text-sky-700",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-sky-600 border-t-transparent rounded-full"}),(0,t.jsx)("span",{children:"Aktualisiere Dashboard..."})]})}),x&&(0,t.jsx)(n.ErrorState,{title:"Fehler beim Laden",message:x,onRetry:m,centered:!o}),o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d,{}),(0,t.jsx)(S,{}),o.nextStep&&(0,t.jsx)(E,{nextStep:o.nextStep,onAction:()=>{o?.nextStep?.target&&e.push(o.nextStep.target)}}),(0,t.jsx)("div",{id:"content-tiles",children:(0,t.jsx)(w,{tiles:o.contentTiles,onTileClick:t=>{t.actionTarget&&e.push(t.actionTarget)}})}),(0,t.jsx)(_,{funnelSummaries:o.funnelSummaries,workupSummary:o.workupSummary,onFunnelClick:t=>{e.push(`/patient/funnel/${t.slug}`)}})]})]})})]})}e.s(["default",()=>z],16616)}]);

//# sourceMappingURL=55dc26841c7ea41b.js.map