(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31713,e=>{"use strict";var t=e.i(18050),a=e.i(71645);e.i(17152);var n=e.i(66763),i=e.i(18566);e.i(47446);var r=e.i(29801),s=e.i(64389);function l(e){switch(e){case"patient":return"/patient";case"clinician":case"nurse":return"/clinician";case"admin":return"/admin"}}function o({role:e,patientOnboardingPath:t}){let a="/";return"patient"===e?a=t??l("patient"):("clinician"===e||"admin"===e||"nurse"===e)&&(a=l(e)),a}async function d(){let{data:e}=await n.supabase.auth.getSession(),t=e.session;t&&await fetch("/api/auth/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"SIGNED_IN",session:t})})}async function c(){try{let e=await fetch("/api/auth/resolve-role",{method:"GET"});if(401===e.status)return{kind:"unauthenticated"};if(!e.ok)return{kind:"fallback_patient"};let t=await e.json();if(!t||"object"!=typeof t)return{kind:"fallback_patient"};let a=t.data;if(!a||"object"!=typeof a)return{kind:"fallback_patient"};let n=a.role,i=a.requiresOnboarding,r=a.reason;if("patient"===n||"clinician"===n||"admin"===n||"nurse"===n)return{kind:"ok",value:{role:n,requiresOnboarding:!0===i,reason:r}};return{kind:"fallback_patient"}}catch{return{kind:"fallback_patient"}}}async function u(){try{let e=await fetch("/api/patient/onboarding-status",{method:"GET",cache:"no-store"});if(401===e.status)return{kind:"unauthenticated"};if(!e.ok)return{kind:"fallback"};let t=await e.json();if(!t||"object"!=typeof t||!("success"in t)||!0!==t.success)return{kind:"fallback"};if(t.data.needsConsent)return{kind:"ok",path:"/patient/onboarding/consent"};if(t.data.needsProfile)return{kind:"ok",path:"/patient/onboarding/profile"};return{kind:"fallback"}}catch{return{kind:"fallback"}}}async function h(e){if("patient"===e){let t=await u();if("unauthenticated"===t.kind)return null;if("ok"===t.kind)return o({role:e,patientOnboardingPath:t.path})}return o({role:e})}function m(){let e=(0,i.useRouter)(),[l,o]=(0,a.useState)(""),[u,m]=(0,a.useState)(""),[p,g]=(0,a.useState)("login"),[x,f]=(0,a.useState)(!1),[b,k]=(0,a.useState)(null),[w,y]=(0,a.useState)(null),[j,v]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{let{data:{user:t}}=await n.supabase.auth.getUser();if(t){await d();let t=await c();if("unauthenticated"===t.kind)return;let a="fallback_patient"===t.kind?"patient":t.value.role,n=await h(a);n&&e.replace(n)}})()},[e]),(0,a.useEffect)(()=>{let{data:{subscription:e}}=n.supabase.auth.onAuthStateChange(async(e,t)=>{await fetch("/api/auth/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:e,session:t})})});return()=>e.unsubscribe()},[]),(0,a.useEffect)(()=>{fetch("/version.json").then(e=>{if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{e&&"string"==typeof e.commitHashShort&&"string"==typeof e.commitDate&&v(e)}).catch(e=>console.error("Failed to load version info:",e))},[]),(0,a.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t=e.get("error"),a=e.get("message");t&&a&&(k(a),window.history.replaceState({},"","/"))},[]);let N=async t=>{t.preventDefault(),k(null),y(null);let a=l.trim(),i=u.trim();if(!a||!i)return void k("Bitte E-Mail und Passwort eingeben.");f(!0);try{if("signup"===p){let{error:e}=await n.supabase.auth.signUp({email:a,password:i});if(e)throw e;y("Ihr Konto wurde angelegt. Bitte prüfen Sie Ihre E-Mails, um Ihre Adresse zu bestätigen.");return}{let{error:e}=await n.supabase.auth.signInWithPassword({email:a,password:i});if(e)throw e}await d();let{data:{user:t},error:r}=await n.supabase.auth.getUser();if(r)throw r;if(!t)throw Error("Kein Benutzerprofil gefunden.");let s=await c();if("unauthenticated"===s.kind)return void k("Bitte einloggen.");let l="fallback_patient"===s.kind?"patient":s.value.role,o=await h(l);if(!o)return void k("Bitte einloggen.");e.replace(o)}catch(e){console.error(e),k(e?.message??e?.error_description??"Es ist ein unerwarteter Fehler aufgetreten.")}finally{f(!1)}},S=""!==l.trim()&&""!==u.trim()&&!x;return(0,t.jsxs)("main",{className:"min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-900 px-4 py-10 transition-colors duration-150 relative",children:[(0,t.jsx)("div",{className:"absolute top-4 right-4",children:(0,t.jsx)(r.ThemeToggle,{size:"md"})}),(0,t.jsxs)("div",{className:"w-full max-w-5xl flex flex-col md:flex-row items-stretch gap-8",children:[(0,t.jsxs)("div",{className:"w-full md:w-[420px] rounded-3xl bg-white/80 dark:bg-slate-800/80 backdrop-blur p-8 shadow-lg transition-colors duration-150",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-4xl sm:text-5xl font-bold tracking-tight text-sky-600 dark:text-sky-400",children:"RHYTHM"}),(0,t.jsx)("h2",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-slate-900 dark:text-slate-100",children:"Rhythmologicum Connect"})]}),(0,t.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed",children:"Willkommen! Dieser Bereich dient dem sicheren Zugang zu Ihrem persönlichen Stress- & Resilienz-Programm."}),(0,t.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed",children:"Ihre Angaben werden vertraulich behandelt und ausschließlich zur Durchführung Ihrer Stress- & Resilienz-Analyse genutzt."}),(0,t.jsx)("a",{href:"/datenschutz",className:"inline-flex text-sm font-medium text-sky-700 dark:text-sky-400 hover:text-sky-800 dark:hover:text-sky-300",children:"Datenschutz & Datennutzung"})]}),j&&(0,t.jsxs)("div",{className:"mt-6 pt-4 border-t border-slate-100 dark:border-slate-700 text-sm text-slate-500 dark:text-slate-400 space-y-1",children:[(0,t.jsxs)("p",{children:["Version: ",(0,t.jsx)("span",{className:"font-mono",children:j.commitHashShort})]}),(0,t.jsx)("p",{children:new Date(j.commitDate).toLocaleString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]})]}),(0,t.jsxs)("div",{className:"flex-1 rounded-3xl bg-white dark:bg-slate-800 p-8 shadow-lg transition-colors duration-150",children:[(0,t.jsxs)("div",{className:"mb-6 grid grid-cols-2 rounded-full bg-slate-100 dark:bg-slate-700 p-1 text-sm font-medium",children:[(0,t.jsx)("button",{type:"button",onClick:()=>g("login"),className:`rounded-full py-2 transition ${"login"===p?"bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-slate-100":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:"Einloggen"}),(0,t.jsx)("button",{type:"button",onClick:()=>g("signup"),className:`rounded-full py-2 transition ${"signup"===p?"bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-slate-100":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:"Registrieren"})]}),(0,t.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"E-Mail"}),(0,t.jsx)(s.Input,{id:"email",type:"email",required:!0,autoComplete:"email",value:l,onChange:e=>o(e.target.value),inputSize:"md"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Passwort"}),(0,t.jsx)(s.Input,{id:"password",type:"password",required:!0,minLength:6,autoComplete:"login"===p?"current-password":"new-password",value:u,onChange:e=>m(e.target.value),inputSize:"md",helperText:"Mindestens 6 Zeichen."})]}),b&&(0,t.jsx)("p",{className:"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2",children:b}),w&&(0,t.jsx)("p",{className:"text-sm text-green-600 bg-green-50 border border-green-100 rounded-lg px-3 py-2",children:w}),(0,t.jsx)("button",{type:"submit",disabled:!S,className:"w-full rounded-xl bg-sky-600 dark:bg-sky-500 text-white px-4 py-2 font-semibold shadow-sm hover:bg-sky-700 dark:hover:bg-sky-600 disabled:opacity-60 transition",children:x?"Bitte warten…":"signup"===p?"Konto anlegen":"Einloggen"})]})]})]})]})}e.s(["default",()=>m],31713)}]);

//# sourceMappingURL=ebfc0d2af86dc50a.js.map