(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,27751,e=>{"use strict";var t=e.i(18050),s=e.i(71645),r=e.i(18566);e.i(17152);var a=e.i(66763),l=e.i(84976);function n(e,t){if(void 0===e)return t;let s=e.toLowerCase().trim();return"true"===s||"1"===s||"yes"===s}let i={AMY_ENABLED:n(l.env.NEXT_PUBLIC_FEATURE_AMY_ENABLED,!0),CLINICIAN_DASHBOARD_ENABLED:n(l.env.NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED,!0),CHARTS_ENABLED:n(l.env.NEXT_PUBLIC_FEATURE_CHARTS_ENABLED,!0)};function o(){let e=(0,r.useRouter)(),[l,n]=(0,s.useState)({status:"idle"}),[o,d]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{let{data:{user:t},error:s}=await a.supabase.auth.getUser();if(s||!t){console.error("Fehler bei getUser:",s),e.push("/");return}let{data:r,error:l}=await a.supabase.from("patient_profiles").select("id").eq("user_id",t.id).single();if(l||!r){console.error("Fehler beim Laden des Patientenprofils:",l),n({status:"error",message:"Ihr Profil konnte nicht geladen werden. Bitte versuchen Sie es spÃ¤ter erneut."});return}try{n({status:"loading"});let e=await fetch(`/api/patient-measures/history?patientId=${r.id}`);if(!e.ok)throw Error("Fehler beim Laden der Verlaufsdaten.");let t=await e.json();n({status:"success",measures:t.measures||[]})}catch(e){console.error("Fehler beim Laden der Verlaufsdaten:",e),n({status:"error",message:"Die Verlaufsdaten konnten nicht geladen werden. Bitte versuchen Sie es spÃ¤ter erneut."})}})()},[e]);let c=e=>{if(!e)return"Datum unbekannt";try{let t=new Date(e);return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(t)}catch{return"Datum unbekannt"}},x=async()=>{try{d(!0);let{data:{session:e},error:t}=await a.supabase.auth.getSession();if(t||!e){console.error("Fehler beim Abrufen der Session:",t),alert("Fehler: Sie sind nicht angemeldet.");return}let s=await fetch("/api/patient-measures/export",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||"Fehler beim Exportieren der Daten.")}let r=await s.json(),l=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),n=window.URL.createObjectURL(l),i=document.createElement("a");i.href=n,i.download=`verlaufsdaten-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n)}catch(e){console.error("Fehler beim Exportieren:",e),alert("Fehler beim Exportieren der Daten. Bitte versuchen Sie es spÃ¤ter erneut.")}finally{d(!1)}};if("loading"===l.status||"idle"===l.status)return(0,t.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10",children:[(0,t.jsxs)("section",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl",children:"Ihr Verlauf"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"Ihre bisherigen Stress- und Schlaf-Messungen"})]}),(0,t.jsxs)("section",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"h-6 w-40 animate-pulse rounded bg-slate-200"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"h-32 animate-pulse rounded-xl bg-slate-200"}),(0,t.jsx)("div",{className:"h-32 animate-pulse rounded-xl bg-slate-200"}),(0,t.jsx)("div",{className:"h-32 animate-pulse rounded-xl bg-slate-200"})]})]})]});if("error"===l.status)return(0,t.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>e.push("/patient/dashboard"),className:"self-start inline-flex items-center gap-2 text-sm font-medium text-sky-700 hover:text-sky-900 hover:underline transition-colors","aria-label":"ZurÃ¼ck zum Dashboard",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"ZurÃ¼ck zum Dashboard"]}),(0,t.jsx)("section",{children:(0,t.jsx)("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl",children:"Ihr Verlauf"})}),(0,t.jsxs)("section",{className:"rounded-xl border border-red-100 bg-red-50 px-4 py-4 text-sm text-red-800",children:[(0,t.jsx)("p",{className:"font-medium",children:"Fehler beim Laden der Daten"}),(0,t.jsx)("p",{className:"mt-1",children:l.message}),(0,t.jsxs)("div",{className:"mt-3 flex gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>e.refresh(),className:"inline-flex items-center rounded-md border border-red-300 bg-white px-3 py-1.5 text-xs font-medium text-red-800 shadow-sm hover:bg-red-50",children:"Noch einmal versuchen"}),(0,t.jsx)("button",{type:"button",onClick:()=>e.push("/patient/dashboard"),className:"inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50",children:"Zum Dashboard"})]})]})]});let{measures:m}=l;if(0===m.length)return(0,t.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>e.push("/patient/dashboard"),className:"self-start inline-flex items-center gap-2 text-sm font-medium text-sky-700 hover:text-sky-900 hover:underline transition-colors","aria-label":"ZurÃ¼ck zum Dashboard",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"ZurÃ¼ck zum Dashboard"]}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl",children:"Ihr Verlauf"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"Ihre bisherigen Stress- und Schlaf-Messungen"})]}),(0,t.jsx)("section",{className:"rounded-xl border border-slate-200 bg-white px-6 py-12 text-center",children:(0,t.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,t.jsx)("p",{className:"text-4xl mb-4","aria-label":"Verlaufsdiagramm-Symbol",children:"ðŸ“Š"}),(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Noch keine Messungen vorhanden"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-slate-600 leading-relaxed",children:"Sie haben bisher noch keine Stress- oder Schlaf-Messungen durchgefÃ¼hrt. Starten Sie jetzt mit Ihrer ersten Messung, um Ihren Verlauf zu dokumentieren."}),(0,t.jsx)("button",{type:"button",onClick:()=>e.push("/patient/dashboard"),className:"mt-6 inline-flex items-center rounded-lg px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:opacity-90 transition-opacity",style:{backgroundColor:"var(--color-primary-600)"},children:"Zum Dashboard"})]})})]});let u=m[0],h=u?.report?.score_numeric??u?.stress_score??null,p=u?.report?.sleep_score??u?.sleep_score??null;return(0,t.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10",children:[(0,t.jsx)("section",{children:(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>e.push("/patient/dashboard"),className:"self-start inline-flex items-center gap-2 text-sm font-medium text-sky-700 hover:text-sky-900 hover:underline transition-colors","aria-label":"ZurÃ¼ck zum Dashboard",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"ZurÃ¼ck zum Dashboard"]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl",children:"Ihr Verlauf"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"Ihre bisherigen Stress- und Schlaf-Messungen im Ãœberblick"})]}),(0,t.jsx)("button",{type:"button",onClick:x,disabled:o,className:"inline-flex items-center gap-2 rounded-lg border px-4 py-2.5 text-sm font-semibold shadow-sm hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed transition-opacity",style:{borderColor:"var(--color-neutral-200)",backgroundColor:"var(--background)",color:"var(--color-neutral-700)"},children:o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-slate-300 border-t-slate-600"}),"Exportiere..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Als JSON exportieren"]})})]}),(0,t.jsxs)("button",{type:"button",onClick:()=>e.push("/patient/assessment"),className:"w-full inline-flex justify-center items-center gap-2 px-5 py-3 rounded-lg text-white text-sm font-semibold shadow-sm hover:opacity-90 transition-opacity",style:{backgroundColor:"var(--color-primary-600)"},"aria-label":"Neue Messung durchfÃ¼hren",children:[(0,t.jsx)("span",{className:"text-base","aria-hidden":"true",children:"âœ“"}),"Neue Messung durchfÃ¼hren"]})]})}),(0,t.jsxs)("section",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-500",children:"Messungen gesamt"}),(0,t.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:m.length}),(0,t.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:["Erste Messung: ",c(m[m.length-1]?.created_at)]})]}),(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-500",children:"Letzter Stress-Score"}),null!=h?(0,t.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:Math.round(h)}):(0,t.jsx)("p",{className:"mt-2 text-sm text-slate-400",children:"Keine Daten"}),(0,t.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:["Von ",c(m[0]?.created_at)]})]}),(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-500",children:"Letzter Schlaf-Score"}),null!=p?(0,t.jsx)("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:Math.round(p)}):(0,t.jsx)("p",{className:"mt-2 text-sm text-slate-400",children:"Keine Daten"}),(0,t.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:["Von ",c(m[0]?.created_at)]})]})]}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h2",{className:"mb-4 text-base font-semibold text-slate-800",children:"Chronologischer Verlauf"}),(0,t.jsx)("div",{className:"space-y-4",children:m.map((e,s)=>{let r=e.report,a=!!r,l=r?.score_numeric??e.stress_score??null,n=r?.sleep_score??e.sleep_score??null,o=r?.risk_level??e.risk_level??null,d=r?.report_text_short??null;return(0,t.jsxs)("article",{className:"rounded-xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-slate-900",children:0===s?"Neueste Messung":`Messung vom ${c(e.created_at)}`}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:(e=>{if(!e)return"Datum unbekannt";try{let t=new Date(e);return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}catch{return"Datum unbekannt"}})(e.created_at)})]}),o&&(0,t.jsx)("span",{className:`inline-flex items-center self-start rounded-full border px-2.5 py-1 text-xs font-medium ${(e=>{switch(e){case"low":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"moderate":return"bg-amber-100 text-amber-800 border-amber-200";case"high":return"bg-red-100 text-red-800 border-red-200";case"pending":return"bg-slate-100 text-slate-600 border-slate-200";default:return"bg-slate-100 text-slate-700 border-slate-200"}})(o)}`,children:(e=>{if(!e)return"Nicht klassifiziert";switch(e){case"low":return"Niedriges Risiko";case"moderate":return"Moderates Risiko";case"high":return"ErhÃ¶htes Risiko";case"pending":return"Wird ermittelt";default:return"Nicht klassifiziert"}})(o)})]}),(0,t.jsxs)("div",{className:"mb-4 grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"rounded-lg border border-slate-100 bg-slate-50 p-3",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-slate-600",children:"Stress-Score"}),null!=l?(0,t.jsx)("p",{className:"mt-1 text-xl font-semibold text-slate-900",children:Math.round(l)}):(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"â€”"})]}),(0,t.jsxs)("div",{className:"rounded-lg border border-slate-100 bg-slate-50 p-3",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-slate-600",children:"Schlaf-Score"}),null!=n?(0,t.jsx)("p",{className:"mt-1 text-xl font-semibold text-slate-900",children:Math.round(n)}):(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"â€”"})]})]}),i.AMY_ENABLED&&d&&(0,t.jsxs)("div",{className:"rounded-lg border border-sky-100 bg-sky-50/50 px-4 py-3",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-sky-900",children:"Einordnung von AMY"}),(0,t.jsx)("span",{className:"inline-flex items-center rounded-full bg-sky-100 px-2 py-0.5 text-[10px] font-medium text-sky-700",children:"KI-Assistenz"})]}),(0,t.jsx)("p",{className:"text-sm leading-6 text-sky-900 whitespace-pre-line",children:d})]}),i.AMY_ENABLED&&a&&!d&&(0,t.jsx)("div",{className:"rounded-lg border border-slate-100 bg-slate-50 px-4 py-3",children:(0,t.jsx)("p",{className:"text-xs text-slate-600",children:"FÃ¼r diese Messung liegt noch kein AMY-Text vor."})}),i.AMY_ENABLED&&!a&&(0,t.jsx)("div",{className:"rounded-lg border border-amber-100 bg-amber-50 px-4 py-3",children:(0,t.jsx)("p",{className:"text-xs text-amber-800",children:"Die Auswertung fÃ¼r diese Messung wird noch erstellt."})})]},e.id)})})]})]})}e.s(["default",()=>o],27751)}]);

//# sourceMappingURL=e8dd4c67d8abb20b.js.map