{"version":3,"sources":["turbopack:///[project]/apps/rhythm-patient-ui/app/patient/history/PatientHistoryClient.tsx","turbopack:///[project]/lib/featureFlags.ts"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { supabase } from '@/lib/supabaseClient'\nimport { featureFlags } from '@/lib/featureFlags'\n\ntype RiskLevel = 'low' | 'moderate' | 'high' | 'pending' | null\n\ntype Report = {\n  id: string\n  assessment_id: string\n  score_numeric: number | null\n  sleep_score: number | null\n  risk_level: RiskLevel\n  report_text_short: string | null\n  created_at: string\n  updated_at: string\n}\n\ntype Measure = {\n  id: string\n  patient_id: string\n  created_at: string\n  report_id: string | null\n  stress_score: number | null\n  sleep_score: number | null\n  risk_level: RiskLevel | 'pending' | null\n  report: Report | null\n}\n\ntype FetchState =\n  | { status: 'idle' }\n  | { status: 'loading' }\n  | { status: 'success'; measures: Measure[] }\n  | { status: 'error'; message: string }\n\nexport default function PatientHistoryClient() {\n  const router = useRouter()\n  const [state, setState] = useState<FetchState>({ status: 'idle' })\n  const [isExporting, setIsExporting] = useState(false)\n\n  useEffect(() => {\n    const checkAuthAndFetch = async () => {\n      // 1. Check authentication\n      const {\n        data: { user },\n        error: authError,\n      } = await supabase.auth.getUser()\n\n      if (authError || !user) {\n        console.error('Fehler bei getUser:', authError)\n        router.push('/')\n        return\n      }\n\n      // 2. Get patient profile\n      const { data: profileData, error: profileError } = await supabase\n        .from('patient_profiles')\n        .select('id')\n        .eq('user_id', user.id)\n        .single()\n\n      if (profileError || !profileData) {\n        console.error('Fehler beim Laden des Patientenprofils:', profileError)\n        setState({\n          status: 'error',\n          message:\n            'Ihr Profil konnte nicht geladen werden. Bitte versuchen Sie es sp√§ter erneut.',\n        })\n        return\n      }\n\n      // 3. Fetch patient history\n      try {\n        setState({ status: 'loading' })\n\n        const res = await fetch(\n          `/api/patient-measures/history?patientId=${profileData.id}`\n        )\n\n        if (!res.ok) {\n          throw new Error('Fehler beim Laden der Verlaufsdaten.')\n        }\n\n        const json = await res.json()\n\n        setState({\n          status: 'success',\n          measures: json.measures || [],\n        })\n      } catch (err) {\n        console.error('Fehler beim Laden der Verlaufsdaten:', err)\n        setState({\n          status: 'error',\n          message:\n            'Die Verlaufsdaten konnten nicht geladen werden. Bitte versuchen Sie es sp√§ter erneut.',\n        })\n      }\n    }\n\n    checkAuthAndFetch()\n  }, [router])\n\n  // Helper functions\n  const formatDateTime = (iso: string | null | undefined) => {\n    if (!iso) return 'Datum unbekannt'\n    try {\n      const d = new Date(iso)\n      return new Intl.DateTimeFormat('de-DE', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n      }).format(d)\n    } catch {\n      return 'Datum unbekannt'\n    }\n  }\n\n  const formatDate = (iso: string | null | undefined) => {\n    if (!iso) return 'Datum unbekannt'\n    try {\n      const d = new Date(iso)\n      return new Intl.DateTimeFormat('de-DE', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric',\n      }).format(d)\n    } catch {\n      return 'Datum unbekannt'\n    }\n  }\n\n  const riskLabel = (risk: RiskLevel) => {\n    if (!risk) return 'Nicht klassifiziert'\n    switch (risk) {\n      case 'low':\n        return 'Niedriges Risiko'\n      case 'moderate':\n        return 'Moderates Risiko'\n      case 'high':\n        return 'Erh√∂htes Risiko'\n      case 'pending':\n        return 'Wird ermittelt'\n      default:\n        return 'Nicht klassifiziert'\n    }\n  }\n\n  const riskBadgeClasses = (risk: RiskLevel) => {\n    switch (risk) {\n      case 'low':\n        return 'bg-emerald-100 text-emerald-800 border-emerald-200'\n      case 'moderate':\n        return 'bg-amber-100 text-amber-800 border-amber-200'\n      case 'high':\n        return 'bg-red-100 text-red-800 border-red-200'\n      case 'pending':\n        return 'bg-slate-100 text-slate-600 border-slate-200'\n      default:\n        return 'bg-slate-100 text-slate-700 border-slate-200'\n    }\n  }\n\n  const handleExportJSON = async () => {\n    try {\n      setIsExporting(true)\n\n      // Get the current session\n      const {\n        data: { session },\n        error: sessionError,\n      } = await supabase.auth.getSession()\n\n      if (sessionError || !session) {\n        console.error('Fehler beim Abrufen der Session:', sessionError)\n        alert('Fehler: Sie sind nicht angemeldet.')\n        return\n      }\n\n      // Call the export endpoint with authorization header\n      const res = await fetch('/api/patient-measures/export', {\n        headers: {\n          Authorization: `Bearer ${session.access_token}`,\n        },\n      })\n\n      if (!res.ok) {\n        const errorData = await res.json().catch(() => ({}))\n        throw new Error(\n          errorData.error || 'Fehler beim Exportieren der Daten.'\n        )\n      }\n\n      const data = await res.json()\n\n      // Create a blob and download the file\n      const blob = new Blob([JSON.stringify(data, null, 2)], {\n        type: 'application/json',\n      })\n      const url = window.URL.createObjectURL(blob)\n      const a = document.createElement('a')\n      a.href = url\n      a.download = `verlaufsdaten-export-${new Date().toISOString().split('T')[0]}.json`\n      document.body.appendChild(a)\n      a.click()\n      document.body.removeChild(a)\n      window.URL.revokeObjectURL(url)\n    } catch (err) {\n      console.error('Fehler beim Exportieren:', err)\n      alert(\n        'Fehler beim Exportieren der Daten. Bitte versuchen Sie es sp√§ter erneut.'\n      )\n    } finally {\n      setIsExporting(false)\n    }\n  }\n\n  // Render states\n  if (state.status === 'loading' || state.status === 'idle') {\n    return (\n      <div className=\"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10\">\n        <section>\n          <h1 className=\"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl\">\n            Ihr Verlauf\n          </h1>\n          <p className=\"mt-1 text-sm text-slate-500\">\n            Ihre bisherigen Stress- und Schlaf-Messungen\n          </p>\n        </section>\n\n        <section className=\"space-y-4\">\n          <div className=\"h-6 w-40 animate-pulse rounded bg-slate-200\" />\n          <div className=\"space-y-3\">\n            <div className=\"h-32 animate-pulse rounded-xl bg-slate-200\" />\n            <div className=\"h-32 animate-pulse rounded-xl bg-slate-200\" />\n            <div className=\"h-32 animate-pulse rounded-xl bg-slate-200\" />\n          </div>\n        </section>\n      </div>\n    )\n  }\n\n  if (state.status === 'error') {\n    return (\n      <div className=\"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10\">\n        {/* E6.5.8: Back to Dashboard button in error state */}\n        <button\n          type=\"button\"\n          onClick={() => router.push('/patient/dashboard')}\n          className=\"self-start inline-flex items-center gap-2 text-sm font-medium text-sky-700 hover:text-sky-900 hover:underline transition-colors\"\n          aria-label=\"Zur√ºck zum Dashboard\"\n        >\n          <svg\n            className=\"w-4 h-4\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M15 19l-7-7 7-7\"\n            />\n          </svg>\n          Zur√ºck zum Dashboard\n        </button>\n        \n        <section>\n          <h1 className=\"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl\">\n            Ihr Verlauf\n          </h1>\n        </section>\n\n        <section className=\"rounded-xl border border-red-100 bg-red-50 px-4 py-4 text-sm text-red-800\">\n          <p className=\"font-medium\">Fehler beim Laden der Daten</p>\n          <p className=\"mt-1\">{state.message}</p>\n          <div className=\"mt-3 flex gap-3\">\n            <button\n              type=\"button\"\n              onClick={() => router.refresh()}\n              className=\"inline-flex items-center rounded-md border border-red-300 bg-white px-3 py-1.5 text-xs font-medium text-red-800 shadow-sm hover:bg-red-50\"\n            >\n              Noch einmal versuchen\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => router.push('/patient/dashboard')}\n              className=\"inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50\"\n            >\n              Zum Dashboard\n            </button>\n          </div>\n        </section>\n      </div>\n    )\n  }\n\n  // status === 'success'\n  const { measures } = state\n\n  if (measures.length === 0) {\n    return (\n      <div className=\"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10\">\n        {/* E6.5.8: Back to Dashboard button in empty state */}\n        <button\n          type=\"button\"\n          onClick={() => router.push('/patient/dashboard')}\n          className=\"self-start inline-flex items-center gap-2 text-sm font-medium text-sky-700 hover:text-sky-900 hover:underline transition-colors\"\n          aria-label=\"Zur√ºck zum Dashboard\"\n        >\n          <svg\n            className=\"w-4 h-4\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M15 19l-7-7 7-7\"\n            />\n          </svg>\n          Zur√ºck zum Dashboard\n        </button>\n        \n        <section>\n          <h1 className=\"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl\">\n            Ihr Verlauf\n          </h1>\n          <p className=\"mt-1 text-sm text-slate-500\">\n            Ihre bisherigen Stress- und Schlaf-Messungen\n          </p>\n        </section>\n\n        <section className=\"rounded-xl border border-slate-200 bg-white px-6 py-12 text-center\">\n          <div className=\"mx-auto max-w-md\">\n            <p className=\"text-4xl mb-4\" aria-label=\"Verlaufsdiagramm-Symbol\">üìä</p>\n            <h2 className=\"text-lg font-semibold text-slate-900\">\n              Noch keine Messungen vorhanden\n            </h2>\n            <p className=\"mt-2 text-sm text-slate-600 leading-relaxed\">\n              Sie haben bisher noch keine Stress- oder Schlaf-Messungen\n              durchgef√ºhrt. Starten Sie jetzt mit Ihrer ersten Messung, um Ihren\n              Verlauf zu dokumentieren.\n            </p>\n            <button\n              type=\"button\"\n              onClick={() => router.push('/patient/dashboard')}\n              className=\"mt-6 inline-flex items-center rounded-lg px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:opacity-90 transition-opacity\"\n              style={{\n                backgroundColor: 'var(--color-primary-600)',\n              }}\n            >\n              Zum Dashboard\n            </button>\n          </div>\n        </section>\n      </div>\n    )\n  }\n\n  const latestMeasurement = measures[0]\n  const latestStressScore =\n    latestMeasurement?.report?.score_numeric ?? latestMeasurement?.stress_score ?? null\n  const latestSleepScore =\n    latestMeasurement?.report?.sleep_score ?? latestMeasurement?.sleep_score ?? null\n\n  return (\n    <div className=\"mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-10\">\n      {/* Header */}\n      <section>\n        <div className=\"flex flex-col gap-3\">\n          {/* E6.5.8: Back to Dashboard button */}\n          <button\n            type=\"button\"\n            onClick={() => router.push('/patient/dashboard')}\n            className=\"self-start inline-flex items-center gap-2 text-sm font-medium text-sky-700 hover:text-sky-900 hover:underline transition-colors\"\n            aria-label=\"Zur√ºck zum Dashboard\"\n          >\n            <svg\n              className=\"w-4 h-4\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M15 19l-7-7 7-7\"\n              />\n            </svg>\n            Zur√ºck zum Dashboard\n          </button>\n          \n          <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-semibold tracking-tight text-slate-900 md:text-3xl\">\n                Ihr Verlauf\n              </h1>\n              <p className=\"mt-1 text-sm text-slate-500\">\n                Ihre bisherigen Stress- und Schlaf-Messungen im √úberblick\n              </p>\n            </div>\n            <button\n              type=\"button\"\n              onClick={handleExportJSON}\n              disabled={isExporting}\n              className=\"inline-flex items-center gap-2 rounded-lg border px-4 py-2.5 text-sm font-semibold shadow-sm hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed transition-opacity\"\n              style={{\n                borderColor: 'var(--color-neutral-200)',\n                backgroundColor: 'var(--background)',\n                color: 'var(--color-neutral-700)',\n              }}\n            >\n              {isExporting ? (\n                <>\n                  <span className=\"h-4 w-4 animate-spin rounded-full border-2 border-slate-300 border-t-slate-600\" />\n                  Exportiere...\n                </>\n              ) : (\n                <>\n                  <svg\n                    className=\"h-4 w-4\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n                    />\n                  </svg>\n                  Als JSON exportieren\n                </>\n              )}\n            </button>\n          </div>\n          \n          {/* New Check CTA */}\n          <button\n            type=\"button\"\n            onClick={() => router.push('/patient/assessment')}\n            className=\"w-full inline-flex justify-center items-center gap-2 px-5 py-3 rounded-lg text-white text-sm font-semibold shadow-sm hover:opacity-90 transition-opacity\"\n            style={{\n              backgroundColor: 'var(--color-primary-600)',\n            }}\n            aria-label=\"Neue Messung durchf√ºhren\"\n          >\n            <span className=\"text-base\" aria-hidden=\"true\">‚úì</span>\n            Neue Messung durchf√ºhren\n          </button>\n        </div>\n      </section>\n\n      {/* Summary Cards */}\n      <section className=\"grid grid-cols-1 gap-4 sm:grid-cols-3\">\n        <div className=\"rounded-xl border border-slate-200 bg-white p-4 shadow-sm\">\n          <p className=\"text-xs font-medium uppercase tracking-wide text-slate-500\">\n            Messungen gesamt\n          </p>\n          <p className=\"mt-2 text-2xl font-semibold text-slate-900\">\n            {measures.length}\n          </p>\n          <p className=\"mt-1 text-[11px] text-slate-500\">\n            Erste Messung: {formatDate(measures[measures.length - 1]?.created_at)}\n          </p>\n        </div>\n\n        <div className=\"rounded-xl border border-slate-200 bg-white p-4 shadow-sm\">\n          <p className=\"text-xs font-medium uppercase tracking-wide text-slate-500\">\n            Letzter Stress-Score\n          </p>\n          {latestStressScore != null ? (\n            <p className=\"mt-2 text-2xl font-semibold text-slate-900\">\n              {Math.round(latestStressScore)}\n            </p>\n          ) : (\n            <p className=\"mt-2 text-sm text-slate-400\">Keine Daten</p>\n          )}\n          <p className=\"mt-1 text-[11px] text-slate-500\">\n            Von {formatDate(measures[0]?.created_at)}\n          </p>\n        </div>\n\n        <div className=\"rounded-xl border border-slate-200 bg-white p-4 shadow-sm\">\n          <p className=\"text-xs font-medium uppercase tracking-wide text-slate-500\">\n            Letzter Schlaf-Score\n          </p>\n          {latestSleepScore != null ? (\n            <p className=\"mt-2 text-2xl font-semibold text-slate-900\">\n              {Math.round(latestSleepScore)}\n            </p>\n          ) : (\n            <p className=\"mt-2 text-sm text-slate-400\">Keine Daten</p>\n          )}\n          <p className=\"mt-1 text-[11px] text-slate-500\">\n            Von {formatDate(measures[0]?.created_at)}\n          </p>\n        </div>\n      </section>\n\n      {/* Timeline/History */}\n      <section>\n        <h2 className=\"mb-4 text-base font-semibold text-slate-800\">\n          Chronologischer Verlauf\n        </h2>\n        <div className=\"space-y-4\">\n          {measures.map((measure, index) => {\n            const report = measure.report\n            const hasReport = !!report\n            const stressScore = report?.score_numeric ?? measure.stress_score ?? null\n            const sleepScore = report?.sleep_score ?? measure.sleep_score ?? null\n            const risk = report?.risk_level ?? measure.risk_level ?? null\n            const amyText = report?.report_text_short ?? null\n\n            return (\n              <article\n                key={measure.id}\n                className=\"rounded-xl border border-slate-200 bg-white p-5 shadow-sm\"\n              >\n                {/* Header */}\n                <div className=\"mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n                  <div>\n                    <h3 className=\"text-sm font-semibold text-slate-900\">\n                      {index === 0 ? 'Neueste Messung' : `Messung vom ${formatDate(measure.created_at)}`}\n                    </h3>\n                    <p className=\"text-xs text-slate-500\">\n                      {formatDateTime(measure.created_at)}\n                    </p>\n                  </div>\n                  {risk && (\n                    <span\n                      className={`inline-flex items-center self-start rounded-full border px-2.5 py-1 text-xs font-medium ${riskBadgeClasses(\n                        risk\n                      )}`}\n                    >\n                      {riskLabel(risk)}\n                    </span>\n                  )}\n                </div>\n\n                {/* Scores */}\n                <div className=\"mb-4 grid grid-cols-2 gap-3\">\n                  <div className=\"rounded-lg border border-slate-100 bg-slate-50 p-3\">\n                    <p className=\"text-xs font-medium text-slate-600\">\n                      Stress-Score\n                    </p>\n                    {stressScore != null ? (\n                      <p className=\"mt-1 text-xl font-semibold text-slate-900\">\n                        {Math.round(stressScore)}\n                      </p>\n                    ) : (\n                      <p className=\"mt-1 text-sm text-slate-400\">‚Äî</p>\n                    )}\n                  </div>\n\n                  <div className=\"rounded-lg border border-slate-100 bg-slate-50 p-3\">\n                    <p className=\"text-xs font-medium text-slate-600\">\n                      Schlaf-Score\n                    </p>\n                    {sleepScore != null ? (\n                      <p className=\"mt-1 text-xl font-semibold text-slate-900\">\n                        {Math.round(sleepScore)}\n                      </p>\n                    ) : (\n                      <p className=\"mt-1 text-sm text-slate-400\">‚Äî</p>\n                    )}\n                  </div>\n                </div>\n\n                {/* AMY Text */}\n                {featureFlags.AMY_ENABLED && amyText && (\n                  <div className=\"rounded-lg border border-sky-100 bg-sky-50/50 px-4 py-3\">\n                    <div className=\"mb-2 flex items-center gap-2\">\n                      <h4 className=\"text-xs font-semibold text-sky-900\">\n                        Einordnung von AMY\n                      </h4>\n                      <span className=\"inline-flex items-center rounded-full bg-sky-100 px-2 py-0.5 text-[10px] font-medium text-sky-700\">\n                        KI-Assistenz\n                      </span>\n                    </div>\n                    <p className=\"text-sm leading-6 text-sky-900 whitespace-pre-line\">\n                      {amyText}\n                    </p>\n                  </div>\n                )}\n\n                {featureFlags.AMY_ENABLED && hasReport && !amyText && (\n                  <div className=\"rounded-lg border border-slate-100 bg-slate-50 px-4 py-3\">\n                    <p className=\"text-xs text-slate-600\">\n                      F√ºr diese Messung liegt noch kein AMY-Text vor.\n                    </p>\n                  </div>\n                )}\n\n                {featureFlags.AMY_ENABLED && !hasReport && (\n                  <div className=\"rounded-lg border border-amber-100 bg-amber-50 px-4 py-3\">\n                    <p className=\"text-xs text-amber-800\">\n                      Die Auswertung f√ºr diese Messung wird noch erstellt.\n                    </p>\n                  </div>\n                )}\n              </article>\n            )\n          })}\n        </div>\n      </section>\n    </div>\n  )\n}\n","/**\n * Feature Flags Configuration\n * \n * Centralized feature flag management for the application.\n * Flags can be controlled via environment variables (NEXT_PUBLIC_FEATURE_*).\n * \n * Environment variables:\n * - NEXT_PUBLIC_FEATURE_AMY_ENABLED: Enable/disable AMY AI assistant (default: true)\n * - NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED: Enable/disable clinician dashboard (default: true)\n * - NEXT_PUBLIC_FEATURE_CHARTS_ENABLED: Enable/disable charts in clinician views (default: true)\n */\n\nimport { env } from '@/lib/env'\n\nexport type FeatureFlags = {\n  AMY_ENABLED: boolean\n  CLINICIAN_DASHBOARD_ENABLED: boolean\n  CHARTS_ENABLED: boolean\n}\n\n/**\n * Parse environment variable to boolean\n * Supports: 'true', '1', 'yes' (case-insensitive) = true\n * Everything else or undefined = uses default value\n */\nexport function parseEnvBoolean(value: string | undefined, defaultValue: boolean): boolean {\n  if (value === undefined) {\n    return defaultValue\n  }\n  const normalized = value.toLowerCase().trim()\n  return normalized === 'true' || normalized === '1' || normalized === 'yes'\n}\n\n/**\n * Feature flags configuration\n * All flags default to true to maintain backward compatibility\n */\nexport const featureFlags: FeatureFlags = {\n  AMY_ENABLED: parseEnvBoolean(\n    env.NEXT_PUBLIC_FEATURE_AMY_ENABLED,\n    true\n  ),\n  CLINICIAN_DASHBOARD_ENABLED: parseEnvBoolean(\n    env.NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED,\n    true\n  ),\n  CHARTS_ENABLED: parseEnvBoolean(\n    env.NEXT_PUBLIC_FEATURE_CHARTS_ENABLED,\n    true\n  ),\n}\n\n/**\n * Check if a specific feature is enabled\n */\nexport function isFeatureEnabled(feature: keyof FeatureFlags): boolean {\n  return featureFlags[feature]\n}\n\n/**\n * Get all feature flags as an object (useful for debugging)\n */\nexport function getAllFeatureFlags(): FeatureFlags {\n  return { ...featureFlags }\n}\n"],"names":[],"mappings":"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"}