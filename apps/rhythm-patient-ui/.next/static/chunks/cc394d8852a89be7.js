(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,95187,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n={callServer:function(){return r.callServer},createServerReference:function(){return s.createServerReference},findSourceMapURL:function(){return o.findSourceMapURL}};for(var i in n)Object.defineProperty(a,i,{enumerable:!0,get:n[i]});let r=e.r(32120),o=e.r(92245),s=e.r(35326)},57234,e=>{"use strict";var t=e.i(18050),a=e.i(71645),n=e.i(18566),i=e.i(95187);let r=(0,i.createServerReference)("4065c67e4958cf201c3bb8de8d8f1709976fb255dc",i.callServer,void 0,i.findSourceMapURL,"saveDocumentConfirmation");var o=e.i(81307);let s=o.z.object({page:o.z.number().optional(),section:o.z.string().optional(),confidence_score:o.z.number().min(0).max(1)}),c=o.z.object({test_name:o.z.string(),value:o.z.union([o.z.number(),o.z.string()]),unit:o.z.string().optional(),reference_range:o.z.string().optional(),date:o.z.string().optional()}),d=o.z.object({name:o.z.string(),dosage:o.z.string().optional(),frequency:o.z.string().optional(),route:o.z.string().optional()}),l=o.z.object({lab_values:o.z.array(c).optional(),medications:o.z.array(d).optional(),vital_signs:o.z.record(o.z.string(),o.z.union([o.z.number(),o.z.string()])).optional(),diagnoses:o.z.array(o.z.string()).optional(),notes:o.z.string().optional()}),u=o.z.object({overall_confidence:o.z.number().min(0).max(1),field_confidence:o.z.record(o.z.string(),o.z.number().min(0).max(1)),evidence:o.z.record(o.z.string(),s),extraction_timestamp:o.z.string()});o.z.object({extractor_version:o.z.string(),input_hash:o.z.string(),extracted_data:l,confidence:u,extracted_at:o.z.string()}),o.z.object({document_id:o.z.string().uuid(),force_reextract:o.z.boolean().optional().default(!1)}),o.z.object({success:o.z.boolean(),data:o.z.object({document_id:o.z.string().uuid(),extractor_version:o.z.string(),input_hash:o.z.string(),extraction_created:o.z.boolean(),extracted_data:l.optional(),confidence:u.optional()}).optional(),error:o.z.object({code:o.z.string(),message:o.z.string()}).optional()});let m="accepted",g=o.z.object({status:o.z.enum(["accepted","edited","rejected"]),original_value:o.z.any().optional(),confirmed_value:o.z.any().optional(),confirmed_at:o.z.string()}),x=o.z.object({lab_values:o.z.array(c).optional(),medications:o.z.array(d).optional(),vital_signs:o.z.record(o.z.string(),o.z.union([o.z.number(),o.z.string()])).optional(),diagnoses:o.z.array(o.z.string()).optional(),notes:o.z.string().optional(),field_confirmations:o.z.record(o.z.string(),g)});function b(e,t=.7){return e<t}function f({documentId:e,initialData:i}){let o=(0,n.useRouter)(),[s,c]=(0,a.useState)(!1),[d,l]=(0,a.useState)(null),[u,g]=(0,a.useState)(()=>i.confirmed_data?.field_confirmations?i.confirmed_data.field_confirmations:{}),[x,b]=(0,a.useState)(()=>i.confirmed_data?{lab_values:i.confirmed_data.lab_values,medications:i.confirmed_data.medications,vital_signs:i.confirmed_data.vital_signs,diagnoses:i.confirmed_data.diagnoses,notes:i.confirmed_data.notes}:i.extracted_data),f=(0,a.useCallback)((e,t)=>{g(a=>({...a,[e]:{status:m,original_value:t,confirmed_value:t,confirmed_at:new Date().toISOString()}}))},[]),z=(0,a.useCallback)((e,t,a)=>{g(n=>({...n,[e]:{status:"edited",original_value:t,confirmed_value:a,confirmed_at:new Date().toISOString()}}))},[]),y=(0,a.useCallback)((e,t)=>{g(a=>({...a,[e]:{status:"rejected",original_value:t,confirmed_at:new Date().toISOString()}}))},[]),N=(0,a.useCallback)(()=>{let e={};i.extracted_data.lab_values?.forEach((t,a)=>{e[`lab_values[${a}]`]={status:m,original_value:t,confirmed_value:t,confirmed_at:new Date().toISOString()}}),i.extracted_data.medications?.forEach((t,a)=>{e[`medications[${a}]`]={status:m,original_value:t,confirmed_value:t,confirmed_at:new Date().toISOString()}}),i.extracted_data.vital_signs&&Object.entries(i.extracted_data.vital_signs).sort(([e],[t])=>e.localeCompare(t)).forEach(([t,a])=>{e[`vital_signs.${t}`]={status:m,original_value:a,confirmed_value:a,confirmed_at:new Date().toISOString()}}),i.extracted_data.diagnoses?.forEach((t,a)=>{e[`diagnoses[${a}]`]={status:m,original_value:t,confirmed_value:t,confirmed_at:new Date().toISOString()}}),i.extracted_data.notes&&(e.notes={status:m,original_value:i.extracted_data.notes,confirmed_value:i.extracted_data.notes,confirmed_at:new Date().toISOString()}),g(e)},[i.extracted_data]),S=(0,a.useCallback)(async()=>{c(!0),l(null);try{let t=await r({document_id:e,confirmed_data:{...x,field_confirmations:u}});if(!t.success){l(t.error?.message||"Failed to save confirmation"),c(!1);return}o.push("/patient?confirmation=success")}catch(e){l("An unexpected error occurred"),c(!1)}},[e,x,u,o]),w=e=>i.confidence.field_confidence?.[e],C=Object.keys(u).length>0,A=C&&(i.extracted_data.lab_values?.length||0)+(i.extracted_data.medications?.length||0)+(Object.keys(i.extracted_data.vital_signs||{}).length||0)+(i.extracted_data.diagnoses?.length||0)+ +!!i.extracted_data.notes===Object.keys(u).length;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"border-b pb-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Review Extracted Values"}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:"Please review the information extracted from your document and confirm or correct it."}),i.confirmed_at&&(0,t.jsxs)("p",{className:"text-sm text-green-600 mt-2",children:["Last confirmed on ",new Date(i.confirmed_at).toLocaleString()]})]}),d&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:d}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:N,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",disabled:s,children:"Accept All"}),(0,t.jsx)("button",{onClick:S,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",disabled:s||!C,children:s?"Saving...":"Save Confirmations"})]}),i.extracted_data.lab_values&&i.extracted_data.lab_values.length>0&&(0,t.jsx)(p,{labValues:i.extracted_data.lab_values,confirmations:u,getConfidenceScore:w,onAccept:f,onEdit:z,onReject:y}),i.extracted_data.medications&&i.extracted_data.medications.length>0&&(0,t.jsx)(_,{medications:i.extracted_data.medications,confirmations:u,getConfidenceScore:w,onAccept:f,onEdit:z,onReject:y}),i.extracted_data.vital_signs&&Object.keys(i.extracted_data.vital_signs).length>0&&(0,t.jsx)(v,{vitalSigns:i.extracted_data.vital_signs,confirmations:u,getConfidenceScore:w,onAccept:f,onEdit:z,onReject:y}),i.extracted_data.diagnoses&&i.extracted_data.diagnoses.length>0&&(0,t.jsx)(j,{diagnoses:i.extracted_data.diagnoses,confirmations:u,getConfidenceScore:w,onAccept:f,onEdit:z,onReject:y}),i.extracted_data.notes&&(0,t.jsx)(h,{notes:i.extracted_data.notes,confirmations:u,getConfidenceScore:w,onAccept:f,onEdit:z,onReject:y}),C&&(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 px-4 py-3 rounded",children:(0,t.jsxs)("p",{className:"text-sm text-blue-700",children:[Object.keys(u).length," field(s) confirmed",A&&" - All fields confirmed!"]})})]})}function p({labValues:e,confirmations:a,getConfidenceScore:n,onAccept:i,onEdit:r,onReject:o}){return(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Lab Values"}),(0,t.jsx)("div",{className:"space-y-3",children:e.map((e,s)=>{let c=`lab_values[${s}]`,d=n(c),l=void 0!==d&&b(d),u=a[c];return(0,t.jsx)(z,{fieldKey:c,label:e.test_name,value:`${e.value}${e.unit?" "+e.unit:""}`,isLowConfidence:l,confidence:d,confirmation:u,onAccept:()=>i(c,e),onEdit:t=>r(c,e,t),onReject:()=>o(c,e)},c)})})]})}function _({medications:e,confirmations:a,getConfidenceScore:n,onAccept:i,onEdit:r,onReject:o}){return(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Medications"}),(0,t.jsx)("div",{className:"space-y-3",children:e.map((e,s)=>{let c=`medications[${s}]`,d=n(c),l=void 0!==d&&b(d),u=a[c],m=`${e.name}${e.dosage?" - "+e.dosage:""}${e.frequency?" ("+e.frequency+")":""}`;return(0,t.jsx)(z,{fieldKey:c,label:"Medication",value:m,isLowConfidence:l,confidence:d,confirmation:u,onAccept:()=>i(c,e),onEdit:t=>r(c,e,t),onReject:()=>o(c,e)},c)})})]})}function v({vitalSigns:e,confirmations:a,getConfidenceScore:n,onAccept:i,onEdit:r,onReject:o}){let s=Object.entries(e).sort(([e],[t])=>e.localeCompare(t));return(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Vital Signs"}),(0,t.jsx)("div",{className:"space-y-3",children:s.map(([e,s])=>{let c=`vital_signs.${e}`,d=n(c),l=void 0!==d&&b(d),u=a[c];return(0,t.jsx)(z,{fieldKey:c,label:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),value:String(s),isLowConfidence:l,confidence:d,confirmation:u,onAccept:()=>i(c,s),onEdit:e=>r(c,s,e),onReject:()=>o(c,s)},c)})})]})}function j({diagnoses:e,confirmations:a,getConfidenceScore:n,onAccept:i,onEdit:r,onReject:o}){return(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Diagnoses"}),(0,t.jsx)("div",{className:"space-y-3",children:e.map((e,s)=>{let c=`diagnoses[${s}]`,d=n(c),l=void 0!==d&&b(d),u=a[c];return(0,t.jsx)(z,{fieldKey:c,label:"Diagnosis",value:e,isLowConfidence:l,confidence:d,confirmation:u,onAccept:()=>i(c,e),onEdit:t=>r(c,e,t),onReject:()=>o(c,e)},c)})})]})}function h({notes:e,confirmations:a,getConfidenceScore:n,onAccept:i,onEdit:r,onReject:o}){let s="notes",c=n(s),d=void 0!==c&&b(c),l=a[s];return(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Notes"}),(0,t.jsx)(z,{fieldKey:s,label:"Additional Notes",value:e,isLowConfidence:d,confidence:c,confirmation:l,onAccept:()=>i(s,e),onEdit:t=>r(s,e,t),onReject:()=>o(s,e),multiline:!0})]})}function z({fieldKey:e,label:n,value:i,isLowConfidence:r,confidence:o,confirmation:s,onAccept:c,onEdit:d,onReject:l,multiline:u=!1}){let[m,g]=(0,a.useState)(!1),[x,b]=(0,a.useState)(i),f=s?.status,p=r?"bg-yellow-50 border-yellow-300":"accepted"===f?"bg-green-50 border-green-300":"edited"===f?"bg-blue-50 border-blue-300":"rejected"===f?"bg-red-50 border-red-300":"bg-white border-gray-300";return(0,t.jsxs)("div",{className:`border rounded p-3 ${p}`,children:[(0,t.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium text-sm text-gray-700",children:n}),void 0!==o&&(0,t.jsxs)("span",{className:`text-xs px-2 py-0.5 rounded ${r?"bg-yellow-200 text-yellow-800":"bg-green-200 text-green-800"}`,children:[Math.round(100*o),"% confidence"]})]}),!m&&(0,t.jsx)("div",{className:"mt-1 text-gray-900",children:u?(0,t.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-sm",children:i}):(0,t.jsx)("span",{className:"text-sm",children:i})}),m&&(0,t.jsxs)("div",{className:"mt-2",children:[u?(0,t.jsx)("textarea",{value:x,onChange:e=>b(e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",rows:4}):(0,t.jsx)("input",{type:"text",value:x,onChange:e=>b(e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"}),(0,t.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,t.jsx)("button",{onClick:()=>{d(x),g(!1)},className:"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Save"}),(0,t.jsx)("button",{onClick:()=>{b(i),g(!1)},className:"px-3 py-1 bg-gray-300 text-gray-700 text-xs rounded hover:bg-gray-400",children:"Cancel"})]})]}),f&&!m&&(0,t.jsxs)("div",{className:"mt-1 text-xs text-gray-600",children:["Status: ",f.charAt(0).toUpperCase()+f.slice(1)]})]})}),!m&&!f&&(0,t.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,t.jsx)("button",{onClick:c,className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"Accept"}),(0,t.jsx)("button",{onClick:()=>g(!0),className:"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Edit"}),(0,t.jsx)("button",{onClick:l,className:"px-3 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700",children:"Not Applicable"})]})]})}o.z.object({document_id:o.z.string().uuid(),confirmed_data:x}),o.z.object({success:o.z.boolean(),data:o.z.object({document_id:o.z.string().uuid(),confirmed_at:o.z.string()}).optional(),error:o.z.object({code:o.z.string(),message:o.z.string()}).optional()}),e.s(["default",()=>f],57234)}]);

//# sourceMappingURL=1ba391c895ba51e7.js.map