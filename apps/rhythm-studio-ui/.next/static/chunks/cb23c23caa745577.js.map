{"version":3,"sources":["turbopack:///[project]/lib/ui/Button.tsx","turbopack:///[project]/lib/ui/Card.tsx","turbopack:///[project]/lib/ui/LoadingSpinner.tsx","turbopack:///[project]/lib/ui/ErrorState.tsx","turbopack:///[project]/lib/ui/Badge.tsx","turbopack:///[project]/lib/ui/PageHeader.tsx","turbopack:///[project]/lib/contracts/registry.ts","turbopack:///[project]/apps/rhythm-studio-ui/app/clinician/funnels/[identifier]/editor/page.tsx","turbopack:///[project]/lib/contracts/funnelManifest.ts","turbopack:///[project]/lib/utils/urlSecurity.ts"],"sourcesContent":["import { forwardRef, type ButtonHTMLAttributes, type ReactNode } from 'react'\nimport { componentTokens } from '@/lib/design-tokens'\n\nexport type ButtonVariant = 'primary' | 'secondary' | 'outline' | 'ghost' | 'destructive' | 'danger'\nexport type ButtonSize = 'sm' | 'md' | 'lg'\n\nexport interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\n  /** Visual style variant */\n  variant?: ButtonVariant\n  /** Size preset */\n  size?: ButtonSize\n  /** Whether button should take full width */\n  fullWidth?: boolean\n  /** Optional icon to display before label */\n  icon?: ReactNode\n  /** Whether button is in loading state */\n  loading?: boolean\n  /** Children content */\n  children: ReactNode\n}\n\n/**\n * Button Component\n * \n * A versatile, accessible button component with multiple variants and sizes.\n * Part of the V0.4 Design System.\n * \n * Features:\n * - Multiple variants: primary, secondary, outline, ghost, destructive\n * - Three sizes: sm, md, lg\n * - Loading state with disabled interaction\n * - Optional icon support\n * - Touch-optimized with minimum 44px height\n * - Smooth animations using design tokens\n * - Fully accessible with proper ARIA attributes\n * \n * @example\n * // Primary button\n * <Button variant=\"primary\" onClick={handleClick}>\n *   Save Changes\n * </Button>\n * \n * @example\n * // Button with icon\n * <Button variant=\"secondary\" icon={<PlusIcon />}>\n *   Add New\n * </Button>\n * \n * @example\n * // Loading state\n * <Button variant=\"primary\" loading disabled>\n *   Processing...\n * </Button>\n */\nexport const Button = forwardRef<HTMLButtonElement, ButtonProps>(\n  (\n    {\n      variant = 'primary',\n      size = 'md',\n      fullWidth = false,\n      icon,\n      loading = false,\n      disabled = false,\n      className = '',\n      children,\n      type = 'button',\n      onClick,\n      onMouseDown,\n      onMouseUp,\n      onTouchStart,\n      onTouchEnd,\n      onKeyDown,\n      onKeyUp,\n      onFocus,\n      onBlur,\n      ...otherProps\n    },\n    ref\n  ) => {\n    // Size configurations\n    const sizeConfig = {\n      sm: {\n        padding: '0.5rem 1rem',\n        fontSize: '0.875rem',\n        minHeight: '36px',\n      },\n      md: {\n        padding: '0.625rem 1.5rem',\n        fontSize: '1rem',\n        minHeight: componentTokens.navigationButton.minHeight,\n      },\n      lg: {\n        padding: '0.875rem 2rem',\n        fontSize: '1.125rem',\n        minHeight: '56px',\n      },\n    }\n\n    // Variant styles\n    const variantStyles = {\n      primary: `\n        bg-sky-600 dark:bg-sky-500 text-white \n        hover:bg-sky-700 dark:hover:bg-sky-600\n        active:bg-sky-800 dark:active:bg-sky-700\n        disabled:bg-slate-300 dark:disabled:bg-slate-700 disabled:text-slate-500 dark:disabled:text-slate-400\n        shadow-md hover:shadow-lg\n      `,\n      secondary: `\n        bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100\n        hover:bg-slate-200 dark:hover:bg-slate-600\n        active:bg-slate-300 dark:active:bg-slate-500\n        disabled:bg-slate-50 dark:disabled:bg-slate-800 disabled:text-slate-400 dark:disabled:text-slate-600\n        border-2 border-slate-200 dark:border-slate-600\n      `,\n      outline: `\n        bg-transparent text-sky-600 dark:text-sky-400\n        border-2 border-sky-600 dark:border-sky-500\n        hover:bg-sky-50 dark:hover:bg-sky-900/30\n        active:bg-sky-100 dark:active:bg-sky-900/50\n        disabled:border-slate-300 dark:disabled:border-slate-600 disabled:text-slate-400 dark:disabled:text-slate-500\n      `,\n      ghost: `\n        bg-transparent text-slate-700 dark:text-slate-300\n        hover:bg-slate-100 dark:hover:bg-slate-700\n        active:bg-slate-200 dark:active:bg-slate-600\n        disabled:text-slate-400 dark:disabled:text-slate-500\n      `,\n      destructive: `\n        bg-red-600 dark:bg-red-500 text-white\n        hover:bg-red-700 dark:hover:bg-red-600\n        active:bg-red-800 dark:active:bg-red-700\n        disabled:bg-slate-300 dark:disabled:bg-slate-700 disabled:text-slate-500 dark:disabled:text-slate-400\n        shadow-md hover:shadow-lg\n      `,\n      // Deprecated: Use 'destructive' instead\n      danger: `\n        bg-red-600 dark:bg-red-500 text-white\n        hover:bg-red-700 dark:hover:bg-red-600\n        active:bg-red-800 dark:active:bg-red-700\n        disabled:bg-slate-300 dark:disabled:bg-slate-700 disabled:text-slate-500 dark:disabled:text-slate-400\n        shadow-md hover:shadow-lg\n      `,\n    }\n\n    const config = sizeConfig[size]\n    const variantClass = variantStyles[variant]\n\n    const baseStyles = `\n      inline-flex items-center justify-center gap-2\n      font-semibold rounded-xl\n      transition-all duration-200\n      focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2\n      disabled:cursor-not-allowed disabled:opacity-60\n      active:scale-[0.98]\n      touch-manipulation\n      ${fullWidth ? 'w-full' : ''}\n      ${variantClass}\n      ${className}\n    `\n\n    return (\n      <button\n        ref={ref}\n        type={type}\n        disabled={disabled || loading}\n        className={baseStyles}\n        style={{\n          padding: config.padding,\n          fontSize: config.fontSize,\n          minHeight: config.minHeight,\n        }}\n        onClick={onClick}\n        onMouseDown={onMouseDown}\n        onMouseUp={onMouseUp}\n        onTouchStart={onTouchStart}\n        onTouchEnd={onTouchEnd}\n        onKeyDown={onKeyDown}\n        onKeyUp={onKeyUp}\n        onFocus={onFocus}\n        onBlur={onBlur}\n        aria-busy={loading}\n        {...otherProps}\n      >\n        {loading && (\n          <svg\n            className=\"animate-spin h-4 w-4\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            aria-hidden=\"true\"\n          >\n            <circle\n              className=\"opacity-25\"\n              cx=\"12\"\n              cy=\"12\"\n              r=\"10\"\n              stroke=\"currentColor\"\n              strokeWidth=\"4\"\n            />\n            <path\n              className=\"opacity-75\"\n              fill=\"currentColor\"\n              d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n            />\n          </svg>\n        )}\n        {!loading && icon && <span className=\"flex-shrink-0\">{icon}</span>}\n        <span>{children}</span>\n      </button>\n    )\n  }\n)\n\nButton.displayName = 'Button'\n\nexport default Button\n","import { type ReactNode, type HTMLAttributes } from 'react'\nimport { shadows, radii, spacing } from '@/lib/design-tokens'\n\nexport interface CardProps extends HTMLAttributes<HTMLDivElement> {\n  /** Optional header content */\n  header?: ReactNode\n  /** Optional footer content */\n  footer?: ReactNode\n  /** Main content */\n  children: ReactNode\n  /** Padding variant */\n  padding?: 'none' | 'sm' | 'md' | 'lg'\n  /** Border radius variant */\n  radius?: 'md' | 'lg' | 'xl' | '2xl'\n  /** Shadow depth */\n  shadow?: 'none' | 'sm' | 'md' | 'lg'\n  /** Whether card is interactive (clickable) */\n  interactive?: boolean\n  /** Whether to show border */\n  border?: boolean\n  /** Optional onClick handler */\n  onClick?: () => void\n}\n\n/**\n * Card Component\n * \n * A flexible container component for grouping related content.\n * Part of the V0.4 Design System.\n * \n * Features:\n * - Optional header and footer sections\n * - Configurable padding, shadow, and border radius\n * - Interactive variant with hover effects\n * - Consistent with design tokens\n * - Semantic HTML structure\n * \n * @example\n * // Basic card\n * <Card>\n *   <p>Card content goes here</p>\n * </Card>\n * \n * @example\n * // Card with header and footer\n * <Card\n *   header={<h3>Card Title</h3>}\n *   footer={<Button>Action</Button>}\n * >\n *   <p>Card body content</p>\n * </Card>\n * \n * @example\n * // Interactive card\n * <Card interactive onClick={() => navigate('/details')}>\n *   <p>Click me!</p>\n * </Card>\n */\nexport function Card({\n  header,\n  footer,\n  children,\n  padding = 'lg',\n  radius: radiusVariant = 'xl',\n  shadow: shadowVariant = 'sm',\n  interactive = false,\n  border = true,\n  onClick,\n  className = '',\n  ...props\n}: CardProps) {\n  // Padding configurations\n  const paddingConfig = {\n    none: '0',\n    sm: spacing.md,\n    md: spacing.lg,\n    lg: spacing.xl,\n  }\n\n  // Shadow configurations\n  const shadowConfig = {\n    none: shadows.none,\n    sm: shadows.sm,\n    md: shadows.md,\n    lg: shadows.lg,\n  }\n\n  // Radius configurations\n  const radiusConfig = {\n    md: radii.md,\n    lg: radii.lg,\n    xl: radii.xl,\n    '2xl': radii['2xl'],\n  }\n\n  const paddingValue = paddingConfig[padding]\n  const shadowValue = shadowConfig[shadowVariant]\n  const radiusValue = radiusConfig[radiusVariant]\n\n  // Base styles\n  const baseClasses = `bg-white dark:bg-slate-800 ${border ? 'border border-slate-200 dark:border-slate-700' : ''} transition-colors duration-150`\n\n  // Interactive styles\n  const interactiveClasses = interactive\n    ? 'cursor-pointer hover:border-sky-400 dark:hover:border-sky-500 hover:shadow-lg active:scale-[0.99] transition-all duration-200'\n    : ''\n\n  if (onClick) {\n    return (\n      <button\n        type=\"button\"\n        className={`${baseClasses} ${interactiveClasses} ${className}`}\n        style={{\n          borderRadius: radiusValue,\n          boxShadow: shadowValue,\n        }}\n        onClick={onClick}\n        onKeyDown={(e) => {\n          if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault()\n            onClick()\n          }\n        }}\n      >\n        {header && (\n          <div\n            className=\"border-b border-slate-200 dark:border-slate-700\"\n            style={{\n              padding: paddingValue,\n            }}\n          >\n            {header}\n          </div>\n        )}\n        <div\n          style={{\n            padding: paddingValue,\n          }}\n        >\n          {children}\n        </div>\n        {footer && (\n          <div\n            className=\"border-t border-slate-200 dark:border-slate-700\"\n            style={{\n              padding: paddingValue,\n            }}\n          >\n            {footer}\n          </div>\n        )}\n      </button>\n    )\n  }\n\n  return (\n    <div\n      className={`${baseClasses} ${interactiveClasses} ${className}`}\n      style={{\n        borderRadius: radiusValue,\n        boxShadow: shadowValue,\n      }}\n      {...props}\n    >\n      {header && (\n        <div\n          className=\"border-b border-slate-200 dark:border-slate-700\"\n          style={{\n            padding: paddingValue,\n          }}\n        >\n          {header}\n        </div>\n      )}\n      <div\n        style={{\n          padding: paddingValue,\n        }}\n      >\n        {children}\n      </div>\n      {footer && (\n        <div\n          className=\"border-t border-slate-200 dark:border-slate-700\"\n          style={{\n            padding: paddingValue,\n          }}\n        >\n          {footer}\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default Card\n","import { type HTMLAttributes } from 'react'\n\nexport type LoadingSpinnerSize = 'sm' | 'md' | 'lg' | 'xl'\n\nexport interface LoadingSpinnerProps extends HTMLAttributes<HTMLDivElement> {\n  /** Size of the spinner */\n  size?: LoadingSpinnerSize\n  /** Optional text to display below spinner */\n  text?: string\n  /** Whether to center the spinner in container */\n  centered?: boolean\n}\n\n/**\n * LoadingSpinner Component\n * \n * A styled loading spinner component for indicating loading states.\n * Part of the V0.4 Design System - E6 Technical Cleanup.\n * \n * Features:\n * - Four size variants (sm, md, lg, xl)\n * - Optional loading text\n * - Can be centered in container\n * - Accessible with proper ARIA attributes\n * - Smooth animation\n * \n * @example\n * // Basic spinner\n * <LoadingSpinner />\n * \n * @example\n * // Large centered spinner with text\n * <LoadingSpinner size=\"lg\" text=\"Laden...\" centered />\n * \n * @example\n * // Small inline spinner\n * <LoadingSpinner size=\"sm\" />\n */\nexport function LoadingSpinner({\n  size = 'md',\n  text,\n  centered = false,\n  className = '',\n  ...props\n}: LoadingSpinnerProps) {\n  // Size configurations\n  const sizeConfig = {\n    sm: {\n      spinner: 'h-4 w-4',\n      text: 'text-xs',\n    },\n    md: {\n      spinner: 'h-8 w-8',\n      text: 'text-sm',\n    },\n    lg: {\n      spinner: 'h-12 w-12',\n      text: 'text-base',\n    },\n    xl: {\n      spinner: 'h-16 w-16',\n      text: 'text-lg',\n    },\n  }\n\n  const config = sizeConfig[size]\n\n  const containerClasses = `\n    ${centered ? 'flex flex-col items-center justify-center min-h-[200px]' : 'inline-flex flex-col items-center'}\n    ${className}\n  `\n\n  return (\n    <div className={containerClasses} role=\"status\" aria-live=\"polite\" {...props}>\n      <svg\n        className={`animate-spin text-sky-600 ${config.spinner}`}\n        xmlns=\"http://www.w3.org/2000/svg\"\n        fill=\"none\"\n        viewBox=\"0 0 24 24\"\n        aria-hidden=\"true\"\n      >\n        <circle\n          className=\"opacity-25\"\n          cx=\"12\"\n          cy=\"12\"\n          r=\"10\"\n          stroke=\"currentColor\"\n          strokeWidth=\"4\"\n        />\n        <path\n          className=\"opacity-75\"\n          fill=\"currentColor\"\n          d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n        />\n      </svg>\n      {text && (\n        <p className={`mt-3 text-slate-600 font-medium ${config.text}`}>\n          {text}\n        </p>\n      )}\n      <span className=\"sr-only\">{text || 'Laden...'}</span>\n    </div>\n  )\n}\n\nexport default LoadingSpinner\n","import { type ReactNode, type HTMLAttributes } from 'react'\nimport { Button } from './Button'\n\nexport interface ErrorStateProps extends HTMLAttributes<HTMLDivElement> {\n  /** Error title/heading */\n  title?: string\n  /** Error message or description */\n  message?: string | ReactNode\n  /** Optional retry button callback */\n  onRetry?: () => void\n  /** Retry button text */\n  retryText?: string\n  /** Whether to show the error centered in a larger container */\n  centered?: boolean\n  /** Optional custom icon */\n  icon?: ReactNode\n}\n\n/**\n * ErrorState Component\n * \n * A styled error state component for displaying errors consistently.\n * Part of the V0.4 Design System - E6 Technical Cleanup.\n * \n * Features:\n * - Consistent error display across the application\n * - Optional retry button\n * - Customizable title, message, and icon\n * - Can be centered in container\n * - Accessible with proper ARIA attributes\n * \n * @example\n * // Basic error\n * <ErrorState\n *   title=\"Fehler beim Laden\"\n *   message=\"Die Daten konnten nicht geladen werden.\"\n * />\n * \n * @example\n * // Error with retry button\n * <ErrorState\n *   title=\"Verbindungsfehler\"\n *   message=\"Bitte überprüfen Sie Ihre Internetverbindung.\"\n *   onRetry={handleRetry}\n *   centered\n * />\n */\nexport function ErrorState({\n  title = 'Ein Fehler ist aufgetreten',\n  message = 'Bitte versuchen Sie es später erneut.',\n  onRetry,\n  retryText = 'Erneut versuchen',\n  centered = false,\n  icon,\n  className = '',\n  ...props\n}: ErrorStateProps) {\n  const containerClasses = `\n    ${centered ? 'flex flex-col items-center justify-center min-h-[300px] text-center' : 'flex flex-col items-center text-center'}\n    ${className}\n  `\n\n  const defaultIcon = (\n    <svg\n      className=\"h-16 w-16 text-red-500\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n      stroke=\"currentColor\"\n      aria-hidden=\"true\"\n    >\n      <path\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        strokeWidth={2}\n        d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n      />\n    </svg>\n  )\n\n  return (\n    <div className={containerClasses} role=\"alert\" aria-live=\"assertive\" {...props}>\n      <div className=\"mb-4\">\n        {icon || defaultIcon}\n      </div>\n      \n      <h2 className=\"text-xl md:text-2xl font-semibold text-slate-900 mb-2\">\n        {title}\n      </h2>\n      \n      {typeof message === 'string' ? (\n        <p className=\"text-sm md:text-base text-slate-600 mb-6 max-w-md\">\n          {message}\n        </p>\n      ) : (\n        <div className=\"text-sm md:text-base text-slate-600 mb-6 max-w-md\">\n          {message}\n        </div>\n      )}\n      \n      {onRetry && (\n        <Button\n          variant=\"primary\"\n          onClick={onRetry}\n          icon={\n            <svg\n              className=\"h-4 w-4\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\n              />\n            </svg>\n          }\n        >\n          {retryText}\n        </Button>\n      )}\n    </div>\n  )\n}\n\nexport default ErrorState\n","/**\n * Badge Component\n * \n * A small, colored label component for displaying status, categories, or tags.\n * Supports multiple variants with semantic colors from the v0.4 design system.\n * \n * @example\n * ```tsx\n * <Badge variant=\"success\">Active</Badge>\n * <Badge variant=\"warning\">Pending</Badge>\n * <Badge variant=\"danger\">High Risk</Badge>\n * ```\n */\n\nimport type { ReactNode } from 'react'\n\nexport type BadgeVariant = 'default' | 'success' | 'warning' | 'danger' | 'info' | 'secondary'\nexport type BadgeSize = 'sm' | 'md'\n\nexport interface BadgeProps {\n  /**\n   * The visual style variant of the badge\n   * @default 'default'\n   */\n  variant?: BadgeVariant\n  \n  /**\n   * The size of the badge\n   * @default 'md'\n   */\n  size?: BadgeSize\n  \n  /**\n   * Badge content\n   */\n  children: ReactNode\n  \n  /**\n   * Additional CSS class names\n   */\n  className?: string\n}\n\n/**\n * Badge component for displaying status, tags, or categories\n */\nexport function Badge({ \n  variant = 'default', \n  size = 'md',\n  children, \n  className = '' \n}: BadgeProps) {\n  // Variant styles\n  const variantStyles: Record<BadgeVariant, string> = {\n    default: 'bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 border-slate-200 dark:border-slate-600',\n    success: 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-400 border-emerald-200 dark:border-emerald-700',\n    warning: 'bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-400 border-amber-200 dark:border-amber-700',\n    danger: 'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-400 border-red-200 dark:border-red-700',\n    info: 'bg-sky-100 dark:bg-sky-900/30 text-sky-800 dark:text-sky-400 border-sky-200 dark:border-sky-700',\n    secondary: 'bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-400 border-slate-200 dark:border-slate-700',\n  }\n\n  // Size styles\n  const sizeStyles: Record<BadgeSize, string> = {\n    sm: 'px-2 py-0.5 text-xs',\n    md: 'px-3 py-1 text-sm',\n  }\n\n  const variantClass = variantStyles[variant]\n  const sizeClass = sizeStyles[size]\n\n  return (\n    <span\n      className={`\n        inline-flex items-center justify-center\n        rounded-full border font-medium\n        whitespace-nowrap\n        ${variantClass}\n        ${sizeClass}\n        ${className}\n      `}\n    >\n      {children}\n    </span>\n  )\n}\n","'use client'\n\nimport { type ReactNode } from 'react'\nimport { spacing } from '@/lib/design-tokens'\n\nexport interface PageHeaderProps {\n  /** Main page title */\n  title: string\n  /** Optional subtitle/description */\n  description?: string\n  /** Optional action buttons on the right */\n  actions?: ReactNode\n  /** Additional CSS classes */\n  className?: string\n}\n\n/**\n * PageHeader Component\n * \n * Standardized page header for Clinician and Admin pages.\n * Provides consistent spacing, typography, and layout.\n * \n * @example\n * <PageHeader\n *   title=\"Dashboard\"\n *   description=\"Übersicht aller Patientinnen und Patienten\"\n *   actions={<Button>Export</Button>}\n * />\n */\nexport function PageHeader({ title, description, actions, className = '' }: PageHeaderProps) {\n  return (\n    <div\n      className={`flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 ${className}`}\n      style={{ marginBottom: spacing.xl }}\n    >\n      <div className=\"flex-1 min-w-0\">\n        <h1 className=\"text-2xl md:text-3xl font-bold text-slate-900 dark:text-slate-50 mb-2\">\n          {title}\n        </h1>\n        {description && (\n          <p className=\"text-base text-slate-600 dark:text-slate-300\">\n            {description}\n          </p>\n        )}\n      </div>\n      {actions && (\n        <div className=\"flex flex-wrap gap-3 items-start shrink-0\">\n          {actions}\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default PageHeader\n","/**\n * Contract Registry - Canonical Identifiers\n * \n * This file serves as the single source of truth for all critical string identifiers\n * used throughout the application. All new identifiers MUST be added here to prevent\n * \"fantasy names\" and ensure consistency.\n * \n * **IMPORTANT**: This file is protected by CODEOWNERS. Any changes require review.\n * \n * Usage:\n * ```typescript\n * import { ASSESSMENT_STATUS, FUNNEL_SLUG, USER_ROLE } from '@/lib/contracts/registry'\n * \n * const status: AssessmentStatus = ASSESSMENT_STATUS.IN_PROGRESS\n * const funnel: FunnelSlug = FUNNEL_SLUG.STRESS_ASSESSMENT\n * ```\n */\n\n// ============================================================\n// Assessment Statuses\n// ============================================================\n\n/**\n * Valid statuses for assessments\n */\nexport const ASSESSMENT_STATUS = {\n  IN_PROGRESS: 'in_progress',\n  COMPLETED: 'completed',\n} as const\n\nexport type AssessmentStatus = typeof ASSESSMENT_STATUS[keyof typeof ASSESSMENT_STATUS]\n\n// ============================================================\n// Content Page Statuses\n// ============================================================\n\n/**\n * Valid statuses for content pages\n */\nexport const CONTENT_STATUS = {\n  DRAFT: 'draft',\n  PUBLISHED: 'published',\n  ARCHIVED: 'archived',\n} as const\n\nexport type ContentStatus = typeof CONTENT_STATUS[keyof typeof CONTENT_STATUS]\n\n// ============================================================\n// Pillar Keys (7-Pillar Model)\n// ============================================================\n\n/**\n * Valid pillar keys for funnel taxonomy (7-Pillar Wellness Model)\n */\nexport const PILLAR_KEY = {\n  NUTRITION: 'nutrition',\n  MOVEMENT: 'movement',\n  SLEEP: 'sleep',\n  MENTAL_HEALTH: 'mental-health',\n  SOCIAL: 'social',\n  MEANING: 'meaning',\n  PREVENTION: 'prevention',\n} as const\n\nexport type PillarKey = typeof PILLAR_KEY[keyof typeof PILLAR_KEY]\n\n// ============================================================\n// Funnel Slugs\n// ============================================================\n\n/**\n * Valid funnel slugs\n * The canonical slug is the primary identifier\n * Legacy aliases are maintained for backward compatibility\n */\nexport const FUNNEL_SLUG = {\n  STRESS_ASSESSMENT: 'stress-assessment',\n  CARDIOVASCULAR_AGE: 'cardiovascular-age',\n  SLEEP_QUALITY: 'sleep-quality',\n  HEART_HEALTH_NUTRITION: 'heart-health-nutrition',\n  // Legacy aliases - deprecated but maintained for compatibility\n  STRESS: 'stress',\n  STRESS_CHECK: 'stress-check',\n  STRESS_CHECK_V2: 'stress-check-v2',\n} as const\n\nexport type FunnelSlug = typeof FUNNEL_SLUG[keyof typeof FUNNEL_SLUG]\n\n/**\n * Maps legacy funnel slugs to their canonical equivalents\n * Uses lowercase keys for case-insensitive matching\n */\nexport const FUNNEL_SLUG_ALIASES: Record<string, string> = {\n  'stress': FUNNEL_SLUG.STRESS_ASSESSMENT,\n  'stress-check': FUNNEL_SLUG.STRESS_ASSESSMENT,\n  'stress-check-v2': FUNNEL_SLUG.STRESS_ASSESSMENT,\n}\n\n/**\n * Resolves a funnel slug to its canonical form\n * Normalizes input by trimming and converting to lowercase for deterministic matching\n * \n * @param slug - The funnel slug to resolve (case-insensitive, whitespace trimmed)\n * @returns The canonical slug or the normalized input if no mapping exists\n */\nexport function getCanonicalFunnelSlug(slug: string): string {\n  const normalized = slug.toLowerCase().trim()\n  return FUNNEL_SLUG_ALIASES[normalized] || normalized\n}\n\n/**\n * Checks if a funnel slug is known in the registry\n * A funnel is \"known\" if it exists in FUNNEL_SLUG values (canonical or legacy)\n * \n * @param slug - The funnel slug to check (case-insensitive, whitespace trimmed)\n * @returns true if the funnel slug is registered, false otherwise\n */\nexport function isKnownFunnelSlug(slug: string): boolean {\n  const canonical = getCanonicalFunnelSlug(slug)\n  const allSlugs = Object.values(FUNNEL_SLUG)\n  return allSlugs.includes(canonical as FunnelSlug)\n}\n\n// ============================================================\n// Node/Step Types\n// ============================================================\n\n/**\n * Valid node/step types for funnel steps\n * These correspond to the 'type' field in the funnel_steps table\n */\nexport const NODE_TYPE = {\n  QUESTION_STEP: 'question_step',\n  FORM: 'form',\n  INFO_STEP: 'info_step',\n  INFO: 'info',\n  CONTENT_PAGE: 'content_page',\n  SUMMARY: 'summary',\n  OTHER: 'other',\n} as const\n\nexport type NodeType = typeof NODE_TYPE[keyof typeof NODE_TYPE]\n\n// ============================================================\n// User Roles\n// ============================================================\n\n/**\n * Valid user roles\n * These are stored in auth.users.raw_app_meta_data.role\n */\nexport const USER_ROLE = {\n  PATIENT: 'patient',\n  CLINICIAN: 'clinician',\n  ADMIN: 'admin',\n  NURSE: 'nurse',\n} as const\n\nexport type UserRole = typeof USER_ROLE[keyof typeof USER_ROLE]\n\n// ============================================================\n// Question Types\n// ============================================================\n\n/**\n * Valid question types\n * These correspond to the 'question_type' field in the questions table\n */\nexport const QUESTION_TYPE = {\n  RADIO: 'radio',\n  CHECKBOX: 'checkbox',\n  TEXT: 'text',\n  TEXTAREA: 'textarea',\n  NUMBER: 'number',\n  SCALE: 'scale',\n  SLIDER: 'slider',\n} as const\n\nexport type QuestionType = typeof QUESTION_TYPE[keyof typeof QUESTION_TYPE]\n\n// ============================================================\n// Patient Demographics\n// ============================================================\n\n/**\n * Valid sex/gender options for patient profiles\n * These correspond to the 'sex' field in the patient_profiles table\n */\nexport const PATIENT_SEX = {\n  MALE: 'male',\n  FEMALE: 'female',\n  OTHER: 'other',\n  PREFER_NOT_TO_SAY: 'prefer_not_to_say',\n} as const\n\nexport type PatientSex = typeof PATIENT_SEX[keyof typeof PATIENT_SEX]\n\n// ============================================================\n// Feature Flag Names\n// ============================================================\n\n/**\n * Valid feature flag names (without NEXT_PUBLIC_FEATURE_ prefix)\n */\nexport const FEATURE_FLAG = {\n  AMY_ENABLED: 'AMY_ENABLED',\n  CLINICIAN_DASHBOARD_ENABLED: 'CLINICIAN_DASHBOARD_ENABLED',\n  CHARTS_ENABLED: 'CHARTS_ENABLED',\n} as const\n\nexport type FeatureFlag = typeof FEATURE_FLAG[keyof typeof FEATURE_FLAG]\n\n// ============================================================\n// Helper Functions\n// ============================================================\n\n/**\n * Type guard to check if a value is a valid assessment status\n */\nexport function isValidAssessmentStatus(value: unknown): value is AssessmentStatus {\n  return typeof value === 'string' && Object.values(ASSESSMENT_STATUS).includes(value as AssessmentStatus)\n}\n\n/**\n * Type guard to check if a value is a valid content status\n */\nexport function isValidContentStatus(value: unknown): value is ContentStatus {\n  return typeof value === 'string' && Object.values(CONTENT_STATUS).includes(value as ContentStatus)\n}\n\n/**\n * Type guard to check if a value is a valid user role\n */\nexport function isValidUserRole(value: unknown): value is UserRole {\n  return typeof value === 'string' && Object.values(USER_ROLE).includes(value as UserRole)\n}\n\n/**\n * Type guard to check if a value is a valid node type\n */\nexport function isValidNodeType(value: unknown): value is NodeType {\n  return typeof value === 'string' && Object.values(NODE_TYPE).includes(value as NodeType)\n}\n\n/**\n * Type guard to check if a value is a valid pillar key\n */\nexport function isValidPillarKey(value: unknown): value is PillarKey {\n  return typeof value === 'string' && Object.values(PILLAR_KEY).includes(value as PillarKey)\n}\n\n/**\n * Type guard to check if a value is a valid patient sex option\n */\nexport function isValidPatientSex(value: unknown): value is PatientSex {\n  return typeof value === 'string' && Object.values(PATIENT_SEX).includes(value as PatientSex)\n}\n\n// ============================================================\n// Audit Log Entity Types\n// ============================================================\n\n/**\n * Valid entity types for audit logging\n * These correspond to the 'entity_type' field in the audit_log table\n */\nexport const AUDIT_ENTITY_TYPE = {\n  ASSESSMENT: 'assessment',\n  REPORT: 'report',\n  TASK: 'task',\n  FUNNEL_VERSION: 'funnel_version',\n  FUNNEL_CATALOG: 'funnel_catalog',\n  CONFIG: 'config',\n  CONSENT: 'consent',\n  ORGANIZATION: 'organization',\n  USER_ORG_MEMBERSHIP: 'user_org_membership',\n  CLINICIAN_ASSIGNMENT: 'clinician_assignment',\n  DOCUMENT: 'document', // V05-I04.3: Document confirmation tracking\n  PROCESSING_JOB: 'processing_job', // V05-I05.1: Processing job orchestration\n  REVIEW_RECORD: 'review_record', // V05-I05.7: Medical review records\n  PRE_SCREENING_CALL: 'pre_screening_call', // V05-I08.2: Pre-screening call records\n  DEVICE_SHIPMENT: 'device_shipment', // V05-I08.3: Shipment tracking\n  SUPPORT_CASE: 'support_case', // V05-I08.4: Support case documentation\n  ACCOUNT: 'account', // V05-I10.2: Account lifecycle (deletion/retention)\n} as const\n\nexport type AuditEntityType = typeof AUDIT_ENTITY_TYPE[keyof typeof AUDIT_ENTITY_TYPE]\n\n// ============================================================\n// Audit Log Actions\n// ============================================================\n\n/**\n * Valid actions for audit logging\n * These correspond to the 'action' field in the audit_log table\n */\nexport const AUDIT_ACTION = {\n  CREATE: 'create',\n  UPDATE: 'update',\n  DELETE: 'delete',\n  APPROVE: 'approve',\n  REJECT: 'reject',\n  REQUEST_CHANGES: 'request_changes', // V05-I05.7: Review workflow\n  GENERATE: 'generate',\n  FLAG: 'flag',\n  ASSIGN: 'assign',\n  ACTIVATE: 'activate',\n  DEACTIVATE: 'deactivate',\n  ROLLOUT: 'rollout',\n  COMPLETE: 'complete',\n  ESCALATE: 'escalate', // V05-I08.4: Support case escalation\n  DELETION_REQUEST: 'deletion_request', // V05-I10.2: User requested account deletion\n  DELETION_CANCEL: 'deletion_cancel', // V05-I10.2: User cancelled deletion request\n  DELETION_EXECUTE: 'deletion_execute', // V05-I10.2: System executed account deletion\n  ANONYMIZE: 'anonymize', // V05-I10.2: Records anonymized instead of deleted\n} as const\n\nexport type AuditAction = typeof AUDIT_ACTION[keyof typeof AUDIT_ACTION]\n\n// ============================================================\n// Audit Log Sources\n// ============================================================\n\n/**\n * Valid sources for audit logging\n * These correspond to the 'source' field in the audit_log table\n */\nexport const AUDIT_SOURCE = {\n  API: 'api',\n  JOB: 'job',\n  ADMIN_UI: 'admin-ui',\n  SYSTEM: 'system',\n} as const\n\nexport type AuditSource = typeof AUDIT_SOURCE[keyof typeof AUDIT_SOURCE]\n\n// ============================================================\n// Audit Type Guards\n// ============================================================\n\n/**\n * Type guard to check if a value is a valid audit entity type\n */\nexport function isValidAuditEntityType(value: unknown): value is AuditEntityType {\n  return typeof value === 'string' && Object.values(AUDIT_ENTITY_TYPE).includes(value as AuditEntityType)\n}\n\n/**\n * Type guard to check if a value is a valid audit action\n */\nexport function isValidAuditAction(value: unknown): value is AuditAction {\n  return typeof value === 'string' && Object.values(AUDIT_ACTION).includes(value as AuditAction)\n}\n\n/**\n * Type guard to check if a value is a valid audit source\n */\nexport function isValidAuditSource(value: unknown): value is AuditSource {\n  return typeof value === 'string' && Object.values(AUDIT_SOURCE).includes(value as AuditSource)\n}\n\n// ============================================================\n// Program Tier Levels (TV05_01D)\n// ============================================================\n\n/**\n * Valid program tier levels based on Thomas' journey model\n * These map the 3-tier patient journey to platform capabilities\n */\nexport const PROGRAM_TIER = {\n  /**\n   * Tier 1 (Essential): Basic stress/resilience assessment\n   * Focus: Initial assessment, baseline data collection\n   */\n  TIER_1_ESSENTIAL: 'tier-1-essential',\n  \n  /**\n   * Tier 2.5 (Enhanced): Extended monitoring with nurse touchpoints\n   * Focus: Regular check-ins, progress tracking\n   */\n  TIER_2_5_ENHANCED: 'tier-2-5-enhanced',\n  \n  /**\n   * Tier 2 (Comprehensive): Full program with intensive support\n   * Focus: Comprehensive care, multiple pillars, frequent touchpoints\n   */\n  TIER_2_COMPREHENSIVE: 'tier-2-comprehensive',\n} as const\n\nexport type ProgramTier = typeof PROGRAM_TIER[keyof typeof PROGRAM_TIER]\n\n/**\n * Type guard to check if a value is a valid program tier\n */\nexport function isValidProgramTier(value: unknown): value is ProgramTier {\n  return typeof value === 'string' && Object.values(PROGRAM_TIER).includes(value as ProgramTier)\n}\n\n// ============================================================\n// Document Extraction Versions (V05-I04.2)\n// ============================================================\n\n/**\n * Valid extractor versions for AI document extraction\n * Format: vMAJOR.MINOR.PATCH\n * Update when extraction logic or prompts change\n */\nexport const EXTRACTOR_VERSION = {\n  /**\n   * v1.0.0: Initial extraction pipeline\n   * - Basic lab value extraction\n   * - Medication list extraction\n   * - Confidence scoring\n   */\n  V1_0_0: 'v1.0.0',\n} as const\n\nexport type ExtractorVersion = typeof EXTRACTOR_VERSION[keyof typeof EXTRACTOR_VERSION]\n\n/**\n * Current extractor version (latest)\n */\nexport const CURRENT_EXTRACTOR_VERSION = EXTRACTOR_VERSION.V1_0_0\n\n/**\n * Type guard to check if a value is a valid extractor version\n */\nexport function isValidExtractorVersion(value: unknown): value is ExtractorVersion {\n  return typeof value === 'string' && Object.values(EXTRACTOR_VERSION).includes(value as ExtractorVersion)\n}\n\n// ============================================================\n// Processing Stages & Status (V05-I05.1)\n// ============================================================\n\n/**\n * Valid processing stages for job orchestrator\n * Jobs progress deterministically through these stages\n */\nexport const PROCESSING_STAGE = {\n  PENDING: 'pending',\n  RISK: 'risk',\n  RANKING: 'ranking',\n  CONTENT: 'content',\n  VALIDATION: 'validation',\n  REVIEW: 'review',\n  PDF: 'pdf',\n  DELIVERY: 'delivery',\n  COMPLETED: 'completed',\n  FAILED: 'failed',\n} as const\n\nexport type ProcessingStage = typeof PROCESSING_STAGE[keyof typeof PROCESSING_STAGE]\n\n/**\n * Valid processing statuses for job orchestrator\n */\nexport const PROCESSING_STATUS = {\n  QUEUED: 'queued',\n  IN_PROGRESS: 'in_progress',\n  COMPLETED: 'completed',\n  FAILED: 'failed',\n} as const\n\nexport type ProcessingStatus = typeof PROCESSING_STATUS[keyof typeof PROCESSING_STATUS]\n\n/**\n * Type guard to check if a value is a valid processing stage\n */\nexport function isValidProcessingStage(value: unknown): value is ProcessingStage {\n  return typeof value === 'string' && Object.values(PROCESSING_STAGE).includes(value as ProcessingStage)\n}\n\n/**\n * Type guard to check if a value is a valid processing status\n */\nexport function isValidProcessingStatus(value: unknown): value is ProcessingStatus {\n  return typeof value === 'string' && Object.values(PROCESSING_STATUS).includes(value as ProcessingStatus)\n}\n","'use client'\n\n/**\n * V05-I06.4 — Visual Block Editor\n * \n * Manifest-based section/block builder for funnel content\n * Enables non-code iteration of mobile content with strict validation\n */\n\nimport { useEffect, useState, useCallback } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { Button, Card, LoadingSpinner, ErrorState, Input, Textarea } from '@/lib/ui'\nimport {\n  SECTION_TYPE,\n  type ContentSection,\n  type ContentPage,\n  type FunnelContentManifest,\n} from '@/lib/contracts/funnelManifest'\n\nexport const dynamic = 'force-dynamic'\n\ntype FunnelVersion = {\n  id: string\n  funnelId: string\n  version: string\n  manifest: FunnelContentManifest\n}\n\ntype FunnelDetailsResponse = {\n  funnel?: { default_version_id?: string }\n  versions?: Array<{ id: string }>\n  default_version?: { id: string }\n}\n\ntype ApiEnvelope<T> = {\n  success?: boolean\n  data?: T\n  error?: { message?: string; details?: unknown }\n}\n\nexport default function ManifestEditorPage() {\n  const params = useParams()\n  const router = useRouter()\n  const funnelSlug = params.identifier as string\n\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [funnelVersion, setFunnelVersion] = useState<FunnelVersion | null>(null)\n  const [manifest, setManifest] = useState<FunnelContentManifest | null>(null)\n  const [selectedPageIndex, setSelectedPageIndex] = useState(0)\n  const [selectedSectionIndex, setSelectedSectionIndex] = useState<number | null>(null)\n  const [editingBlock, setEditingBlock] = useState<ContentSection | null>(null)\n  const [validationErrors, setValidationErrors] = useState<string[]>([])\n\n  // Load funnel and its default version\n  const loadFunnelVersion = useCallback(async () => {\n    try {\n      setLoading(true)\n      setError(null)\n\n      // First, get funnel to find default version\n      const funnelRes = await fetch(`/api/admin/funnels/${funnelSlug}`)\n      if (!funnelRes.ok) {\n        throw new Error('Failed to load funnel')\n      }\n\n      const funnelData: ApiEnvelope<FunnelDetailsResponse> = await funnelRes.json()\n\n      // Deterministic version selection:\n      // Prefer latest version returned by the API (ordered desc), otherwise fall back to default.\n      // IMPORTANT: Do not transform UUIDs.\n      const latestVersionId =\n        funnelData.data?.versions?.[0]?.id || funnelData.data?.default_version?.id\n\n      if (!latestVersionId) {\n        throw new Error('No funnel version found for funnel')\n      }\n\n      // Load manifest\n      const manifestRes = await fetch(`/api/admin/funnel-versions/${latestVersionId}/manifest`)\n      if (!manifestRes.ok) {\n        throw new Error('Failed to load manifest')\n      }\n\n      const manifestData: ApiEnvelope<FunnelVersion> = await manifestRes.json()\n      if (!manifestData.data) {\n        throw new Error('No manifest data returned')\n      }\n\n      setFunnelVersion(manifestData.data)\n      setManifest(manifestData.data.manifest)\n    } catch (err) {\n      console.error('Error loading funnel version:', err)\n      setError(err instanceof Error ? err.message : 'Failed to load funnel')\n    } finally {\n      setLoading(false)\n    }\n  }, [funnelSlug])\n\n  useEffect(() => {\n    loadFunnelVersion()\n  }, [loadFunnelVersion])\n\n  // Save manifest\n  const saveManifest = async () => {\n    if (!funnelVersion || !manifest) return\n\n    // Clear previous validation errors\n    setValidationErrors([])\n\n    try {\n      setSaving(true)\n\n      const response = await fetch(`/api/admin/funnel-versions/${funnelVersion.id}/manifest`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ manifest }),\n      })\n\n      if (!response.ok) {\n        const errorData: ApiEnvelope<unknown> = await response.json()\n        if (errorData.error?.details) {\n          // Show Zod validation errors\n          const details = errorData.error.details as { path: (string | number)[]; message: string }[]\n          setValidationErrors(details.map(d => `${d.path.join('.')}: ${d.message}`))\n        }\n        throw new Error(errorData.error?.message || 'Failed to save manifest')\n      }\n\n      const data: ApiEnvelope<FunnelVersion> = await response.json()\n      if (data.data) {\n        setFunnelVersion(data.data)\n        setManifest(data.data.manifest)\n      }\n\n      alert('Manifest erfolgreich gespeichert')\n    } catch (err) {\n      console.error('Error saving manifest:', err)\n      alert(`Fehler beim Speichern: ${err instanceof Error ? err.message : 'Unknown error'}`)\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  // Add new block to current page\n  const addBlock = (type: string) => {\n    if (!manifest) return\n\n    const currentPage = manifest.pages[selectedPageIndex]\n    if (!currentPage) return\n\n    const newSection: ContentSection = {\n      key: `section-${Date.now()}`,\n      type: type as ContentSection['type'],\n      content: {},\n      orderIndex: currentPage.sections.length,\n    }\n\n    const updatedPages = [...manifest.pages]\n    updatedPages[selectedPageIndex] = {\n      ...currentPage,\n      sections: [...currentPage.sections, newSection],\n    }\n\n    setManifest({\n      ...manifest,\n      pages: updatedPages,\n    })\n  }\n\n  // Remove block\n  const removeBlock = (sectionIndex: number) => {\n    if (!manifest || !confirm('Block wirklich löschen?')) return\n\n    const currentPage = manifest.pages[selectedPageIndex]\n    if (!currentPage) return\n\n    const updatedSections = currentPage.sections.filter((_, i) => i !== sectionIndex)\n    // Reindex\n    updatedSections.forEach((s, i) => {\n      s.orderIndex = i\n    })\n\n    const updatedPages = [...manifest.pages]\n    updatedPages[selectedPageIndex] = {\n      ...currentPage,\n      sections: updatedSections,\n    }\n\n    setManifest({\n      ...manifest,\n      pages: updatedPages,\n    })\n\n    if (selectedSectionIndex === sectionIndex) {\n      setSelectedSectionIndex(null)\n      setEditingBlock(null)\n    }\n  }\n\n  // Move block up/down\n  const moveBlock = (sectionIndex: number, direction: 'up' | 'down') => {\n    if (!manifest) return\n\n    const currentPage = manifest.pages[selectedPageIndex]\n    if (!currentPage) return\n\n    const newIndex = direction === 'up' ? sectionIndex - 1 : sectionIndex + 1\n    if (newIndex < 0 || newIndex >= currentPage.sections.length) return\n\n    const updatedSections = [...currentPage.sections]\n    const [moved] = updatedSections.splice(sectionIndex, 1)\n    updatedSections.splice(newIndex, 0, moved)\n\n    // Reindex for determinism\n    updatedSections.forEach((s, i) => {\n      s.orderIndex = i\n    })\n\n    const updatedPages = [...manifest.pages]\n    updatedPages[selectedPageIndex] = {\n      ...currentPage,\n      sections: updatedSections,\n    }\n\n    setManifest({\n      ...manifest,\n      pages: updatedPages,\n    })\n  }\n\n  // Update block content\n  const updateBlockContent = (sectionIndex: number, content: Record<string, unknown>) => {\n    if (!manifest) return\n\n    const currentPage = manifest.pages[selectedPageIndex]\n    if (!currentPage) return\n\n    const updatedSections = [...currentPage.sections]\n    updatedSections[sectionIndex] = {\n      ...updatedSections[sectionIndex],\n      content,\n    }\n\n    const updatedPages = [...manifest.pages]\n    updatedPages[selectedPageIndex] = {\n      ...currentPage,\n      sections: updatedSections,\n    }\n\n    setManifest({\n      ...manifest,\n      pages: updatedPages,\n    })\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <LoadingSpinner size=\"lg\" text=\"Lade Manifest…\" centered />\n      </div>\n    )\n  }\n\n  if (error || !manifest || !funnelVersion) {\n    return (\n      <div className=\"max-w-6xl mx-auto\">\n        <ErrorState title=\"Fehler beim Laden\" message={error || 'Manifest nicht gefunden'} centered />\n        <div className=\"mt-4 text-center\">\n          <Link\n            href={`/clinician/funnels/${funnelSlug}`}\n            className=\"inline-flex items-center text-sm text-sky-600 hover:text-sky-700 font-medium\"\n          >\n            ← Zurück zum Funnel\n          </Link>\n        </div>\n      </div>\n    )\n  }\n\n  const currentPage = manifest.pages[selectedPageIndex]\n\n  return (\n    <div className=\"max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <div className=\"mb-4\">\n          <Link\n            href={`/clinician/funnels/${funnelSlug}`}\n            className=\"inline-flex items-center text-sm text-sky-600 hover:text-sky-700 font-medium\"\n          >\n            ← Zurück zum Funnel\n          </Link>\n        </div>\n\n        <div className=\"flex items-start justify-between gap-4\">\n          <div>\n            <h1 className=\"text-2xl md:text-3xl font-bold text-slate-900 dark:text-slate-50 mb-2\">\n              Content Block Editor\n            </h1>\n            <p className=\"text-slate-600 dark:text-slate-300\">\n              Manifest Version: {funnelVersion.version} • {manifest.pages.length} Seite(n)\n            </p>\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button variant=\"secondary\" size=\"md\" onClick={() => router.back()}>\n              Abbrechen\n            </Button>\n            <Button variant=\"primary\" size=\"md\" onClick={saveManifest} disabled={saving}>\n              {saving ? 'Speichert…' : 'Speichern'}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Validation Errors */}\n      {validationErrors.length > 0 && (\n        <Card padding=\"md\" className=\"mb-6 bg-red-50 border-red-200\">\n          <h3 className=\"text-sm font-semibold text-red-900 mb-2\">Validierungsfehler:</h3>\n          <ul className=\"list-disc list-inside text-sm text-red-800 space-y-1\">\n            {validationErrors.map((err, i) => (\n              <li key={i}>{err}</li>\n            ))}\n          </ul>\n        </Card>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Left Panel: Page List */}\n        <div className=\"lg:col-span-1\">\n          <Card padding=\"md\">\n            <h2 className=\"text-lg font-semibold text-slate-900 dark:text-slate-50 mb-4\">Seiten</h2>\n            <div className=\"space-y-2\">\n              {manifest.pages.map((page, index) => (\n                <button\n                  key={page.slug}\n                  onClick={() => {\n                    setSelectedPageIndex(index)\n                    setSelectedSectionIndex(null)\n                    setEditingBlock(null)\n                  }}\n                  className={`w-full text-left px-3 py-2 rounded transition-colors ${\n                    selectedPageIndex === index\n                      ? 'bg-sky-100 text-sky-900 dark:bg-sky-900 dark:text-sky-50'\n                      : 'hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-300'\n                  }`}\n                >\n                  <div className=\"font-medium truncate\">{page.title}</div>\n                  <div className=\"text-xs text-slate-500 dark:text-slate-400 truncate\">\n                    {page.slug} • {page.sections.length} Block(s)\n                  </div>\n                </button>\n              ))}\n            </div>\n          </Card>\n        </div>\n\n        {/* Middle Panel: Section/Block List */}\n        <div className=\"lg:col-span-1\">\n          <Card padding=\"md\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-lg font-semibold text-slate-900 dark:text-slate-50\">\n                Blocks: {currentPage?.title}\n              </h2>\n              <div className=\"relative group\">\n                <Button variant=\"primary\" size=\"sm\">\n                  + Block\n                </Button>\n                <div className=\"absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10\">\n                  {Object.entries(SECTION_TYPE).map(([key, value]) => (\n                    <button\n                      key={value}\n                      onClick={() => addBlock(value)}\n                      className=\"block w-full text-left px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700 first:rounded-t-lg last:rounded-b-lg\"\n                    >\n                      {key}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              {currentPage?.sections.map((section, index) => (\n                <div\n                  key={section.key}\n                  className={`border rounded-lg transition-colors ${\n                    selectedSectionIndex === index\n                      ? 'border-sky-500 bg-sky-50 dark:bg-sky-900/20'\n                      : 'border-slate-200 dark:border-slate-700 hover:border-slate-300'\n                  }`}\n                >\n                  <button\n                    onClick={() => {\n                      setSelectedSectionIndex(index)\n                      setEditingBlock(section)\n                    }}\n                    className=\"w-full text-left px-3 py-2\"\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"text-sm font-medium text-slate-900 dark:text-slate-50\">\n                          {section.type}\n                        </div>\n                        <div className=\"text-xs text-slate-500 dark:text-slate-400 truncate\">\n                          {section.key}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-1 ml-2\">\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation()\n                            moveBlock(index, 'up')\n                          }}\n                          disabled={index === 0}\n                          className=\"p-1 text-slate-500 hover:text-slate-700 disabled:opacity-30 disabled:cursor-not-allowed\"\n                          title=\"Nach oben\"\n                        >\n                          ↑\n                        </button>\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation()\n                            moveBlock(index, 'down')\n                          }}\n                          disabled={index === currentPage.sections.length - 1}\n                          className=\"p-1 text-slate-500 hover:text-slate-700 disabled:opacity-30 disabled:cursor-not-allowed\"\n                          title=\"Nach unten\"\n                        >\n                          ↓\n                        </button>\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation()\n                            removeBlock(index)\n                          }}\n                          className=\"p-1 text-red-500 hover:text-red-700\"\n                          title=\"Löschen\"\n                        >\n                          ✕\n                        </button>\n                      </div>\n                    </div>\n                  </button>\n                </div>\n              ))}\n            </div>\n\n            {currentPage?.sections.length === 0 && (\n              <div className=\"text-center py-8 text-slate-500 dark:text-slate-400 text-sm\">\n                Keine Blocks vorhanden. Fügen Sie einen Block hinzu.\n              </div>\n            )}\n          </Card>\n        </div>\n\n        {/* Right Panel: Block Editor */}\n        <div className=\"lg:col-span-1\">\n          <Card padding=\"md\">\n            <h2 className=\"text-lg font-semibold text-slate-900 dark:text-slate-50 mb-4\">\n              Block bearbeiten\n            </h2>\n\n            {editingBlock && selectedSectionIndex !== null ? (\n              <BlockEditor\n                section={editingBlock}\n                onChange={(content) => updateBlockContent(selectedSectionIndex, content)}\n              />\n            ) : (\n              <div className=\"text-center py-8 text-slate-500 dark:text-slate-400 text-sm\">\n                Wählen Sie einen Block zum Bearbeiten aus\n              </div>\n            )}\n          </Card>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// Block Editor Component\ntype BlockEditorProps = {\n  section: ContentSection\n  onChange: (content: Record<string, unknown>) => void\n}\n\nfunction BlockEditor({ section, onChange }: BlockEditorProps) {\n  const content = section.content || {}\n\n  const handleFieldChange = (field: string, value: unknown) => {\n    onChange({\n      ...content,\n      [field]: value,\n    })\n  }\n\n  // Render fields based on block type\n  switch (section.type) {\n    case SECTION_TYPE.HERO:\n      return (\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Titel\n            </label>\n            <Input\n              type=\"text\"\n              value={(content.title as string) || ''}\n              onChange={(e) => handleFieldChange('title', e.target.value)}\n              inputSize=\"md\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Untertitel\n            </label>\n            <Input\n              type=\"text\"\n              value={(content.subtitle as string) || ''}\n              onChange={(e) => handleFieldChange('subtitle', e.target.value)}\n              inputSize=\"md\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Ausrichtung\n            </label>\n            <select\n              value={(content.alignment as string) || 'center'}\n              onChange={(e) => handleFieldChange('alignment', e.target.value)}\n              className=\"w-full px-3 py-2 border border-slate-300 rounded-md\"\n            >\n              <option value=\"left\">Links</option>\n              <option value=\"center\">Zentriert</option>\n              <option value=\"right\">Rechts</option>\n            </select>\n          </div>\n        </div>\n      )\n\n    case SECTION_TYPE.TEXT:\n      return (\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Titel (optional)\n            </label>\n            <Input\n              type=\"text\"\n              value={(content.title as string) || ''}\n              onChange={(e) => handleFieldChange('title', e.target.value)}\n              inputSize=\"md\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Text\n            </label>\n            <Textarea\n              value={(content.text as string) || ''}\n              onChange={(e) => handleFieldChange('text', e.target.value)}\n              rows={5}\n              textareaSize=\"md\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Ausrichtung\n            </label>\n            <select\n              value={(content.alignment as string) || 'left'}\n              onChange={(e) => handleFieldChange('alignment', e.target.value)}\n              className=\"w-full px-3 py-2 border border-slate-300 rounded-md\"\n            >\n              <option value=\"left\">Links</option>\n              <option value=\"center\">Zentriert</option>\n              <option value=\"right\">Rechts</option>\n            </select>\n          </div>\n        </div>\n      )\n\n    case SECTION_TYPE.IMAGE:\n      return (\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Bild-URL\n            </label>\n            <Input\n              type=\"text\"\n              value={(content.url as string) || ''}\n              onChange={(e) => handleFieldChange('url', e.target.value)}\n              inputSize=\"md\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Alt-Text\n            </label>\n            <Input\n              type=\"text\"\n              value={(content.alt as string) || ''}\n              onChange={(e) => handleFieldChange('alt', e.target.value)}\n              inputSize=\"md\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Bildunterschrift (optional)\n            </label>\n            <Input\n              type=\"text\"\n              value={(content.caption as string) || ''}\n              onChange={(e) => handleFieldChange('caption', e.target.value)}\n              inputSize=\"md\"\n            />\n          </div>\n        </div>\n      )\n\n    case SECTION_TYPE.VIDEO:\n      return (\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Video-URL\n            </label>\n            <Input\n              type=\"text\"\n              value={(content.url as string) || ''}\n              onChange={(e) => handleFieldChange('url', e.target.value)}\n              inputSize=\"md\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Untertitel (optional)\n            </label>\n            <Input\n              type=\"text\"\n              value={(content.caption as string) || ''}\n              onChange={(e) => handleFieldChange('caption', e.target.value)}\n              inputSize=\"md\"\n            />\n          </div>\n        </div>\n      )\n\n    case SECTION_TYPE.MARKDOWN:\n      return (\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Markdown-Inhalt\n            </label>\n            <Textarea\n              value={(content.markdown as string) || ''}\n              onChange={(e) => handleFieldChange('markdown', e.target.value)}\n              rows={10}\n              textareaSize=\"md\"\n              className=\"font-mono text-sm\"\n            />\n          </div>\n        </div>\n      )\n\n    case SECTION_TYPE.CTA:\n      return (\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Button-Text\n            </label>\n            <Input\n              type=\"text\"\n              value={(content.text as string) || ''}\n              onChange={(e) => handleFieldChange('text', e.target.value)}\n              inputSize=\"md\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Link (href)\n            </label>\n            <Input\n              type=\"text\"\n              value={(content.href as string) || ''}\n              onChange={(e) => handleFieldChange('href', e.target.value)}\n              inputSize=\"md\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Variante\n            </label>\n            <select\n              value={(content.variant as string) || 'primary'}\n              onChange={(e) => handleFieldChange('variant', e.target.value)}\n              className=\"w-full px-3 py-2 border border-slate-300 rounded-md\"\n            >\n              <option value=\"primary\">Primary</option>\n              <option value=\"secondary\">Secondary</option>\n              <option value=\"outline\">Outline</option>\n            </select>\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Ausrichtung\n            </label>\n            <select\n              value={(content.alignment as string) || 'center'}\n              onChange={(e) => handleFieldChange('alignment', e.target.value)}\n              className=\"w-full px-3 py-2 border border-slate-300 rounded-md\"\n            >\n              <option value=\"left\">Links</option>\n              <option value=\"center\">Zentriert</option>\n              <option value=\"right\">Rechts</option>\n            </select>\n          </div>\n        </div>\n      )\n\n    case SECTION_TYPE.DIVIDER:\n      return (\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Stil\n            </label>\n            <select\n              value={(content.style as string) || 'solid'}\n              onChange={(e) => handleFieldChange('style', e.target.value)}\n              className=\"w-full px-3 py-2 border border-slate-300 rounded-md\"\n            >\n              <option value=\"solid\">Durchgezogen</option>\n              <option value=\"dashed\">Gestrichelt</option>\n              <option value=\"dotted\">Gepunktet</option>\n            </select>\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\n              Abstand\n            </label>\n            <select\n              value={(content.spacing as string) || 'md'}\n              onChange={(e) => handleFieldChange('spacing', e.target.value)}\n              className=\"w-full px-3 py-2 border border-slate-300 rounded-md\"\n            >\n              <option value=\"sm\">Klein</option>\n              <option value=\"md\">Mittel</option>\n              <option value=\"lg\">Groß</option>\n            </select>\n          </div>\n        </div>\n      )\n\n    default:\n      return (\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n          <p className=\"text-sm text-red-800 font-semibold\">Unbekannter Block-Typ</p>\n          <p className=\"text-xs text-red-600 mt-1\">\n            Typ &quot;{section.type}&quot; wird nicht unterstützt. Dieser Block kann nicht\n            bearbeitet werden.\n          </p>\n        </div>\n      )\n  }\n}\n","/**\n * Funnel Plugin Manifest Schemas (V05-I02.2)\n * \n * This file defines the versioned \"Plugin Manifest\" structure for funnels.\n * All funnel versions store their configuration in JSONB fields validated by these schemas.\n * \n * **NO MAGIC STRINGS**: All question types, section types, and step types come from registry.\n * \n * Structure:\n * - FunnelQuestionnaireConfigSchema: Steps, questions, validation logic\n * - FunnelContentManifestSchema: Content pages, sections, assets\n * - Algorithm bundle version: String pointer to algorithm version\n * - Prompt version: String for content/report generation\n */\n\nimport { z } from 'zod'\nimport { NODE_TYPE, QUESTION_TYPE, type NodeType, type QuestionType } from './registry'\nimport { isValidUrl } from '@/lib/utils/urlSecurity'\n\nfunction normalizeQuestionType(value: unknown): unknown {\n  if (typeof value !== 'string') return value\n\n  const normalized = value.toLowerCase().trim()\n  if (Object.values(QUESTION_TYPE).includes(normalized as QuestionType)) {\n    return normalized\n  }\n\n  // Compatibility layer for older/looser DB values.\n  // Keep this mapping narrow + deterministic so QuestionRenderer still receives only registry types.\n  const aliases: Record<string, QuestionType> = {\n    // single choice\n    'single_choice': QUESTION_TYPE.RADIO,\n    'single-choice': QUESTION_TYPE.RADIO,\n    'select_one': QUESTION_TYPE.RADIO,\n    'select-one': QUESTION_TYPE.RADIO,\n    'multiple_choice': QUESTION_TYPE.RADIO,\n\n    // multiple select\n    'multi_choice': QUESTION_TYPE.CHECKBOX,\n    'multi-choice': QUESTION_TYPE.CHECKBOX,\n    'select_many': QUESTION_TYPE.CHECKBOX,\n    'select-many': QUESTION_TYPE.CHECKBOX,\n    'multiple_select': QUESTION_TYPE.CHECKBOX,\n    'multiple-select': QUESTION_TYPE.CHECKBOX,\n\n    // text\n    'short_text': QUESTION_TYPE.TEXT,\n    'short-text': QUESTION_TYPE.TEXT,\n    'string': QUESTION_TYPE.TEXT,\n\n    // textarea\n    'long_text': QUESTION_TYPE.TEXTAREA,\n    'long-text': QUESTION_TYPE.TEXTAREA,\n    'paragraph': QUESTION_TYPE.TEXTAREA,\n\n    // number\n    'integer': QUESTION_TYPE.NUMBER,\n    'float': QUESTION_TYPE.NUMBER,\n    'decimal': QUESTION_TYPE.NUMBER,\n\n    // scale/rating\n    'likert': QUESTION_TYPE.SCALE,\n    'likert_scale': QUESTION_TYPE.SCALE,\n    'likert-scale': QUESTION_TYPE.SCALE,\n    'rating': QUESTION_TYPE.SCALE,\n\n    // slider/range\n    'range': QUESTION_TYPE.SLIDER,\n  }\n\n  return aliases[normalized] ?? normalized\n}\n\n// IMPORTANT: keep this optional at the *object key* level.\n// Using `.transform()` directly can turn it into a required key with `string | undefined`.\nconst nullableString = z\n  .preprocess((value) => (value === null ? undefined : value), z.string().optional())\n  .optional()\n\n// ============================================================\n// Questionnaire Config Schema\n// ============================================================\n\n/**\n * V05-I06.4 Security: Safe URL validator for Zod schemas\n * Rejects javascript:, data:, vbscript:, file: and other dangerous protocols\n */\nconst safeUrlValidator = z.string().refine(\n  (url) => {\n    // Empty/undefined is OK for optional fields\n    if (!url || url.trim() === '') return true\n    return isValidUrl(url, false)\n  },\n  {\n    message: 'URL must use http:, https:, mailto:, tel:, or be a relative path. Dangerous protocols (javascript:, data:, vbscript:, file:) are not allowed.',\n  }\n)\n\n/**\n * Validation rule for question\n */\nexport const QuestionValidationSchema = z.object({\n  required: z.boolean().optional(),\n  min: z.number().optional(),\n  max: z.number().optional(),\n  pattern: z.string().optional(),\n  message: z.string().optional(),\n})\n\nexport type QuestionValidation = z.infer<typeof QuestionValidationSchema>\n\n/**\n * Option for radio/checkbox questions\n */\nexport const QuestionOptionSchema = z.object({\n  value: z.string(),\n  label: z.string(),\n  helpText: nullableString,\n})\n\nexport type QuestionOption = z.infer<typeof QuestionOptionSchema>\n\n/**\n * Individual question in questionnaire\n */\nexport const QuestionConfigSchema = z.object({\n  id: z.string(),\n  key: z.string(),\n  type: z.preprocess(\n    normalizeQuestionType,\n    z.enum([\n      QUESTION_TYPE.RADIO,\n      QUESTION_TYPE.CHECKBOX,\n      QUESTION_TYPE.TEXT,\n      QUESTION_TYPE.TEXTAREA,\n      QUESTION_TYPE.NUMBER,\n      QUESTION_TYPE.SCALE,\n      QUESTION_TYPE.SLIDER,\n    ] as [QuestionType, ...QuestionType[]]),\n  ),\n  label: z.string(),\n  helpText: nullableString,\n  required: z.boolean().default(false),\n  options: z.array(QuestionOptionSchema).optional(),\n  validation: QuestionValidationSchema.optional(),\n  minValue: z.number().optional(),\n  maxValue: z.number().optional(),\n})\n\nexport type QuestionConfig = z.infer<typeof QuestionConfigSchema>\n\n/**\n * Conditional logic for step/question visibility\n */\nexport const ConditionalLogicSchema = z.object({\n  type: z.enum(['show', 'hide', 'skip']),\n  conditions: z.array(\n    z.object({\n      questionId: z.string(),\n      operator: z.enum(['eq', 'neq', 'gt', 'gte', 'lt', 'lte', 'in', 'notIn']),\n      value: z.union([z.string(), z.number(), z.boolean(), z.array(z.string())]),\n    }),\n  ),\n  logic: z.enum(['and', 'or']).default('and'),\n})\n\nexport type ConditionalLogic = z.infer<typeof ConditionalLogicSchema>\n\n/**\n * Step in questionnaire flow\n */\nexport const QuestionnaireStepSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  description: z.string().optional(),\n  questions: z.array(QuestionConfigSchema),\n  conditionalLogic: ConditionalLogicSchema.optional(),\n})\n\nexport type QuestionnaireStep = z.infer<typeof QuestionnaireStepSchema>\n\n/**\n * Complete questionnaire configuration\n */\nexport const FunnelQuestionnaireConfigSchema = z.object({\n  version: z.string().default('1.0'),\n  steps: z.array(QuestionnaireStepSchema),\n  conditionalLogic: z.array(ConditionalLogicSchema).optional(),\n  metadata: z.record(z.string(), z.any()).optional(),\n})\n\nexport type FunnelQuestionnaireConfig = z.infer<typeof FunnelQuestionnaireConfigSchema>\n\n// ============================================================\n// Content Manifest Schema\n// ============================================================\n\n/**\n * Section types for content pages\n * These are the allowed types for sections within content pages\n */\nexport const SECTION_TYPE = {\n  HERO: 'hero',\n  TEXT: 'text',\n  IMAGE: 'image',\n  VIDEO: 'video',\n  MARKDOWN: 'markdown',\n  CTA: 'cta',\n  DIVIDER: 'divider',\n} as const\n\nexport type SectionType = typeof SECTION_TYPE[keyof typeof SECTION_TYPE]\n\n/**\n * Content section within a page\n * \n * V05-I06.2 Hardening: Added strict bounds and validation\n * V05-I06.4 Security: Added URL validation for content fields\n * - key: max 200 chars (prevent DoS)\n * - contentRef: max 2048 chars (URL/path length limit)\n * - orderIndex: non-negative integer (deterministic sorting)\n * - content.url, content.href: validated against dangerous protocols\n * - No unknown keys allowed (strict mode via .strict())\n */\nexport const ContentSectionSchema = z\n  .object({\n    key: z.string().min(1).max(200),\n    type: z.enum([\n      SECTION_TYPE.HERO,\n      SECTION_TYPE.TEXT,\n      SECTION_TYPE.IMAGE,\n      SECTION_TYPE.VIDEO,\n      SECTION_TYPE.MARKDOWN,\n      SECTION_TYPE.CTA,\n      SECTION_TYPE.DIVIDER,\n    ] as [SectionType, ...SectionType[]]),\n    contentRef: z.string().max(2048).optional(),\n    content: z.record(z.string(), z.any()).optional(),\n    orderIndex: z.number().int().nonnegative().optional(),\n  })\n  .strict()\n  .refine(\n    (section) => {\n      // Validate URLs in content object for security\n      if (!section.content) return true\n      \n      // Check href field (CTA blocks)\n      if ('href' in section.content && typeof section.content.href === 'string') {\n        if (!isValidUrl(section.content.href, false)) {\n          return false\n        }\n      }\n      \n      // Check url field (Image, Video blocks)\n      if ('url' in section.content && typeof section.content.url === 'string') {\n        if (!isValidUrl(section.content.url, false)) {\n          return false\n        }\n      }\n      \n      // Check backgroundImage field (Hero blocks)\n      if ('backgroundImage' in section.content && typeof section.content.backgroundImage === 'string') {\n        if (section.content.backgroundImage && !isValidUrl(section.content.backgroundImage, false)) {\n          return false\n        }\n      }\n      \n      return true\n    },\n    {\n      message: 'Content URLs must use safe protocols (http:, https:, mailto:, tel:, or relative paths). Dangerous protocols (javascript:, data:, vbscript:, file:) are not allowed.',\n    }\n  )\n\nexport type ContentSection = z.infer<typeof ContentSectionSchema>\n\n/**\n * Content page definition\n * \n * V05-I06.2 Hardening: Added strict bounds\n * - slug: max 200 chars, alphanumeric + hyphens\n * - title: max 500 chars\n * - description: max 2000 chars\n * - sections: max 100 sections per page\n * - No unknown keys allowed (strict mode)\n */\nexport const ContentPageSchema = z\n  .object({\n    slug: z\n      .string()\n      .min(1)\n      .max(200)\n      .regex(/^[a-z0-9-]+$/, 'Slug must be lowercase alphanumeric with hyphens'),\n    title: z.string().min(1).max(500),\n    description: z.string().max(2000).optional(),\n    sections: z.array(ContentSectionSchema).max(100),\n    metadata: z.record(z.string(), z.any()).optional(),\n  })\n  .strict()\n\nexport type ContentPage = z.infer<typeof ContentPageSchema>\n\n/**\n * Complete content manifest\n * \n * V05-I06.2 Hardening: Added strict bounds\n * - version: max 20 chars\n * - pages: max 50 pages per manifest\n * - assets: max 200 assets per manifest\n * - asset key: max 200 chars\n * - asset url: max 2048 chars\n * - No unknown keys allowed (strict mode)\n */\nexport const FunnelContentManifestSchema = z\n  .object({\n    version: z.string().max(20).default('1.0'),\n    pages: z.array(ContentPageSchema).max(50),\n    assets: z\n      .array(\n        z\n          .object({\n            key: z.string().min(1).max(200),\n            type: z.enum(['image', 'video', 'audio', 'document']),\n            url: safeUrlValidator.min(1).max(2048),\n            metadata: z.record(z.string(), z.any()).optional(),\n          })\n          .strict(),\n      )\n      .max(200)\n      .optional(),\n    metadata: z.record(z.string(), z.any()).optional(),\n  })\n  .strict()\n\nexport type FunnelContentManifest = z.infer<typeof FunnelContentManifestSchema>\n\n// ============================================================\n// Complete Plugin Manifest\n// ============================================================\n\n/**\n * Complete funnel plugin manifest\n * This represents all configuration data for a funnel version\n */\nexport const FunnelPluginManifestSchema = z.object({\n  questionnaire_config: FunnelQuestionnaireConfigSchema,\n  content_manifest: FunnelContentManifestSchema,\n  algorithm_bundle_version: z.string(),\n  prompt_version: z.string(),\n})\n\nexport type FunnelPluginManifest = z.infer<typeof FunnelPluginManifestSchema>\n\n// ============================================================\n// Helper Functions\n// ============================================================\n\n/**\n * Type guard to check if a value is a valid section type\n */\nexport function isValidSectionType(value: unknown): value is SectionType {\n  return typeof value === 'string' && Object.values(SECTION_TYPE).includes(value as SectionType)\n}\n\n/**\n * Validates and parses questionnaire config from JSONB\n * @throws ZodError if validation fails\n */\nexport function parseQuestionnaireConfig(\n  json: unknown,\n): FunnelQuestionnaireConfig {\n  return FunnelQuestionnaireConfigSchema.parse(json)\n}\n\n/**\n * Safely parses questionnaire config with error handling\n * @returns Parsed config or null if invalid\n */\nexport function safeParseQuestionnaireConfig(\n  json: unknown,\n): FunnelQuestionnaireConfig | null {\n  const result = FunnelQuestionnaireConfigSchema.safeParse(json)\n  return result.success ? result.data : null\n}\n\n/**\n * Validates and parses content manifest from JSONB\n * @throws ZodError if validation fails\n */\nexport function parseContentManifest(json: unknown): FunnelContentManifest {\n  return FunnelContentManifestSchema.parse(json)\n}\n\n/**\n * Safely parses content manifest with error handling\n * @returns Parsed manifest or null if invalid\n */\nexport function safeParseContentManifest(json: unknown): FunnelContentManifest | null {\n  const result = FunnelContentManifestSchema.safeParse(json)\n  return result.success ? result.data : null\n}\n\n/**\n * Validates and parses complete plugin manifest\n * @throws ZodError if validation fails\n */\nexport function parsePluginManifest(json: unknown): FunnelPluginManifest {\n  return FunnelPluginManifestSchema.parse(json)\n}\n\n/**\n * Safely parses complete plugin manifest with error handling\n * @returns Parsed manifest or null if invalid\n */\nexport function safeParsePluginManifest(json: unknown): FunnelPluginManifest | null {\n  const result = FunnelPluginManifestSchema.safeParse(json)\n  return result.success ? result.data : null\n}\n","/**\n * URL Security Validation (V05-I06.2 Hardening)\n * \n * Validates URLs to prevent XSS and other security issues\n * Denies javascript:, data:, vbscript:, and other dangerous protocols\n */\n\n/**\n * Allowed URL protocols for content blocks\n */\nconst ALLOWED_PROTOCOLS = ['http:', 'https:', 'mailto:', 'tel:']\n\n/**\n * Maximum URL length to prevent buffer overflow attacks\n */\nconst MAX_URL_LENGTH = 2048\n\n/**\n * Validates a URL for security\n * \n * Rejects:\n * - javascript: URLs (XSS)\n * - data: URLs (unless explicitly allowed)\n * - vbscript: URLs (XSS)\n * - file: URLs (local file access)\n * - Overly long URLs (DoS)\n * \n * @param url - URL to validate\n * @param allowDataUrls - Whether to allow data: URLs (default: false)\n * @returns true if URL is safe, false otherwise\n */\nexport function isValidUrl(url: string | undefined, allowDataUrls = false): boolean {\n  if (!url || typeof url !== 'string') {\n    return false\n  }\n\n  // Check length\n  if (url.length > MAX_URL_LENGTH) {\n    return false\n  }\n\n  // Trim and normalize\n  const trimmed = url.trim().toLowerCase()\n\n  // Empty after trim\n  if (trimmed.length === 0) {\n    return false\n  }\n\n  // Check for dangerous protocols (always forbidden)\n  const dangerousProtocols = ['javascript:', 'vbscript:', 'file:', 'about:']\n  \n  for (const protocol of dangerousProtocols) {\n    if (trimmed.startsWith(protocol)) {\n      return false\n    }\n  }\n\n  // Handle data: URLs separately\n  if (trimmed.startsWith('data:')) {\n    return allowDataUrls\n  }\n\n  // Relative URLs are OK (start with /, ./, ../)\n  if (trimmed.startsWith('/') || trimmed.startsWith('./') || trimmed.startsWith('../')) {\n    return true\n  }\n\n  // Check for allowed protocols\n  try {\n    const parsed = new URL(url)\n    return ALLOWED_PROTOCOLS.includes(parsed.protocol)\n  } catch {\n    // If URL parsing fails, allow relative URLs that don't look suspicious\n    // This handles cases like \"page.html\" or \"#anchor\"\n    return !trimmed.includes(':')\n  }\n}\n\n/**\n * Sanitizes a URL by returning it only if valid, otherwise returns fallback\n * \n * @param url - URL to sanitize\n * @param fallback - Fallback URL if invalid (default: '#')\n * @param allowDataUrls - Whether to allow data: URLs (default: false)\n * @returns Sanitized URL or fallback\n */\nexport function sanitizeUrl(\n  url: string | undefined,\n  fallback = '#',\n  allowDataUrls = false,\n): string {\n  return isValidUrl(url, allowDataUrls) ? url! : fallback\n}\n\n/**\n * Gets safe link props for external links\n * Adds rel=\"noopener noreferrer\" for external links\n * \n * @param href - Link href\n * @returns Object with href and optional rel/target\n */\nexport function getSafeLinkProps(href: string): {\n  href: string\n  rel?: string\n  target?: string\n} {\n  const sanitized = sanitizeUrl(href)\n\n  // Check if external link (starts with http:// or https://)\n  const isExternal =\n    sanitized.startsWith('http://') || sanitized.startsWith('https://')\n\n  if (isExternal) {\n    return {\n      href: sanitized,\n      rel: 'noopener noreferrer',\n      target: '_blank',\n    }\n  }\n\n  return { href: sanitized }\n}\n"],"names":[],"mappings":"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"}