(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87130,e=>{"use strict";let t=(0,e.i(68569).default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.s(["Filter",()=>t],87130)},70419,e=>{"use strict";var t=e.i(18050),s=e.i(71645);e.i(47446);var r=e.i(67488),a=e.i(12911),l=e.i(32796),n=e.i(84584),i=e.i(52220),o=e.i(63209),c=e.i(87130),d=e.i(81307);let u={OPEN:"open",IN_PROGRESS:"in_progress",ESCALATED:"escalated",RESOLVED:"resolved",CLOSED:"closed"},x=d.z.enum([u.OPEN,u.IN_PROGRESS,u.ESCALATED,u.RESOLVED,u.CLOSED]),g={LOW:"low",MEDIUM:"medium",HIGH:"high",URGENT:"urgent"},m=d.z.enum([g.LOW,g.MEDIUM,g.HIGH,g.URGENT]),p="technical",b="medical",h="administrative",j="billing",f="general",y="other",N=d.z.enum([p,b,h,j,f,y]);function v(e){switch(e){case u.OPEN:return"Offen";case u.IN_PROGRESS:return"In Bearbeitung";case u.ESCALATED:return"Eskaliert";case u.RESOLVED:return"Gelöst";case u.CLOSED:return"Geschlossen";default:return e}}function E(e){switch(e){case g.LOW:return"Niedrig";case g.MEDIUM:return"Mittel";case g.HIGH:return"Hoch";case g.URGENT:return"Dringend";default:return e}}d.z.object({id:d.z.string().uuid(),patient_id:d.z.string().uuid(),organization_id:d.z.string().uuid().nullable(),created_by_user_id:d.z.string().uuid().nullable(),assigned_to_user_id:d.z.string().uuid().nullable(),escalated_task_id:d.z.string().uuid().nullable(),category:N,priority:m,status:x,subject:d.z.string(),description:d.z.string().nullable(),notes:d.z.string().nullable(),resolution_notes:d.z.string().nullable(),metadata:d.z.record(d.z.string(),d.z.any()).nullable(),escalated_at:d.z.string().nullable(),escalated_by_user_id:d.z.string().uuid().nullable(),created_at:d.z.string(),updated_at:d.z.string().nullable(),resolved_at:d.z.string().nullable(),closed_at:d.z.string().nullable()}),d.z.object({patient_id:d.z.string().uuid(),category:N.optional(),priority:m.optional(),subject:d.z.string().min(1,"Subject is required").max(200,"Subject too long"),description:d.z.string().optional(),metadata:d.z.record(d.z.string(),d.z.any()).optional()}),d.z.object({status:x.optional(),priority:m.optional(),assigned_to_user_id:d.z.string().uuid().nullable().optional(),description:d.z.string().nullable().optional(),notes:d.z.string().nullable().optional(),resolution_notes:d.z.string().nullable().optional(),metadata:d.z.record(d.z.string(),d.z.any()).optional()}),d.z.object({assigned_to_role:d.z.enum(["clinician","admin"]),assigned_to_user_id:d.z.string().uuid().optional(),escalation_notes:d.z.string().optional(),task_due_at:d.z.string().optional()}),d.z.object({patient_id:d.z.string().uuid().optional(),organization_id:d.z.string().uuid().optional(),assigned_to_user_id:d.z.string().uuid().optional(),category:N.optional(),priority:m.optional(),status:x.optional(),is_escalated:d.z.boolean().optional()});var S=e.i(37727),z=e.i(78894);function _({supportCase:e,onClose:a,onEscalate:l}){let[n,i]=(0,s.useState)("clinician"),[o,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(!1),[x,g]=(0,s.useState)(null);async function m(e){e.preventDefault();try{u(!0),g(null),await l({assigned_to_role:n,escalation_notes:o.trim()||void 0})}catch(e){console.error("Error escalating:",e),g(e instanceof Error?e.message:"Fehler beim Eskalieren"),u(!1)}}return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full",children:[(0,t.jsxs)("div",{className:"border-b border-gray-200 p-6 flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(z.AlertTriangle,{size:24,className:"text-orange-600"}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Support-Fall eskalieren"})]}),(0,t.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:d,children:(0,t.jsx)(S.X,{size:24})})]}),(0,t.jsxs)("form",{onSubmit:m,className:"p-6 space-y-6",children:[x&&(0,t.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded text-red-800 text-sm",children:x}),(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded",children:[(0,t.jsxs)("p",{className:"text-sm text-blue-900",children:[(0,t.jsx)("strong",{children:"Betreff:"})," ",e.subject]}),e.description&&(0,t.jsxs)("p",{className:"text-sm text-blue-800 mt-2",children:[(0,t.jsx)("strong",{children:"Beschreibung:"})," ",e.description]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"assigned_to_role",className:"block text-sm font-medium text-gray-700 mb-2",children:"Rolle zuweisen"}),(0,t.jsxs)("select",{id:"assigned_to_role",value:n,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:d,children:[(0,t.jsx)("option",{value:"clinician",children:"Arzt/Ärztin"}),(0,t.jsx)("option",{value:"admin",children:"Administrator"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"escalation_notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Eskalationsnotizen"}),(0,t.jsx)("textarea",{id:"escalation_notes",value:o,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[100px]",placeholder:"Grund für die Eskalation, wichtige Hinweise...",disabled:d})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[(0,t.jsx)(r.Button,{type:"button",onClick:a,disabled:d,className:"bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Abbrechen"}),(0,t.jsx)(r.Button,{type:"submit",disabled:d,className:"bg-orange-600 hover:bg-orange-700",children:d?"Wird eskaliert...":"Eskalieren"})]})]})]})})}let w=(0,e.i(68569).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);function C({supportCase:e,onClose:a,onUpdate:l}){let[n,i]=(0,s.useState)(e.status),[o,c]=(0,s.useState)(e.priority),[d,x]=(0,s.useState)(e.notes||""),[m,p]=(0,s.useState)(e.resolution_notes||""),[b,h]=(0,s.useState)(!1),[j,f]=(0,s.useState)(null),y=function(e){switch(e){case u.OPEN:return[u.IN_PROGRESS,u.ESCALATED,u.RESOLVED,u.CLOSED];case u.IN_PROGRESS:return[u.ESCALATED,u.RESOLVED,u.CLOSED];case u.ESCALATED:return[u.IN_PROGRESS,u.RESOLVED,u.CLOSED];case u.RESOLVED:return[u.CLOSED,u.OPEN];case u.CLOSED:return[u.OPEN];default:return[]}}(e.status);async function N(t){t.preventDefault();try{h(!0),f(null);let t={};n!==e.status&&(t.status=n),o!==e.priority&&(t.priority=o),d!==(e.notes||"")&&(t.notes=d.trim()||null),m!==(e.resolution_notes||"")&&(t.resolution_notes=m.trim()||null),await l(t)}catch(e){console.error("Error updating:",e),f(e instanceof Error?e.message:"Fehler beim Aktualisieren"),h(!1)}}return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(w,{size:24,className:"text-blue-600"}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Support-Fall bearbeiten"})]}),(0,t.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:b,children:(0,t.jsx)(S.X,{size:24})})]}),(0,t.jsxs)("form",{onSubmit:N,className:"p-6 space-y-6",children:[j&&(0,t.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded text-red-800 text-sm",children:j}),(0,t.jsx)("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded",children:(0,t.jsxs)("p",{className:"text-sm text-gray-900",children:[(0,t.jsx)("strong",{children:"Betreff:"})," ",e.subject]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,t.jsxs)("select",{id:"status",value:n,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:b,children:[(0,t.jsxs)("option",{value:e.status,children:[v(e.status)," (Aktuell)"]}),y.filter(t=>t!==e.status).map(e=>(0,t.jsx)("option",{value:e,children:v(e)},e))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-2",children:"Priorität"}),(0,t.jsx)("select",{id:"priority",value:o,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:b,children:Object.values(g).map(e=>(0,t.jsx)("option",{value:e,children:E(e)},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Interne Notizen"}),(0,t.jsx)("textarea",{id:"notes",value:d,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[100px]",placeholder:"Interne Notizen (nicht für Patient sichtbar)...",disabled:b})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"resolution_notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Lösungsnotizen"}),(0,t.jsx)("textarea",{id:"resolution_notes",value:m,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[100px]",placeholder:"Wie wurde der Fall gelöst? (für Patient sichtbar)...",disabled:b})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[(0,t.jsx)(r.Button,{type:"button",onClick:a,disabled:b,className:"bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Abbrechen"}),(0,t.jsx)(r.Button,{type:"submit",disabled:b,children:b?"Wird gespeichert...":"Speichern"})]})]})]})})}function O(){let[e,d]=(0,s.useState)(!0),[x,m]=(0,s.useState)(null),[N,S]=(0,s.useState)([]),[z,w]=(0,s.useState)("all"),[O,D]=(0,s.useState)("all"),[L,A]=(0,s.useState)(null),[k,R]=(0,s.useState)(!1),[F,P]=(0,s.useState)(!1);async function T(){try{d(!0),m(null);let e=new URLSearchParams;"all"!==z&&e.append("status",z),"all"!==O&&e.append("priority",O);let t=await fetch(`/api/support-cases?${e.toString()}`),s=await t.json();if(!s.success)throw Error(s.error?.message||"Failed to load support cases");S(s.data||[])}catch(e){console.error("Error loading support cases:",e),m(e instanceof Error?e.message:"Failed to load support cases")}finally{d(!1)}}async function I(e,t){try{let s=await fetch(`/api/support-cases/${e}/escalate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await s.json();if(!r.success)throw Error(r.error?.message||"Failed to escalate support case");await T(),R(!1),A(null)}catch(e){throw console.error("Error escalating support case:",e),e}}async function G(e,t){try{let s=await fetch(`/api/support-cases/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await s.json();if(!r.success)throw Error(r.error?.message||"Failed to update support case");await T(),P(!1),A(null)}catch(e){throw console.error("Error updating support case:",e),e}}return((0,s.useEffect)(()=>{T()},[z,O]),e)?(0,t.jsx)(n.LoadingSpinner,{text:"Lade Support-Fälle..."}):x?(0,t.jsx)(i.ErrorState,{message:x,onRetry:T}):(0,t.jsxs)("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Support-Fälle"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Übersicht und Verwaltung aller Support-Anfragen"})]})}),(0,t.jsx)(a.Card,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(c.Filter,{size:20,className:"text-gray-500"}),(0,t.jsxs)("div",{className:"flex gap-4 flex-1",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"status-filter",className:"text-sm font-medium text-gray-700 mr-2",children:"Status:"}),(0,t.jsxs)("select",{id:"status-filter",value:z,onChange:e=>w(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[(0,t.jsx)("option",{value:"all",children:"Alle"}),Object.values(u).map(e=>(0,t.jsx)("option",{value:e,children:v(e)},e))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"priority-filter",className:"text-sm font-medium text-gray-700 mr-2",children:"Priorität:"}),(0,t.jsxs)("select",{id:"priority-filter",value:O,onChange:e=>D(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[(0,t.jsx)("option",{value:"all",children:"Alle"}),Object.values(g).map(e=>(0,t.jsx)("option",{value:e,children:E(e)},e))]})]})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[N.length," ",1===N.length?"Fall":"Fälle"]})]})}),(0,t.jsx)("div",{className:"space-y-4",children:0===N.length?(0,t.jsxs)(a.Card,{className:"p-8 text-center",children:[(0,t.jsx)(o.AlertCircle,{size:48,className:"mx-auto text-gray-400 mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Keine Support-Fälle gefunden."})]}):N.map(e=>(0,t.jsx)(a.Card,{className:"p-6 hover:shadow-md transition-shadow",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.subject}),(0,t.jsx)(l.Badge,{className:function(e){switch(e){case u.OPEN:return"bg-blue-100 text-blue-800";case u.IN_PROGRESS:return"bg-yellow-100 text-yellow-800";case u.ESCALATED:return"bg-red-100 text-red-800";case u.RESOLVED:return"bg-green-100 text-green-800";case u.CLOSED:default:return"bg-gray-100 text-gray-800"}}(e.status),children:v(e.status)}),(0,t.jsx)(l.Badge,{className:function(e){switch(e){case g.LOW:return"bg-gray-100 text-gray-800";case g.MEDIUM:return"bg-blue-100 text-blue-800";case g.HIGH:return"bg-orange-100 text-orange-800";case g.URGENT:return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}(e.priority),children:E(e.priority)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[(0,t.jsx)("span",{children:function(e){switch(e){case p:return"Technisch";case b:return"Medizinisch";case h:return"Administrativ";case j:return"Abrechnung";case f:return"Allgemein";case y:return"Sonstiges";default:return e}}(e.category)}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:["Patient: ",e.patient_profiles?.full_name||"Unbekannt"]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:new Date(e.created_at).toLocaleDateString("de-DE")}),e.escalated_at&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{className:"text-orange-600",children:["Eskaliert am"," ",new Date(e.escalated_at).toLocaleDateString("de-DE")]})]})]}),e.description&&(0,t.jsx)("p",{className:"text-gray-700 text-sm mb-3",children:e.description}),e.notes&&(0,t.jsxs)("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-blue-800 mb-1",children:"Interne Notizen:"}),(0,t.jsx)("p",{className:"text-sm text-blue-700",children:e.notes})]}),e.resolution_notes&&(0,t.jsxs)("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-green-800 mb-1",children:"Lösung:"}),(0,t.jsx)("p",{className:"text-sm text-green-700",children:e.resolution_notes})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 ml-4",children:[e.status!==u.ESCALATED&&e.status!==u.CLOSED&&!e.escalated_task_id&&(0,t.jsx)(r.Button,{onClick:()=>{A(e),R(!0)},className:"bg-orange-600 hover:bg-orange-700 text-white text-sm px-3 py-1",children:"Eskalieren"}),(0,t.jsx)(r.Button,{onClick:()=>{A(e),P(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white text-sm px-3 py-1",children:"Bearbeiten"})]})]})},e.id))}),k&&L&&(0,t.jsx)(_,{supportCase:L,onClose:()=>{R(!1),A(null)},onEscalate:e=>I(L.id,e)}),F&&L&&(0,t.jsx)(C,{supportCase:L,onClose:()=>{P(!1),A(null)},onUpdate:e=>G(L.id,e)})]})}e.s(["default",()=>O],70419)}]);

//# sourceMappingURL=bc6004e29cffe920.js.map