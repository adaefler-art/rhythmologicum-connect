(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3116,e=>{"use strict";let t=(0,e.i(68569).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>t],3116)},26912,e=>{"use strict";let t=(0,e.i(68569).default)("file-check",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);e.s(["FileCheck",()=>t],26912)},78983,e=>{"use strict";var t=e.i(18050),s=e.i(71645),a=e.i(18566);e.i(17152);var l=e.i(66763);e.i(47446);var r=e.i(32796),i=e.i(12911),n=e.i(87052),d=e.i(84584),c=e.i(52220),m=e.i(26912),o=e.i(78894),x=e.i(3116);let u=(0,e.i(68569).default)("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);function h(){let e=(0,a.useRouter)(),[h,g]=(0,s.useState)(!0),[p,f]=(0,s.useState)(null),[b,k]=(0,s.useState)([]),[_,j]=(0,s.useState)(0),v=(0,s.useCallback)(async()=>{try{g(!0),f(null);let{data:e,error:t}=await l.supabase.from("assessments").select(`
            id,
            patient_id,
            funnel,
            funnel_id,
            started_at,
            completed_at,
            status,
            state,
            patient_profiles!assessments_patient_id_fkey (
              id,
              full_name,
              user_id
            ),
            funnels!assessments_funnel_id_fkey (
              id,
              slug,
              title
            )
          `).order("started_at",{ascending:!1}).limit(100);if(t)throw t;let s=(e??[]).map(e=>e.id),a=null,r=null;if(s.length>0){let{data:e,error:t}=await l.supabase.from("processing_jobs").select("assessment_id, status, stage, delivery_status").in("assessment_id",s);t&&console.warn("Processing jobs query failed:",t),a=e;let{data:i,error:n}=await l.supabase.from("reports").select("assessment_id, id, status, risk_level").in("assessment_id",s);n&&console.warn("Reports query failed:",n),r=i}let i=new Map((a??[]).map(e=>[e.assessment_id,e])),n=new Map((r??[]).map(e=>[e.assessment_id,e])),d=(e??[]).map(e=>{let t,s=i.get(e.id),a=n.get(e.id),l=null;return"in_progress"===e.status?t="incomplete":e.completed_at&&s?"failed"===s.status?(t="flagged",l="Processing failed"):"completed"===s.status&&"DELIVERED"===s.delivery_status?(t="report_ready",a?.risk_level==="high"&&(t="flagged",l="High risk detected")):t="queued"===s.status||"in_progress"===s.status?"processing":"report_ready":t=e.completed_at&&!s?"processing":"incomplete",{assessment_id:e.id,patient_id:e.patient_id,patient_name:e.patient_profiles?.full_name??e.patient_profiles?.user_id??"Unbekannt",funnel_slug:e.funnel||e.funnels?.slug||"unknown",funnel_title:e.funnels?.title||null,started_at:e.started_at,completed_at:e.completed_at,assessment_status:e.status,assessment_state:e.state,processing_status:s?.status||null,processing_stage:s?.stage||null,report_status:a?.status||null,report_id:a?.id||null,risk_level:a?.risk_level||null,triage_status:t,flagged_reason:l}});k(d)}catch(e){console.error(e),f(e instanceof Error?e.message:"Fehler beim Laden der Triage-Daten.")}finally{g(!1)}},[]);(0,s.useEffect)(()=>{v()},[v,_]);let N=(0,s.useCallback)(()=>{j(e=>e+1)},[]),y=(0,s.useMemo)(()=>{let e=b.filter(e=>"incomplete"===e.triage_status).length,t=b.filter(e=>"processing"===e.triage_status).length;return{incomplete:e,processing:t,reportReady:b.filter(e=>"report_ready"===e.triage_status).length,flagged:b.filter(e=>"flagged"===e.triage_status).length,total:b.length}},[b]),w=(0,s.useCallback)(e=>{switch(e){case"incomplete":return{variant:"secondary",label:"Unvollständig",icon:x.Clock};case"processing":return{variant:"info",label:"In Bearbeitung",icon:u};case"report_ready":return{variant:"success",label:"Bericht bereit",icon:m.FileCheck};case"flagged":return{variant:"danger",label:"Markiert",icon:o.AlertTriangle}}},[]),C=(0,s.useCallback)(e=>{if(!e)return"—";try{return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e))}catch{return"Datum unbekannt"}},[]),M=(0,s.useCallback)(t=>{e.push(`/clinician/patient/${t.patient_id}`)},[e]),A=(0,s.useMemo)(()=>[{header:"Patient:in",accessor:e=>(0,t.jsx)("span",{className:"font-medium text-slate-900 dark:text-slate-50",children:e.patient_name}),sortable:!0},{header:"Funnel",accessor:e=>(0,t.jsx)("span",{className:"text-slate-700 dark:text-slate-300",children:e.funnel_title||e.funnel_slug}),sortable:!0},{header:"Status",accessor:e=>{let s=w(e.triage_status);return(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)(r.Badge,{variant:s.variant,children:s.label}),e.flagged_reason&&(0,t.jsx)("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:e.flagged_reason})]})},sortable:!0},{header:"Gestartet",accessor:e=>(0,t.jsx)("span",{className:"text-slate-700 dark:text-slate-300 whitespace-nowrap",children:C(e.started_at)}),sortable:!0},{header:"Abgeschlossen",accessor:e=>(0,t.jsx)("span",{className:"text-slate-700 dark:text-slate-300 whitespace-nowrap",children:C(e.completed_at)}),sortable:!0}],[w,C]);return h?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(d.LoadingSpinner,{size:"md",text:"Triage-Übersicht wird geladen…"})}):p?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(c.ErrorState,{title:"Fehler beim Laden",message:p,onRetry:N,retryText:"Neu laden"})}):(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-50 mb-2",children:"Triage / Übersicht"}),(0,t.jsx)("p",{className:"text-slate-600 dark:text-slate-300",children:"Aktive Patienten und Funnels mit aktuellem Bearbeitungsstatus"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,t.jsx)(i.Card,{padding:"lg",shadow:"md",radius:"lg",className:"hover:shadow-lg transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Unvollständig"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-50 mb-1",children:y.incomplete}),(0,t.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Noch in Bearbeitung"})]}),(0,t.jsx)("div",{className:"p-3 bg-slate-100 dark:bg-slate-800 rounded-lg",children:(0,t.jsx)(x.Clock,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})})]})}),(0,t.jsx)(i.Card,{padding:"lg",shadow:"md",radius:"lg",className:"hover:shadow-lg transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"In Bearbeitung"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-50 mb-1",children:y.processing}),(0,t.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Bericht wird erstellt"})]}),(0,t.jsx)("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:(0,t.jsx)(u,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})})]})}),(0,t.jsx)(i.Card,{padding:"lg",shadow:"md",radius:"lg",className:"hover:shadow-lg transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Bericht bereit"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-50 mb-1",children:y.reportReady}),(0,t.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Bereit zur Einsicht"})]}),(0,t.jsx)("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:(0,t.jsx)(m.FileCheck,{className:"w-5 h-5 text-green-600 dark:text-green-400"})})]})}),(0,t.jsx)(i.Card,{padding:"lg",shadow:"md",radius:"lg",className:"hover:shadow-lg transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Markiert"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-50 mb-1",children:y.flagged}),y.flagged>0&&(0,t.jsx)(r.Badge,{variant:"danger",size:"sm",className:"mt-1",children:"Aufmerksamkeit erforderlich"})]}),(0,t.jsx)("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-lg",children:(0,t.jsx)(o.AlertTriangle,{className:"w-5 h-5 text-red-600 dark:text-red-400"})})]})})]}),(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-50",children:"Alle Assessments"}),(0,t.jsxs)("p",{className:"text-sm text-slate-600 dark:text-slate-300 mt-1",children:[y.total," aktive Assessments insgesamt"]})]})})}),(0,t.jsx)(n.Table,{columns:A,data:b,keyExtractor:e=>e.assessment_id,hoverable:!0,bordered:!0,onRowClick:M,emptyMessage:"Noch keine Assessments vorhanden"})]})}e.s(["default",()=>h],78983)}]);

//# sourceMappingURL=c083d5f98f4358d2.js.map