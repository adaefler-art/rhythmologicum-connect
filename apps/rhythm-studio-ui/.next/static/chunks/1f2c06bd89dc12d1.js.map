{"version":3,"sources":["turbopack:///[project]/apps/rhythm-studio-ui/app/clinician/funnels/[identifier]/page.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState, useCallback } from 'react'\nimport { useParams } from 'next/navigation'\nimport Link from 'next/link'\nimport { Input, Textarea, LoadingSpinner, ErrorState } from '@/lib/ui'\n\nexport const dynamic = 'force-dynamic'\n\ntype Question = {\n  id: string\n  key: string\n  label: string\n  help_text: string | null\n  question_type: string\n  funnel_step_question_id: string\n  is_required: boolean\n  order_index: number\n}\n\ntype Step = {\n  id: string\n  funnel_id: string\n  order_index: number\n  title: string\n  description: string | null\n  type: string\n  content_page_id: string | null\n  content_page?: {\n    id: string\n    slug: string\n    title: string\n    excerpt: string | null\n    status: string\n  } | null\n  questions: Question[]\n}\n\ntype Funnel = {\n  id: string\n  slug: string\n  title: string\n  description: string | null\n  is_active: boolean\n  created_at: string\n  updated_at: string\n}\n\ntype FunnelVersion = {\n  id: string\n  funnel_id: string\n  version: string\n  is_default: boolean\n  rollout_percent: number\n  algorithm_bundle_version: string\n  prompt_version: string\n  created_at: string\n  updated_at: string | null\n}\n\n// Translation helpers\nconst translateQuestionType = (type: string): string => {\n  const translations: Record<string, string> = {\n    slider: 'Schieberegler',\n    text: 'Text',\n    select: 'Auswahl',\n    textarea: 'Textfeld',\n    radio: 'Optionsfeld',\n    checkbox: 'Kontrollkästchen',\n  }\n  return translations[type] || type\n}\n\nconst translateStepType = (type: string): string => {\n  const translations: Record<string, string> = {\n    question_step: 'Fragen',\n    form: 'Formular',\n    info_step: 'Informationsschritt',\n    info: 'Info',\n    content_page: 'Inhaltsseite',\n    summary: 'Zusammenfassung',\n  }\n  return translations[type] || type\n}\n\n// UUID regex pattern for strict validation\nconst UUID_PATTERN = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i\n\nfunction isUUID(value: string): boolean {\n  return UUID_PATTERN.test(value)\n}\n\nexport default function FunnelDetailPage() {\n  const params = useParams()\n  const identifier = params.identifier as string\n  const isId = isUUID(identifier)\n\n  const [funnel, setFunnel] = useState<Funnel | null>(null)\n  const [steps, setSteps] = useState<Step[]>([])\n  const [versions, setVersions] = useState<FunnelVersion[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [saving, setSaving] = useState(false)\n\n  // Edit mode state\n  const [editingFunnel, setEditingFunnel] = useState(false)\n  const [editedFunnel, setEditedFunnel] = useState<Partial<Funnel>>({})\n  const [editingStep, setEditingStep] = useState<string | null>(null)\n  const [editedStep, setEditedStep] = useState<Partial<Step>>({})\n\n  type Envelope<T> = {\n    success?: boolean\n    data?: T\n    error?: { message?: string; requestId?: string; details?: { requestId?: string } }\n  }\n\n  function asEnvelope<T>(value: unknown): Envelope<T> | null {\n    return value && typeof value === 'object' ? (value as Envelope<T>) : null\n  }\n\n  const loadFunnelDetails = useCallback(async () => {\n    try {\n      setLoading(true)\n      setError(null)\n\n      const response = await fetch(`/api/admin/funnels/${identifier}`)\n\n      if (!response.ok) {\n        let requestId = response.headers.get('x-request-id')\n        let message = 'Failed to load funnel details'\n\n        try {\n          const json: unknown = await response.json()\n          const envelope = asEnvelope<unknown>(json)\n          const errorMessage = envelope?.error?.message\n          const errorRequestId = envelope?.error?.requestId || envelope?.error?.details?.requestId\n          if (typeof errorMessage === 'string' && errorMessage.length > 0) message = errorMessage\n          if (typeof errorRequestId === 'string' && errorRequestId.length > 0) requestId = errorRequestId\n        } catch {\n          // ignore json parse errors\n        }\n\n        throw new Error(requestId ? `${message} (requestId: ${requestId})` : message)\n      }\n\n      const json: unknown = await response.json()\n      const envelope = asEnvelope<{ funnel?: Funnel; steps?: Step[]; versions?: FunnelVersion[] }>(json)\n      const funnelData = envelope?.data?.funnel\n      const stepsData = envelope?.data?.steps\n      const versionsData = envelope?.data?.versions\n\n      setFunnel(funnelData ?? null)\n      setSteps(Array.isArray(stepsData) ? stepsData : [])\n      setVersions(Array.isArray(versionsData) ? versionsData : [])\n    } catch (err) {\n      console.error('Error loading funnel details:', err)\n      setError(err instanceof Error ? err.message : 'Fehler beim Laden der Funnel-Details')\n    } finally {\n      setLoading(false)\n    }\n  }, [identifier])\n\n  useEffect(() => {\n    loadFunnelDetails()\n  }, [loadFunnelDetails])\n\n  const toggleFunnelActive = async () => {\n    if (!funnel) return\n\n    try {\n      setSaving(true)\n      const response = await fetch(`/api/admin/funnels/${identifier}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ is_active: !funnel.is_active }),\n      })\n\n      if (!response.ok) {\n        let requestId = response.headers.get('x-request-id')\n        let message = 'Failed to update funnel'\n\n        try {\n          const json: unknown = await response.json()\n          const envelope = asEnvelope<unknown>(json)\n          const errorMessage = envelope?.error?.message\n          const errorRequestId = envelope?.error?.requestId || envelope?.error?.details?.requestId\n          if (typeof errorMessage === 'string' && errorMessage.length > 0) message = errorMessage\n          if (typeof errorRequestId === 'string' && errorRequestId.length > 0) requestId = errorRequestId\n        } catch {\n          // ignore\n        }\n\n        throw new Error(requestId ? `${message} (requestId: ${requestId})` : message)\n      }\n\n      const json: unknown = await response.json()\n      const envelope = asEnvelope<{ funnel?: Funnel }>(json)\n      setFunnel(envelope?.data?.funnel ?? null)\n    } catch (err) {\n      console.error('Error updating funnel:', err)\n      alert(`Fehler beim Aktualisieren des Funnels: ${err instanceof Error ? err.message : 'Unbekannter Fehler'}`)\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const startEditingFunnel = () => {\n    setEditingFunnel(true)\n    setEditedFunnel({\n      title: funnel?.title || '',\n      description: funnel?.description || '',\n    })\n  }\n\n  const cancelEditingFunnel = () => {\n    setEditingFunnel(false)\n    setEditedFunnel({})\n  }\n\n  const saveFunnelEdit = async () => {\n    if (!funnel) return\n\n    // Client-side validation\n    const title = editedFunnel.title?.trim() || ''\n    if (title.length === 0) {\n      alert('Titel darf nicht leer sein')\n      return\n    }\n    if (title.length > 255) {\n      alert('Titel ist zu lang (maximal 255 Zeichen)')\n      return\n    }\n\n    const description = editedFunnel.description?.trim() || ''\n    if (description.length > 2000) {\n      alert('Beschreibung ist zu lang (maximal 2000 Zeichen)')\n      return\n    }\n\n    try {\n      setSaving(true)\n      const response = await fetch(`/api/admin/funnels/${identifier}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          title,\n          description,\n        }),\n      })\n\n      if (!response.ok) {\n        let requestId = response.headers.get('x-request-id')\n        let message = 'Failed to update funnel'\n\n        try {\n          const json: unknown = await response.json()\n          const envelope = asEnvelope<unknown>(json)\n          const errorMessage = envelope?.error?.message\n          const errorRequestId = envelope?.error?.requestId || envelope?.error?.details?.requestId\n          if (typeof errorMessage === 'string' && errorMessage.length > 0) message = errorMessage\n          if (typeof errorRequestId === 'string' && errorRequestId.length > 0) requestId = errorRequestId\n        } catch {\n          // ignore\n        }\n\n        throw new Error(requestId ? `${message} (requestId: ${requestId})` : message)\n      }\n\n      const json: unknown = await response.json()\n      const envelope = asEnvelope<{ funnel?: Funnel }>(json)\n      setFunnel(envelope?.data?.funnel ?? null)\n      setEditingFunnel(false)\n      setEditedFunnel({})\n    } catch (err) {\n      console.error('Error updating funnel:', err)\n      alert(`Fehler beim Speichern: ${err instanceof Error ? err.message : 'Unbekannter Fehler'}`)\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const startEditingStep = (step: Step) => {\n    setEditingStep(step.id)\n    setEditedStep({\n      title: step.title,\n      description: step.description,\n    })\n  }\n\n  const cancelEditingStep = () => {\n    setEditingStep(null)\n    setEditedStep({})\n  }\n\n  const saveStepEdit = async (stepId: string) => {\n    // Client-side validation\n    const title = editedStep.title?.trim() || ''\n    if (title.length === 0) {\n      alert('Schritt-Titel darf nicht leer sein')\n      return\n    }\n    if (title.length > 255) {\n      alert('Schritt-Titel ist zu lang (maximal 255 Zeichen)')\n      return\n    }\n\n    const description = editedStep.description?.trim() || ''\n    if (description.length > 2000) {\n      alert('Schritt-Beschreibung ist zu lang (maximal 2000 Zeichen)')\n      return\n    }\n\n    try {\n      setSaving(true)\n      const response = await fetch(`/api/admin/funnel-steps/${stepId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          title,\n          description,\n        }),\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json()\n        throw new Error(errorData.error || 'Failed to update step')\n      }\n\n      await loadFunnelDetails()\n      setEditingStep(null)\n      setEditedStep({})\n    } catch (err) {\n      console.error('Error updating step:', err)\n      alert(`Fehler beim Speichern: ${err instanceof Error ? err.message : 'Unbekannter Fehler'}`)\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const toggleQuestionRequired = async (questionId: string, currentRequired: boolean) => {\n    try {\n      setSaving(true)\n      const response = await fetch(`/api/admin/funnel-step-questions/${questionId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ is_required: !currentRequired }),\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to update question')\n      }\n\n      // Reload data\n      await loadFunnelDetails()\n    } catch (err) {\n      console.error('Error updating question:', err)\n      alert('Fehler beim Aktualisieren der Frage')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const moveStep = async (stepId: string, currentIndex: number, direction: 'up' | 'down') => {\n    const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1\n\n    // Check bounds\n    if (newIndex < 0 || newIndex >= steps.length) return\n\n    try {\n      setSaving(true)\n\n      // Get the other step that we're swapping with\n      const otherStep = steps[newIndex]\n\n      // Update both steps\n      await Promise.all([\n        fetch(`/api/admin/funnel-steps/${stepId}`, {\n          method: 'PATCH',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ order_index: newIndex }),\n        }),\n        fetch(`/api/admin/funnel-steps/${otherStep.id}`, {\n          method: 'PATCH',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ order_index: currentIndex }),\n        }),\n      ])\n\n      // Reload data\n      await loadFunnelDetails()\n    } catch (err) {\n      console.error('Error moving step:', err)\n      alert('Fehler beim Verschieben des Steps')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const setDefaultVersion = async (versionId: string) => {\n    try {\n      setSaving(true)\n      const response = await fetch(`/api/admin/funnel-versions/${versionId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ is_default: true }),\n      })\n\n      if (!response.ok) {\n        let requestId = response.headers.get('x-request-id')\n        let message = 'Failed to set default version'\n\n        try {\n          const json: unknown = await response.json()\n          const envelope = asEnvelope<unknown>(json)\n          const errorMessage = envelope?.error?.message\n          const errorRequestId = envelope?.error?.requestId || envelope?.error?.details?.requestId\n          if (typeof errorMessage === 'string' && errorMessage.length > 0) message = errorMessage\n          if (typeof errorRequestId === 'string' && errorRequestId.length > 0) requestId = errorRequestId\n        } catch {\n          // ignore\n        }\n\n        throw new Error(requestId ? `${message} (requestId: ${requestId})` : message)\n      }\n\n      // Reload to get updated versions\n      await loadFunnelDetails()\n    } catch (err) {\n      console.error('Error setting default version:', err)\n      alert(`Fehler beim Setzen der Standard-Version: ${err instanceof Error ? err.message : 'Unbekannter Fehler'}`)\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const updateVersionRollout = async (versionId: string, rolloutPercent: number) => {\n    try {\n      setSaving(true)\n      const response = await fetch(`/api/admin/funnel-versions/${versionId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ rollout_percent: rolloutPercent }),\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to update rollout percentage')\n      }\n\n      // Reload to get updated versions\n      await loadFunnelDetails()\n    } catch (err) {\n      console.error('Error updating rollout:', err)\n      alert('Fehler beim Aktualisieren des Rollouts')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const updateVersionMetadata = async (versionId: string, algorithmVersion?: string, promptVersion?: string) => {\n    try {\n      setSaving(true)\n      const updatePayload: { algorithm_bundle_version?: string; prompt_version?: string } = {}\n      if (algorithmVersion !== undefined) updatePayload.algorithm_bundle_version = algorithmVersion\n      if (promptVersion !== undefined) updatePayload.prompt_version = promptVersion\n\n      const response = await fetch(`/api/admin/funnel-versions/${versionId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updatePayload),\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to update version metadata')\n      }\n\n      // Reload to get updated versions\n      await loadFunnelDetails()\n    } catch (err) {\n      console.error('Error updating version metadata:', err)\n      alert('Fehler beim Aktualisieren der Versions-Metadaten')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <LoadingSpinner size=\"lg\" text=\"Lade Funnel-Details…\" centered />\n      </div>\n    )\n  }\n\n  if (error || !funnel) {\n    return (\n      <div className=\"max-w-6xl mx-auto\">\n        <ErrorState\n          title=\"Fehler beim Laden\"\n          message={error || 'Funnel nicht gefunden'}\n          centered\n        />\n        <div className=\"mt-4 text-center\">\n          <Link\n            href=\"/clinician/funnels\"\n            className=\"inline-flex items-center text-sm text-sky-600 dark:text-sky-400 hover:text-sky-700 dark:hover:text-sky-300 font-medium\"\n          >\n            ← Zurück zur Übersicht\n          </Link>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <div className=\"mb-4\">\n          <Link\n            href=\"/clinician/funnels\"\n            className=\"inline-flex items-center text-sm text-sky-600 hover:text-sky-700 font-medium\"\n          >\n            ← Zurück zur Übersicht\n          </Link>\n        </div>\n\n        {/* Funnel Header - Editable */}\n        <div className=\"bg-white border border-slate-200 rounded-lg p-6 mb-6\">\n          <div className=\"flex items-start justify-between gap-4 mb-4\">\n            <div className=\"flex-1\">\n              {editingFunnel ? (\n                <div className=\"space-y-4\">\n                  <div>\n                    <label htmlFor=\"funnel-title\" className=\"block text-sm font-medium text-slate-700 mb-1\">\n                      Titel\n                    </label>\n                    <Input\n                      id=\"funnel-title\"\n                      type=\"text\"\n                      value={editedFunnel.title || ''}\n                      onChange={(e) =>\n                        setEditedFunnel({ ...editedFunnel, title: e.target.value })\n                      }\n                      inputSize=\"md\"\n                    />\n                  </div>\n                  <div>\n                    <label htmlFor=\"funnel-description\" className=\"block text-sm font-medium text-slate-700 mb-1\">\n                      Beschreibung\n                    </label>\n                    <Textarea\n                      id=\"funnel-description\"\n                      value={editedFunnel.description || ''}\n                      onChange={(e) =>\n                        setEditedFunnel({ ...editedFunnel, description: e.target.value })\n                      }\n                      rows={3}\n                      textareaSize=\"md\"\n                    />\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={saveFunnelEdit}\n                      disabled={saving}\n                      className=\"h-10 px-4 py-2 text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                      {saving ? 'Speichert…' : 'Speichern'}\n                    </button>\n                    <button\n                      onClick={cancelEditingFunnel}\n                      disabled={saving}\n                      className=\"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                      Abbrechen\n                    </button>\n                  </div>\n                </div>\n              ) : (\n                <div>\n                  <h1 className=\"text-2xl md:text-3xl font-bold text-slate-900 dark:text-slate-50 mb-2\">\n                    {funnel.title}\n                  </h1>\n                  {funnel.description && (\n                    <p className=\"text-sm text-slate-500 dark:text-slate-400 mb-3\">{funnel.description}</p>\n                  )}\n                  <div className=\"flex items-center gap-3 text-sm text-slate-400 dark:text-slate-500\">\n                    <span>ID: {funnel.slug}</span>\n                    <span>•</span>\n                    <span>{steps.length} Schritte</span>\n                    <span>•</span>\n                    <span>\n                      {steps.reduce((total, step) => total + step.questions.length, 0)} Fragen\n                    </span>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <Link\n                href={`/clinician/funnels/${funnel.slug}/editor`}\n                className=\"h-10 px-4 py-2 text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 rounded-md transition-colors inline-flex items-center\"\n              >\n                Content Editor\n              </Link>\n              {!editingFunnel && (\n                <button\n                  onClick={startEditingFunnel}\n                  className=\"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors\"\n                >\n                  Bearbeiten\n                </button>\n              )}\n              <button\n                onClick={toggleFunnelActive}\n                disabled={saving}\n                className={`h-10 px-4 py-2 text-sm font-medium rounded-md transition-colors ${\n                  funnel.is_active\n                    ? 'bg-green-100 text-green-800 hover:bg-green-200'\n                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'\n                } disabled:opacity-50 disabled:cursor-not-allowed`}\n              >\n                {saving ? 'Speichert…' : funnel.is_active ? 'Aktiv' : 'Inaktiv'}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Version Management Section */}\n      {versions.length > 0 && (\n        <div className=\"mb-8\">\n          <h2 className=\"text-xl font-semibold text-slate-900 dark:text-slate-50 mb-4\">Versionen</h2>\n          <div className=\"bg-white border border-slate-200 rounded-lg overflow-hidden\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-slate-200\">\n                <thead className=\"bg-slate-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">\n                      Version\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">\n                      Status\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">\n                      Rollout %\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">\n                      Algorithmus\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">\n                      Prompt\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">\n                      Erstellt\n                    </th>\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider\">\n                      Aktionen\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-slate-200\">\n                  {versions.map((version) => (\n                    <tr key={version.id} className={version.is_default ? 'bg-sky-50' : ''}>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-sm font-medium text-slate-900\">{version.version}</span>\n                          {version.is_default && (\n                            <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-sky-100 text-sky-800\">\n                              Standard\n                            </span>\n                          )}\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <span className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${\n                          version.is_default \n                            ? 'bg-green-100 text-green-800' \n                            : 'bg-slate-100 text-slate-600'\n                        }`}>\n                          {version.is_default ? 'Aktiv' : 'Bereit'}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center gap-2\">\n                          <input\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"100\"\n                            defaultValue={version.rollout_percent}\n                            onBlur={(e) => {\n                              const value = parseInt(e.target.value, 10)\n                              if (!isNaN(value) && value >= 0 && value <= 100 && value !== version.rollout_percent) {\n                                updateVersionRollout(version.id, value)\n                              } else if (value !== version.rollout_percent) {\n                                // Reset to current value if invalid\n                                e.target.value = String(version.rollout_percent)\n                              }\n                            }}\n                            disabled={saving}\n                            className=\"w-16 px-2 py-1 text-sm border border-slate-300 rounded focus:ring-1 focus:ring-sky-500 focus:border-sky-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                          />\n                          <span className=\"text-sm text-slate-600\">%</span>\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <span className=\"text-sm text-slate-900 font-mono\">\n                          {version.algorithm_bundle_version}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <span className=\"text-sm text-slate-900 font-mono\">\n                          {version.prompt_version}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-slate-500\">\n                        {new Date(version.created_at).toLocaleDateString('de-DE')}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm\">\n                        {!version.is_default && (\n                          <button\n                            onClick={() => setDefaultVersion(version.id)}\n                            disabled={saving}\n                            className=\"inline-flex items-center px-3 py-1.5 border border-sky-600 text-sky-600 hover:bg-sky-50 rounded text-xs font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                          >\n                            Als Standard setzen\n                          </button>\n                        )}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n          <div className=\"mt-4 text-sm text-slate-600\">\n            <p className=\"mb-1\">\n              <strong>Rollout %:</strong> Prozentsatz der Nutzer, die diese Version sehen (0-100). Bei mehreren aktiven Versionen wird nach Prozentsatz gewichtet ausgewählt.\n            </p>\n            <p>\n              <strong>Standard:</strong> Die Standard-Version wird neuen Nutzern zugewiesen und ist die Haupt-Version des Funnels.\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Steps List */}\n      <div className=\"space-y-6\">\n        <h2 className=\"text-xl font-semibold text-slate-900 dark:text-slate-50\">Schritte</h2>\n        {steps.map((step, stepIndex) => (\n          <div\n            key={step.id}\n            className=\"bg-white border border-slate-200 rounded-lg overflow-hidden\"\n          >\n            {/* Step Header */}\n            <div className=\"bg-slate-50 px-6 py-4 border-b border-slate-200\">\n              {editingStep === step.id ? (\n                <div className=\"space-y-4\">\n                  <div>\n                    <label htmlFor={`step-title-${step.id}`} className=\"block text-sm font-medium text-slate-700 mb-1\">\n                      Schritt-Titel\n                    </label>\n                    <Input\n                      id={`step-title-${step.id}`}\n                      type=\"text\"\n                      value={editedStep.title || ''}\n                      onChange={(e) => setEditedStep({ ...editedStep, title: e.target.value })}\n                      inputSize=\"md\"\n                    />\n                  </div>\n                  <div>\n                    <label htmlFor={`step-desc-${step.id}`} className=\"block text-sm font-medium text-slate-700 mb-1\">\n                      Schritt-Beschreibung\n                    </label>\n                    <Textarea\n                      id={`step-desc-${step.id}`}\n                      value={editedStep.description || ''}\n                      onChange={(e) =>\n                        setEditedStep({ ...editedStep, description: e.target.value })\n                      }\n                      rows={2}\n                      textareaSize=\"md\"\n                    />\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={() => saveStepEdit(step.id)}\n                      disabled={saving}\n                      className=\"h-10 px-4 py-2 text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                      {saving ? 'Speichert…' : 'Speichern'}\n                    </button>\n                    <button\n                      onClick={cancelEditingStep}\n                      disabled={saving}\n                      className=\"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                      Abbrechen\n                    </button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"flex items-center justify-between gap-4\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-3 mb-1\">\n                      <span className=\"text-xs font-semibold text-slate-500 uppercase\">\n                        Schritt {step.order_index + 1}\n                      </span>\n                      <span className=\"text-xs text-slate-400\">\n                        (Typ: {translateStepType(step.type)})\n                      </span>\n                    </div>\n                    <h3 className=\"text-lg font-semibold text-slate-900\">{step.title}</h3>\n                    {step.description && (\n                      <p className=\"text-sm text-slate-600 mt-1\">{step.description}</p>\n                    )}\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      onClick={() => startEditingStep(step)}\n                      className=\"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded transition-colors\"\n                    >\n                      Bearbeiten\n                    </button>\n                    <button\n                      onClick={() => moveStep(step.id, stepIndex, 'up')}\n                      disabled={stepIndex === 0 || saving}\n                      className=\"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors\"\n                      title=\"Nach oben\"\n                    >\n                      ↑\n                    </button>\n                    <button\n                      onClick={() => moveStep(step.id, stepIndex, 'down')}\n                      disabled={stepIndex === steps.length - 1 || saving}\n                      className=\"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors\"\n                      title=\"Nach unten\"\n                    >\n                      ↓\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Content Page Info (for content_page steps) */}\n            {step.type === 'content_page' && (\n              <div className=\"px-6 py-4 bg-blue-50 border-b border-blue-200\">\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"flex-1\">\n                    <h4 className=\"text-sm font-semibold text-blue-900 mb-2\">Zugeordnete Inhaltsseite</h4>\n                    {step.content_page ? (\n                      <div>\n                        <p className=\"text-sm font-medium text-blue-900\">{step.content_page.title}</p>\n                        <p className=\"text-xs text-blue-700 mt-1\">Slug: {step.content_page.slug}</p>\n                        {step.content_page.excerpt && (\n                          <p className=\"text-xs text-blue-600 mt-1\">{step.content_page.excerpt}</p>\n                        )}\n                        <span className={`inline-block mt-2 px-2 py-1 text-xs rounded ${\n                          step.content_page.status === 'published'\n                            ? 'bg-green-100 text-green-800'\n                            : 'bg-yellow-100 text-yellow-800'\n                        }`}>\n                          {step.content_page.status === 'published' ? 'Veröffentlicht' : 'Entwurf'}\n                        </span>\n                      </div>\n                    ) : (\n                      <p className=\"text-sm text-red-700\">⚠️ Keine Inhaltsseite zugeordnet</p>\n                    )}\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Questions */}\n            {step.questions.length > 0 && (\n              <div className=\"divide-y divide-slate-200\">\n                <div className=\"px-6 py-3 bg-slate-50 border-b border-slate-200\">\n                  <h4 className=\"text-sm font-semibold text-slate-700\">Fragen</h4>\n                </div>\n                {step.questions.map((question) => (\n                  <div key={question.id} className=\"px-6 py-4\">\n                    <div className=\"flex items-start justify-between gap-4\">\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <span className=\"text-xs font-semibold text-slate-500\">\n                            Frageschlüssel:\n                          </span>\n                          <span className=\"text-xs font-mono text-slate-500\">\n                            {question.key}\n                          </span>\n                        </div>\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <span className=\"text-xs font-semibold text-slate-500\">Typ:</span>\n                          <span className=\"text-xs text-slate-500\">\n                            {translateQuestionType(question.question_type)}\n                          </span>\n                        </div>\n                        <p className=\"text-sm font-medium text-slate-900 mb-1\">\n                          {question.label}\n                        </p>\n                        {question.help_text && (\n                          <p className=\"text-xs text-slate-600\">{question.help_text}</p>\n                        )}\n                      </div>\n\n                      <button\n                        onClick={() =>\n                          toggleQuestionRequired(\n                            question.funnel_step_question_id,\n                            question.is_required\n                          )\n                        }\n                        disabled={saving}\n                        className={`px-3 py-1.5 text-xs font-medium rounded transition-colors ${\n                          question.is_required\n                            ? 'bg-orange-100 text-orange-800 hover:bg-orange-200'\n                            : 'bg-slate-100 text-slate-600 hover:bg-slate-200'\n                        } disabled:opacity-50 disabled:cursor-not-allowed`}\n                      >\n                        {question.is_required ? 'Pflichtfeld' : 'Optional'}\n                      </button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {step.questions.length === 0 && (\n              <div className=\"px-6 py-4 text-center text-sm text-slate-500\">\n                Keine Fragen in diesem Schritt\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n\n      {steps.length === 0 && (\n        <div className=\"bg-white border border-slate-200 rounded-lg p-8 text-center\">\n          <p className=\"text-slate-600\">Keine Schritte definiert.</p>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}