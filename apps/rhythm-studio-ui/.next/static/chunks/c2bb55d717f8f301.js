(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,64475,e=>{"use strict";var t=e.i(18050),s=e.i(71645),a=e.i(18566),i=e.i(22016);e.i(47446);var r=e.i(64389),l=e.i(34683),n=e.i(84584),d=e.i(52220);let o=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function c(){let e=(0,a.useParams)().identifier;o.test(e);let[c,x]=(0,s.useState)(null),[m,h]=(0,s.useState)([]),[p,u]=(0,s.useState)([]),[f,b]=(0,s.useState)(!0),[g,y]=(0,s.useState)(null),[j,N]=(0,s.useState)(!1),[v,w]=(0,s.useState)(!1),[k,S]=(0,s.useState)({}),[_,F]=(0,s.useState)(null),[C,T]=(0,s.useState)({});function $(e){return e&&"object"==typeof e?e:null}let q=(0,s.useCallback)(async()=>{try{b(!0),y(null);let t=await fetch(`/api/admin/funnels/${e}`);if(!t.ok){let e=t.headers.get("x-request-id"),s="Failed to load funnel details";try{let a=await t.json(),i=$(a),r=i?.error?.message,l=i?.error?.requestId||i?.error?.details?.requestId;"string"==typeof r&&r.length>0&&(s=r),"string"==typeof l&&l.length>0&&(e=l)}catch{}throw Error(e?`${s} (requestId: ${e})`:s)}let s=await t.json(),a=$(s),i=a?.data?.funnel,r=a?.data?.steps,l=a?.data?.versions;x(i??null),h(Array.isArray(r)?r:[]),u(Array.isArray(l)?l:[])}catch(e){console.error("Error loading funnel details:",e),y(e instanceof Error?e.message:"Fehler beim Laden der Funnel-Details")}finally{b(!1)}},[e]);(0,s.useEffect)(()=>{q()},[q]);let E=async()=>{if(c)try{N(!0);let t=await fetch(`/api/admin/funnels/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_active:!c.is_active})});if(!t.ok){let e=t.headers.get("x-request-id"),s="Failed to update funnel";try{let a=await t.json(),i=$(a),r=i?.error?.message,l=i?.error?.requestId||i?.error?.details?.requestId;"string"==typeof r&&r.length>0&&(s=r),"string"==typeof l&&l.length>0&&(e=l)}catch{}throw Error(e?`${s} (requestId: ${e})`:s)}let s=await t.json(),a=$(s);x(a?.data?.funnel??null)}catch(e){console.error("Error updating funnel:",e),alert(`Fehler beim Aktualisieren des Funnels: ${e instanceof Error?e.message:"Unbekannter Fehler"}`)}finally{N(!1)}},A=async()=>{if(!c)return;let t=k.title?.trim()||"";if(0===t.length)return void alert("Titel darf nicht leer sein");if(t.length>255)return void alert("Titel ist zu lang (maximal 255 Zeichen)");let s=k.description?.trim()||"";if(s.length>2e3)return void alert("Beschreibung ist zu lang (maximal 2000 Zeichen)");try{N(!0);let a=await fetch(`/api/admin/funnels/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,description:s})});if(!a.ok){let e=a.headers.get("x-request-id"),t="Failed to update funnel";try{let s=await a.json(),i=$(s),r=i?.error?.message,l=i?.error?.requestId||i?.error?.details?.requestId;"string"==typeof r&&r.length>0&&(t=r),"string"==typeof l&&l.length>0&&(e=l)}catch{}throw Error(e?`${t} (requestId: ${e})`:t)}let i=await a.json(),r=$(i);x(r?.data?.funnel??null),w(!1),S({})}catch(e){console.error("Error updating funnel:",e),alert(`Fehler beim Speichern: ${e instanceof Error?e.message:"Unbekannter Fehler"}`)}finally{N(!1)}},I=()=>{F(null),T({})},z=async e=>{let t=C.title?.trim()||"";if(0===t.length)return void alert("Schritt-Titel darf nicht leer sein");if(t.length>255)return void alert("Schritt-Titel ist zu lang (maximal 255 Zeichen)");let s=C.description?.trim()||"";if(s.length>2e3)return void alert("Schritt-Beschreibung ist zu lang (maximal 2000 Zeichen)");try{N(!0);let a=await fetch(`/api/admin/funnel-steps/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,description:s})});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to update step")}await q(),F(null),T({})}catch(e){console.error("Error updating step:",e),alert(`Fehler beim Speichern: ${e instanceof Error?e.message:"Unbekannter Fehler"}`)}finally{N(!1)}},P=async(e,t)=>{try{if(N(!0),!(await fetch(`/api/admin/funnel-step-questions/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_required:!t})})).ok)throw Error("Failed to update question");await q()}catch(e){console.error("Error updating question:",e),alert("Fehler beim Aktualisieren der Frage")}finally{N(!1)}},O=async(e,t,s)=>{let a="up"===s?t-1:t+1;if(!(a<0)&&!(a>=m.length))try{N(!0);let s=m[a];await Promise.all([fetch(`/api/admin/funnel-steps/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_index:a})}),fetch(`/api/admin/funnel-steps/${s.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_index:t})})]),await q()}catch(e){console.error("Error moving step:",e),alert("Fehler beim Verschieben des Steps")}finally{N(!1)}},B=async e=>{try{N(!0);let t=await fetch(`/api/admin/funnel-versions/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_default:!0})});if(!t.ok){let e=t.headers.get("x-request-id"),s="Failed to set default version";try{let a=await t.json(),i=$(a),r=i?.error?.message,l=i?.error?.requestId||i?.error?.details?.requestId;"string"==typeof r&&r.length>0&&(s=r),"string"==typeof l&&l.length>0&&(e=l)}catch{}throw Error(e?`${s} (requestId: ${e})`:s)}await q()}catch(e){console.error("Error setting default version:",e),alert(`Fehler beim Setzen der Standard-Version: ${e instanceof Error?e.message:"Unbekannter Fehler"}`)}finally{N(!1)}},V=async(e,t)=>{try{if(N(!0),!(await fetch(`/api/admin/funnel-versions/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({rollout_percent:t})})).ok)throw Error("Failed to update rollout percentage");await q()}catch(e){console.error("Error updating rollout:",e),alert("Fehler beim Aktualisieren des Rollouts")}finally{N(!1)}};return f?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(n.LoadingSpinner,{size:"lg",text:"Lade Funnel-Details…",centered:!0})}):g||!c?(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsx)(d.ErrorState,{title:"Fehler beim Laden",message:g||"Funnel nicht gefunden",centered:!0}),(0,t.jsx)("div",{className:"mt-4 text-center",children:(0,t.jsx)(i.default,{href:"/clinician/funnels",className:"inline-flex items-center text-sm text-sky-600 dark:text-sky-400 hover:text-sky-700 dark:hover:text-sky-300 font-medium",children:"← Zurück zur Übersicht"})})]}):(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(i.default,{href:"/clinician/funnels",className:"inline-flex items-center text-sm text-sky-600 hover:text-sky-700 font-medium",children:"← Zurück zur Übersicht"})}),(0,t.jsx)("div",{className:"bg-white border border-slate-200 rounded-lg p-6 mb-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-4",children:[(0,t.jsx)("div",{className:"flex-1",children:v?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"funnel-title",className:"block text-sm font-medium text-slate-700 mb-1",children:"Titel"}),(0,t.jsx)(r.Input,{id:"funnel-title",type:"text",value:k.title||"",onChange:e=>S({...k,title:e.target.value}),inputSize:"md"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"funnel-description",className:"block text-sm font-medium text-slate-700 mb-1",children:"Beschreibung"}),(0,t.jsx)(l.Textarea,{id:"funnel-description",value:k.description||"",onChange:e=>S({...k,description:e.target.value}),rows:3,textareaSize:"md"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:A,disabled:j,className:"h-10 px-4 py-2 text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Speichert…":"Speichern"}),(0,t.jsx)("button",{onClick:()=>{w(!1),S({})},disabled:j,className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Abbrechen"})]})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900 dark:text-slate-50 mb-2",children:c.title}),c.description&&(0,t.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-3",children:c.description}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm text-slate-400 dark:text-slate-500",children:[(0,t.jsxs)("span",{children:["ID: ",c.slug]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:[m.length," Schritte"]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:[m.reduce((e,t)=>e+t.questions.length,0)," Fragen"]})]})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.default,{href:`/clinician/funnels/${c.slug}/editor`,className:"h-10 px-4 py-2 text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 rounded-md transition-colors inline-flex items-center",children:"Content Editor"}),!v&&(0,t.jsx)("button",{onClick:()=>{w(!0),S({title:c?.title||"",description:c?.description||""})},className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors",children:"Bearbeiten"}),(0,t.jsx)("button",{onClick:E,disabled:j,className:`h-10 px-4 py-2 text-sm font-medium rounded-md transition-colors ${c.is_active?"bg-green-100 text-green-800 hover:bg-green-200":"bg-slate-100 text-slate-600 hover:bg-slate-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:j?"Speichert…":c.is_active?"Aktiv":"Inaktiv"})]})]})})]}),p.length>0&&(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-50 mb-4",children:"Versionen"}),(0,t.jsx)("div",{className:"bg-white border border-slate-200 rounded-lg overflow-hidden",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-slate-200",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Version"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Status"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Rollout %"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Algorithmus"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Prompt"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Erstellt"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Aktionen"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-slate-200",children:p.map(e=>(0,t.jsxs)("tr",{className:e.is_default?"bg-sky-50":"",children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-slate-900",children:e.version}),e.is_default&&(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-sky-100 text-sky-800",children:"Standard"})]})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsx)("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${e.is_default?"bg-green-100 text-green-800":"bg-slate-100 text-slate-600"}`,children:e.is_default?"Aktiv":"Bereit"})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"number",min:"0",max:"100",defaultValue:e.rollout_percent,onBlur:t=>{let s=parseInt(t.target.value,10);!isNaN(s)&&s>=0&&s<=100&&s!==e.rollout_percent?V(e.id,s):s!==e.rollout_percent&&(t.target.value=String(e.rollout_percent))},disabled:j,className:"w-16 px-2 py-1 text-sm border border-slate-300 rounded focus:ring-1 focus:ring-sky-500 focus:border-sky-500 disabled:opacity-50 disabled:cursor-not-allowed"}),(0,t.jsx)("span",{className:"text-sm text-slate-600",children:"%"})]})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsx)("span",{className:"text-sm text-slate-900 font-mono",children:e.algorithm_bundle_version})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsx)("span",{className:"text-sm text-slate-900 font-mono",children:e.prompt_version})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500",children:new Date(e.created_at).toLocaleDateString("de-DE")}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:!e.is_default&&(0,t.jsx)("button",{onClick:()=>B(e.id),disabled:j,className:"inline-flex items-center px-3 py-1.5 border border-sky-600 text-sky-600 hover:bg-sky-50 rounded text-xs font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Als Standard setzen"})})]},e.id))})]})})}),(0,t.jsxs)("div",{className:"mt-4 text-sm text-slate-600",children:[(0,t.jsxs)("p",{className:"mb-1",children:[(0,t.jsx)("strong",{children:"Rollout %:"})," Prozentsatz der Nutzer, die diese Version sehen (0-100). Bei mehreren aktiven Versionen wird nach Prozentsatz gewichtet ausgewählt."]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Standard:"})," Die Standard-Version wird neuen Nutzern zugewiesen und ist die Haupt-Version des Funnels."]})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-50",children:"Schritte"}),m.map((e,s)=>{var a;return(0,t.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-slate-50 px-6 py-4 border-b border-slate-200",children:_===e.id?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:`step-title-${e.id}`,className:"block text-sm font-medium text-slate-700 mb-1",children:"Schritt-Titel"}),(0,t.jsx)(r.Input,{id:`step-title-${e.id}`,type:"text",value:C.title||"",onChange:e=>T({...C,title:e.target.value}),inputSize:"md"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:`step-desc-${e.id}`,className:"block text-sm font-medium text-slate-700 mb-1",children:"Schritt-Beschreibung"}),(0,t.jsx)(l.Textarea,{id:`step-desc-${e.id}`,value:C.description||"",onChange:e=>T({...C,description:e.target.value}),rows:2,textareaSize:"md"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>z(e.id),disabled:j,className:"h-10 px-4 py-2 text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Speichert…":"Speichern"}),(0,t.jsx)("button",{onClick:I,disabled:j,className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Abbrechen"})]})]}):(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,t.jsxs)("span",{className:"text-xs font-semibold text-slate-500 uppercase",children:["Schritt ",e.order_index+1]}),(0,t.jsxs)("span",{className:"text-xs text-slate-400",children:["(Typ: ",{question_step:"Fragen",form:"Formular",info_step:"Informationsschritt",info:"Info",content_page:"Inhaltsseite",summary:"Zusammenfassung"}[a=e.type]||a,")"]})]}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:e.title}),e.description&&(0,t.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:e.description})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>{F(e.id),T({title:e.title,description:e.description})},className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded transition-colors",children:"Bearbeiten"}),(0,t.jsx)("button",{onClick:()=>O(e.id,s,"up"),disabled:0===s||j,className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Nach oben",children:"↑"}),(0,t.jsx)("button",{onClick:()=>O(e.id,s,"down"),disabled:s===m.length-1||j,className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Nach unten",children:"↓"})]})]})}),"content_page"===e.type&&(0,t.jsx)("div",{className:"px-6 py-4 bg-blue-50 border-b border-blue-200",children:(0,t.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Zugeordnete Inhaltsseite"}),e.content_page?(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-blue-900",children:e.content_page.title}),(0,t.jsxs)("p",{className:"text-xs text-blue-700 mt-1",children:["Slug: ",e.content_page.slug]}),e.content_page.excerpt&&(0,t.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:e.content_page.excerpt}),(0,t.jsx)("span",{className:`inline-block mt-2 px-2 py-1 text-xs rounded ${"published"===e.content_page.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:"published"===e.content_page.status?"Veröffentlicht":"Entwurf"})]}):(0,t.jsx)("p",{className:"text-sm text-red-700",children:"⚠️ Keine Inhaltsseite zugeordnet"})]})})}),e.questions.length>0&&(0,t.jsxs)("div",{className:"divide-y divide-slate-200",children:[(0,t.jsx)("div",{className:"px-6 py-3 bg-slate-50 border-b border-slate-200",children:(0,t.jsx)("h4",{className:"text-sm font-semibold text-slate-700",children:"Fragen"})}),e.questions.map(e=>{var s;return(0,t.jsx)("div",{className:"px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-slate-500",children:"Frageschlüssel:"}),(0,t.jsx)("span",{className:"text-xs font-mono text-slate-500",children:e.key})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-slate-500",children:"Typ:"}),(0,t.jsx)("span",{className:"text-xs text-slate-500",children:{slider:"Schieberegler",text:"Text",select:"Auswahl",textarea:"Textfeld",radio:"Optionsfeld",checkbox:"Kontrollkästchen"}[s=e.question_type]||s})]}),(0,t.jsx)("p",{className:"text-sm font-medium text-slate-900 mb-1",children:e.label}),e.help_text&&(0,t.jsx)("p",{className:"text-xs text-slate-600",children:e.help_text})]}),(0,t.jsx)("button",{onClick:()=>P(e.funnel_step_question_id,e.is_required),disabled:j,className:`px-3 py-1.5 text-xs font-medium rounded transition-colors ${e.is_required?"bg-orange-100 text-orange-800 hover:bg-orange-200":"bg-slate-100 text-slate-600 hover:bg-slate-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:e.is_required?"Pflichtfeld":"Optional"})]})},e.id)})]}),0===e.questions.length&&(0,t.jsx)("div",{className:"px-6 py-4 text-center text-sm text-slate-500",children:"Keine Fragen in diesem Schritt"})]},e.id)})]}),0===m.length&&(0,t.jsx)("div",{className:"bg-white border border-slate-200 rounded-lg p-8 text-center",children:(0,t.jsx)("p",{className:"text-slate-600",children:"Keine Schritte definiert."})})]})}e.s(["default",()=>c,"dynamic",0,"force-dynamic"])}]);

//# sourceMappingURL=1f2c06bd89dc12d1.js.map