(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,26912,e=>{"use strict";let t=(0,e.i(68569).default)("file-check",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);e.s(["FileCheck",()=>t],26912)},40160,e=>{"use strict";let t=(0,e.i(68569).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],40160)},61911,e=>{"use strict";let t=(0,e.i(68569).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["Users",()=>t],61911)},91741,e=>{"use strict";let t=(0,e.i(68569).default)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);e.s(["ClipboardList",()=>t],91741)},68155,e=>{"use strict";var t=e.i(18050),s=e.i(71645),a=e.i(18566);e.i(17152);var r=e.i(66763);e.i(47446);var i=e.i(32796),l=e.i(67488),n=e.i(12911),d=e.i(87052),c=e.i(84584),o=e.i(52220),m=e.i(76107),h=e.i(94354),u=e.i(61911),x=e.i(91741),p=e.i(26912),g=e.i(78894),k=e.i(40160);let f=(0,e.i(68569).default)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.i(180);var j=e.i(53012);function w(){let e=(0,a.useRouter)(),[w,_]=(0,s.useState)(!0),[b,v]=(0,s.useState)(null),[y,N]=(0,s.useState)([]);(0,s.useEffect)(()=>{(async()=>{try{_(!0),v(null);let{data:e,error:t}=await r.supabase.from("patient_measures").select(`
            id,
            patient_id,
            created_at,
            stress_score,
            risk_level,
            report_id,
            patient_profiles!fk_patient_measures_patient (
              id,
              full_name,
              user_id
            )
          `).order("created_at",{ascending:!1});if(t)throw t;N(e??[])}catch(e){console.error(e),v(e instanceof Error?e.message:"Fehler beim Laden der Patientendaten.")}finally{_(!1)}})()},[]);let C=(0,s.useMemo)(()=>{let e=new Map;y.forEach(t=>{e.has(t.patient_id)||e.set(t.patient_id,[]),e.get(t.patient_id).push(t)});let t=[];return e.forEach((e,s)=>{let a=e[0];t.push({patient_id:s,patient_name:a.patient_profiles?.full_name??a.patient_profiles?.user_id??"Unbekannt",latest_stress_score:a.stress_score,latest_risk_level:a.risk_level,latest_measurement_time:a.created_at,measurement_count:e.length,report_id:a.report_id})}),t},[y]),M=(0,s.useCallback)(e=>{switch(e){case"high":return"Hoch";case"moderate":return"Mittel";case"low":return"Niedrig";case"pending":return"Ausstehend";default:return"Unbekannt"}},[]),A=(0,s.useCallback)(e=>{switch(e){case"high":return"danger";case"moderate":return"warning";case"low":return"success";case"pending":return"secondary";default:return"default"}},[]),D=(0,s.useCallback)(e=>{try{return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e))}catch{return"Datum unbekannt"}},[]),R=(0,s.useCallback)(t=>{e.push(`/clinician/patient/${t.patient_id}`)},[e]),z=(0,s.useMemo)(()=>{let e=C.length,t=new Date(new Date().getTime()-864e5),s=y.filter(e=>"high"===e.risk_level&&new Date(e.created_at)>t).length,a=C.filter(e=>"moderate"===e.latest_risk_level).length,r=y.length;return{totalPatients:e,highRiskCount24h:s,moderateRiskCount:a,totalMeasurements:r,recentCount:y.filter(e=>new Date(e.created_at)>t).length,openFunnelsCount:new Set(y.map(e=>e.patient_id)).size}},[C,y]),T=(0,s.useMemo)(()=>[...C].sort((e,t)=>new Date(t.latest_measurement_time).getTime()-new Date(e.latest_measurement_time).getTime()),[C]),F=(0,s.useMemo)(()=>[{header:"Patient:in",accessor:e=>(0,t.jsx)("span",{className:"font-medium text-slate-900 dark:text-slate-50",children:e.patient_name}),sortable:!0},{header:"StressScore",accessor:e=>null!==e.latest_stress_score?(0,t.jsx)("span",{className:"text-slate-900 dark:text-slate-50 font-semibold",children:Math.round(e.latest_stress_score)}):(0,t.jsx)("span",{className:"text-slate-400 dark:text-slate-500",children:"—"}),sortable:!0},{header:"RiskLevel",accessor:e=>(0,t.jsx)(i.Badge,{variant:A(e.latest_risk_level),children:M(e.latest_risk_level)}),sortable:!0},{header:"Letzte Messung",accessor:e=>(0,t.jsx)("span",{className:"text-slate-700 dark:text-slate-300 whitespace-nowrap",children:D(e.latest_measurement_time)}),sortable:!0},{header:"Messungen",accessor:e=>(0,t.jsx)("span",{className:"text-slate-600 dark:text-slate-300",children:e.measurement_count})}],[A,M,D]);return w?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(c.LoadingSpinner,{size:"md",text:"Patientenübersicht wird geladen…"})}):b?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(o.ErrorState,{title:"Fehler beim Laden",message:b,onRetry:()=>window.location.reload(),retryText:"Neu laden"})}):(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)(m.PageHeader,{title:"Dashboard",description:"Übersicht aller Patientinnen und Patienten mit aktuellen Assessments",actions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Button,{variant:"secondary",size:"md",icon:(0,t.jsx)(f,{className:"w-4 h-4"}),onClick:()=>e.push("/clinician/funnels"),children:"Funnels verwalten"}),(0,t.jsx)(l.Button,{variant:"secondary",size:"md",icon:(0,t.jsx)(k.Download,{className:"w-4 h-4"}),onClick:()=>window.print(),children:"Exportieren"})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",style:{marginBottom:j.spacing.xl},children:[(0,t.jsx)(n.Card,{padding:"lg",shadow:"md",radius:"lg",className:"hover:shadow-lg transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Aktive Patienten"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-50 mb-1",children:z.totalPatients}),(0,t.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Patienten mit Assessments"})]}),(0,t.jsx)("div",{className:"p-3 bg-primary-100 dark:bg-primary-900/30 rounded-lg",children:(0,t.jsx)(u.Users,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})})]})}),(0,t.jsx)(n.Card,{padding:"lg",shadow:"md",radius:"lg",className:"hover:shadow-lg transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Offene Funnels"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-50 mb-1",children:z.openFunnelsCount}),z.moderateRiskCount>0&&(0,t.jsxs)(i.Badge,{variant:"warning",size:"sm",className:"mt-1",children:[z.moderateRiskCount," pending"]})]}),(0,t.jsx)("div",{className:"p-3 bg-teal-100 dark:bg-teal-900/30 rounded-lg",children:(0,t.jsx)(x.ClipboardList,{className:"w-5 h-5 text-teal-700 dark:text-teal-400"})})]})}),(0,t.jsx)(n.Card,{padding:"lg",shadow:"md",radius:"lg",className:"hover:shadow-lg transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Aktuelle Assessments"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-50 mb-1",children:z.recentCount}),z.recentCount>0&&(0,t.jsx)(i.Badge,{variant:"info",size:"sm",className:"mt-1",children:"Today"})]}),(0,t.jsx)("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:(0,t.jsx)(p.FileCheck,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})})]})}),(0,t.jsx)(n.Card,{padding:"lg",shadow:"md",radius:"lg",className:"hover:shadow-lg transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Rote Flaggen (24h)"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-50 mb-1",children:z.highRiskCount24h}),z.highRiskCount24h>0&&(0,t.jsx)(i.Badge,{variant:"danger",size:"sm",className:"mt-1",children:"Urgent"})]}),(0,t.jsx)("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-lg",children:(0,t.jsx)(g.AlertTriangle,{className:"w-5 h-5 text-red-600 dark:text-red-400"})})]})})]}),(0,t.jsx)(h.SectionHeader,{title:"Recent Assessments",description:"Aktuelle Messungen und Risikobewertungen"}),(0,t.jsx)(d.Table,{columns:F,data:T,keyExtractor:e=>e.patient_id,hoverable:!0,bordered:!0,onRowClick:R,emptyMessage:"Noch keine Assessments vorhanden"})]})}e.s(["default",()=>w],68155)}]);

//# sourceMappingURL=c21ef7793fef773f.js.map