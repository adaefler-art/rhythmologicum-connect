{"version":3,"sources":["turbopack:///[project]/lib/featureFlags.ts","turbopack:///[project]/apps/rhythm-studio-ui/app/clinician/report/[id]/page.tsx"],"sourcesContent":["/**\n * Feature Flags Configuration\n * \n * Centralized feature flag management for the application.\n * Flags can be controlled via environment variables (NEXT_PUBLIC_FEATURE_*).\n * \n * Environment variables:\n * - NEXT_PUBLIC_FEATURE_AMY_ENABLED: Enable/disable AMY AI assistant (default: true)\n * - NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED: Enable/disable clinician dashboard (default: true)\n * - NEXT_PUBLIC_FEATURE_CHARTS_ENABLED: Enable/disable charts in clinician views (default: true)\n */\n\nimport { env } from '@/lib/env'\n\nexport type FeatureFlags = {\n  AMY_ENABLED: boolean\n  CLINICIAN_DASHBOARD_ENABLED: boolean\n  CHARTS_ENABLED: boolean\n}\n\n/**\n * Parse environment variable to boolean\n * Supports: 'true', '1', 'yes' (case-insensitive) = true\n * Everything else or undefined = uses default value\n */\nexport function parseEnvBoolean(value: string | undefined, defaultValue: boolean): boolean {\n  if (value === undefined) {\n    return defaultValue\n  }\n  const normalized = value.toLowerCase().trim()\n  return normalized === 'true' || normalized === '1' || normalized === 'yes'\n}\n\n/**\n * Feature flags configuration\n * All flags default to true to maintain backward compatibility\n */\nexport const featureFlags: FeatureFlags = {\n  AMY_ENABLED: parseEnvBoolean(\n    env.NEXT_PUBLIC_FEATURE_AMY_ENABLED,\n    true\n  ),\n  CLINICIAN_DASHBOARD_ENABLED: parseEnvBoolean(\n    env.NEXT_PUBLIC_FEATURE_CLINICIAN_DASHBOARD_ENABLED,\n    true\n  ),\n  CHARTS_ENABLED: parseEnvBoolean(\n    env.NEXT_PUBLIC_FEATURE_CHARTS_ENABLED,\n    true\n  ),\n}\n\n/**\n * Check if a specific feature is enabled\n */\nexport function isFeatureEnabled(feature: keyof FeatureFlags): boolean {\n  return featureFlags[feature]\n}\n\n/**\n * Get all feature flags as an object (useful for debugging)\n */\nexport function getAllFeatureFlags(): FeatureFlags {\n  return { ...featureFlags }\n}\n","'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { supabase } from '@/lib/supabaseClient'\nimport { featureFlags } from '@/lib/featureFlags'\n\ntype AnswerRow = {\n  question_id: string\n  answer_value: number\n}\n\ntype Report = {\n  id: string\n  assessment_id: string\n  created_at: string\n  score_numeric: number | null\n  sleep_score: number | null\n  risk_level: 'low' | 'moderate' | 'high' | null\n  report_text_short: string | null\n}\n\ntype Assessment = {\n  id: string\n  patient_id: string\n}\n\ntype PatientProfile = {\n  id: string\n  full_name: string | null\n}\n\nexport default function ClinicianReportDetailPage() {\n  const params = useParams()\n  const router = useRouter()\n  const reportId = params.id as string\n\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  const [report, setReport] = useState<Report | null>(null)\n  const [patient, setPatient] = useState<PatientProfile | null>(null)\n  const [answers, setAnswers] = useState<AnswerRow[]>([])\n\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        setLoading(true)\n        setError(null)\n\n        // 1) Report laden\n        const { data: reportData, error: reportError } = await supabase\n          .from('reports')\n          .select<'*', Report>('*')\n          .eq('id', reportId)\n          .single()\n\n        if (reportError) throw reportError\n        setReport(reportData)\n\n        // 2) Assessment laden\n        const { data: assessmentData, error: assessmentError } = await supabase\n          .from('assessments')\n          .select<'*', Assessment>('*')\n          .eq('id', reportData.assessment_id)\n          .single()\n\n        if (assessmentError) throw assessmentError\n\n        // 3) Patient laden\n        const { data: patientData, error: patientError } = await supabase\n          .from('patient_profiles')\n          .select<'*', PatientProfile>('*')\n          .eq('id', assessmentData.patient_id)\n          .single()\n\n        if (patientError) throw patientError\n        setPatient(patientData)\n\n        // 4) Antworten laden\n        const { data: answersData, error: answersError } = await supabase\n          .from('assessment_answers')\n          .select('question_id, answer_value')\n          .eq('assessment_id', assessmentData.id)\n\n        if (answersError) throw answersError\n        setAnswers((answersData ?? []) as AnswerRow[])\n      } catch (e: unknown) {\n        const message = e instanceof Error ? e.message : 'Unbekannter Fehler'\n        console.error('Fehler beim Laden der Report-Details:', e)\n        setError(message)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    if (reportId) {\n      loadData()\n    }\n  }, [reportId])\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <p className=\"text-slate-600 dark:text-slate-300\">Report wird geladen…</p>\n      </div>\n    )\n  }\n\n  if (error || !report) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"max-w-md text-center\">\n          <p className=\"text-red-500 dark:text-red-400 mb-4\">\n            {error ?? 'Report nicht gefunden.'}\n          </p>\n          <button\n            onClick={() => router.push('/clinician')}\n            className=\"px-6 py-3 min-h-11 rounded bg-sky-600 dark:bg-sky-500 text-white text-sm md:text-base hover:bg-sky-700 dark:hover:bg-sky-600 transition touch-manipulation\"\n          >\n            Zurück\n          </button>\n        </div>\n      </div>\n    )\n  }\n\n  const riskLabel =\n    report.risk_level === 'high'\n      ? 'Hohes Stressniveau'\n      : report.risk_level === 'moderate'\n      ? 'Mittleres Stressniveau'\n      : 'Niedriges Stressniveau'\n\n  return (\n    <div className=\"max-w-3xl mx-auto\">\n      <button\n        onClick={() => router.push('/clinician')}\n        className=\"mb-4 px-4 py-2.5 min-h-11 text-sm md:text-base text-sky-600 dark:text-sky-400 hover:text-sky-700 dark:hover:text-sky-300 hover:underline transition touch-manipulation inline-flex items-center gap-2\"\n      >\n        ← Zur Übersicht\n      </button>\n\n      <h1 className=\"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-slate-50 mb-4 md:mb-6\">Report – Stress & Resilienz</h1>\n\n      {/* Meta-Daten */}\n      <div className=\"mb-6 space-y-3 md:space-y-4\">\n        <div>\n          <p className=\"text-sm md:text-base text-slate-500 dark:text-slate-400\">Datum</p>\n          <p className=\"font-medium text-sm md:text-base text-slate-900 dark:text-slate-100\">\n            {new Date(report.created_at).toLocaleString()}\n          </p>\n        </div>\n\n        <div>\n          <p className=\"text-sm md:text-base text-slate-500 dark:text-slate-400\">Patient</p>\n          <p className=\"font-medium text-sm md:text-base text-slate-900 dark:text-slate-100\">\n            {patient?.full_name ?? patient?.id ?? 'Unbekannt'}\n          </p>\n        </div>\n\n        <div>\n          <p className=\"text-sm md:text-base text-slate-500 dark:text-slate-400\">Stress-Score</p>\n          <p className=\"text-xl md:text-2xl font-bold text-slate-900 dark:text-slate-50\">{report.score_numeric ?? 'N/A'}</p>\n        </div>\n\n        <div>\n          <p className=\"text-sm md:text-base text-slate-500 dark:text-slate-400\">Schlaf-Score</p>\n          <p className=\"text-xl md:text-2xl font-bold text-slate-900 dark:text-slate-50\">{report.sleep_score ?? 'N/A'}</p>\n        </div>\n\n        <div>\n          <p className=\"text-sm md:text-base text-slate-500 dark:text-slate-400\">Stress-Level</p>\n          <p className=\"font-medium text-sm md:text-base text-slate-900 dark:text-slate-100\">{riskLabel}</p>\n        </div>\n      </div>\n\n      {/* AMY-Text */}\n      {featureFlags.AMY_ENABLED && (\n        <div className=\"border border-slate-200 dark:border-slate-700 rounded-xl p-4 md:p-6 mb-6 bg-white dark:bg-slate-800 transition-colors\">\n          <h2 className=\"text-lg md:text-xl font-semibold text-slate-900 dark:text-slate-50 mb-3 md:mb-4\">Kurzbericht (AMY)</h2>\n          <p className=\"whitespace-pre-line text-gray-800 dark:text-slate-200 text-sm md:text-base\">\n            {report.report_text_short}\n          </p>\n        </div>\n      )}\n\n      {/* Antworten */}\n      <div className=\"border border-slate-200 dark:border-slate-700 rounded-xl p-4 md:p-6 bg-white dark:bg-slate-800 transition-colors\">\n        <h2 className=\"text-lg md:text-xl font-semibold text-slate-900 dark:text-slate-50 mb-3 md:mb-4\">Antworten (Rohdaten)</h2>\n        {answers.length === 0 ? (\n          <p className=\"text-sm md:text-base text-slate-500 dark:text-slate-400\">\n            Keine Antworten gefunden.\n          </p>\n        ) : (\n          <ul className=\"list-disc pl-5 space-y-1 text-sm md:text-base text-slate-700 dark:text-slate-300\">\n            {answers.map((a) => (\n              <li key={a.question_id}>\n                <strong>{a.question_id}:</strong> {a.answer_value}\n              </li>\n            ))}\n          </ul>\n        )}\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}