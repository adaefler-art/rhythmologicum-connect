{"version":3,"sources":["../../../../../../lib/utils/roleBasedRouting.ts","../../../../../../apps/rhythm-studio-ui/app/clinician/ClinicianLayoutClient.tsx"],"sourcesContent":["import type { User } from '@supabase/supabase-js'\n\n/**\n * User roles in the application\n */\nexport type UserRole = 'patient' | 'clinician' | 'admin' | 'nurse'\n\n/**\n * Navigation item for role-based menus\n */\nexport interface RoleNavItem {\n  href: string\n  label: string\n  icon?: React.ReactNode\n  active?: boolean\n}\n\n/**\n * Get the user's role from their metadata\n */\nexport function getUserRole(user: User | null): UserRole | null {\n  if (!user) return null\n  const role = user.app_metadata?.role || user.user_metadata?.role\n  return role as UserRole | null\n}\n\n/**\n * Check if a user has a specific role\n */\nexport function hasRole(user: User | null, requiredRole: UserRole): boolean {\n  const role = getUserRole(user)\n  return role === requiredRole\n}\n\n/**\n * Check if a user has any of the specified roles\n */\nexport function hasAnyRole(user: User | null, requiredRoles: UserRole[]): boolean {\n  const role = getUserRole(user)\n  return role ? requiredRoles.includes(role) : false\n}\n\n/**\n * Get the default landing page for a user based on their role\n */\nexport function getRoleLandingPage(user: User | null): string {\n  const role = getUserRole(user)\n  \n  switch (role) {\n    case 'clinician':\n      return '/clinician'\n    case 'admin':\n      // Admins share the same dashboard as clinicians\n      return '/clinician'\n    case 'nurse':\n      // Nurses share the same dashboard as clinicians\n      return '/clinician'\n    case 'patient':\n      return '/patient'\n    default:\n      return '/patient'\n  }\n}\n\n/**\n * Get navigation items for clinician/admin role\n * \n * Returns user-friendly navigation with clear, non-technical labels.\n * Navigation order reflects typical workflow: overview -> triage -> assessments -> content.\n */\nexport function getClinicianNavItems(pathname: string): RoleNavItem[] {\n  return [\n    {\n      href: '/clinician',\n      label: 'Übersicht',\n      active: pathname === '/clinician',\n    },\n    {\n      href: '/clinician/triage',\n      label: 'Triage',\n      active: pathname?.startsWith('/clinician/triage') ?? false,\n    },\n    {\n      href: '/clinician/pre-screening',\n      label: 'Pre-Screening',\n      active: pathname?.startsWith('/clinician/pre-screening') ?? false,\n    },\n    {\n      href: '/clinician/shipments',\n      label: 'Geräteversand',\n      active: pathname?.startsWith('/clinician/shipments') ?? false,\n    },\n    {\n      href: '/clinician/funnels',\n      label: 'Fragebögen',\n      active: pathname?.startsWith('/clinician/funnels') ?? false,\n    },\n    {\n      href: '/admin/content',\n      label: 'Inhalte',\n      active: pathname?.startsWith('/admin/content') ?? false,\n    },\n    {\n      href: '/admin/navigation',\n      label: 'Navigation',\n      active: pathname?.startsWith('/admin/navigation') ?? false,\n    },\n  ]\n}\n\n/**\n * Get navigation items for admin role\n * \n * Admins get additional navigation items including design system access.\n */\nexport function getAdminNavItems(pathname: string): RoleNavItem[] {\n  return [\n    {\n      href: '/clinician',\n      label: 'Übersicht',\n      active: pathname === '/clinician',\n    },\n    {\n      href: '/clinician/triage',\n      label: 'Triage',\n      active: pathname?.startsWith('/clinician/triage') ?? false,\n    },\n    {\n      href: '/clinician/pre-screening',\n      label: 'Pre-Screening',\n      active: pathname?.startsWith('/clinician/pre-screening') ?? false,\n    },\n    {\n      href: '/clinician/shipments',\n      label: 'Geräteversand',\n      active: pathname?.startsWith('/clinician/shipments') ?? false,\n    },\n    {\n      href: '/clinician/funnels',\n      label: 'Fragebögen',\n      active: pathname?.startsWith('/clinician/funnels') ?? false,\n    },\n    {\n      href: '/admin/content',\n      label: 'Inhalte',\n      active: pathname?.startsWith('/admin/content') ?? false,\n    },\n    {\n      href: '/admin/navigation',\n      label: 'Navigation',\n      active: pathname?.startsWith('/admin/navigation') ?? false,\n    },\n    {\n      href: '/admin/dev/endpoints',\n      label: 'Endpoints',\n      active: pathname?.startsWith('/admin/dev/endpoints') ?? false,\n    },\n  ]\n}\n\n/**\n * Get navigation items for patient role\n * \n * Patient-facing navigation with clear, friendly labels in German.\n * Simple two-item navigation: start assessment -> view history.\n */\nexport function getPatientNavItems(pathname: string): RoleNavItem[] {\n  return [\n    {\n      href: '/patient/funnels',\n      label: 'Fragebogen starten',\n      active:\n        pathname?.startsWith('/patient/assessment') || \n        pathname?.startsWith('/patient/funnel/') || \n        false,\n    },\n    {\n      href: '/patient/history',\n      label: 'Mein Verlauf',\n      active: pathname === '/patient/history',\n    },\n  ]\n}\n\n/**\n * Get navigation items for nurse role\n * \n * Nurse navigation shares clinician dashboard access but with nurse-specific label.\n * Nurses can view patient assessments and manage their workflow.\n */\nexport function getNurseNavItems(pathname: string): RoleNavItem[] {\n  return [\n    {\n      href: '/clinician',\n      label: 'Übersicht',\n      active: pathname === '/clinician',\n    },\n    {\n      href: '/clinician/triage',\n      label: 'Triage',\n      active: pathname?.startsWith('/clinician/triage') ?? false,\n    },\n    {\n      href: '/clinician/shipments',\n      label: 'Geräteversand',\n      active: pathname?.startsWith('/clinician/shipments') ?? false,\n    },\n    {\n      href: '/clinician/funnels',\n      label: 'Fragebögen',\n      active: pathname?.startsWith('/clinician/funnels') ?? false,\n    },\n  ]\n}\n\n/**\n * Get navigation items based on user role\n * \n * Automatically returns the appropriate navigation items for the user's role.\n * This is the recommended way to get navigation items in layouts.\n * \n * Fail-closed: Returns empty array if role cannot be determined or user is not authenticated.\n */\nexport function getNavItemsForRole(user: User | null, pathname: string): RoleNavItem[] {\n  // Fail-closed: unauthenticated users get no navigation\n  if (!user) {\n    return []\n  }\n  \n  const role = getUserRole(user)\n  \n  switch (role) {\n    case 'admin':\n      return getAdminNavItems(pathname)\n    case 'clinician':\n      return getClinicianNavItems(pathname)\n    case 'nurse':\n      return getNurseNavItems(pathname)\n    case 'patient':\n      return getPatientNavItems(pathname)\n    default:\n      // Fail-closed: unknown roles get no privileged navigation\n      return []\n  }\n}\n\n/**\n * Get role display name in German\n */\nexport function getRoleDisplayName(role: UserRole | null): string {\n  switch (role) {\n    case 'clinician':\n      return 'Clinician'\n    case 'admin':\n      return 'Administrator'\n    case 'nurse':\n      return 'Nurse'\n    case 'patient':\n      return 'Patient'\n    default:\n      return 'Benutzer'\n  }\n}\n\n/**\n * Check if a route is accessible for a given role\n */\nexport function canAccessRoute(user: User | null, route: string): boolean {\n  const role = getUserRole(user)\n  \n  // Public routes (login, datenschutz, etc.)\n  if (route === '/' || route.startsWith('/datenschutz')) {\n    return true\n  }\n  \n  // Patient routes\n  if (route.startsWith('/patient')) {\n    return role === 'patient' || role === 'clinician' || role === 'admin' || role === 'nurse'\n  }\n  \n  // Clinician routes\n  if (route.startsWith('/clinician')) {\n    return role === 'clinician' || role === 'admin' || role === 'nurse'\n  }\n  \n  // Admin routes (clinicians also have access)\n  if (route.startsWith('/admin')) {\n    return role === 'clinician' || role === 'admin'\n  }\n  \n  return false\n}\n\n/**\n * Fetch navigation items from database for a specific role\n * \n * Falls back to hardcoded navigation if:\n * - Database is not ready (schema not deployed)\n * - API call fails\n * - No configuration exists for the role\n * \n * @param role - User role\n * @param pathname - Current pathname for active state\n * @returns Navigation items with active state\n */\nexport async function fetchNavItemsForRole(\n  role: UserRole,\n  pathname: string,\n): Promise<RoleNavItem[]> {\n  try {\n    // Fetch navigation config from API\n    const response = await fetch('/api/admin/navigation')\n    \n    if (!response.ok) {\n      // Fallback to hardcoded navigation on error\n      console.warn('Navigation config API failed, using fallback')\n      return getFallbackNavItems(role, pathname)\n    }\n\n    const data = await response.json()\n    \n    if (!data.success || !data.data) {\n      return getFallbackNavItems(role, pathname)\n    }\n\n    const { items, configs } = data.data\n\n    // Filter and sort items for this role\n    const roleConfigs = configs\n      .filter((c: { role: string; is_enabled: boolean }) => c.role === role && c.is_enabled)\n      .sort((a: { order_index: number }, b: { order_index: number }) => a.order_index - b.order_index)\n\n    // Build navigation items from configs\n    const navItems: RoleNavItem[] = roleConfigs.map((config: {\n      navigation_item_id: string\n      custom_label: string | null\n      order_index: number\n    }) => {\n      const item = items.find((i: { id: string }) => i.id === config.navigation_item_id)\n      if (!item) return null\n\n      return {\n        href: item.route,\n        label: config.custom_label || item.default_label,\n        active:\n          pathname === item.route ||\n          (item.route !== '/clinician' && pathname?.startsWith(item.route)) ||\n          false,\n      }\n    }).filter(Boolean) as RoleNavItem[]\n\n    // If we got items from DB, return them\n    if (navItems.length > 0) {\n      return navItems\n    }\n\n    // Otherwise fallback to hardcoded\n    return getFallbackNavItems(role, pathname)\n  } catch (error) {\n    console.warn('Error fetching navigation config:', error)\n    return getFallbackNavItems(role, pathname)\n  }\n}\n\n/**\n * Get fallback navigation items when DB config is unavailable\n */\nfunction getFallbackNavItems(role: UserRole, pathname: string): RoleNavItem[] {\n  switch (role) {\n    case 'admin':\n      return getAdminNavItems(pathname)\n    case 'clinician':\n      return getClinicianNavItems(pathname)\n    case 'nurse':\n      return getNurseNavItems(pathname)\n    case 'patient':\n      return getPatientNavItems(pathname)\n    default:\n      return []\n  }\n}\n\n","'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useRouter, usePathname } from 'next/navigation'\nimport { supabase } from '@/lib/supabaseClient'\nimport { DesktopLayout } from '@/lib/ui'\nimport {\n  getNavItemsForRole,\n  hasAnyRole,\n  getUserRole,\n  getRoleDisplayName,\n} from '@/lib/utils/roleBasedRouting'\nimport type { ReactNode } from 'react'\nimport type { Session, User } from '@supabase/supabase-js'\n\ntype ResolvedUserRole = 'patient' | 'clinician' | 'admin' | 'nurse'\n\ntype RoleResolution = { role: ResolvedUserRole | null; status: number | null }\n\nasync function notifyAuthCallback(event: string, session: Session | null) {\n  try {\n    await fetch('/api/auth/callback', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ event, session }),\n    })\n  } catch {\n    // Best-effort cookie sync; failures are handled by auth guards.\n  }\n}\n\nasync function resolveRole(): Promise<RoleResolution> {\n  try {\n    const res = await fetch('/api/auth/resolve-role', { method: 'GET' })\n    if (!res.ok) return { role: null, status: res.status }\n    const json: unknown = await res.json()\n    if (!json || typeof json !== 'object') return { role: null, status: res.status }\n    const role = (json as { data?: { role?: string } }).data?.role\n    if (role === 'patient' || role === 'clinician' || role === 'admin' || role === 'nurse') {\n      return { role, status: res.status }\n    }\n    return { role: null, status: res.status }\n  } catch {\n    return { role: null, status: null }\n  }\n}\n\n// Constants for redirect URLs\nconst AUTH_REQUIRED_REDIRECT = '/?error=authentication_required&message=Bitte melden Sie sich an.'\nconst ACCESS_DENIED_REDIRECT =\n  '/?error=access_denied&message=Keine Berechtigung für den Clinician-Bereich.'\n\nexport default function ClinicianLayoutClient({ children }: { children: ReactNode }) {\n  const router = useRouter()\n  const pathname = usePathname()\n  const [user, setUser] = useState<User | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    // Check authentication on mount\n    const checkAuth = async () => {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser()\n\n      if (!user) {\n        router.push(AUTH_REQUIRED_REDIRECT)\n        return\n      }\n\n      const {\n        data: { session },\n      } = await supabase.auth.getSession()\n      if (session) {\n        await notifyAuthCallback('SIGNED_IN', session)\n      }\n\n      // Prefer DB membership role resolution (fail-closed)\n      const resolution = await resolveRole()\n      if (resolution.role) {\n        if (\n          resolution.role !== 'clinician' &&\n          resolution.role !== 'admin' &&\n          resolution.role !== 'nurse'\n        ) {\n          router.push(ACCESS_DENIED_REDIRECT)\n          return\n        }\n      } else if (resolution.status === 403) {\n        router.push(ACCESS_DENIED_REDIRECT)\n        return\n      } else {\n        // Fallback to metadata only if resolver is unavailable (network/5xx)\n        if (!hasAnyRole(user, ['clinician', 'admin', 'nurse'])) {\n          router.push(ACCESS_DENIED_REDIRECT)\n          return\n        }\n      }\n\n      setUser(user)\n      setLoading(false)\n    }\n\n    checkAuth()\n\n    // Subscribe to auth changes\n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange(async (event, session) => {\n      // Don't sync SIGNED_OUT events - they're handled by the signout endpoint\n      // This prevents auto-relogin after explicit logout\n      if (event !== 'SIGNED_OUT') {\n        await notifyAuthCallback(event, session ?? null)\n      }\n      \n      if (event === 'SIGNED_OUT') {\n        router.push('/')\n      } else if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {\n        if (session?.user) {\n          const resolution = await resolveRole()\n          if (resolution.role) {\n            if (\n              resolution.role !== 'clinician' &&\n              resolution.role !== 'admin' &&\n              resolution.role !== 'nurse'\n            ) {\n              router.push(ACCESS_DENIED_REDIRECT)\n              return\n            }\n          } else if (resolution.status === 403) {\n            router.push(ACCESS_DENIED_REDIRECT)\n            return\n          } else {\n            if (!hasAnyRole(session.user, ['clinician', 'admin', 'nurse'])) {\n              router.push(ACCESS_DENIED_REDIRECT)\n              return\n            }\n          }\n          setUser(session.user)\n          setLoading(false)\n        }\n      }\n    })\n\n    return () => {\n      subscription.unsubscribe()\n    }\n  }, [router])\n\n  const handleSignOut = async () => {\n    await supabase.auth.signOut()\n    try {\n      await fetch('/api/auth/signout', { method: 'POST', credentials: 'include' })\n    } catch {\n      // Ignore network errors; client session is already cleared\n    }\n    window.location.assign('/')\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-slate-50 dark:bg-slate-900\">\n        <p className=\"text-slate-600 dark:text-slate-300\">Authentifizierung wird überprüft…</p>\n      </div>\n    )\n  }\n\n  // Get navigation items and role display name\n  const navItems = getNavItemsForRole(user, pathname)\n  const role = getUserRole(user)\n  const roleDisplay = getRoleDisplayName(role)\n\n  return (\n    <DesktopLayout\n      appTitle=\"Rhythmologicum Connect\"\n      userEmail={user?.email}\n      onSignOut={handleSignOut}\n      navItems={navItems}\n    >\n      {/* Role indicator */}\n      <div className=\"mb-4 text-xs text-slate-500 dark:text-slate-400\">\n        Angemeldet als:{' '}\n        <span className=\"font-medium text-slate-700 dark:text-slate-300\">{roleDisplay}</span>\n      </div>\n      {children}\n    </DesktopLayout>\n  )\n}\n"],"names":[],"mappings":"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"}