module.exports=[19629,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246);a.i(59620);var f=a.i(98595),g=a.i(26818),h=a.i(86071),i=a.i(63156);let j=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function k(){let a=(0,d.useParams)().identifier;j.test(a);let[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(!0),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)({}),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)({});function E(a){return a&&"object"==typeof a?a:null}let F=(0,c.useCallback)(async()=>{try{r(!0),t(null);let b=await fetch(`/api/admin/funnels/${a}`);if(!b.ok){let a=b.headers.get("x-request-id"),c="Failed to load funnel details";try{let d=await b.json(),e=E(d),f=e?.error?.message,g=e?.error?.requestId||e?.error?.details?.requestId;"string"==typeof f&&f.length>0&&(c=f),"string"==typeof g&&g.length>0&&(a=g)}catch{}throw Error(a?`${c} (requestId: ${a})`:c)}let c=await b.json(),d=E(c),e=d?.data?.funnel,f=d?.data?.steps,g=d?.data?.versions;l(e??null),n(Array.isArray(f)?f:[]),p(Array.isArray(g)?g:[])}catch(a){console.error("Error loading funnel details:",a),t(a instanceof Error?a.message:"Fehler beim Laden der Funnel-Details")}finally{r(!1)}},[a]);(0,c.useEffect)(()=>{F()},[F]);let G=async()=>{if(k)try{v(!0);let b=await fetch(`/api/admin/funnels/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_active:!k.is_active})});if(!b.ok){let a=b.headers.get("x-request-id"),c="Failed to update funnel";try{let d=await b.json(),e=E(d),f=e?.error?.message,g=e?.error?.requestId||e?.error?.details?.requestId;"string"==typeof f&&f.length>0&&(c=f),"string"==typeof g&&g.length>0&&(a=g)}catch{}throw Error(a?`${c} (requestId: ${a})`:c)}let c=await b.json(),d=E(c);l(d?.data?.funnel??null)}catch(a){console.error("Error updating funnel:",a),alert(`Fehler beim Aktualisieren des Funnels: ${a instanceof Error?a.message:"Unbekannter Fehler"}`)}finally{v(!1)}},H=async()=>{if(!k)return;let b=y.title?.trim()||"";if(0===b.length)return void alert("Titel darf nicht leer sein");if(b.length>255)return void alert("Titel ist zu lang (maximal 255 Zeichen)");let c=y.description?.trim()||"";if(c.length>2e3)return void alert("Beschreibung ist zu lang (maximal 2000 Zeichen)");try{v(!0);let d=await fetch(`/api/admin/funnels/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:b,description:c})});if(!d.ok){let a=d.headers.get("x-request-id"),b="Failed to update funnel";try{let c=await d.json(),e=E(c),f=e?.error?.message,g=e?.error?.requestId||e?.error?.details?.requestId;"string"==typeof f&&f.length>0&&(b=f),"string"==typeof g&&g.length>0&&(a=g)}catch{}throw Error(a?`${b} (requestId: ${a})`:b)}let e=await d.json(),f=E(e);l(f?.data?.funnel??null),x(!1),z({})}catch(a){console.error("Error updating funnel:",a),alert(`Fehler beim Speichern: ${a instanceof Error?a.message:"Unbekannter Fehler"}`)}finally{v(!1)}},I=()=>{B(null),D({})},J=async a=>{let b=C.title?.trim()||"";if(0===b.length)return void alert("Schritt-Titel darf nicht leer sein");if(b.length>255)return void alert("Schritt-Titel ist zu lang (maximal 255 Zeichen)");let c=C.description?.trim()||"";if(c.length>2e3)return void alert("Schritt-Beschreibung ist zu lang (maximal 2000 Zeichen)");try{v(!0);let d=await fetch(`/api/admin/funnel-steps/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:b,description:c})});if(!d.ok){let a=await d.json();throw Error(a.error||"Failed to update step")}await F(),B(null),D({})}catch(a){console.error("Error updating step:",a),alert(`Fehler beim Speichern: ${a instanceof Error?a.message:"Unbekannter Fehler"}`)}finally{v(!1)}},K=async(a,b)=>{try{if(v(!0),!(await fetch(`/api/admin/funnel-step-questions/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_required:!b})})).ok)throw Error("Failed to update question");await F()}catch(a){console.error("Error updating question:",a),alert("Fehler beim Aktualisieren der Frage")}finally{v(!1)}},L=async(a,b,c)=>{let d="up"===c?b-1:b+1;if(!(d<0)&&!(d>=m.length))try{v(!0);let c=m[d];await Promise.all([fetch(`/api/admin/funnel-steps/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_index:d})}),fetch(`/api/admin/funnel-steps/${c.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_index:b})})]),await F()}catch(a){console.error("Error moving step:",a),alert("Fehler beim Verschieben des Steps")}finally{v(!1)}},M=async a=>{try{v(!0);let b=await fetch(`/api/admin/funnel-versions/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_default:!0})});if(!b.ok){let a=b.headers.get("x-request-id"),c="Failed to set default version";try{let d=await b.json(),e=E(d),f=e?.error?.message,g=e?.error?.requestId||e?.error?.details?.requestId;"string"==typeof f&&f.length>0&&(c=f),"string"==typeof g&&g.length>0&&(a=g)}catch{}throw Error(a?`${c} (requestId: ${a})`:c)}await F()}catch(a){console.error("Error setting default version:",a),alert(`Fehler beim Setzen der Standard-Version: ${a instanceof Error?a.message:"Unbekannter Fehler"}`)}finally{v(!1)}},N=async(a,b)=>{try{if(v(!0),!(await fetch(`/api/admin/funnel-versions/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({rollout_percent:b})})).ok)throw Error("Failed to update rollout percentage");await F()}catch(a){console.error("Error updating rollout:",a),alert("Fehler beim Aktualisieren des Rollouts")}finally{v(!1)}};return q?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(h.LoadingSpinner,{size:"lg",text:"Lade Funnel-Details…",centered:!0})}):s||!k?(0,b.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,b.jsx)(i.ErrorState,{title:"Fehler beim Laden",message:s||"Funnel nicht gefunden",centered:!0}),(0,b.jsx)("div",{className:"mt-4 text-center",children:(0,b.jsx)(e.default,{href:"/clinician/funnels",className:"inline-flex items-center text-sm text-sky-600 dark:text-sky-400 hover:text-sky-700 dark:hover:text-sky-300 font-medium",children:"← Zurück zur Übersicht"})})]}):(0,b.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsx)(e.default,{href:"/clinician/funnels",className:"inline-flex items-center text-sm text-sky-600 hover:text-sky-700 font-medium",children:"← Zurück zur Übersicht"})}),(0,b.jsx)("div",{className:"bg-white border border-slate-200 rounded-lg p-6 mb-6",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-4",children:[(0,b.jsx)("div",{className:"flex-1",children:w?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"funnel-title",className:"block text-sm font-medium text-slate-700 mb-1",children:"Titel"}),(0,b.jsx)(f.Input,{id:"funnel-title",type:"text",value:y.title||"",onChange:a=>z({...y,title:a.target.value}),inputSize:"md"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"funnel-description",className:"block text-sm font-medium text-slate-700 mb-1",children:"Beschreibung"}),(0,b.jsx)(g.Textarea,{id:"funnel-description",value:y.description||"",onChange:a=>z({...y,description:a.target.value}),rows:3,textareaSize:"md"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:H,disabled:u,className:"h-10 px-4 py-2 text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Speichert…":"Speichern"}),(0,b.jsx)("button",{onClick:()=>{x(!1),z({})},disabled:u,className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Abbrechen"})]})]}):(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900 dark:text-slate-50 mb-2",children:k.title}),k.description&&(0,b.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-3",children:k.description}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm text-slate-400 dark:text-slate-500",children:[(0,b.jsxs)("span",{children:["ID: ",k.slug]}),(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{children:[m.length," Schritte"]}),(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{children:[m.reduce((a,b)=>a+b.questions.length,0)," Fragen"]})]})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.default,{href:`/clinician/funnels/${k.slug}/editor`,className:"h-10 px-4 py-2 text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 rounded-md transition-colors inline-flex items-center",children:"Content Editor"}),!w&&(0,b.jsx)("button",{onClick:()=>{x(!0),z({title:k?.title||"",description:k?.description||""})},className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors",children:"Bearbeiten"}),(0,b.jsx)("button",{onClick:G,disabled:u,className:`h-10 px-4 py-2 text-sm font-medium rounded-md transition-colors ${k.is_active?"bg-green-100 text-green-800 hover:bg-green-200":"bg-slate-100 text-slate-600 hover:bg-slate-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:u?"Speichert…":k.is_active?"Aktiv":"Inaktiv"})]})]})})]}),o.length>0&&(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-50 mb-4",children:"Versionen"}),(0,b.jsx)("div",{className:"bg-white border border-slate-200 rounded-lg overflow-hidden",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-slate-200",children:[(0,b.jsx)("thead",{className:"bg-slate-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Version"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Rollout %"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Algorithmus"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Prompt"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Erstellt"}),(0,b.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Aktionen"})]})}),(0,b.jsx)("tbody",{className:"bg-white divide-y divide-slate-200",children:o.map(a=>(0,b.jsxs)("tr",{className:a.is_default?"bg-sky-50":"",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-slate-900",children:a.version}),a.is_default&&(0,b.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-sky-100 text-sky-800",children:"Standard"})]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${a.is_default?"bg-green-100 text-green-800":"bg-slate-100 text-slate-600"}`,children:a.is_default?"Aktiv":"Bereit"})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"number",min:"0",max:"100",defaultValue:a.rollout_percent,onBlur:b=>{let c=parseInt(b.target.value,10);!isNaN(c)&&c>=0&&c<=100&&c!==a.rollout_percent?N(a.id,c):c!==a.rollout_percent&&(b.target.value=String(a.rollout_percent))},disabled:u,className:"w-16 px-2 py-1 text-sm border border-slate-300 rounded focus:ring-1 focus:ring-sky-500 focus:border-sky-500 disabled:opacity-50 disabled:cursor-not-allowed"}),(0,b.jsx)("span",{className:"text-sm text-slate-600",children:"%"})]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:"text-sm text-slate-900 font-mono",children:a.algorithm_bundle_version})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:"text-sm text-slate-900 font-mono",children:a.prompt_version})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500",children:new Date(a.created_at).toLocaleDateString("de-DE")}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:!a.is_default&&(0,b.jsx)("button",{onClick:()=>M(a.id),disabled:u,className:"inline-flex items-center px-3 py-1.5 border border-sky-600 text-sky-600 hover:bg-sky-50 rounded text-xs font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Als Standard setzen"})})]},a.id))})]})})}),(0,b.jsxs)("div",{className:"mt-4 text-sm text-slate-600",children:[(0,b.jsxs)("p",{className:"mb-1",children:[(0,b.jsx)("strong",{children:"Rollout %:"})," Prozentsatz der Nutzer, die diese Version sehen (0-100). Bei mehreren aktiven Versionen wird nach Prozentsatz gewichtet ausgewählt."]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Standard:"})," Die Standard-Version wird neuen Nutzern zugewiesen und ist die Haupt-Version des Funnels."]})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-50",children:"Schritte"}),m.map((a,c)=>{var d;return(0,b.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-slate-50 px-6 py-4 border-b border-slate-200",children:A===a.id?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:`step-title-${a.id}`,className:"block text-sm font-medium text-slate-700 mb-1",children:"Schritt-Titel"}),(0,b.jsx)(f.Input,{id:`step-title-${a.id}`,type:"text",value:C.title||"",onChange:a=>D({...C,title:a.target.value}),inputSize:"md"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:`step-desc-${a.id}`,className:"block text-sm font-medium text-slate-700 mb-1",children:"Schritt-Beschreibung"}),(0,b.jsx)(g.Textarea,{id:`step-desc-${a.id}`,value:C.description||"",onChange:a=>D({...C,description:a.target.value}),rows:2,textareaSize:"md"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>J(a.id),disabled:u,className:"h-10 px-4 py-2 text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Speichert…":"Speichern"}),(0,b.jsx)("button",{onClick:I,disabled:u,className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Abbrechen"})]})]}):(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,b.jsxs)("span",{className:"text-xs font-semibold text-slate-500 uppercase",children:["Schritt ",a.order_index+1]}),(0,b.jsxs)("span",{className:"text-xs text-slate-400",children:["(Typ: ",{question_step:"Fragen",form:"Formular",info_step:"Informationsschritt",info:"Info",content_page:"Inhaltsseite",summary:"Zusammenfassung"}[d=a.type]||d,")"]})]}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:a.title}),a.description&&(0,b.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:a.description})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:()=>{B(a.id),D({title:a.title,description:a.description})},className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded transition-colors",children:"Bearbeiten"}),(0,b.jsx)("button",{onClick:()=>L(a.id,c,"up"),disabled:0===c||u,className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Nach oben",children:"↑"}),(0,b.jsx)("button",{onClick:()=>L(a.id,c,"down"),disabled:c===m.length-1||u,className:"h-10 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Nach unten",children:"↓"})]})]})}),"content_page"===a.type&&(0,b.jsx)("div",{className:"px-6 py-4 bg-blue-50 border-b border-blue-200",children:(0,b.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Zugeordnete Inhaltsseite"}),a.content_page?(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-blue-900",children:a.content_page.title}),(0,b.jsxs)("p",{className:"text-xs text-blue-700 mt-1",children:["Slug: ",a.content_page.slug]}),a.content_page.excerpt&&(0,b.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:a.content_page.excerpt}),(0,b.jsx)("span",{className:`inline-block mt-2 px-2 py-1 text-xs rounded ${"published"===a.content_page.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:"published"===a.content_page.status?"Veröffentlicht":"Entwurf"})]}):(0,b.jsx)("p",{className:"text-sm text-red-700",children:"⚠️ Keine Inhaltsseite zugeordnet"})]})})}),a.questions.length>0&&(0,b.jsxs)("div",{className:"divide-y divide-slate-200",children:[(0,b.jsx)("div",{className:"px-6 py-3 bg-slate-50 border-b border-slate-200",children:(0,b.jsx)("h4",{className:"text-sm font-semibold text-slate-700",children:"Fragen"})}),a.questions.map(a=>{var c;return(0,b.jsx)("div",{className:"px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-500",children:"Frageschlüssel:"}),(0,b.jsx)("span",{className:"text-xs font-mono text-slate-500",children:a.key})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-slate-500",children:"Typ:"}),(0,b.jsx)("span",{className:"text-xs text-slate-500",children:{slider:"Schieberegler",text:"Text",select:"Auswahl",textarea:"Textfeld",radio:"Optionsfeld",checkbox:"Kontrollkästchen"}[c=a.question_type]||c})]}),(0,b.jsx)("p",{className:"text-sm font-medium text-slate-900 mb-1",children:a.label}),a.help_text&&(0,b.jsx)("p",{className:"text-xs text-slate-600",children:a.help_text})]}),(0,b.jsx)("button",{onClick:()=>K(a.funnel_step_question_id,a.is_required),disabled:u,className:`px-3 py-1.5 text-xs font-medium rounded transition-colors ${a.is_required?"bg-orange-100 text-orange-800 hover:bg-orange-200":"bg-slate-100 text-slate-600 hover:bg-slate-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:a.is_required?"Pflichtfeld":"Optional"})]})},a.id)})]}),0===a.questions.length&&(0,b.jsx)("div",{className:"px-6 py-4 text-center text-sm text-slate-500",children:"Keine Fragen in diesem Schritt"})]},a.id)})]}),0===m.length&&(0,b.jsx)("div",{className:"bg-white border border-slate-200 rounded-lg p-8 text-center",children:(0,b.jsx)("p",{className:"text-slate-600",children:"Keine Schritte definiert."})})]})}a.s(["default",()=>k,"dynamic",0,"force-dynamic"])}];

//# sourceMappingURL=apps_rhythm-studio-ui_app_clinician_funnels_%5Bidentifier%5D_page_tsx_6a0fe956._.js.map