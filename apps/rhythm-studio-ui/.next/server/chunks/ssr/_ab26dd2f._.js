module.exports=[79341,a=>{"use strict";function b(a){return a?a.app_metadata?.role||a.user_metadata?.role:null}function c(a,c){let d=b(a);return!!d&&c.includes(d)}function d(a){return[{href:"/clinician",label:"Übersicht",active:"/clinician"===a},{href:"/clinician/triage",label:"Triage",active:a?.startsWith("/clinician/triage")??!1},{href:"/clinician/pre-screening",label:"Pre-Screening",active:a?.startsWith("/clinician/pre-screening")??!1},{href:"/clinician/shipments",label:"Geräteversand",active:a?.startsWith("/clinician/shipments")??!1},{href:"/clinician/funnels",label:"Fragebögen",active:a?.startsWith("/clinician/funnels")??!1},{href:"/admin/content",label:"Inhalte",active:a?.startsWith("/admin/content")??!1},{href:"/admin/navigation",label:"Navigation",active:a?.startsWith("/admin/navigation")??!1}]}function e(a){return[{href:"/clinician",label:"Übersicht",active:"/clinician"===a},{href:"/clinician/triage",label:"Triage",active:a?.startsWith("/clinician/triage")??!1},{href:"/clinician/pre-screening",label:"Pre-Screening",active:a?.startsWith("/clinician/pre-screening")??!1},{href:"/clinician/shipments",label:"Geräteversand",active:a?.startsWith("/clinician/shipments")??!1},{href:"/clinician/funnels",label:"Fragebögen",active:a?.startsWith("/clinician/funnels")??!1},{href:"/admin/content",label:"Inhalte",active:a?.startsWith("/admin/content")??!1},{href:"/admin/navigation",label:"Navigation",active:a?.startsWith("/admin/navigation")??!1},{href:"/admin/dev/endpoints",label:"Endpoints",active:a?.startsWith("/admin/dev/endpoints")??!1}]}function f(a){return[{href:"/patient/funnels",label:"Fragebogen starten",active:a?.startsWith("/patient/assessment")||a?.startsWith("/patient/funnel/")||!1},{href:"/patient/history",label:"Mein Verlauf",active:"/patient/history"===a}]}function g(a){return[{href:"/clinician",label:"Übersicht",active:"/clinician"===a},{href:"/clinician/triage",label:"Triage",active:a?.startsWith("/clinician/triage")??!1},{href:"/clinician/shipments",label:"Geräteversand",active:a?.startsWith("/clinician/shipments")??!1},{href:"/clinician/funnels",label:"Fragebögen",active:a?.startsWith("/clinician/funnels")??!1}]}function h(a,c){if(!a)return[];switch(b(a)){case"admin":return e(c);case"clinician":return d(c);case"nurse":return g(c);case"patient":return f(c);default:return[]}}function i(a){switch(a){case"clinician":return"Clinician";case"admin":return"Administrator";case"nurse":return"Nurse";case"patient":return"Patient";default:return"Benutzer"}}async function j(a,b){try{let c=await fetch("/api/admin/navigation");if(!c.ok)return console.warn("Navigation config API failed, using fallback"),k(a,b);let d=await c.json();if(!d.success||!d.data)return k(a,b);let{items:e,configs:f}=d.data,g=f.filter(b=>b.role===a&&b.is_enabled).sort((a,b)=>a.order_index-b.order_index).map(a=>{let c=e.find(b=>b.id===a.navigation_item_id);return c?{href:c.route,label:a.custom_label||c.default_label,active:b===c.route||"/clinician"!==c.route&&b?.startsWith(c.route)||!1}:null}).filter(Boolean);if(g.length>0)return g;return k(a,b)}catch(c){return console.warn("Error fetching navigation config:",c),k(a,b)}}function k(a,b){switch(a){case"admin":return e(b);case"clinician":return d(b);case"nurse":return g(b);case"patient":return f(b);default:return[]}}a.s(["fetchNavItemsForRole",()=>j,"getNavItemsForRole",()=>h,"getRoleDisplayName",()=>i,"getUserRole",()=>b,"hasAnyRole",()=>c])},84748,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);a.i(53547);var e=a.i(28914);a.i(59620);var f=a.i(35094),g=a.i(79341);async function h(a,b){try{await fetch("/api/auth/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:a,session:b})})}catch{}}async function i(){try{let a=await fetch("/api/auth/resolve-role",{method:"GET"});if(!a.ok)return{role:null,status:a.status};let b=await a.json();if(!b||"object"!=typeof b)return{role:null,status:a.status};let c=b.data?.role;if("patient"===c||"clinician"===c||"admin"===c||"nurse"===c)return{role:c,status:a.status};return{role:null,status:a.status}}catch{return{role:null,status:null}}}let j="/?error=access_denied&message=Keine Berechtigung für den Clinician-Bereich.";function k({children:a}){let k=(0,d.useRouter)(),l=(0,d.usePathname)(),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!0);(0,c.useEffect)(()=>{(async()=>{let{data:{user:a}}=await e.supabase.auth.getUser();if(!a)return k.push("/?error=authentication_required&message=Bitte melden Sie sich an.");let{data:{session:b}}=await e.supabase.auth.getSession();b&&await h("SIGNED_IN",b);let c=await i();if(c.role){if("clinician"!==c.role&&"admin"!==c.role&&"nurse"!==c.role)return k.push(j)}else if(403===c.status)return k.push(j);else if(!(0,g.hasAnyRole)(a,["clinician","admin","nurse"]))return k.push(j);n(a),p(!1)})();let{data:{subscription:a}}=e.supabase.auth.onAuthStateChange(async(a,b)=>{if("SIGNED_OUT"!==a&&await h(a,b??null),"SIGNED_OUT"===a)k.push("/");else if(("SIGNED_IN"===a||"TOKEN_REFRESHED"===a)&&b?.user){let a=await i();if(a.role){if("clinician"!==a.role&&"admin"!==a.role&&"nurse"!==a.role)return void k.push(j)}else if(403===a.status)return void k.push(j);else if(!(0,g.hasAnyRole)(b.user,["clinician","admin","nurse"]))return void k.push(j);n(b.user),p(!1)}});return()=>{a.unsubscribe()}},[k]);let q=async()=>{await e.supabase.auth.signOut();try{await fetch("/api/auth/signout",{method:"POST",credentials:"include"})}catch{}window.location.assign("/")};if(o)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 dark:bg-slate-900",children:(0,b.jsx)("p",{className:"text-slate-600 dark:text-slate-300",children:"Authentifizierung wird überprüft…"})});let r=(0,g.getNavItemsForRole)(m,l),s=(0,g.getUserRole)(m),t=(0,g.getRoleDisplayName)(s);return(0,b.jsxs)(f.DesktopLayout,{appTitle:"Rhythmologicum Connect",userEmail:m?.email,onSignOut:q,navItems:r,children:[(0,b.jsxs)("div",{className:"mb-4 text-xs text-slate-500 dark:text-slate-400",children:["Angemeldet als:"," ",(0,b.jsx)("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:t})]}),a]})}a.s(["default",()=>k])}];

//# sourceMappingURL=_ab26dd2f._.js.map