# EPIC: v0.3 – Funnel-Engine Backend (konfigurierbare Funnels)

Ziel:
Einführung einer generischen Funnel-Engine, damit Fragebögen/Funnels (z.B. Stress, Schlaf, AF-Risikotest) vollständig in der Datenbank definiert werden können.
Der aktuelle Stress-Check wird als erster Funnel migriert.

## Issue 1 — DB: Funnel-Basis-Tabellen anlegen

Beschreibung:
Neue Tabellen für das Funnel-Modell anlegen:

funnels

funnel_steps

questions

funnel_step_questions

AKs:

SQL-Migration erstellen.

Constraints & Indexe setzen.

funnels.slug einzigartig machen.

## Issue 2 — DB: assessments um funnel_id erweitern

Beschreibung:
assessments soll eine Referenz auf funnels enthalten.

AKs:

Spalte funnel_id uuid null hinzufügen.

FK → funnels.id.

Index auf funnel_id.

## Issue 3 — API: GET /api/funnels/[slug]

Beschreibung:
API-Route, die komplette Funnel-Definition aus der DB lädt (Steps + Fragen).

AKs:

Route anlegen.

Funnel per slug laden.

Steps + Questions zusammensetzen.

JSON-Response liefern.

Fehlerfall bei unbekanntem Slug.

## Issue 4 — API: POST /api/funnel-assessments/[slug]

Beschreibung:
Generische Submit-Route für Funnel-Antworten.

AKs:

Route erstellen.

Antworten in assessment_answers speichern.

Neues Assessment anlegen → mit funnel_id.

patient_measures aktualisieren.

Stress-Funnel: AMY/Report-Logik anbinden.

## Issue 5 — Seed: Stress-Funnel in Datenbank übernehmen

Beschreibung:
Der heutige hartcodierte Stress-Funnel wird als DB-Datensatz angelegt.

AKs:

INSERT/Seed für funnels.

Step(s) für Stress-Funnel erzeugen.

Fragen übernehmen (QUESTIONS-Array).

Fragen mit Step verknüpfen.

# EPIC: v0.3 – Generischer Funnel-Client & Result-Ansichten

Ziel:
Das Frontend soll jeden Funnel dynamisch anhand des Slugs darstellen.
Ergebnisse sollen generisch angezeigt werden.

## Issue 6 — FE: Route /patient/funnel/[slug]

Beschreibung:
Generische Patientenseite für jeden Funnel.

AKs:

Route bauen.

Funnel via API laden.

Fehler-UI bei ungültigem Slug.

## Issue 7 — FE: FunnelFormClient (generische Formular-Komponente)

Beschreibung:
Komponente, die Steps & Fragen dynamisch rendert.

AKs:

State für Antworten.

Required-Validation.

Submit → POST /api/funnel-assessments/[slug].

Redirect auf Result.

## Issue 8 — FE: Result-Seite /patient/funnel/[slug]/result

Beschreibung:
Generische Result-Seite für Funnel-Reports.

AKs:

assessmentId aus Query laden.

Assessment + Report laden.

Score, Risk-Level, AMY-Text anzeigen.

Layout konsistent zur Web-App.

## Issue 9 — Redirect /patient/stress-check → /patient/funnel/stress

Beschreibung:
Legacy-URL weiterleiten.

# EPIC: v0.3 – Parametrisierbares UI & Layout-Framework

Ziel:
Ein zentrales UI-Framework schaffen, sodass Design, Layout und Komponenten konsistent und parametrisierbar sind.

## Issue 10 — UI: Theme-/Design-Modell einführen

Beschreibung:
Zentrales Theme-Objekt (Farben, Spacing, Radius, Typografie).

AKs:

Datei ui/theme.ts erstellen.

Typ RhythmTheme definieren.

defaultTheme bereitstellen.

Theme in UI-Komponenten nutzbar machen.

## Issue 11 — UI: Globales AppLayout + PageShell

Beschreibung:
Einheitliches Layout für alle Seiten der App.

AKs:

Globales Layout definieren.

PageShell-Komponente für Titel & Struktur.

Wichtige Seiten auf PageShell portieren.

## Issue 12 — UI: Basis-Komponentenbibliothek (Button, Card, Heading, Text)

Beschreibung:
UI-Komponenten erstellen, die Theme + Tailwind nutzen.

AKs:

Ordner components/ui/ erstellen.

Buttons, Cards, Headings, Text implementieren.

Funnel-Flows auf neue Komponenten umstellen.

# EPIC: v0.3 – Redaktionelle Content-Seiten (CMS-Light)

Ziel:
Redaktionelle Inhalte (Markdown) im System verwaltbar und darstellbar machen.
Zum Beispiel: „Was ist Stress?“ als Wissensseite.

## Issue 13 — DB: Tabelle content_pages

Beschreibung:
Tabelle für redaktionelle Inhalte.

AKs:

Tabelle content_pages erstellen.

Spalten: slug, title, excerpt, body_markdown, status, layout, timestamps.

Optional: funnel_id als FK.

## Issue 14 — API: GET /api/content/[slug]

Beschreibung:
Content-Seite über API abrufbar machen.

AKs:

Route app/api/content/[slug].

Nur status = 'published' ausliefern.

JSON-Response definieren.

## Issue 15 — FE: Route /content/[slug] – Markdown Rendering

Beschreibung:
Redaktionelle Seite im Frontend anzeigen.

AKs:

Route erstellen.

Content via API laden.

Markdown rendern.

PageShell nutzen.

## Issue 16 — FE: Content in Funnel-Result-Flow verlinken

Beschreibung:
Content-Seiten in Result-Ansichten sichtbar machen (z.B. Stress-Wissen verlinken).

AKs:

CTA „Mehr erfahren“ in Result-Seiten integrieren.

Slug konfigurierbar (z.B. über Funnel).