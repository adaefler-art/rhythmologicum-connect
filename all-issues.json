[{"body":"Scope:\n- docs/counseling/PANEL_V1.md (Panelbeschreibung)\n- docs/counseling/PDF_DOWNLOAD.md (Endpoint, Header, Audit)\n- Smoke-Script: assign clinician, run diagnosis, open panel, download PDF, Mock-Call/Termin, Audit pr√ºfen\n\nAcceptance Criteria:\n- Docs vorhanden & epic-verlinkt\n- Smoke reproducible\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"}],"number":755,"state":"OPEN","title":"E77.8 ‚Äî Docs + Ops Smoke Script Counseling Panel"},{"body":"Ziel: Keine Leaks, nur berechtigte Nutzer auf Counseling-Panel/Daten.\n\nScope:\n- RLS f√ºr diagnosis_runs/artifacts korrekt (E76)\n- API-Endpoint f√ºr PDF: AuthZ assigned clinician/org enforced\n- Patientensummary nur mit erlaubten Feldern\n\nAcceptance Criteria:\n- Unassigned: kein Zugang\n- Assigned: Zugang ok\n- Fehler deterministisch (403/404)\n\nTest Plan:\n- RLS/ACL f√ºr PDF/Panel-Daten testen\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"}],"number":754,"state":"OPEN","title":"E77.7 ‚Äî Access Control Hardening (RLS + API auth) f√ºr Counseling Panel"},{"body":"Ziel: Alle relevanten operativen Aktionen audit-loggen, sowohl Backend als auch UI-Mocks.\n\nScope:\n- Audit-Events: DIAGNOSIS_PDF_DOWNLOADED, MOCK_CALL_STARTED, MOCK_APPOINTMENT_CREATED\n- Optional: UPDATED/CANCELLED if persistiert\n- Pflichtfelder: actor_user_id, role, org_id, entity_type/id, metadata (timestamp, evt. Notizen)\n\nAcceptance Criteria:\n- Aktionen erzeugen Audit-Log-Eintrag\n- Audit Log in DB/UIs sichtbar\n\nTest Plan:\n- Aktionen ausl√∂sen, Eintrag nachpr√ºfen\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"}],"number":753,"state":"OPEN","title":"E77.6 ‚Äî Audit f√ºr operative Aktionen (Downloads, Mock-Calls, Mock-Termine)"},{"body":"Ziel: Clickable Mock-UX f√ºr Termin und Videocall, nur lokal, plausibles UI.\n\nScope:\n- ‚ÄúTermin vorschlagen‚Äù (Modal: Datum/Uhrzeit/Text)\n- ‚ÄúVideocall starten‚Äù (zeigt Meeting-Code, Copy-Button)\n- Keine externen Calls/APIs\n- Audit (mindestens lokal)\n- Datenspeicherung optional\n\nAcceptance Criteria:\n- Mock-Flows nutzbar, crashfrei\n- Keine externen Integrationen\n\nTest Plan:\n- Modals √∂ffnen/schlie√üen, Terminvorschlag absenden\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":752,"state":"OPEN","title":"E77.5 ‚Äî Mock Videocall/Terminmanagement UI (kein Integration)"},{"body":"Ziel: UI-Button im Beratungspanel triggert Download zuverl√§ssig, zeigt Status/Fehler deterministisch.\n\nScope:\n- Download-Button: nur wenn PDF verf√ºgbar/run succeeded\n- Download in neuem Tab/Browser-Download\n- UX States: disabled, Fehleranzeige\n- Provenance (Datum, Model, Prompt-Version optional)\n\nAcceptance Criteria:\n- Download Button erscheint nur bei Erfolg\n- Download liefert echtes PDF\n- Fehler deterministisch/stabil\n\nTest Plan:\n- Queued run ‚Üí Button disabled\n- Succeeded run ‚Üí Download funktioniert\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":751,"state":"OPEN","title":"E77.4 ‚Äî Studio UI: PDF-Download-Button & UX-Kontrakte"},{"body":"Ziel: Endpunkt GET /api/studio/diagnosis-runs/{runId}/download.pdf liefert PDF f√ºr berechtigten Clinician, loggt Audit.\n\nScope:\n- AuthZ: assigned clinician/admin in org\n- PDF aus diagnosis_json\n- Audit log: action, runId, patientId, actor_user_id, role, entity, metadata\n- Optional: caching in diagnosis_artifacts\n\nAcceptance Criteria:\n- Clinician kann PDF downloaden\n- Unassigned denied/no leak\n- Audit Log per Download\n\nTest Plan:\n- Assigned Download klappt\n- Unauthorized denied + kein Leak\n- Audit-Eintrag vorhanden\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"}],"number":750,"state":"OPEN","title":"E77.3 ‚Äî API: Download Diagnose PDF (authz + audit)"},{"body":"Ziel: Diagnose-Artefakt (diagnosis_json) wird zu PDF (Header: Patient, run_id, created_at, prompt/model versions, Summary, DiffDiag, Recommendations, Red flags, Disclaimer)\n\nScope:\n- Funktion: renderDiagnosisPdf(artifactJson, meta) -> PDF Bytes\n- Styling minimal/stabil/ohne Webfonts\n- Fail fast: invalid JSON ‚Üí error code\n- PHI beachten (keine Rohdaten dumps)\n\nAcceptance Criteria:\n- PDF generiert aus realem diagnosis artifact\n- Enth√§lt Kernsektionen + Metadaten\n- Fehlerf√§lle sauber (invalid artifact, missing run)\n\nTest Plan:\n- PDF download √∂ffnet bei bekanntem Artifact\n- Invalid JSON ‚Üí deterministischer Error\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":749,"state":"OPEN","title":"E77.2 ‚Äî PDF Generator v1: Diagnose JSON ‚Üí PDF Render (server-side)"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nZiel: Ein dedizierter Studio-Bereich ‚ÄúBeratung‚Äù/‚ÄúCounseling Panel‚Äù, der zentral pro Patient/Case die Diagnose zug√§nglich macht.\n\nScope:\n- Studio Route(s): Studio ‚Üí Patient Detail ‚Üí Beratung (Tab) oder /counseling/{patientId}\n- Layout: left: Patient summary (minimal), main: latest diagnosis run + status\n- Actions: Download PDF, Mock call, Mock appointment\n- Deterministic UI states: loading/empty/error\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nAcceptance Criteria:\n- Panel erreichbar und performant\n- Zeigt latest diagnosis run status + summary (falls vorhanden)\n- Keine unhandled errors bei missing data\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nTest Plan:\n- Patient ohne run ‚Üí empty state\n- Patient mit succeeded run ‚Üí panel zeigt summary\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report.","labels":[],"number":748,"state":"OPEN","title":"E77.1 ‚Äî Studio Beratungspanel: Navigation + Case-Layout (MVP)"},{"body":"**Epic Ziel:**\nE77 liefert ein operativ nutzbares Beratungspanel im Studio: Ein Clinician kann einen Case √∂ffnen, das Diagnose-Artefakt sehen, ein Diagnose-PDF herunterladen, und einen Mock-Flow f√ºr Videocall/Terminmanagement nutzen. Alle relevanten Aktionen sind auditierbar.\n\n**Gate-Abh√§ngigkeiten:**\n- E76: Diagnose-Runs erzeugen Artefakte (JSON) und sind im Studio sichtbar\n- E75: Anamnese existiert (als Input, optional angezeigt)\n- E73: Legacy ghosting + CI stabil\n- Optional: PDF/Storage-Utilities vorhanden\n\n**SSOT f√ºr E77:**\n- Diagnose: diagnosis_runs, diagnosis_artifacts\n- Audit: audit_log (oder pilot_flow_events)\n\n**Exit Criteria:**\n- Studio Beratungspanel existiert und ist navigierbar\n- Diagnose-Artefakt kann als PDF generiert u. heruntergeladen werden\n- Videocall/Terminmanagement Mock-UI verf√ºgbar\n- Downloads/Mock-Aktionen werden audit-geloggt\n- Zugriff und Auth korrekt (nur assigned clinician/org)\n\n**Ergebnis-Artefakte:**\n- RULES_VS_CHECKS_MATRIX.md, Diff-Report\n- Endpoint-Katalog-Artefakte: docs/api/ENDPOINT_CATALOG.md, ORPHAN_ENDPOINTS.md, UNKNOWN_CALLSITES.md, UNKNOWN_ACCESS_ENDPOINTS.md\n\nüîí Guardrails\n\n- Jede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n- Output eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\n- Ergebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report.\n- \"No endpoints without callsite\" ist als absolute Regel zu hart; erlaubt ist: tempor√§r orphan, aber nur allowlisted + Removal-Ticket (Deadline).\n- G2 ‚Äî Endpoint Catalog Gate (Orphans/Unknown) ist verbindlich\n- G3 ‚Äî DB Migration Idempotency Gate ist verbindlich\n- G4 ‚Äî ‚ÄúLint changed lines‚Äù darf keine generierten Artefakte linten\n- G5 ‚Äî Mobile-v2 Surface Isolation (kein Legacy im (mobile))\n- G6 ‚Äî Content ist ‚Äúecht‚Äù (kein Mock/Build-Time), Verhalten ist deterministisch\n- G7 ‚Äî Legacy Ghosting ist verpflichtend, um Drift sofort sichtbar zu machen.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"}],"number":747,"state":"OPEN","title":"EPIC E77 ‚Äî Studio Beratungspanel inkl. Diagnose-PDF und Mock-Termin/Videocall (Release v0.7)"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nDeveloper-Doku/Runbooks:\n- MCP_SERVER.md (Run/ENV)\n- ARTIFACT_SCHEMA_V1.md\n- SECURITY_MODEL.md\n- Troubleshooting: LLM_ERROR, VALIDATION_ERROR, AUTH_ERROR\n- Check Alignment: Mapping rules‚Üîchecks (Policytests, Schamavalidierungen)\n- Onboarding Steps f√ºr lokale Ausf√ºhrung\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nAcceptance/Test:\n- Doku vorhanden, Onboarding erfolgreich, Mapping dokumentiert\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":746,"state":"OPEN","title":"E76.9 ‚Äî Docs & Developer Runbook (Failsafe f√ºr Checks)"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nDeterministische Berechnung des inputs_hash aus Context Pack (Stable/Sortierung). Dedupe-Policy implementieren (A: allow duplicates always, Warnung; oder B: innerhalb Zeitfenster only). inputs_meta mit Referenzen/IDs persistieren.\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nAcceptance/Test:\n- inputs_hash stabil (gleicher Zustand = gleiche Hash)\n- Dedupe-Policy greift deterministisch\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":745,"state":"OPEN","title":"E76.8 ‚Äî Determinismus & Idempotenz: inputs_hash + Dedupe Policy"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nRLS-Policies f√ºr diagnosis_runs, diagnosis_artifacts: Zugriffsregeln, Auditlog (run/artifact created, artifact viewed/downloaded). Nur zugewiesene Personen, keine Leaks, Korrekte Audit-Dokumentation.\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nAcceptance/Test:\n- Zugriff NUR f√ºr Assignments\n- Audit events und Policy-Tests\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":744,"state":"OPEN","title":"E76.7 ‚Äî Security/RLS + Audit f√ºr Diagnose"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nUI-Komponenten (Studio): Tab ‚ÄúDiagnosis‚Äù bei Patient, ListView aller Runs (Status/Timestamp), Detailansicht mit Summary + JSON-Render. Robuste Status (loading/empty/error), keine PDF (E77).\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nAcceptance/Test:\n- Run starten, View nach Erfolg\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":743,"state":"OPEN","title":"E76.6 ‚Äî Studio UI: Diagnose Runs + Artifact Viewer (JSON)"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nDefiniere Prompt-B√ºndel (prompt_bundle_version/prompt_version) und JSON Schema v1 f√ºr Diagnose-Artefakte:\n- summary, patient_context_used, differential_diagnoses (mit rationale/confidence), recommended_next_steps, urgent_red_flags, disclaimer.\n- Explizite Anweisung: Kein Medical Advice, nur zur Pr√ºfung durch Clinician.\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nAcceptance/Test:\n- Prompt+Schema dokumentiert und validiert gegen Output\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":742,"state":"OPEN","title":"E76.5 ‚Äî Prompt v1 (Diagnosis JSON Spec) + Output Schema Contract"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nWorker (cron/job/queue) f√ºr queuete Diagnose-Runs: Setzt Status, holt Context Pack, ruft LLM/MCP, persistiert Artefakt (bei Fehler: Status failed inkl. Error-Payload). Konkurenz vermeiden, minimale Schema-Validation (diagnosis JSON), sensible Daten only restricted accessible.\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nAcceptance/Test:\n- Run verarbeitet, Artefakt geschrieben\n- Invalides Ergebnis: Status failed mit VALIDATION_ERROR\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":741,"state":"OPEN","title":"E76.4 ‚Äî Execution Worker: Diagnose-Run ausf√ºhren + Artefakt persistieren"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nImplementiere Studio-API-Endpunkte f√ºr Diagnose-Runs:\n- POST /api/studio/patients/{patientId}/diagnosis-runs\n- GET /api/studio/patients/{patientId}/diagnosis-runs\n- GET /api/studio/diagnosis-runs/{runId}\n- GET /api/studio/diagnosis-runs/{runId}/artifacts\n- GET /api/studio/diagnosis-artifacts/{artifactId}\nZustandsmaschine: queued ‚Üí running ‚Üí succeeded|failed. Auth: Nur zugewiesener Clinician/Admin.\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nAcceptance/Test:\n- Run erstellen, Lifecycle durchlaufen, Zugriffsrechte korrekt enforced\n- Dedupe: gleiche Inputs innerhalb Zeitfenster optional\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":740,"state":"OPEN","title":"E76.3 ‚Äî Runs API (Studio): Create/Read/List + State Machine"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nImplementierung des standardisierten \"Patient Context Pack\" als Input f√ºr LLM ‚Äì beinhaltet Anamnese, ausgew√§hlte History, Funnel-Runs, aktuelle Results, Provenance-Metadata. Begrenzung des Outputs (z. B. max 30 Anamnese-Entries, max 2 Runs je Funnel) zwingend. Deterministischer, stabiler inputs_hash.\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nAcceptance/Test:\n- Context Pack enth√§lt richtige Daten\n- Hash-Berechnung ist stabil und korrekt\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":739,"state":"OPEN","title":"E76.2 ‚Äî Context Pack Builder v1 (Anamnese + Funnel Runs + Results)"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nMCP-Server als eigenst√§ndiger Service/Process, startbar mit Health-Endpoint und deterministischer Tool-API.\n\nScope:\n- Eigenes MCP-Server-Projekt/Package (startbar, Health-Endpoint, Logging)\n- Tool-API: get_patient_context(patient_id), run_diagnosis(patient_id, options)\n- MCP Tool-Responses deterministisch schema-basiert (zod/json schema)\n- Logging: correlation id = run_id\n- Secrets: LLM-API-Key via ENV, keine Leakage in Logs\n- Versioning (mcp_server_version, run_version, prompt_version)\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nAcceptance/Test:\n- Server startbar/Health-Check\n- Tools liefern stubbed Response\n- Version-Metadata-Ausgabe\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":738,"state":"OPEN","title":"E76.1 ‚Äî MCP Server Skeleton + Tooling Contract"},{"body":"Ziel:\nE76 liefert ein echtes, startbares Diagnose-System als MCP Server mit LLM-Integration, das aus Anamnese (E75) + Funnel Runs (E74) strukturierte Diagnose-Artefakte erzeugt, persistiert und im Studio sichtbar macht. Noch ohne medizinisches Guardrailing/Regelwerk (kommt sp√§ter), aber technisch sauber: deterministisch, versioniert, auditierbar, idempotent.\n\nAbh√§ngigkeiten:\n- E75: Anamnese API + Speicher + Zugriff/Assignments\n- E74: Funnel A/B Runs + answers + SSOT Results\n- E73: Legacy Ghosting + stabile API Ownership + CI Hardening\n\nData Model (verbindlich):\nTabellen:\n- diagnosis_runs\n- diagnosis_artifacts\n(Vgl. detaillierte Struktur im Prompt)\n\nExit Criteria (DoD):\n- Diagnose-Run startbar (Studio), vollst√§ndiger Lifecycle, Artefakt persistiert\n- Audit/Provenance vorhanden, keine Legacy-Abh√§ngigkeiten\n- Stabiler Contract: Reruns idempotent/traceable, Failure States erkl√§rbar\n\nArtefakte:\n- RULES_VS_CHECKS_MATRIX.md + Diff-Report\n- docs/api/ENDPOINT_CATALOG.md\n- ORPHAN_ENDPOINTS.md\n- UNKNOWN_CALLSITES.md\n- UNKNOWN_ACCESS_ENDPOINTS.md\n- docs/diagnosis/MCP_SERVER.md\n- docs/diagnosis/ARTIFACT_SCHEMA_V1.md\n- docs/diagnosis/SECURITY_MODEL.md\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (schnelle Diagnose).\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":737,"state":"OPEN","title":"EPIC E76 ‚Äî Diagnose Agentic System v1 (MCP Server + LLM Integration) ‚Äî Release v0.7 Plan"},{"body":"Ziel\nVerhindert Drift: Anamnese Schema + API contract + UI mapping klar dokumentiert & checks‚Üîguardrails abgedeckt.\n\nScope\n- docs/anamnesis/SCHEMA_V1.md: entry types, required fields\n- docs/anamnesis/API_V1.md: endpoints & status codes\n- docs/anamnesis/SECURITY_MODEL.md (RLS, assignments)\n- Minimal ‚ÄûRLS Smoke Script‚Äú + CI-Docs-Link\n- Mapping rules ‚Üî checks (RLS-Test=Rule ID)\n\nAcceptance Criteria\n- Docs vorhanden und in Issues referenziert\n- Manueller Test-Script existiert, l√§uft gr√ºn\n\nüîí Guardrails\nJede Regel hat Check-Implementierung (Script/CI) und umgekehrt, jeder Check referenziert Regel-ID. Ergebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check/checks-without-rule/scope mismatch). Output eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"}],"number":736,"state":"OPEN","title":"E75.7 ‚Äî Contract + Docs + Check Alignment (minimizes future failures)"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\nZiel\nExportierbarkeit (min. JSON) f√ºr Patient/Clinician, korrekt scoped.\n\nScope\n- Endpoint:\n   * GET /api/patient/anamnesis/export.json\n   * GET /api/studio/patients/{patientId}/anamnesis/export.json\n- Payload: entries (letzte Version), Option: ?include_versions=true, Metadata: generated_at, patient_id, org_id\n- Audit-Export-Event\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\nNon-Goals\n- Kein PDF/FHIR Export (sp√§ter)\n\nAcceptance Criteria\n- Endpoint liefert korrekt und compliant\n- JSON-Schema stabil/dokumentiert\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\nTest Plan\n- Patient-Export nur eigene Daten\n- Clinician-Export nur assigned\n\nüîí Guardrails\nJede Regel hat Check-Implementierung (Script/CI) und umgekehrt, jeder Check referenziert Regel-ID. Ergebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check/checks-without-rule/scope mismatch). Output eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).","labels":[],"number":735,"state":"OPEN","title":"E75.6 ‚Äî Export v1: JSON Export (Patient + Clinician)"},{"body":"Ziel\nFunnel/Assessment-Daten k√∂nnen als system-generated summary Eintrag in Anamnese gespeichert werden.\n\nScope\n- Nach Assessment-Completion: create/update anamnesis_entries vom Typ funnel_summary\n- Referenzen: funnel_slug/version, assessment_id, key answers, results summary\n- Policy: Ein Summary je (patient, funnel, assessment) oder rollierend, Provenienz speichern\n\nNon-Goals\n- Kein narrative Clinical Writing\n- Kein Merging √ºber Funnels\n\nImplementation Notes\n- Idempotent: Reprocessing erzeugt keine Duplikate\n- F√ºr E76 (Diagnose-Bridge): Struktur klar\n\nAcceptance Criteria\n- Completion erstellt summary entry\n- Reprocessing ‚Üí keine Duplikate\n- Clinician sieht Eintrag\n\nTest Plan\n- Assessment complete ‚Üí summary\n- Re-run job ‚Üí 1 summary\n\nüîí Guardrails\nJede Regel hat Check-Implementierung (Script/CI) und umgekehrt, jeder Check referenziert Regel-ID. Ergebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check/checks-without-rule/scope mismatch). Output eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWpPg","name":"integration","description":"","color":"ededed"}],"number":734,"state":"OPEN","title":"E75.5 ‚Äî Funnel ‚Üí Anamnese Integration (Summaries as entries)"},{"body":"Ziel\nClinician sieht Patient-Anamnese und kann Eintr√§ge erg√§nzen.\n\nScope\n- Studio patient detail: Anamnese tab\n  * list + latest versions\n  * add clinician note/diagnosis/medication\n  * append/edit/archive\n  * Access nur via Assignment\n\nNon-Goals\n- Kein Bulk-Import\n- Kein Approvals\n\nAcceptance Criteria\n- Clinician kann assigned ansehen/erg√§nzen\n- Patient kann sehen\n- Unassigned ‚Üí denied\n\nTest Plan\n- Assign clinician ‚Üí okay\n- Remove assignment ‚Üí denied\n\nüîí Guardrails\nJede Regel hat Check-Implementierung (Script/CI) und umgekehrt, jeder Check referenziert Regel-ID. Ergebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check/checks-without-rule/scope mismatch). Output eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\n","labels":[],"number":733,"state":"OPEN","title":"E75.4 ‚Äî Studio UI: Clinician Anamnese View + Entry Add/Edit"},{"body":"Ziel\nPatient kann Anamnese sehen und minimal bearbeiten.\n\nScope\n- Anamnese-Screen (mobile v2):\n   * list grouped nach entry_type/Datum\n   * entry detail (letzte Version)\n   * Add (MVP Form)\n   * Edit = neue Version\n   * Archive\n   * Deterministische UI states: loading/empty/error/offline\n\nNon-Goals\n- Komplexe Forms (nur 3‚Äì5 Typen)\n- Keine rich Filters\n\nImplementation Notes\n- Form mapped zu entry_type: symptom, medication, note, allergy (Start)\n- UI zeigt ‚Äûlast updated/creator‚Äú\n\nAcceptance Criteria\n- Patient add/update/view\n- √Ñnderungen persistiert\n- Kein Legacy in (mobile)\n\nTest Plan\n- Add ‚Üí erscheint\n- Edit ‚Üí neue Version\n\nüîí Guardrails\nJede Regel hat Check-Implementierung (Script/CI) und umgekehrt, jeder Check referenziert Regel-ID. Ergebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check/checks-without-rule/scope mismatch). Output eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\n","labels":[],"number":732,"state":"OPEN","title":"E75.3 ‚Äî Patient UI: Anamnese Timeline v1"},{"body":"Ziel\nAPI liefert deterministisches Verhalten, erzeugt Versions korrekt.\n\nScope\nPatient:\n- GET /api/patient/anamnesis (list heads)\n- GET /api/patient/anamnesis/{entryId} (inkl. Versions)\n- POST /api/patient/anamnesis (neu + version 1)\n- POST /api/patient/anamnesis/{entryId}/versions (neue Version)\n- POST /api/patient/anamnesis/{entryId}/archive\nStudio/Clinician:\n- GET /api/studio/patients/{patientId}/anamnesis\n- POST /api/studio/patients/{patientId}/anamnesis\n- POST /api/studio/anamnesis/{entryId}/versions\n- POST /api/studio/anamnesis/{entryId}/archive\n\nDeterministische Fehler:\n- 404 bei nicht zug√§nglich\n- 403 f√ºr Role-Verletzung\n- 409 bei Update auf archiviert (optional)\n\nImplementation Notes\n- Create: head+version 1 in Transaktion\n- Update: neue Version + head.updated_at\n- Validation: schema by entry_type, max size f√ºr jsonb\n\nAcceptance Criteria\n- Patient kann CRUD auf eigene\n- Clinician f√ºr zugewiesene Patienten\n- Update immer neue Version\n- API gibt latest+Versions deterministisch zur√ºck\n\nTest Plan\n- Create, dann update‚ÜíVersion 1..3\n- Archive‚Üíupdate‚Üí409 (wenn Policy)\n- Unauthorized‚Üí404/403\n\nüîí Guardrails\nJede Regel hat Check-Implementierung (Script/CI) und umgekehrt, jeder Check referenziert Regel-ID. Ergebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check/checks-without-rule/scope mismatch). Output eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":731,"state":"OPEN","title":"E75.2 ‚Äî Anamnese API v1 (Patient + Studio): CRUD via versioning"},{"body":"Ziel\nNeue Tabellen + Policies so, dass:\n- Patient sieht/bearbeitet nur eigene Eintr√§ge\n- Clinician sieht Eintr√§ge f√ºr zugewiesene Patienten\n- Orgs/Assignments werden ber√ºcksichtigt\n- Keine Cross-Org Leaks\n\nScope\nMigrations f√ºr:\n- create anamnesis_entries\n- create anamnesis_entry_versions\n- Indexes: (patient_id, updated_at desc), (entry_id, version desc)\n- RLS-Policies (Supabase/Postgres):\n   * Patient: patient_profiles.user_id = auth.uid()\n   * Clinician: Zugriff wenn clinician_patient_assignments.clinician_user_id = auth.uid()\n   * Admin: via org membership\n- Audit: insert/update ‚Üí audit_log (oder bestehend)\n\nNon-Goals\n- Kein Feld-basiertes Access\n- Kein Multi-Org patient federation\n\nImplementation Notes\n- Versionen immutable (no update, nur neuer Insert)\n- anamnesis_entries.updated_at ist latest version timestamp\n- Migration idempotent (DROP/CREATE IF NOT EXISTS, guarded)\n\nAcceptance Criteria\n- Tabellen/Migration Rerunnable\n- RLS sch√ºtzt korrekt (Patient A sieht nicht B)\n- Clinician Zugriff nur via Assignment\n- Admin kann via Org (wenn gew√ºnscht)\n\nTest Plan\n- RLS-Test-Scripts: eigene Eintr√§ge ja, fremde nein\n- Clinician assigned: Zugang ja, sonst nein\n- Admin in Org: Zugang ja (falls gew√ºnscht)\n\nüîí Guardrails\nJede Regel hat Check-Implementierung (Script/CI) und umgekehrt, jeder Check referenziert Regel-ID. Ergebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check/checks-without-rule/scope mismatch). Output eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNNISw","name":"db","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"}],"number":730,"state":"OPEN","title":"E75.1 ‚Äî DB Schema: Anamnese Tables v1 + RLS/Access Model"},{"body":"Epic Ziel\n\nE75 etabliert eine dauerhafte, versionierte, auditierbare Anamnese als gemeinsame Wissensbasis f√ºr Patient und Clinician. Sie ist scoped (Org/Assignments), SSOT-f√§hig (kein patient_state als ‚Äúdumping ground‚Äù f√ºr medizinische Inhalte) und exportierbar (mind. JSON). E75 liefert die Grundlage f√ºr E76 (Diagnose via MCP/LLM).\n\nAbh√§ngigkeit (Gate):\nE75 setzt voraus:\n- E73: Legacy ghosting + SSOT Results + stabile Patient/Studio Basis\n- E74: Funnels A/B laufen produktiv, Antworten sind persistiert (assessment_answers) und clinician-sichtbar\n\nSSOT f√ºr E75 (prim√§r neu): anamnesis_* (siehe Modell unten), Referenzen: patient_profiles / auth.users, organizations, clinician_patient_assignments, user_org_membership. Optional Link zu Funnel Runs: assessments, assessment_answers, calculated_results.\n\nEpic Exit Criteria (Definition of Done):\n- Patient kann Anamnese-Eintr√§ge anlegen/√§ndern & Timeline sehen\n- Clinician sieht identische (scoped) Timeline, kann eigene Eintr√§ge hinzuf√ºgen\n- √Ñnderungen sind versioniert & auditierbar (wer/was/wann)\n- Export (mind. JSON) funktioniert\n- Zugriff ist korrekt (RLS/role-gated), keine Datenleaks\n- Diagnose (E76) kann Anamnese deterministisch abrufen\n\nüîí Guardrails\nJede Regel hat Check-Implementierung (Script/CI) und umgekehrt, jeder Check referenziert Regel-ID. Ergebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check/checks-without-rule/scope mismatch). Output eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten (f√ºr schnelle Diagnose).\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"}],"number":729,"state":"OPEN","title":"EPIC E75 ‚Äî Anamnese-Speicher (Patient + Arzt)"},{"body":"CI-Drift zwischen Definition/Editor/Runner verhindern; Doku und Check-Mapping aktualisieren, End-to-end-Testscript dokumentiert.\n\n**Scope:**\n- docs/funnels/DEFINITION_V1.md (Schema + Beispiele)\n- docs/funnels/START_RESUME_SEMANTICS.md\n- docs/funnels/STUDIO_PUBLISH_GATES.md\n- Update rules-vs-checks matrix: Mapping Check ‚Üí Rule-ID\n- Ein End-to-End-Testscript f√ºr Manual-Test\n\n**Acceptance:**\n- Dokumente sind vorhanden und referenziert\n- Validator-Check ist an Rule-ID gebunden\n- Neuer Dev kann End-to-End-Test ausf√ºhren\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten. Matrix + Diff-Report: RULES_VS_CHECKS_MATRIX.md\nWeitere Guardrail-Details siehe Epic/CI-Doku.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"}],"number":727,"state":"OPEN","title":"E74.9 ‚Äî Contract/Docs + Check alignment (reducing future failures)"},{"body":"Clinician-Sicht: Runs/Assessement-Verlauf, Antworten, Status und Ergebnis zusammengefasst, Zugriffsregeln wie Patient-History.\n\n**Scope:**\n- Studio: Run-Timeline, Status, Antworten, Ergebnis\n- Optional: processing/ready Status\n- RBAC: nur sichtbare Patienten\n\n**Acceptance:**\n- Clinician sieht alle Runs, Antworten & Resultate\n- Resultats-Zusammenfassung bei readiness\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten. Matrix + Diff-Report: RULES_VS_CHECKS_MATRIX.md\nWeitere Guardrail-Details siehe Epic/CI-Doku.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"}],"number":726,"state":"OPEN","title":"E74.8 ‚Äî Clinician View v1: Funnel Run Timeline + Answers + Result Summary"},{"body":"Eliminiert doppelte Assessment-Runs, kl√§rt klare Resume/Create-Semantik auf Server-Seite.\n\n**Scope:**\n- API: RESUME_OR_CREATE default, atomare Policy, Locking\n- Explizit neuer Run nur mit extra Flag/Endpoint\n- Server-seitig: EIN in-progress assessment pro patient+funnel\n\n**Acceptance:**\n- Parallel/Repeat startet NICHT zweites Assessment\n- Explizit neuer Run schlie√üt vorheriges korrekt ab\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten. Matrix + Diff-Report: RULES_VS_CHECKS_MATRIX.md\nWeitere Guardrail-Details siehe Epic/CI-Doku.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":725,"state":"OPEN","title":"E74.7 ‚Äî Start/Resume Idempotency: No duplicate runs, deterministic ‚Äúnew vs resume‚Äù"},{"body":"Studio kann Patienten zu Funnel A/B zuweisen/steuern (active/paused/completed), UI und API werden erweitert.\n\n**Scope:**\n- patient_funnels: Assignment, version pointer, Statuswechsel\n- Studio-UI: Assignments view, Status toggle\n- Audit-log f√ºr √Ñnderungen\n- Authorization: nur eigene Patienten\n\n**Acceptance:**\n- Zuordnung, Pausierung, Abschluss, Versionselektion bedienbar\n- Nur auf authorisierte Nutzer beschr√§nkt\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten. Matrix + Diff-Report: RULES_VS_CHECKS_MATRIX.md\nWeitere Guardrail-Details siehe Epic/CI-Doku.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":724,"state":"OPEN","title":"E74.6 ‚Äî Steering/Assignment: patient_funnels lifecycle + org scoping"},{"body":"Antworten und Fortschritt werden zuverl√§ssig persistiert, Resume ist deterministisch und doppelte Runs werden vermieden.\n\n**Scope:**\n- Antworten per assessment_id + question_key upsert/idempotent speichern\n- Progress: assessments.current_step_id oder state_data konsistent\n- Resume: In-progress Assessment rekonstruieren/snapshoten\n- Save-Endpoint retry-safe, keine Duplikate\n\n**Acceptance:**\n- Refresh ‚Üí Resume auf gleicher Step/Antwort m√∂glich\n- Doppelklick save erzeugt keine Duplikate\n- Migrationen idempotent\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten. Matrix + Diff-Report: RULES_VS_CHECKS_MATRIX.md\nWeitere Guardrail-Details siehe Epic/CI-Doku.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":723,"state":"OPEN","title":"E74.5 ‚Äî Persistenz: Answers + Progress (SSOT) + Resume deterministisch"},{"body":"Patient kann Funnel A/B gem√§√ü canonical schema ausf√ºhren: Schritt-f√ºr-Schritt, mit validierung und Resume.\n\n**Scope:**\n- Runner UI: Steps (Fragen + Content) aus Definition, Validierung, Navigation\n- Conditional visible/required rules\n- Resume bestehender Assessment/run\n- Fehlerstate: loading/empty/offline deterministisch (E71-Stil)\n- Kein Build-time Content im Runner\n\n**Acceptance:**\n- Start/Walkthrough: Funnel A/B sind komplett durchf√ºhrbar, validation blocks, Resume funktioniert\n- States deterministisch\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten. Matrix + Diff-Report: RULES_VS_CHECKS_MATRIX.md\nWeitere Guardrail-Details siehe Epic/CI-Doku.","labels":[],"number":722,"state":"OPEN","title":"E74.4 ‚Äî Patient Funnel Execution UI v1 (Step Runner aus Definition)"},{"body":"Studio erlaubt strukturierte Bearbeitung von Funnel-Definitionen und sicheres Publizieren.\n\n**Scope:**\n- Studio-UI: List/Edit/Draft/Publish/Versioning f√ºr Funnel-Definitionen (JSON-Editor minimal)\n- Validierung via E74.1, errors anzeigen\n- Draft clonen + editieren + publish pointer setzen (atomic)\n- Audit: Audit-Log mit Diff bei publish\n\n**Acceptance:**\n- Edit/Draft/Publish aktualisiert Datasets & Pointer\n- Invalid Draft blockt Publish mit Fehler\n- Patient sieht nur published version\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten. Matrix + Diff-Report: RULES_VS_CHECKS_MATRIX.md\nWeitere Guardrail-Details siehe Epic/CI-Doku.","labels":[],"number":721,"state":"OPEN","title":"E74.3 ‚Äî Studio Funnel Editor v1 (Draft/Edit/Publish/Versioning)"},{"body":"Die vorhandenen 4 Funnel-Datens√§tze werden in canonical v1 √ºberf√ºhrt; zwei davon als Funnel A/B festgelegt (default, patient-visible).\n\n**Scope:**\n- Data cleanse: Slug uniqueness, pillar mapping\n- funnel_versions mit canonical v1 JSON\n- default_version_id f√ºr A/B\n- Mapping: Welche zwei sind official release, welche archived\n- Wiederholbar/idempotent als Migration/Script\n- source provenience vermerken\n\n**Acceptance:**\n- Funnel A/B default + API liefert canonical v1\n- Migrations idempotent, keine legacy tables genutzt\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten. Matrix + Diff-Report: RULES_VS_CHECKS_MATRIX.md\nWeitere Guardrail-Details siehe Epic/CI-Doku.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":720,"state":"OPEN","title":"E74.2 ‚Äî Backfill/Migration: 4 Datens√§tze ‚Üí canonical v1 ^Z zwei als ‚ÄúA/B‚Äù"},{"body":"Ein kanonischer, versionierter Definition-Contract, der:\n- f√ºr Patient UI ausf√ºhrbar ist\n- im Studio editierbar ist\n- deterministisch validiert werden kann (CI/Check)\n\n**Scope:**\n- Definition in funnel_versions.questionnaire_config + content_manifest (Split klar definieren)\n- Mindestens: Metadata, Steps, Questions, Rules (conditionals), Navigation Logik\n- Server-Side Validator (z. B. Zod):\n  - Validiert JSON schema + referentielle Integrit√§t\n  - Liefert deterministische Fehler-Codes (z. B. DEF_MISSING_STEP_TITLE)\n- Muss versioniert sein (schema_version: \"v1\")\n- Kein Publish ohne valid Schema\n- Keine Versuche invalid zu publishen zulassen\n\n**Acceptance:**\n- Validator rejectet invalid configs\n- Studio Publish blockt ung√ºltige mit Fehlerlist & Codes\n- Patient Definition API liefert v1\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten. Matrix + Diff-Report: RULES_VS_CHECKS_MATRIX.md\nWeitere Guardrail-Details siehe Epic/CI-Doku.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":719,"state":"OPEN","title":"E74.1 ‚Äî Canonical Funnel Definition Schema v1 (contract + validator)"},{"body":"**Ziel:**\nDas Funnel-System wird produktiv und steuerbar gemacht: Zwei Funnels (A & B) sind editierbar (Studio), zuweisbar (Steuerung), durchlaufbar (Patient), persistiert (answers) und f√ºr Clinicians sichtbar ‚Äì alles SSOT-konform und ohne Legacy-Abh√§ngigkeiten.\n\n**Abh√§ngigkeiten:**\n- Basierend auf stabilem Result API Contract (ready/processing/in_progress)\n- Legacy-Komponenten m√ºssen ghosted/isoliert, Content v1 ver√∂ffentlicht sein\n- SSOT: funnels_catalog, funnel_versions, assessments, assessment_answers, funnel_question_rules, calculated_results\n\n**Exit Criteria:**\n- Funnel A/B sind editierbar, zuweisbar, durchlaufbar, sichtbar und entsprechen SSOT\n- Keine Legacy-Reexports/Abh√§ngigkeiten\n- CI/Checks: Allowlist/Orphan-Gate, Migrations-idempotency, Lint excludes sind erf√ºllt\n\n**Issues:**\n- Canonical Definition Contract & Validator\n- Datensatz-Migrationen + Defaults\n- Studio Editor (Draft/Edit/Publish)\n- Patient Runner UI\n- Answers Persistenz/Resume\n- Steuerung/Assignment\n- Start/Resume Idempotenz\n- Clinician View: Runs & Ergebnisse\n- Docs/Checks-Alignment\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\nOutput eines Checks muss ‚Äûviolates R-XYZ‚Äú enthalten. Matrix + Diff-Report: RULES_VS_CHECKS_MATRIX.md\nWeitere Guardrail-Details siehe Einzelissues/CI-Doku.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"}],"number":718,"state":"OPEN","title":"Epic E74 ‚Äì Zwei Funnels vollst√§ndig & steuerbar (Release v0.7 Plan v7)"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\n**Labels:** ci, v0.7, priority:high\n\n### Ziel\nCI-Workflow verhindert Fails durch generated files (insb. .next/types/*.d.ts etc.) bei Lint auf changed files, bleibt effektiv f√ºr echte Sources.\n\n### Scope\n- Filter changed TS/TSX: exclude .next/**, node_modules/**, dist/**, build/**, .turbo/**, out/**, .vercel/**, coverage/**, artifacts/**\n- Wenn nach Filter nichts bleibt: produzierte report artefacts deterministic empty\n- Optional: .eslintignore enth√§lt auch diese excludes\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\n### Acceptance Criteria\n- PRs failen nicht mehr an generated Types\n- Lint-Gate bleibt f√ºr echte TS-Sources bestehen\n- Pipeline stabil auch bei leeren TS-Changes\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\n### Test Plan\n- Diff simulieren nur .next/types ‚Üí Lint ignoriert\n- PR ohne TS-Changes ‚Üí Pipeline produziert g√ºltige Empty Reports\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":717,"state":"CLOSED","title":"E73.10 ‚Äî CI Hardening: Changed-lines ESLint must exclude generated artifacts (reduce failures)"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\n**Labels:** studio-ui, patient-ui, design, v0.7, priority:medium\n\n### Ziel\nStudio kann Patient UI ‚Äútunen‚Äù (Tokens + component/page config), Patient l√§dt config and √ºbernimmt Ver√§nderungen.\n\n### Scope\n- Design Tokens Editor (bestehend)\n- Page/Component config: Speicherung als design_tokens-Eintrag unter Konvention\n- Patient: GET /api/patient/design gibt gemergte tokens zur√ºck, Anwendung im Dashboard\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\n### Acceptance Criteria\n- Studio edit ‚Üí save tokens/config\n- Patient reload zeigt √Ñnderungen\n- Dashboard: mindestens 1 sichtbarer Effekt\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\n### Test Plan\n- Token setzen ‚Üí UI √§ndert sich\n- Token entfernen ‚Üí coole Defaults treten in Kraft\n\n### Implementation Notes\n- org-scoped\n- safe defaults, validierung\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":716,"state":"CLOSED","title":"E73.9 ‚Äî Studio Design Tool v1 (Tokens + Page/Component Config), Patient applies"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\n**Labels:** patient-ui, llm, v0.7, priority:medium\n\n### Ziel\nAMY ist ein Dashboard-Chat mit LLM-Antwort; keine Steuerung, kein Funnel-Start, keine Navigation.\n\n### Scope\n- API: POST /api/amy/chat\n- Patientenstatus- oder eigene Tabelle f√ºr chat log\n- UI: chat widget\n- Keine Funnel/Assessment-Endpoint-Aktionen, keine Steuerung\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\n### Acceptance Criteria\n- Chat antwortet per LLM\n- Conversation persists √ºber reload\n- Keine Side Effects\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\n### Test Plan\n- Chat ‚Üí reload ‚Üí Verlaufsdaten erhalten\n- Network-Monitor: nur amy endpoints\n\n### Implementation Notes\n- Keine Steuerung: Server darf keine Mutationen von Assessment/Funnel endpoints aufrufen\n- Optional: system prompt mit \"I cannot perform actions\"\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":715,"state":"CLOSED","title":"E73.8 ‚Äî AMY Frontdesk Chat (LLM), ohne Steuerung"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\n**Labels:** content, studio-ui, patient-ui, v0.7, priority:medium\n\n### Ziel\nEchter Content im System: Studio kann Draft/Publish, Patient sieht nur published, deterministische 404.\n\n### Scope\n- Studio pages: list, detail editor, draft/publish\n- Patient API: GET /content/{slug} returns published only, 404 sonst\n- Renderer: section types v1 minimal (title, markdown, etc.)\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\n### Acceptance Criteria\n- Published content in Patient sichtbar\n- Unpublished/missing strikt 404\n- Studio publish changes visible after reload\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\n### Test Plan\n- Create Draft ‚Üí 404 (Patient)\n- Publish ‚Üí 200 (Patient)\n- Unpublish ‚Üí wieder 404\n\n### Implementation Notes\n- draft/published Felder\n- deterministic 404 (no fallback)\n- kein Build-time content, Patient UI ‚Üí runtime fetch\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":714,"state":"CLOSED","title":"E73.7 ‚Äî Content System v1: Studio CRUD + Publish, Patient published-only (deterministisch)"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\n**Labels:** infra, refactor, v0.7, priority:high\n\n### Ziel\nLegacy wird isoliert, damit produktiver Code keine Imports erlaubt und Legacy-Routen sofort gebrochen (410) liefern. DB-Kit separat dokumentiert.\n\n### Scope\n- /legacy/ Verzeichnisstruktur: code, routes (410-Stub), db (README + SQL)\n- ESLint no-restricted-imports auf legacy/**\n- Root tsconfig excludes legacy/**\n- Legacy API routes return 410 mit JSON: {error:'LEGACY_GHOSTED', route:'...'}\n- Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\n### Acceptance Criteria\n- CI bricht, wenn produktiver Code legacy/** importiert\n- Legacy-Endpunkte 410 + error code\n- Drop-Kit vorhanden pro legacy cluster\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\n### Test Plan\n- absichtlicher Import test (should fail lint)\n- call legacy endpoint returns 410\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":713,"state":"CLOSED","title":"E73.6 ‚Äî Legacy Ghosting Framework (Code + Routes + DB Drop-Kit)"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\n**Labels:** patient-ui, studio-ui, v0.7, priority:high\n\n### Ziel\nPatient History und Studio/Clinician Views zeigen completed assessments und deren Ergebnisse konsistent (SSOT), ohne Refresh-Glitches.\n\n### Scope\n- Patient History listet completed assessments mit Ergebnissen\n- Studio/Clinician: analog, per assignment\n- show only sichtbar (completed + result exists)\n  - Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\n### Acceptance Criteria\n- Completed+ready erscheinen in Patient History\n- Gleiches in Studio/Clinician\n- Keine Verwendung von legacy measures\n- Kein Refresh n√∂tig\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\n### Test Plan\n- End-to-end: complete ‚Üí processing ‚Üí results appear both UIs\n\n### Implementation Notes\n- Sichtbarkeit: default only ready, optional processing separat\n- Query Performance: assessment_id in calculated_results\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":712,"state":"CLOSED","title":"E73.5 ‚Äî History + Studio/Clinician: SSOT Join, konsistente Sichtbarkeit"},{"body":"**Strategy A ‚Äì Vertical Slice Requirements**\n- Endpoint changes require at least one literal callsite in the same PR (fetch('/api/...') literal).\n- If feature is not live: gate callsite behind a feature flag, but keep the literal string.\n- External-only endpoints: allowlist entry with justification.\n\n**Labels:** backend, patient-api, v0.7, priority:high\n\n### Ziel\nGET ‚Ä¶/result liefert SSOT aus calculated_results, oder liefert kontrolliert ‚Äúprocessing‚Äù wenn noch nicht vorhanden. Keine POC-only result source als primary.\n\n### Scope\n- Update GET /api/funnels/{slug}/assessments/{assessmentId}/result:\n  - fetch assessment; verify access\n  - if status != completed ‚Üí 409/422\n  - if completed but no calculated_results ‚Üí 409 processing\n  - else return from calculated_results\n  - Minimal wiring (flagged) ist Teil dieses Issues/PR.\n\n### Acceptance Criteria\n- completed & results ‚Üí 200, SSOT payload\n- completed & results fehlen ‚Üí 409 processing, kein throw-stack\n- in_progress ‚Üí 409/422 + in_progress payload\n- UI kann daraus Polling steuern\n- [ ] If an API route is introduced/changed: at least one in-repo literal callsite exists.\n- [ ] Endpoint wiring gate shows no orphan for this endpoint.\n- [ ] (If external) allowlist entry exists with justification.\n\n### Test Plan\n- In-progress ‚Üí deterministic contract\n- Completed-after-processing ‚Üí ready\n\n### Implementation Notes\n- Stable schema:\n  - state: 'ready'|'processing'|'in_progress'\n  - assessmentId\n  - result: {...} nur wenn ready\n- Keine hidden redirects; status code deterministisch\n\n### CI/Guardrails\n- No orphan endpoints added\n- Migrations idempotent\n\nüîí Guardrails\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[],"number":711,"state":"CLOSED","title":"E73.4 ‚Äî Result API SSOT-first + ‚Äúprocessing‚Äù Contract (409 ohne Loops)"},{"body":"**Labels:** backend, pipeline, v0.7, priority:high\n\n### Ziel\nF√ºr jedes completed assessment wird immer ein calculated_results Datensatz geschrieben, idempotent, reproduzierbar, als SSOT-Quelle.\n\n### Scope\n- Implement \"results writer\" in Processing Pipeline\n- Inputs: assessment_id + derived scores/risks/priorities\n- Output: calculated_results row\n- Upsert: (assessment_id, algorithm_version, inputs_hash)\n- Inhalt: scores jsonb (required); risk_models, priority_ranking optional; computed_at, inputs_hash\n\n### Acceptance Criteria\n- Nach job completion existiert calculated_results (1 row)\n- Re-run job erzeugt kein Duplikat (upsert)\n- payload ist stabil\n\n### Test Plan\n- Create assessment ‚Üí complete ‚Üí run processing ‚Üí verify row exists\n- Re-run processing ‚Üí immer 1 row\n\n### CI/Guardrails\n- Keine Orphan endpoints\n- Migrations idempotent\n\nüîí Guardrails\n\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":710,"state":"CLOSED","title":"E73.3 ‚Äî Processing: calculated_results zuverl√§ssig erzeugen (Upsert, SSOT)"},{"body":"**Labels:** backend, patient-api, v0.7, priority:high\n\n### Ziel\nWenn ein Assessment abgeschlossen wird, muss ein Processing-Job idempotent erzeugt werden, der sp√§ter calculated_results erzeugt.\n\n### Scope\n- POST ‚Ä¶/complete setzt assessments.status=completed, completed_at=now()\n- erzeugt/queued processing_jobs mit stabiler Correlation\n- idempotency: unique constraint oder select+upsert pattern\n- writes audit/event\n\n### Acceptance Criteria\n- complete setzt Assessment completed\n- processing_jobs existiert nur einmal pro assessment (idempotent)\n- complete retry-safe (2√ó call ‚Üí kein Doppeljob)\n- Response enth√§lt job_id/status\n\n### Test Plan\n- Zweimal complete call ‚Üí 1 job row, gleiche correlation\n- job status transitions sichtbar (sp√§ter)\n\n### CI/Guardrails\n- DB changes (falls unique) sind migrations-idempotent\n- Endpoint catalog aktualisiert (keine Orphans)\n\nüîí Guardrails\n\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":709,"state":"CLOSED","title":"E73.2 ‚Äî Wire: Complete ‚Üí Processing Job (idempotent)"},{"body":"**Labels:** bug, patient, v0.7, priority:high\n\n### Problem / Kontext\nBeim Klick ‚ÄúAssessment starten‚Äù entsteht ein Request-Loop (definition ‚Üí create assessment ‚Üí result 409 ‚Üí ‚Ä¶). Ursache: ein Start/Load-useEffect h√§ngt an instabilen Dependencies (z. B. refetchResult aus einem Hook, das sich mit assessmentId √§ndert) und startet dadurch wiederholt neue Assessments.\n\n### Ziel\n- Assessment wird pro Klick/Session exakt einmal gestartet\n- Result-Fetch nur, wenn Ergebnis angezeigt werden soll\n- 409 nur noch \"Processing...\", kein Restart mehr\n\n### Scope\n- Patient UI: Assessment Flow v2 Start/Load-Logik\n- Optional: useAssessmentResult erweitert um enabled oder equivalent\n- UI-Logik f√ºr 409: Polling/Backoff nur im Result-Modus\n\n### Non-Goals\n- SSOT-Results erst ab E73.2‚ÄìE73.4\n- Kein UI-Redesign\n\n### Implementation Notes\n- Start/Load Effect darf nicht von refetchResult abh√§ngig sein\n- Entweder: Effect splitten oder refetchResult via useRef entkoppeln\n- Result Hook nur wenn enabled\n\n### Acceptance Criteria\n- Klick ‚ÄúAssessment starten‚Äù ‚Üí exakt 1√ó POST /‚Ä¶/assessments (201)\n- Kein weiterer POST bei Setzen von assessmentId\n- GET ‚Ä¶/result wird nur bei showResult/Results-Route ausgef√ºhrt\n- 409 f√ºhrt zu Processing-UI, kein Restart, Polling kontrolliert\n- Resume bei assessmentId weiterhin m√∂glich\n\n### Test Plan\n- Manuell: Dashboard ‚Üí ‚ÄúAssessment starten‚Äù ‚Üí 1√ó create, 0 loops\n- Automatisiert: Playwright/Smoke: Start flow emits single create\n\n### CI/Guardrails\n- npm run build\n- Lint: changed-lines gate (nach E73.10 robust)\n- Keine neuen API endpoints ohne Callsite (au√üer allowlist+Removal-Ticket)\n\nüîí Guardrails\n\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRLh6WQ","name":"bug","description":"Something isn't working","color":"d73a4a"}],"number":708,"state":"CLOSED","title":"E73.1 ‚Äî Fix Patient Assessment Start Loop + deterministisches Fetch-Gating"},{"body":"## Epic Ziel\n\nE73 macht das System deterministisch, SSOT-konform, legacy-frei im v2-Pfad und reduziert CI/Check-Failures durch klare Guardrails + saubere Ownership. Zus√§tzlich: Content v1 (published-only), AMY Frontdesk Chat (LLM, ohne Steuerung), Studio Design Tool (Tokens + Component/Page Config).\n\n**SSOT (verbindlich f√ºr E73):**\n- Assessment Lifecycle: assessments\n- Antworten: assessment_answers\n- Result Payload: calculated_results (primary)\n- Optional klinisch: reports (fallback/optional)\n\n### Epic Exit Criteria (Definition of Done)\n- Assessment-Start ist 1:1, deterministisch, kein Loop, kein 409-Refresh-Problem\n- Processing-Jobs und Results sind idempotent, SSOT-konform\n- Keine Legacy-Routes/Code nutzbar (Ghosting-Framework)\n- Content v1: Studio kann Draft/Publish, Patient sieht published-only, deterministisches Verhalten\n- AMY Chat (LLM) nur Frontdesk, keine Steuerung\n- Studio-Design Tool: Tokens + Konfig editierbar, Patient √ºbernimmt nach Reload\n- CI stabil: Artefakt-excludes f√ºr .next/types etc.\n\nüîí Guardrails\n\nJede Regel hat eine Check-Implementierung (Script/CI) und umgekehrt: jeder Check referenziert eine Regel-ID.\n\nErgebnis-Artefakt: RULES_VS_CHECKS_MATRIX.md + Diff-Report (rules-without-check / checks-without-rule / scope mismatch).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"}],"number":707,"state":"OPEN","title":"[Epic E73] Wiring, Legacy Ghosting, Content v1, AMY Chat, Studio Design Tool (+ CI Robustness for v0.7)"},{"body":"**Canonical ID**: E72.ALIGN.P0.DBSEC.001\n**Priority**: P0\n**Owner Domain**: DB / Guardrails\n**Goal**: Enforce R-DB-009 (‚ÄúRLS required on user data tables‚Äù) automatically in CI with deterministic evidence output.\n\n### Background / Problem\n\nR-DB-009 exists as a documented guardrail, but there is currently **no automated enforcement**. This creates a security gap and no audit trail of compliance. The Rules-vs-Checks diff recommends adding an automated verifier script and integrating it into the DB determinism workflow.\n\n### Scope\n\n1. Create a new deterministic verification script:\n    * `scripts/db/verify-rls-policies.ps1`\n2. Integrate the script into CI:\n    * `.github/workflows/db-determinism.yml`\n3. Introduce a machine-readable allowlist for known exceptions (public metadata/system tables):\n    * `docs/canon/rls-allowlist.json` (or `docs/guardrails/rls-allowlist.json`; pick one canonical location and reference it consistently in the matrix)\n4. Update guardrail documentation and mapping:\n    * `docs/guardrails/RULES_VS_CHECKS_MATRIX.md` (R-DB-009 enforcement mapping)\n    * `docs/guardrails/RULES_VS_CHECKS_DIFF.md` (close/mark resolved finding 1.1)\n\n### Non-Goals\n* Do not weaken R-DB-009.\n* Do not attempt full semantic validation of policy correctness (this check validates **presence** + **RLS enabled**, not business correctness).\n* Do not refactor unrelated migration/linter logic.\n\n### Definition of ‚ÄúUser Data Table‚Äù (Deterministic Heuristic)\nA table is considered ‚Äúuser data‚Äù if:\n* It has a column named `patient_id` OR `user_id`\n  (Heuristic must be configurable to reduce false positives and allow explicit exceptions.)\n\n### Acceptance Criteria\n**Enforcement**\n* CI fails if any ‚Äúuser data table‚Äù has:\n  * RLS not enabled, OR\n  * no patient-role policy found (existence check)\n* CI is **fail-closed**: unexpected errors querying metadata => non-zero exit code.\n\n**Evidence Output**\n* Script emits:\n  * `artifacts/rls-verify/rls-summary.json` (machine-readable)\n  * `artifacts/rls-verify/rls-summary.txt` (human-readable)\n* JSON includes per-table records:\n  * `schema`, `table`\n  * `classification`: `{ matchedColumns: [\"patient_id\"|\"user_id\"], source: \"heuristic\" }`\n  * `rlsEnabled: true|false`\n  * `policies: [{ policyName, roles, cmd }]` (minimal fields)\n  * `allowlisted: true|false` + `allowlistReason` if applicable\n\n**Allowlist**\n* Allowlist file is self-documenting and validated:\n  * format description in-file (comment field)\n  * entries are explicit schema.table strings (e.g., `\"public.some_table\"`)\n* Script validates allowlist format; invalid allowlist => fail CI (fail-closed).\n\n**Docs**\n* Matrix updated: R-DB-009 shows exact enforcement script + workflow step.\n* Diff report marks finding 1.1 resolved (or moved to ‚Äúenforced‚Äù).\n\n### Implementation Notes (PowerShell-first)\n\n* Use SQL queries against CI DB:\n  * Determine candidate tables via `information_schema.columns` or `pg_attribute` joins.\n  * RLS enabled can be derived from `pg_class.relrowsecurity`.\n  * Policies via `pg_policies`.\n* Patient-role policy check:\n  * Minimum requirement: at least one policy exists that includes a role matching configured `patientRoleName` (default `\"patient\"`).\n  * Make role name configurable via env var to prevent coupling.\n* Exclude system schemas by default (`pg_catalog`, `information_schema`), but still allow explicit allowlist.\n\n### Verification (PowerShell)\n```powershell\npwsh -File .\\scripts\\db\\verify-rls-policies.ps1\n# If script requires env:\n$env:PGHOST=\"...\"\n$env:PGUSER=\"...\"\n$env:PGPASSWORD=\"...\"\n$env:PGDATABASE=\"...\"\npwsh -File .\\scripts\\db\\verify-rls-policies.ps1\n```\n\n### Done Definition (DoD)\n* Script exists, is deterministic, and produces evidence artifacts.\n* CI workflow runs it and fails appropriately.\n* Allowlist file exists + validated.\n* Matrix + diff updated.\n* At least one fixture-based test or controlled scenario exists to demonstrate:\n  * failing case (missing RLS)\n  * passing case (RLS enabled + policy exists)\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"}],"number":694,"state":"CLOSED","title":"[P0] DB Security Enforcement Pack ‚Äî Automated RLS Verification (R-DB-009)"},{"body":"**Canonical ID**: E72.ALIGN.P1.DETCON.001\n**Priority**: P1\n**Owner Domain**: CI + API Contracts\n**Goal**: Reduce CI flakiness and API contract drift by standardizing BASE_SHA resolution and enforcing a canonical API response shape.\n\n### Background / Problem\n\nTwo medium-priority gaps drive nondeterminism and drift:\n\n1. BASE_SHA is computed inconsistently across workflows, risking shallow-clone nondeterminism and inconsistent diff-based checks.\n2. The API response format contract is documented but not enforced; endpoints can drift, breaking frontend assumptions.\n\nAlso noted: the diff text labels the API response rule as **R-DB-010**, but semantically it belongs to **API rules**. This must be corrected in the rule mapping to avoid long-term governance confusion.\n\n### Scope A ‚Äî BASE_SHA Standardization (R-CI-002)\n\n1. Create a single shared BASE_SHA resolver:\n   * Prefer **PowerShell**: `scripts/ci/get-base-sha.ps1`\n   * Output: BASE_SHA + HEAD_SHA + context metadata\n2. Update all workflows that require BASE_SHA to call this shared script.\n3. Document behavior in `docs/canon/CI_DEPLOY_MODEL.md`.\n4. Update guardrail mapping:\n   * `docs/guardrails/RULES_VS_CHECKS_MATRIX.md` for R-CI-002\n   * `docs/guardrails/RULES_VS_CHECKS_DIFF.md` mark findings resolved/moved\n\n**BASE_SHA Behavior (deterministic)**\n\n* PR event:\n  * Use GitHub-provided base SHA if available.\n  * Fallback: compute merge-base between PR head and base branch head (requires fetch-depth 0).\n* Push event:\n  * Use `GITHUB_EVENT_BEFORE` when available.\n  * Fallback: `HEAD~1` if history is sufficient; otherwise fail-closed.\n\n**Acceptance Criteria (BASE_SHA)**\n\n* All relevant workflows use the shared script (no inline ad-hoc logic remains).\n* Script prints a stable, parseable output (e.g., JSON line or `BASE_SHA=...`).\n* Shallow clone or missing refs:\n  * script attempts deterministic recovery (fetch base branch ref)\n  * if still impossible, it fails (fail-closed) with actionable message.\n* Evidence is captured in CI logs (and optionally artifact).\n\n### Scope B ‚Äî API Response Contract Enforcement (Correct Rule-ID mapping)\n\n1. Introduce a canonical type:\n   * `lib/types/api.ts` (or canonical location)\n   * `export type ApiResponse<T> = { success: true; data: T } | { success: false; error: { code: string; message: string } }`\n2. Provide helper constructors (recommended):\n   * `ok<T>(data: T): ApiResponse<T>`\n   * `fail(code: string, message: string): ApiResponse<never>`\n3. Enforce in ‚Äúchanged files only‚Äù mode initially:\n   * Either:\n     * wrapper utility required for `NextResponse.json(...)`, OR\n     * ESLint rule/config pattern (avoid heavy custom rule unless already used)\n4. Update docs:\n   * `docs/canon/CONTRACTS.md` add canonical response contract + examples.\n5. Fix governance naming:\n   * Update matrix/diff to move the response-contract rule to the correct domain (API), or at minimum add an explicit note that the prior label R-DB-010 was a misclassification and provide the corrected Rule-ID.\n\n**Acceptance Criteria (API Contract)**\n\n* At least one canonical API route uses `ApiResponse<T>` end-to-end.\n* New/changed API routes must comply (lint/build fails otherwise).\n* Docs contain:\n   * contract definition\n   * examples for success and error cases\n   * guidance for migration of existing routes\n\n### Non-Goals\n* Do not migrate all legacy endpoints in one pass; changed-files scope is sufficient.\n* Do not weaken fail-closed behavior in CI.\n* Do not add new product features.\n\n### Verification (PowerShell)\n```powershell\n# BASE_SHA script local sanity (will depend on env)\npwsh -File .\\scripts\\ci\\get-base-sha.ps1\n\n# Type enforcement\nnpm run lint\nnpm run build\n```\n\n### DoD\n* Shared BASE_SHA script used everywhere relevant.\n* Docs updated and consistent.\n* API response type introduced + at least one route migrated.\n* Enforcement exists for changed routes (lint/build gate).\n* RULES_VS_CHECKS_MATRIX and DIFF updated to reflect new enforcement and corrected rule classification.\n\nGuardrails Impact Addendum (E72 Standard)\n\nGuardrails-Baseline\n\nDiese Arbeit folgt der Guardrails-Quelle-of-Truth aus:\n\ndocs/guardrails/RULES_VS_CHECKS_MATRIX.md\n\ndocs/guardrails/RULES_VS_CHECKS_DIFF.md\n\ndocs/guardrails/README.md\n\nJede fr√ºhere, abweichende ‚ÄúGuardrails‚Äù-Beschreibung im Issue gilt als veraltet, sobald ein PR diese Artefakte aktualisiert.\n\nPflicht: Rule-ID und Enforcement-Mapping\n\nDer PR MUSS f√ºr alle betroffenen Rules:\n\nRule-ID(s) referenzieren (stabil, unver√§ndert oder explizit migriert)\n\nEnforcement-Mapping aktualisieren (Script/Workflow/Command)\n\nEvidence-Output definieren (Artefaktpfad + Inhalt)\n\nFalls eine Rule-ID im Diff falsch klassifiziert ist (z. B. API-Regel als DB-Regel):\n\nvor Umsetzung: Korrektur im Matrix/Diff als Teil des PR (oder als erster Commit im PR) dokumentieren, inkl. kurzer Migrationsnotiz (‚Äúrename only; no weakening‚Äù).\n\nPflicht: Diff-Report Hygiene\n\nRULES_VS_CHECKS_DIFF.md muss nach Umsetzung:\n\nden Finding-Status aktualisieren (resolved/moved/partially-resolved)\n\ndie Begr√ºndung enthalten, falls nur Teil-Alignment umgesetzt wurde.\n\nNo Weakening / Fail-Closed\n\nGuardrails d√ºrfen nicht abgeschw√§cht werden:\n\nkeine ‚ÄúWarn statt Fail‚Äù-√Ñnderung ohne explizite Rule-√Ñnderung + Begr√ºndung im Diff\n\nChecks bleiben fail-closed bei unbekannten Fehlern (Exit != 0), au√üer die Rule sagt explizit etwas anderes.\n\nCI/Workflow Konsistenz\n\nWenn ein Check in CI l√§uft, muss die Matrix den konkreten Workflow-Step nennen (Datei + Step-Name).\n\nWenn ein Check (noch) nur manuell ist, muss die Matrix explizit ‚Äúmanual only‚Äù tragen (keine implizite CI-Enforcement-Behauptung).\n\nAcceptance Criteria Erg√§nzung (f√ºr Guardrails)\n\n‚úÖ Matrix/Diff/README sind aktualisiert und konsistent\n\n‚úÖ Rule‚ÜíCheck Mapping ist korrekt und auditierbar\n\n‚úÖ Evidence Output ist vorhanden und deterministisch\n\n‚úÖ Kein Guardrail wurde abgeschw√§cht (oder √Ñnderung ist im Diff als Rule-Change sauber dokumentiert)\n\nDoD Erg√§nzung (f√ºr Guardrails)\n\nPR enth√§lt die Guardrails-Updates im gleichen Change-Set (oder klar getrennt als Commit 1/2 innerhalb desselben PR).\n\nReviewer kann aus der Matrix direkt:\n\ndie Rule finden,\n\nden Check ausf√ºhren,\n\ndie Evidence-Artefakte pr√ºfen.\n","labels":[],"number":693,"state":"CLOSED","title":"[P1] Determinism & Contract Enforcement Pack ‚Äî BASE_SHA + API Response Contract"},{"body":"**Canonical ID**: E72.ALIGN.P2.GOV.001\n**Priority**: P2\n**Owner Domain**: Guardrails Governance / Docs\n**Goal**: Remove ambiguity and ‚Äúfalse confidence‚Äù in guardrails by documenting allowlists clearly, aligning UI v2 enforcement status, and formalizing an existing linter self-test as an explicit rule.\n\n### Background / Problem\n\nSeveral mismatches are governance/documentation-level:\n* allowlist formats are unclear or not self-documenting\n* UI v2 rules reference a script but are not integrated in CI (manual only), creating false confidence if matrix implies CI enforcement\n* migration linter self-test exists but has no explicit rule entry\n\n### Scope A ‚Äî Allowlist Format Documentation & Optional Validation\n\n1. Make allowlist files self-documenting:\n   * Add `_comment` + `entries` wrapper object (where applicable)\n   * Provide example entry and removal guidance\n2. Ensure every rule referencing an allowlist has:\n   * explicit format definition in `RULES_VS_CHECKS_MATRIX.md`\n   * link to canonical file\n3. Optional (warn-only) allowlist validation:\n   * Endpoint allowlist entries that don‚Äôt exist in code => warning output (fail-closed only if explicitly decided later)\n\n**Acceptance Criteria**\n* All allowlists referenced in rules are self-describing and consistent.\n* Matrix describes format and provides example.\n* Optional validation (if implemented) produces a deterministic report artifact.\n\n### Scope B ‚Äî UI v2 Checks Status Alignment (R-UI-001..R-UI-006)\n\nChoose one:\n* **Doc-only (default for P2):** Matrix explicitly says ‚Äúmanual run only; not in CI yet‚Äù.\n* Optional subtask: add `ui-v2-gate.yml` workflow to run `scripts/verify-ui-v2.mjs` on PRs affecting patient UI v2.\n\n**Acceptance Criteria (Doc-only)**\n* Matrix and README clearly state current enforcement status.\n* Developer instructions include PowerShell command to run locally.\n\n**Acceptance Criteria (Optional CI Gate)**\n* UI v2 gate runs on relevant path changes and produces an evidence summary.\n* Does not introduce noise on unrelated PRs.\n\n### Scope C ‚Äî Add Rule Entry for Migration Linter Self-Test (R-DB-011)\n\n1. Add new rule entry R-DB-011 in matrix:\n   * Statement: ‚ÄúMigration linter test suite must pass before checking real migrations‚Äù\n   * Enforcement mapping: `scripts/db/test-linter.ps1` + workflow step\n2. Update README quick reference tables.\n\n**Acceptance Criteria**\n* Rule is present and correctly mapped; no code changes required.\n\n### Non-Goals\n* Do not rewrite verify scripts unless needed for documentation hooks.\n* Do not weaken UI/DB guardrails; this is clarity + formalization.\n\n### Verification (PowerShell)\n```powershell\n# Allowlist checks (if any script added)\n# Example:\nnode .\\scripts\\verify-endpoint-allowlist.mjs  # only if created\n\n# UI v2 manual check\nnode .\\scripts\\verify-ui-v2.mjs\n```\n\n### DoD\n* Matrix and README updated and consistent.\n* Allowlist formats self-documenting.\n* UI v2 enforcement status accurately represented.\n* R-DB-011 added and mapped to existing check.\n\n\nGuardrails Impact Addendum (E72 Standard)\n\nGuardrails-Baseline\n\nDiese Arbeit folgt der Guardrails-Quelle-of-Truth aus:\n\ndocs/guardrails/RULES_VS_CHECKS_MATRIX.md\n\ndocs/guardrails/RULES_VS_CHECKS_DIFF.md\n\ndocs/guardrails/README.md\n\nJede fr√ºhere, abweichende ‚ÄúGuardrails‚Äù-Beschreibung im Issue gilt als veraltet, sobald ein PR diese Artefakte aktualisiert.\n\nPflicht: Rule-ID und Enforcement-Mapping\n\nDer PR MUSS f√ºr alle betroffenen Rules:\n\nRule-ID(s) referenzieren (stabil, unver√§ndert oder explizit migriert)\n\nEnforcement-Mapping aktualisieren (Script/Workflow/Command)\n\nEvidence-Output definieren (Artefaktpfad + Inhalt)\n\nFalls eine Rule-ID im Diff falsch klassifiziert ist (z. B. API-Regel als DB-Regel):\n\nvor Umsetzung: Korrektur im Matrix/Diff als Teil des PR (oder als erster Commit im PR) dokumentieren, inkl. kurzer Migrationsnotiz (‚Äúrename only; no weakening‚Äù).\n\nPflicht: Diff-Report Hygiene\n\nRULES_VS_CHECKS_DIFF.md muss nach Umsetzung:\n\nden Finding-Status aktualisieren (resolved/moved/partially-resolved)\n\ndie Begr√ºndung enthalten, falls nur Teil-Alignment umgesetzt wurde.\n\nNo Weakening / Fail-Closed\n\nGuardrails d√ºrfen nicht abgeschw√§cht werden:\n\nkeine ‚ÄúWarn statt Fail‚Äù-√Ñnderung ohne explizite Rule-√Ñnderung + Begr√ºndung im Diff\n\nChecks bleiben fail-closed bei unbekannten Fehlern (Exit != 0), au√üer die Rule sagt explizit etwas anderes.\n\nCI/Workflow Konsistenz\n\nWenn ein Check in CI l√§uft, muss die Matrix den konkreten Workflow-Step nennen (Datei + Step-Name).\n\nWenn ein Check (noch) nur manuell ist, muss die Matrix explizit ‚Äúmanual only‚Äù tragen (keine implizite CI-Enforcement-Behauptung).\n\nAcceptance Criteria Erg√§nzung (f√ºr Guardrails)\n\n‚úÖ Matrix/Diff/README sind aktualisiert und konsistent\n\n‚úÖ Rule‚ÜíCheck Mapping ist korrekt und auditierbar\n\n‚úÖ Evidence Output ist vorhanden und deterministisch\n\n‚úÖ Kein Guardrail wurde abgeschw√§cht (oder √Ñnderung ist im Diff als Rule-Change sauber dokumentiert)\n\nDoD Erg√§nzung (f√ºr Guardrails)\n\nPR enth√§lt die Guardrails-Updates im gleichen Change-Set (oder klar getrennt als Commit 1/2 innerhalb desselben PR).\n\nReviewer kann aus der Matrix direkt:\n\ndie Rule finden,\n\nden Check ausf√ºhren,\n\ndie Evidence-Artefakte pr√ºfen.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"}],"number":692,"state":"CLOSED","title":"[P2] Governance Clarity Pack ‚Äî Allowlists, UI v2 Check Status, Migration Linter Rule"},{"body":"\nEpic: E71 (v0.7)\nType: Quality / Governance / Determinism\nPriority: P0 (reduces recurring CI churn)\nOwner Surface: Repo-wide (Patient + Studio + CI)\nRule Source of Truth: /docs/guardrails/**\n\nIntent\n\nEliminate recurring ‚ÄúCI chaos‚Äù by aligning written guardrail rules with actual enforcement checks. Produce an evidence-based matrix that:\n\nmaps every rule ‚Üí check(s) (or explicitly ‚Äúmanual review‚Äù),\n\nmaps every check ‚Üí rule(s),\n\nidentifies scope mismatches and allowlist format mismatches,\n\nresults in minimal PRs that synchronize rules and checks (not loosen).\n\nNon-Goals\n\nDo not weaken guardrails to make CI green.\n\nDo not introduce new product scope (no new features).\n\nDo not refactor unrelated code.\n\nDeliverables\nD1) RULES_VS_CHECKS_MATRIX (canonical)\n\nCreate: docs/guardrails/RULES_VS_CHECKS_MATRIX.md\n\nFor each row:\n\nRule ID (create stable IDs: R-API-001, R-DB-001, R-UI-001, etc.)\n\nRule Text (1‚Äì2 sentences, unambiguous)\n\nScope (exact path patterns / surfaces)\n\nEnforced by (script(s) + file paths)\n\nPass condition (exact)\n\nExceptions (allowlist file path + exact entry format)\n\nEvidence output (what file/log proves pass/fail)\n\nKnown gaps (no check / false positive risk)\n\nOwner (E71/E72/E73)\n\nD2) DIFF REPORT (mismatches)\n\nCreate: docs/guardrails/RULES_VS_CHECKS_DIFF.md listing:\n\nRules without checks\n\nChecks without rules\n\nScope mismatches (rule says ‚Äúall‚Äù, check enforces subset)\n\nFormat mismatches (e.g., allowlist expects method+path but docs specify path-only)\n\nFalse-positive candidates (parser/regex limitations)\n\nD3) Minimal alignment PRs (tight scope)\n\nCreate 1‚Äì3 small follow-up issues (or PRs) that fix only the discovered mismatches, e.g.:\n\nUpdate rule text to match exact enforced scope\n\nUpdate check to match rule text (preferred when rule is correct and check is wrong)\n\nStandardize allowlist entry format + document it\n\nAdd ‚Äúremoval ticket required‚Äù pattern for temporary allowlists\n\nInventory (Checks to include at minimum)\n\nInclude these scripts and any others referenced in CI:\n\nscripts/ci/verify-endpoint-catalog.ps1\n\nscripts/db/lint-migrations.ps1\n\nscripts/verify-ui-v2.mjs\n\nverify-critical-api-handlers.js\n\n.github/workflows/*.yml (checkout ref determinism + which scripts run)\n\nAcceptance Criteria\n\nMatrix contains 100% of rules in /docs/guardrails/** (no orphan rule text).\n\nMatrix contains 100% of enforced checks run in CI workflows.\n\nEvery allowlist has documented exact match format and a short example.\n\nDiff report names each mismatch with:\n\n(a) current rule statement,\n\n(b) current check behavior,\n\n(c) recommended alignment (rule change vs check change),\n\n(d) why this is not a ‚Äúweakening‚Äù.\n\nOptional but recommended: each check output references a Rule ID in its failure message (future-proofing).\n\nImplementation Plan (Packages)\nPackage 1 ‚Äî Collect & normalize rules (docs/guardrails)\n\nEnumerate all markdown in /docs/guardrails/**\n\nExtract candidate ‚ÄúMUST/SHOULD/FORBIDDEN/ALLOWED‚Äù statements\n\nAssign stable Rule IDs and group by domain:\n\nAPI / Endpoint wiring\n\nDB / Migrations / Canon\n\nUI v2 / Layout patterns / Icons\n\nCI determinism / False-green prevention\n\nPackage 2 ‚Äî Collect & normalize checks (scripts + workflows)\n\nParse scripts for enforced constraints (exit codes, violations)\n\nParse workflows for the exact commands and paths invoked\n\nProduce list of ‚Äúenforced checks‚Äù with their scopes and inputs/allowlists\n\nPackage 3 ‚Äî Build the matrix + diff report\n\nFill RULES_VS_CHECKS_MATRIX.md\n\nProduce RULES_VS_CHECKS_DIFF.md\n\nAdd a short ‚ÄúHow to add a new rule/check‚Äù section\n\nPackage 4 ‚Äî Follow-up fixes (separate issues)\n\nCreate targeted follow-up issues (max 3) to close mismatches\n\nEnsure each fix references Rule IDs and updates docs/tests accordingly","labels":[],"number":690,"state":"CLOSED","title":"E72.F1: Rules vs Checks Consistency Audit (docs/guardrails)"},{"body":"Deliverable:\ndocs/test-runs/v0.7/E73_CONTENT_SYSTEM.md\n\nSteps:\n- Studio: create‚Üíedit‚Üípublish\n- Patient: loads published\n- Studio: unpublish\n- Patient: 404\n- Evidence: URLs + screenshots (optional)\n\nAcceptance Criteria:\n- PASS/FAIL eindeutig\n\nQuellen:\n- [AFU-9 CodeFactory Control Contracts](codefactory-control/docs/contracts/)\n\n---\n### üîí Guardrails\n\n**Test Guardrails**\n- Smoke Pack ausschlie√ülich mit Published Content im Patient testen (kein Mocking)\n- Testprotokoll dokumentiert und versioniert im Repo-Pfad wie angegeben\n\n**Auth-Guardrails**\n- Test-Accounts mit klar dokumentierter Rolle/E-Mail\n- √Ñnderungen an Test Cases werden versioniert und reviewed\n\n[weitere Guardrails siehe Policy und contracts]\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWpPg","name":"integration","description":"","color":"ededed"}],"number":687,"state":"CLOSED","title":"I73.8 ‚Äî E73 Smoke Pack (Testlauf nach Template)"},{"body":"Intent: Kein R√ºckfall in Demo/Mocks.\n\nChecks:\n- verify script fails if:\n  - patient content route uses fixtures/demo content outside dev routes\n  - forbidden legacy imports in content routes\n- Contract test:\n  - 404 error string stable\n\nAcceptance Criteria:\n- CI fails on reintroducing mock content.\n\nQuellen:\n- [AFU-9 CodeFactory Control Contracts](codefactory-control/docs/contracts/)\n\n---\n### üîí Guardrails\n\n**CI Guardrails**\n- CI pr√ºft, dass in /patient/content/* nie Demo-/Mock-Content verwendet wird\n- Forbidden-Import-Checks laufen automatisiert f√ºr alle content routes\n\n**Contract Guardrails**\n- Test f√ºr stabile 404-Strings f√ºr Patient-Content-API muss existieren\n\n[weitere Guardrails siehe Policy und contracts]\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSLEbkA","name":"codefactory","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpPg","name":"integration","description":"","color":"ededed"}],"number":686,"state":"CLOSED","title":"I73.7 ‚Äî Guardrails: No mock content outside dev + contract stability"},{"body":"Intent: Publish wirkt zeitnah im Patient.\n\nImplementation:\n- if Next revalidate supported: call revalidatePath(\"/patient/content/\"+slug) on publish/unpublish\n- else: short TTL caching with ETag\n\nAcceptance Criteria:\n- Publish/unpublish sichtbar innerhalb ‚â§60s (dokumentiert)\n\nQuellen:\n- [AFU-9 CodeFactory Control Contracts](codefactory-control/docs/contracts/)\n\n---\n### üîí Guardrails\n\n**Infra Guardrails**\n- Revalidate/Invalidate Mechanismus dokumentiert und CI-getestet\n- Kein persistentes Caching nach Unpublish zulassen (Verification-Step!)\n- Patienten-Content-API returned immer aktuellen Stand der published content_pages\n- Ver√∂ffentlichungen/Unver√∂ffentlichungen werden mit Timestamps und User-IDs geloggt\n\n**Auth-Guardrails**\n- Publish/unpublish darf nur Studio/Admin triggern\n\n[weitere Guardrails siehe Policy und contracts]\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSLEbkA","name":"codefactory","description":"","color":"ededed"}],"number":685,"state":"CLOSED","title":"I73.6 ‚Äî Publish propagation: Revalidate/Cache Invalidation"},{"body":"Intent: Patient rendert ‚Äúechten‚Äù Content in v2 primitives.\n\nRoute:\n- /patient/content/[slug]\n\nRenderer:\n- fetch via patient API\n- render sections by type:\n  - markdown: use existing safe markdown renderer (no raw html), or minimal safe subset\n- states: loading/error/404 (v2 UI)\n- no legacy wrapper, no max-w-* in mobile pages\n\nAcceptance Criteria:\n- Published content appears; draft returns ‚ÄúContent nicht gefunden‚Äù (v2 UI)\n- npm run verify:ui-v2 passes\n- PowerShell Verify\n- npm run build\n\nQuellen:\n- [AFU-9 CodeFactory Control Contracts](codefactory-control/docs/contracts/)\n\n---\n### üîí Guardrails\n\n**Frontend Guardrails**\n- Patient-UI konsumiert nur explizit freigegebene API-Endpunkte des aktuellen Repos\n- Kein Zugriff auf Draft/Unpublished Content im Patient-UI\n- Keine Mock-/Demo-Fallbacks f√ºr Content in produktiven Patient-Routen\n- Renderer f√ºr Content-Sections gew√§hrleistet, dass HTML/markdown escapes sanitized werden (kein XSS, kein raw-html rendering)\n\n**Auth-Guardrails**\n- Patient-Role wird auf allen Patient-Content-Routen serverseitig gepr√ºft\n\n[weitere Guardrails siehe Policy und contracts]\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSLEbkA","name":"codefactory","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"}],"number":684,"state":"CLOSED","title":"I73.5 ‚Äî Patient Renderer (Mobile-v2, section types v1)"},{"body":"Intent: Nicht h√ºbsch, aber bedienbar, ohne Devtools.\n\nUI:\n- List view: slug/title/status/version/updatedAt + create\n- Detail view:\n  - edit meta (title/slug)\n  - sections list (reorder up/down)\n  - markdown editor textarea (MVP)\n  - save, publish/unpublish buttons\n- Error handling:\n  - show API errors inline\n  - disable buttons on pending\n\nAcceptance Criteria:\n- Ohne Code√§nderung kann ein User eine neue Page ver√∂ffentlichen und wieder entfernen.\n- No broken routes/404 in Studio.\n- PowerShell Verify\n- npm run build\n- npm run verify\n\nQuellen:\n- [AFU-9 CodeFactory Control Contracts](codefactory-control/docs/contracts/)\n\n---\n### üîí Guardrails\n\n**UI Guardrails**\n- Studio-UI darf nur freigegebene Client-APIs konsumieren (keine fetch-Aufrufe au√üer EngineClient)\n- Fehler- und Loading-States m√ºssen f√ºr alle API-Interaktionen klar sichtbar, testbar und √ºberpr√ºfbar sein\n- Kein Zugriff auf Patient-API aus Studio-UI\n- Keine Manipulation kritischer Meta-Infos durch UI (z.B. publish date, version nur durch API serverseitig)\n\n**Auth-Guardrails**\n- Rolle Studio/Admin explizit pr√ºfen, auch client-seitig beim Navigieren/Rendern\n\n[weitere Guardrails siehe Policy und contracts]\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSLEbkA","name":"codefactory","description":"","color":"ededed"}],"number":683,"state":"CLOSED","title":"I73.4 ‚Äî Studio Content Admin UI (usable MVP)"},{"body":"Intent: Studio kann authoren ohne direkt in DB rumzufummeln.\n\nEndpoints (minimal set):\n- GET /api/admin/content-pages (list meta)\n- POST /api/admin/content-pages (create draft)\n- GET /api/admin/content-pages/[id] (draft + sections)\n- PUT /api/admin/content-pages/[id] (update meta)\n- GET /api/admin/content-pages/[id]/sections\n- POST /api/admin/content-pages/[id]/sections\n- PUT /api/admin/content-pages/[id]/sections/[sectionId]\n- DELETE /api/admin/content-pages/[id]/sections/[sectionId]\n- POST /api/admin/content-pages/[id]/publish\n- POST /api/admin/content-pages/[id]/unpublish\n\nValidation\n- slug format (lowercase, hyphen), title required\n- section payload schema: start with type=\"markdown\" payload { markdown: string }\n\nPublish Rules:\n- publish sets status=\"published\", increments version, sets published_at\n- unpublish sets status=\"draft\" (oder unpublished) aber beh√§lt history fields\n\nAcceptance Criteria:\n- Create‚Üíadd section‚Üípublish works mit stabilen Semantics.\n- Publish increments version genau um +1.\n- Unpublish causes patient API to return 404.\n- PowerShell Verify\n- npm run build\n- npm run verify\n\nQuellen:\n- [AFU-9 CodeFactory Control Contracts](codefactory-control/docs/contracts/)\n\n---\n### üîí Guardrails\n\n**API-Contract Guardrails**\n- API-Endpoints m√ºssen alle im Control-Contract dokumentiert und versioniert sein\n- UI darf diese Endpunkte ausschlie√ülich √ºber bereitgestellte Client-Funktionen konsumieren\n- Keine direkten DB-Operationen aus UI/Studio\n\n**DB-Guardrails**\n- CRUD-Policies: Nur Studio/Admin darf Content-Seiten CRUD ausf√ºhren (RLS/SSR)\n- Back-end validiert alle Eingaben schematisch\n- Kein √úberschreiben/Verlust von Content ohne History-Eintrag\n\n**Auth-Guardrails**\n- Rolle Studio/Admin wird bei jedem API-Aufruf gepr√ºft\n- Kein Cross-Repo-Access auf Content\n\n[weitere Guardrails siehe Policy und contracts]\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSLEbkA","name":"codefactory","description":"","color":"ededed"}],"number":682,"state":"CLOSED","title":"I73.3 ‚Äî Studio Authoring API (CRUD Draft + Publish/Unpublish)"},{"body":"Intent: Patient bekommt niemals Draft/Unpublished; API semantics sind stabil.\n\nEndpoint: GET /api/content-pages/[slug]\n\nResponse Semantics:\n- 200: { slug, title, version, publishedAt, sections:[...] }\n- 404: { error: \"Content page not found\", slug }\n- 500: { error: \"Internal error\" } (keine DB details)\n\nRules:\n- published-only\n- optional locale support nur wenn bereits vorhanden\n- caching: Cache-Control + ETag (wenn leicht)\n\nAcceptance Criteria:\n- Published slug ‚Üí 200\n- Draft/unpublished slug ‚Üí 404 (kein 200-empty)\n- 404 JSON error string exakt stabil (Tests)\n- PowerShell Verify\n- npm run build\n- npm run verify\n\nQuellen:\n- [AFU-9 CodeFactory Control Contracts](codefactory-control/docs/contracts/)\n\n---\n### üîí Guardrails\n\n**DB-Guardrails**\n- Nur ver√∂ffentlichte content_pages d√ºrfen ausgeliefert werden (status=\"published\")\n- Kein Zugriff f√ºr Patienten auf Drafts/Unver√∂ffentlichtes\n- DB-Zugriffsregeln auf Row-Level (RLS): Patienten nur GET auf published\n- Keine Leaks von Meta- oder Fehlerinfos aus DB nach au√üen (insbesondere nicht 500 mit detail)\n\n**Auth-Guardrails**\n- Patienten-Rollenpr√ºfung vor API-Zugriff erzwingen (Supabase Policy/SSR Checks)\n- Kein direkter DB-Zugriff vom Client; nur via API\n\n[weitere Guardrails siehe Policy und contracts]\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSLEbkA","name":"codefactory","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"}],"number":681,"state":"CLOSED","title":"I73.2 ‚Äî Patient Content API (Published-only, deterministic 404)"},{"body":"Intent: Datenmodell ist so, dass ‚Äúpage exists but sections missing‚Äù nicht mehr m√∂glich ist (oder repariert wird).\n\nScope:\nDB Schema (oder Supabase migration): content_pages, content_page_sections\n- content_pages.slug unique (case-insensitive wenn m√∂glich)\n- content_page_sections referential integrity + order unique per page\n\nBackfill:\n- F√ºr jede bestehende content_pages ohne sections: create one default section (type=\"markdown\", payload minimal)\n\nContracts (Zod + TS):\n- ContentPageMeta\n- ContentSection\n- ContentPageDraft (meta + sections)\n- ContentPagePublished (snapshot)\n\nAcceptance Criteria:\n- Query content_pages list zeigt keine page ohne mind. 1 section.\n- Duplicate slugs werden verhindert.\n- Migration ist idempotent (re-run safe).\n- Evidence: Migration file paths + line refs in PR description.\n- Backfill report (counts created).\n- PowerShell Verify\n- npm run build\n- npm run verify\n\nQuellen:\n- [AFU-9 CodeFactory Control Contracts](codefactory-control/docs/contracts/)\n\n---\n### üîí Guardrails\n\n**DB-Guardrails**\n- content_pages.slug muss eindeutig und idealerweise case-insensitive unique sein\n- Referenzielle Integrit√§t zwischen Pages und Sections ist enforced, auch bei L√∂schungen (z.B. ON DELETE CASCADE nur, wenn Policy das ausdr√ºcklich erlaubt)\n- Backfill-Vorg√§nge werden geloggt, auditierbar gemacht und dokumentiert\n- Migration-Skripte d√ºrfen keine bestehenden Daten zerst√∂ren\n- Migration ist idempotent\n\n**Auth-Guardrails**\n- Only Studio/Admin darf Migrationen/Backfills triggern (√ºber kontrolliertes Script, nicht Migration zur Laufzeit)\n\n[weitere Guardrails siehe Policy und contracts]\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSLEbkA","name":"codefactory","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqfg","name":"database","description":"","color":"ededed"}],"number":680,"state":"CLOSED","title":"I73.1 ‚Äî Canonical Content Schema v1 + Backfill (Pages/Sections, Version/Publish)"},{"body":"**Epic Intent**\n\nStudio kann Content authoren & publishen, Patient rendert nur published Content in Mobile-v2 UI, ohne Mock-Fallback. Publish ist versioniert/auditierbar, 404/403 Semantics sind deterministisch.\n\n**Epic DoD**\n\n- Studio: create/edit sections/reorder/publish/unpublish funktioniert end-to-end.\n- Patient: /patient/content/[slug] rendert published content; draft/unpublished = 404 mit stabilem JSON.\n- Keine ‚Äúsilent empty states‚Äù.\n- npm run build, npm run verify, npm run verify:ui-v2 gr√ºn.\n- Smoke Pack E73 PASS.\n\n**Quellen:**\n- [AFU-9 CodeFactory Control Contracts](codefactory-control/docs/contracts/)\n\n---\n### üîí Guardrails\n\n**Contract-first / Anti-Drift (verpflichtend)**\n- **Source of Truth:** Repo-√ºbergreifende Contracts sind in `codefactory-control/docs/contracts/*` kanonisch (z.B. `docs/contracts/engine-api.v1.md`). Keine Implementierung/Anbindung ohne Contract-Eintrag.\n- **Engine:** `/api/dev/endpoints` ist **deployte Best√§tigung**, nicht Source of Truth. Neue/√§nderte Engine-Routen m√ºssen im Control-Contract dokumentiert sein; Catalog muss konsistent sein (`count == endpoints.length`, sortiert, optional `purpose`).\n- **UI:** Engine-Calls nur √ºber zentralen `EngineClient`/Adapter. **Keine** direkten `fetch`/HTTP-Aufrufe auf Engine-Endpunkte au√üerhalb des Clients. Wenn Contract-Endpunkt noch nicht deployt ist: expliziter ‚ÄúNot available / Planned‚Äù Zustand oder Mock/Fixture-Mode (kein silent fail, kein Raten).\n- **Fail-closed Gates:** Jede √Ñnderung, die Engine-Routen oder UI‚ÜîEngine Calls betrifft, muss einen Gate-Check aktualisieren/erweitern (script/CI), der uncontracted Routes bzw. direkte Engine-Fetches au√üerhalb `EngineClient` verhindert.\n- **schemaVersion:** F√ºr Contract-Endpunkte muss Response `schemaVersion` enthalten (additiv, kein Breaking Change). UI pr√ºft `schemaVersion` best-effort und zeigt bei Mismatch einen klaren Fehler inkl. `requestId` (falls vorhanden).\n\n[weitere DB-/Auth-Guardrails aus Policy hier erg√§nzen]\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSLEbkA","name":"codefactory","description":"","color":"ededed"}],"number":679,"state":"CLOSED","title":"E73 ‚Äî Content System (echter Content, kein Mock)"},{"body":"\n\nEpic: E1 (v0.7)\nType: Refactor / Adoption / Quality Gate\nPriority: P0 (Design-Abnahme-Blocker)\nSurface: apps/rhythm-patient-ui (alle Patient-Routen)\n\nIntent (Outcome)\n\nDie gesamte Patient UI ist konsequent aus dem kanonischen Mobile-v2 Design-Paket gebaut:\n\nkeine ‚Äúfreih√§ndigen‚Äù Tailwind-Implementierungen pro Page,\n\nkeine Ersatz-Icons, wenn Spec-Assets existieren,\n\nkeine Layout-Constraints (max-w-*, container, prose) in (mobile) Pages,\n\nStyling/Spacing/Typo zentral √ºber UI Kit Primitives/Tokens steuerbar.\n\nWarum das machbar ist\n\nJa, das ist machbar, wenn wir es als mechanische Migration behandeln:\n\nPages werden zu Compositions,\n\nalle Primitives kommen aus src/components/patient-ui/* (Wrapper) bzw. Vendor src/vendor/rhythm_mobile_v2/*,\n\nGates (verify:ui-v2, guardrails) verhindern Regression.\n\nScope\n\nIn\n\nAlle Patient UI Routen unter apps/rhythm-patient-ui/app/patient/**\n\nFokus insbesondere auf (mobile) Route Group (v2 Architektur)\n\nMigration von:\n\nButtons, Cards, Tiles, Badges, Progress, Inputs, Radios, Nav, TopBar/BottomNav\n\nIcons/Grafiken ‚Üí Spec SVG/PNG\n\nfreie Tokens ‚Üí zentrale Tokens\n\nErg√§nzung/Erweiterung von scripts/verify-ui-v2.mjs falls n√∂tig (nur wenn L√ºcken)\n\nOut\n\nMedizinische Logik/AMY live\n\nBackend-Semantik √Ñnderungen (nur UI wiring + contracts)\n\nRedesign\n\nGuardrails (Non-Negotiables)\n\nNo ad-hoc primitives in Patient Pages: keine eigenen rounded-* shadow-* bg-* text-* ‚ÄúKonstrukte‚Äù, wenn UI Kit Pendant existiert.\n\nNo forbidden width patterns in (mobile) pages (max-w-*, container, prose). npm run verify:ui-v2 muss gr√ºn sein.\n\nNo placeholder icons: wenn Spec Asset existiert ‚Üí nur Spec.\n\nMinimal-diff pro Route, aber repo-weit konsequent.\n\nImplementation Plan (Packages)\nPackage 1 ‚Äî Inventory + Mapping (evidence-first)\n\n Erzeuge eine Liste aller Patient Pages/Routes:\n\napps/rhythm-patient-ui/app/patient/**/page.tsx\n\n F√ºr jede Route: klassifiziere:\n\nv2 mobile? (unter (mobile))\n\nverwendet UI Kit vollst√§ndig / teilweise / gar nicht\n\nenth√§lt verbotene Patterns (max-w/container/prose) oder Legacy Imports\n\n Output als Datei: apps/rhythm-patient-ui/docs/PATIENT_UI_V2_ADOPTION_MAP.md\n(Route ‚Üí Status, TODOs, betroffene Komponenten)\n\nAcceptance\n\nMap deckt 100% der Patient routes ab.\n\nMindestens: listet alle Violations (width patterns, legacy imports, placeholder icons).\n\nPowerShell\n\nGet-ChildItem .\\apps\\rhythm-patient-ui\\app\\patient -Recurse -Filter page.tsx |\n  Select-Object FullName | Sort-Object\n\nrg -n \"max-w-|\\\\bcontainer\\\\b|\\\\bprose\\\\b\" .\\apps\\rhythm-patient-ui\\app\\patient -S\nrg -n \"lucide-react|heroicons|from \\\"@/app\" .\\apps\\rhythm-patient-ui\\app\\patient -S\n\nPackage 2 ‚Äî Primitives vollst√§ndig standardisieren (UI Kit als einzige Quelle)\n\n Stelle sicher, dass es Wrapper/Exports gibt (oder erstelle sie), die alle √ºblichen Primitives abdecken:\n\nPrimaryButton, SecondaryButton, IconButton\n\nCard, Tile, Section, Divider\n\nBadgePill, ProgressBar, RadioOptionRow, Tabs/SegmentTabs\n\nTopBar, BottomNav\n\nIconSquare + Spec SVG registry\n\n Jede Patient Page muss Primitives ausschlie√ülich von dort beziehen.\n\nAcceptance\n\nEs gibt keine duplicative UI primitive Implementierung mehr in Pages.\n\nPackage 3 ‚Äî Route-by-route Migration (mechanisch, deterministisch)\n\n F√ºr jede Patient Route:\n\nErsetze ad-hoc Markup durch UI Kit Komponenten.\n\nEntferne max-w-*, container, prose in (mobile).\n\nEntferne Ersatz-Icons ‚Üí Spec icons.\n\nStelle sicher: Empty/Error States nutzen UI Kit (keine blank).\n\n Wichtig: Keine funktionale Logik √§ndern, nur UI-Komposition.\n\nAcceptance\n\nnpm run verify:ui-v2 gr√ºn.\n\nUI wirkt konsistent √ºber alle Routen (Nav, spacing, cards).\n\nPackage 4 ‚Äî Repo-weite Regression Prevention (strengthen verify:ui-v2)\n\n Erg√§nze verify-ui-v2.mjs um:\n\n‚ÄúNo ad-hoc primitives‚Äù (heuristisch): verbiete in (mobile) pages bestimmte Klassencluster (z.B. rounded-, shadow-, bg-, text-) wenn nicht aus UI Kit importiert (allowlist needed).\n\n‚ÄúNo placeholder icons‚Äù: verbiete lucide-react imports in (mobile) pages (allowlist falls n√∂tig).\n\n Fail-closed: lieber wenige false-positives, aber klarer Fixpfad.\n\nAcceptance\n\nJede neue Abweichung wird automatisch als violation gefangen.\n\nAcceptance Criteria (Definition of Done)\n\nAlle Patient Routen sind UI Kit / Spec-driven:\n\nkeine max-w-*/container/prose in (mobile)\n\nkeine Ersatz-Icons, wenn Spec Assets existieren\n\nPages sind Compositions, keine ad-hoc UI primitives\n\nnpm run build gr√ºn\n\nnpm run verify gr√ºn\n\nnpm run verify:ui-v2 gr√ºn\n\nVerify (PowerShell)\nnpm run build\nnpm run verify\nnpm run verify:ui-v2","labels":[],"number":677,"state":"CLOSED","title":"E71.F5 - UIADOPT ‚Äî Patient UI v2: UI Kit konsequent auf alle Patient-Routen anwenden (Spec-driven, no ad-hoc UI)"},{"body":"\nEpic: E1 (v0.7)\nType: Fix / Prevent Regression\nPriority: P0 (Design-Abnahme-Blocker)\nOwner Surface: apps/rhythm-patient-ui (prim√§r), ggf. shared layout/wrapper\n\nIntent (Outcome)\n\nDer ‚Äúschmale Box‚Äù Fehler (Screen-Compositions werden durch container/prose/max-w-* zu schmal gerendert) tritt nicht mehr auf und kann nicht unbemerkt wieder eingef√ºhrt werden.\n\nProblem / Evidence\n\nIn der Design-System-Seite (Component Gallery + Screen Gallery) wird der gerenderte Screen (z.B. Dashboard) erneut in eine schmale Spalte gezwungen. Das deutet auf einen √ºbergeordneten Layout-Wrapper (z.B. container, max-w-*, prose) oder ein falsches Frame-Pattern hin.\n\nRoot Cause Hypothese (zu verifizieren)\n\nDev/Docs Layout nutzt container/prose und umschlie√üt die Screen Gallery.\n\nScreen Gallery rendert Screens ohne ‚ÄúFullBleed‚Äù/DeviceFrame, sodass Parent Constraints durchschlagen.\n\nFix wurde lokal (Page) gemacht, aber ein anderes nested layout (App Router) greift wieder.\n\nScope\n\nIn:\n\nScreen Gallery Route (z.B. /patient/dev/components oder design system page)\n\nImplementierung eines kanonischen Frame-Patterns (FullBleed, DeviceFrame)\n\nRepo-weite Regression-Prevention (Guardrail Script oder Test)\n\nOut:\n\nGlobales Entfernen von container/max-w-* aus allen Pages (w√ºrde Docs/Admin zerst√∂ren)\n\nRedesign von Layouts au√üerhalb des Screen-Kontexts\n\nImplementation Plan\nPackage 1 ‚Äî Diagnose (evidence-first)\n\n Finde die konkrete Route/Page, die den Screenshot erzeugt (Design System Page).\n\n Identifiziere den Constraint:\n\nParent container / max-w-* / prose\n\noder Screen Root setzt selbst max-w-*/container\n\n Dokumentiere Fundstelle (Datei + relevante Klassen/Markup) im Issue-Kommentar.\n\nPass/Fail\n\nPass: genaue Ursache ist lokalisiert (1‚Äì2 Dateien).\n\nFail: Ursache nicht lokalisierbar ‚Üí weitere Suche in Layout-Hierarchie.\n\nPackage 2 ‚Äî Kanonischer Fix: FullBleed + DeviceFrame\n\n Implementiere zwei Wrapper (oder √§quivalent):\n\nFullBleed: neutralisiert Parent Constraints f√ºr ‚ÄúScreens‚Äù\n\nerzwingt w-full max-w-none und verhindert prose/container Side-Effects\n\nDeviceFrame: rendert in fester Phone-Breite (z.B. 390px) + Frame UI\n\nOuter: mx-auto w-[390px] max-w-full\n\nInner: w-full max-w-none overflow-hidden rounded-* border shadow\n\n Screen Gallery rendert jede Screen-Composition innerhalb DeviceFrame, und der Screen Root bekommt immer w-full max-w-none.\n\n Falls Screen-Komponenten intern container/max-w-* setzen:\n\nf√ºge className/rootClassName Prop hinzu oder entferne Constraint nur im Gallery-Kontext (minimal-diff).\n\nPass/Fail\n\nPass: Screen Gallery zeigt Dashboard/Assessments/‚Ä¶ in korrekter Phone-Breite, keine schmale Spalte.\n\nFail: Screen bleibt schmal ‚Üí weiterer Constraint gefunden und ebenfalls neutralisiert.\n\nPackage 3 ‚Äî Repo-wide Prevention (Guardrail)\n\nW√§hle eine der Optionen (bevorzugt A + optional B):\n\nA) Static Guard Script (schnell, robust)\n\n Implementiere scripts/guard-no-narrow-screens.mjs:\n\nPr√ºft definierte ‚ÄúScreen Routes‚Äù/Komponenten (z.B. app/patient/dev/components/** und/oder ScreenGallery component)\n\nFail, wenn im unmittelbaren Wrapper container oder prose oder max-w- vorkommt ohne gleichzeitiges max-w-none/FullBleed\n\n Hook in npm run verify oder repo:verify.\n\nB) Visual/Smoke Test\n\n Falls Playwright vorhanden: Screenshot-Test f√ºr Screen Gallery, der Layout-Diff sofort zeigt.\n\nPass/Fail\n\nPass: Guardrail schl√§gt in CI/verify fehl, wenn der Fehler wieder eingef√ºhrt wird.\n\nFail: Guardrail zu noisy ‚Üí Regex/Scope enger machen.\n\nAcceptance Criteria\n\nScreen Gallery (alle Tabs) rendert in stabiler Phone-Breite (keine schmale Spalte).\n\nFix ist robust gegen Parent Layouts (container/prose/max-w-*).\n\nGuardrail verhindert Wiederkehr.\n\nnpm run build ist gr√ºn.\n\n(Optional) Playwright Test gr√ºn.\n\nEvidence / Artifacts\n\nScreenshot ‚Äúvorher/nachher‚Äù (oder URL + Beschreibung)\n\nListe ge√§nderter Dateien + rationale pro Datei\n\nPowerShell Verify\nnpm run build\n\n# Optional: falls Guard in verify integriert\nnpm run verify\n\n# Manuell:\n# /patient/dev/components (oder relevante Design-System-Route)\n# Tab Dashboard: Screen Phone-breit, nicht schmal","labels":[],"number":674,"state":"CLOSED","title":"E71.F4  ‚Äî ‚ÄúSchmale Box‚Äù dauerhaft eliminieren (repo-wide Guardrail + FullBleed/DeviceFrame)"},{"body":"I2.6 ‚Äî v0.7 Patient Smoke Pack: Testlauf (Template) + optional Playwright Smoke\n\nProblem\nEpic 2 muss √ºber einen reproduzierbaren Testlauf abgenommen werden, nicht per Bauchgef√ºhl.\n\n‚ûï I72.6 ‚Äî Assessment Handoff Contract (nicht implementieren, nur anbinden)\nIntent: E72 kann zuverl√§ssig testen, ohne dass Assessment schon 100% final ist ‚Äì aber wenn Assessment existiert, wird es genutzt.\nScope:\n\nDefiniere ‚ÄúAssessmentSummary‚Äù als Teil des PatientState (z. B. lastAssessment: { status, funnelSlug, updatedAt, answersCount, reportId? }).\n\nAMY Orchestrator liest lastAssessment und entscheidet:\n\nwenn none: schl√§gt ‚ÄúAssessment starten‚Äù als Aktion vor (f√ºhrt auf Entry), keine Fake-Resultate.\n\nwenn in-progress: schl√§gt ‚ÄúFortsetzen‚Äù vor.\n\nwenn completed: kann ‚ÄúInsights/Next Step/Content‚Äù triggern.\n\nKeine neue Assessment-Logik; nur read + routen.\nAcceptance:\n\nOhne Assessment: AMY zeigt klare Action ‚ÄúAssessment starten‚Äù und es gibt keinen kaputten Pfad.\n\nMit in-progress: AMY bietet ‚ÄúFortsetzen‚Äù.\n\nMit completed: AMY kann ‚ÄúInsights‚Äù/‚ÄúNext Step‚Äù ausl√∂sen.\n\nnpm run build, npm run verify, npm run verify:ui-v2 gr√ºn.\n\nSo umgeht ihr das Assessment nicht ‚Äì ihr macht E72 robust gegen den aktuellen Assessment-Stand.\n\nDeliverables\n- docs/test-runs/v0.7_patient_smoke.md (oder bestehender Testlauf-Ordner) nach eurem Template:\n  - Zweck, Scope, Intent, Ablauf, Expected, Ist, Artefakte (URLs/Screenshots), Abweichungen, Entscheidung.\n- Optional: minimaler Playwright Smoke (kein Pixel, nur navigation + presence checks):\n  - dashboard loads\n  - start assessment ‚Üí results visible\n  - results ‚Üí dialog loads with context\n  - insights shows activity after completion\n\nAcceptance Criteria\n- Testlauf ist vollst√§ndig ausgef√ºllt und referenziert die kanonischen URLs.\n- Pass/Fail ist eindeutig.\n\nPowerShell Verify\n```\nnpm run build\n# optional:\n# npm run test:e2e\n```\n\nGuardrails are mandatory and fail-closed.\nBefore implementing: run `npm run preflight` and paste the output as evidence.\n- R-DB-009: RLS verify must pass; update allowlist only with justification + rule-id link.\n- R-DB-007: Typegen verify must pass using scripts/db/typegen.ps1 (pinned supabase@2.63.1, --local). If drift: run -Generate and commit lib/types/supabase.ts.\n- Endpoint wiring: any new /api route must have a literal callsite OR be allowlisted with justification.\n- Migrations: any CREATE POLICY must be guarded (DROP POLICY IF EXISTS or pg_policies DO-block).\nEvidence-first: quote failing gate output before changing code. Minimal diff only.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":673,"state":"CLOSED","title":"[I2.6] v0.7 Patient Smoke Pack: Testlauf (Template) + optional Playwright Smoke"},{"body":"I2.5 ‚Äî Navigation Consistency: TopBar/BottomNav, Back/Close Semantik, No Redirect Surprises\n\nProblem\nMobile Shell ist sensibel; kleine Inkonsistenzen erzeugen Loops/Deadends. Wir brauchen kanonische Regeln f√ºr Back/Close je Flow.\n\nRequirements\n- Definiere verbindliche Navigation Semantik:\n  - Assessment Flow: Close ‚Üí Assessments List (oder Dashboard, aber deterministisch)\n  - Dialog: Back ‚Üí last non-dialog screen (fallback: Dashboard)\n  - Results: Back ‚Üí Dashboard oder Assessments List (deterministisch)\n- Entferne ‚Äúrandom redirects‚Äù: Aliases d√ºrfen redirecten, aber nur zu kanonischen Routes.\n- Sicherstellen: TopBar Varianten (Back+Close vs Hamburger+Bell+Avatar) sind konsistent pro Screen.\n\nAcceptance Criteria\n- Keine Redirect-Loops in Patient UI.\n- Back/Close f√ºhrt reproduzierbar zum selben Ziel.\n\nPowerShell Verify\n```\nnpm run build\n# Manuell: Back/Close in Flow/Dialog/Results mehrfach testen (inkl. reload)\n```\n\nGuardrails are mandatory and fail-closed.\nBefore implementing: run `npm run preflight` and paste the output as evidence.\n- R-DB-009: RLS verify must pass; update allowlist only with justification + rule-id link.\n- R-DB-007: Typegen verify must pass using scripts/db/typegen.ps1 (pinned supabase@2.63.1, --local). If drift: run -Generate and commit lib/types/supabase.ts.\n- Endpoint wiring: any new /api route must have a literal callsite OR be allowlisted with justification.\n- Migrations: any CREATE POLICY must be guarded (DROP POLICY IF EXISTS or pg_policies DO-block).\nEvidence-first: quote failing gate output before changing code. Minimal diff only.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":672,"state":"CLOSED","title":"[I2.5] Navigation Consistency: TopBar/BottomNav, Back/Close Semantik, No Redirect Surprises"},{"body":"I2.4 ‚Äî Personal Insights v2: Data Binding an PatientState (kein hardcoded Demo)\n\nProblem\nInsights darf nicht nur Demo-UI sein; es muss Daten aus PatientState konsumieren und auf Assessment/Results reagieren.\n\nRequirements\n- GET state ‚Üí Insights rendert:\n  - Health Score (value + delta)\n  - Key Metrics cards (HR/BP/Sleep/Weight) + chart placeholders/mini series\n  - Milestones + Recent Activity (aus state.activity)\n  - ‚ÄúGenerate Report‚Äù nutzt denselben Report Stub wie Results\n  - Empty State: wenn keine Daten ‚Üí klare UI (‚ÄúNo insights yet. Complete an assessment.‚Äù)\n\nAcceptance Criteria\n- Nach Abschluss/Mock-Abschluss eines Assessments taucht ein Recent Activity Entry auf und (mindestens) ein Metric/Score aktualisiert sich.\n- Keine hardcoded ‚ÄúSarah‚Äù Daten ohne State-Bezug.\n\nPowerShell Verify\n```\nnpm run build\n# Manuell:\n# /patient/insights-v2 ‚Üí leerer State zeigt CTA\n# Assessment/Mock completion ‚Üí Insights zeigt Activity Update\n```\n\nGuardrails are mandatory and fail-closed.\nBefore implementing: run `npm run preflight` and paste the output as evidence.\n- R-DB-009: RLS verify must pass; update allowlist only with justification + rule-id link.\n- R-DB-007: Typegen verify must pass using scripts/db/typegen.ps1 (pinned supabase@2.63.1, --local). If drift: run -Generate and commit lib/types/supabase.ts.\n- Endpoint wiring: any new /api route must have a literal callsite OR be allowlisted with justification.\n- Migrations: any CREATE POLICY must be guarded (DROP POLICY IF EXISTS or pg_policies DO-block).\nEvidence-first: quote failing gate output before changing code. Minimal diff only.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":671,"state":"CLOSED","title":"[I2.4] Personal Insights v2: Data Binding an PatientState (kein hardcoded Demo)"},{"body":"I2.3 ‚Äî Results Actions Wiring: Report Stub + Disabled Actions mit Reasons\n\nProblem\nResults Screen ist UI-seitig da, aber Actions sind nicht sauber wired (Download/Video/Visit). Dead links sind nicht akzeptabel.\n\nRequirements\n- ‚ÄúDownload Full Report‚Äù:\n  - Implementiere stub contract √ºber API route, z.B. GET /api/patient/reports/latest oder GET /api/patient/reports/:assessmentId\n  - Response: entweder Download (minimal PDF placeholder) oder JSON, aber UI muss konsistent sein (wenn JSON: Button hei√üt ‚ÄúView Report (stub)‚Äù)\n- ‚ÄúStart Video Consultation‚Äù / ‚ÄúBook In-Person Visit‚Äù:\n  - Wenn nicht implementiert: disabled + sichtbarer Reason (‚Äúcoming soon‚Äù / ‚Äúpilot not enabled‚Äù)\n- Results muss aus Assessment Completion erreichbar sein (auch Mock completion).\n\nAcceptance Criteria\n- Keine Action f√ºhrt ins Leere: entweder funktioniert oder disabled mit Reason.\n- Results zeigt ‚ÄúRecommended Actions‚Äù konsistent.\n\nPowerShell Verify\n```\nnpm run build\n# Manuell:\n# /patient/results-v2 ‚Üí Download Full Report funktioniert (stub) oder zeigt klare Stub UI\n# Video/Visit disabled mit Reason\n```\n\nGuardrails are mandatory and fail-closed.\nBefore implementing: run `npm run preflight` and paste the output as evidence.\n- R-DB-009: RLS verify must pass; update allowlist only with justification + rule-id link.\n- R-DB-007: Typegen verify must pass using scripts/db/typegen.ps1 (pinned supabase@2.63.1, --local). If drift: run -Generate and commit lib/types/supabase.ts.\n- Endpoint wiring: any new /api route must have a literal callsite OR be allowlisted with justification.\n- Migrations: any CREATE POLICY must be guarded (DROP POLICY IF EXISTS or pg_policies DO-block).\nEvidence-first: quote failing gate output before changing code. Minimal diff only.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":670,"state":"CLOSED","title":"[I2.3] Results Actions Wiring: Report Stub + Disabled Actions mit Reasons"},{"body":"I2.2 ‚Äî AMY Dialog MVP: Screen, Entry Points, Context Pack (stubbed conversation)\n\nProblem\n/patient/dialog ist nicht ausreichend ‚Äúflow-ready‚Äù: Es braucht deterministische Entry Points (Dashboard/Results) und einen minimalen Conversation Contract mit Context.\n\nScope\nPatient Dialog UI + minimal stubbed assistant responses.\n\nFunctional Requirements\n- Entry Points:\n  - Dashboard Hero (‚ÄúChat with AMY‚Äù) ‚Üí /patient/dialog?context=dashboard\n  - Results CTA (‚ÄúContinue Dialog with AMY‚Äù) ‚Üí /patient/dialog?context=results&assessmentId=<id>\n- Context Pack:\n  - Bei context=results: initiale System-/Assistant-Message enth√§lt kurze Results Summary (aus PatientState) oder zeigt ‚ÄúNo results yet‚Äù.\n  - Bei context=dashboard: neutraler Start.\n- Conversation Contract (minimal):\n  - messages: { id, role: \"user\"|\"assistant\"|\"system\", text, createdAt, context? }\n  - typing state, send disable on empty\n- Stub response:\n  - deterministisch (z.B. based on context + last message length), kein ‚ÄúRandom‚Äù\n- Persistenz:\n  - speichere messages im PatientState (dialog.messages oder dialog.threadId), mindestens lastMessageAt + count.\n\nAcceptance Criteria\n- /patient/dialog l√§dt immer (keine blank states), zeigt Kontext korrekt.\n- Senden erzeugt user message + stub assistant reply, beides sichtbar.\n- Return-Navigation (Back / BottomNav) funktioniert deterministisch.\n\nPowerShell Verify\n```\nnpm run build\n# Manuell:\n# /patient/dashboard ‚Üí Chat with AMY ‚Üí send msg ‚Üí reload ‚Üí messages persistieren (mind. count/lastMessageAt)\n# /patient/results-v2 ‚Üí Continue Dialog ‚Üí Kontext sichtbar\n```\n\nGuardrails are mandatory and fail-closed.\nBefore implementing: run `npm run preflight` and paste the output as evidence.\n- R-DB-009: RLS verify must pass; update allowlist only with justification + rule-id link.\n- R-DB-007: Typegen verify must pass using scripts/db/typegen.ps1 (pinned supabase@2.63.1, --local). If drift: run -Generate and commit lib/types/supabase.ts.\n- Endpoint wiring: any new /api route must have a literal callsite OR be allowlisted with justification.\n- Migrations: any CREATE POLICY must be guarded (DROP POLICY IF EXISTS or pg_policies DO-block).\nEvidence-first: quote failing gate output before changing code. Minimal diff only.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":669,"state":"CLOSED","title":"[I2.2] AMY Dialog MVP: Screen, Entry Points, Context Pack (stubbed conversation)"},{"body":"I2.1 ‚Äî Canonical Patient State v0.1 (Minimal Persistence + Versioning)\n\nProblem\nDialog/Insights ben√∂tigen einen gemeinsamen, stabilen State (Assessment progress, Results summary, Recent Activity). Aktuell sind Teile UI-only.\n\nScope\napps/rhythm-patient-ui + minimaler serverseitiger Endpunkt (Next route handler) oder existierender Storage-Mechanismus (falls bereits im Repo etabliert). Keine neue Architektur.\n\nImplementation Requirements\n- Introduce PatientState v0.1 als minimale, versionierte Struktur (z.B. patient_state_version: \"0.1\").\n- Enth√§lt mindestens:\n  - assessment: lastAssessmentId, status (not_started/in_progress/completed), progress (0‚Äì1), completedAt?\n  - results: short summary cards (3‚Äì5), recommendedActions (ids), lastGeneratedAt\n  - dialog: lastContext (dashboard/results), messageCount, lastMessageAt\n  - activity: recentActivity[] (type, label, timestamp)\n  - metrics: healthScore (current + delta), keyMetrics (HR/BP/Sleep/Weight series minimal)\n- Storage:  Preferred: existierender Server/DB Pfad im Projekt. Wenn nicht verf√ºgbar: interim server-side KV / file-based dev store (nur wenn im Projekt √ºblich) oder LocalStorage klar gekennzeichnet + TODO; aber muss deterministisch reloadbar sein.\n\nAcceptance Criteria\n- Reload/Navigation verliert den Status nicht (mindestens innerhalb einer Session; wenn DB verf√ºgbar dann persistent).\n- State ist versioniert; bei fehlendem State: sauberer Default/Empty.\n- Keine neuen UI-Tokens; UI konsumiert nur State.\n\nEvidence / Verification\n- Route(s) dokumentiert: wo wird gelesen/geschrieben.\n- Manuell nachweisbar: ‚ÄúAssessment completed‚Äù ‚Üí Results/Insights zeigen neue Activity.\n\nPowerShell Verify\n```\nnpm run build\n# Manuell:\n# /patient/dashboard ‚Üí navigieren ‚Üí reload ‚Üí State bleibt konsistent\n```\n\nVS-Code Copilot Prompt\nDu bist mein Implementation Copilot. Ziel: Canonical Patient State v0.1 einf√ºhren (minimal, versioniert, deterministisch) f√ºr apps/rhythm-patient-ui.\n\nSuche vorhandene Patterns (state, storage, api routes). Nutze bestehende Mechanismen statt neue Architektur.\n\nImplementiere PatientState v0.1 + Default State + Read/Write API (oder Storage Adapter).\n\nStelle sicher: Reload/Navigation bleibt konsistent; Empty/Not-found States sind explizit.\n\nOutput: changed files, rationale, PowerShell verify steps.\n\n### üîí Guardrails\n\nFail-closed: Alle Guardrail-Checks m√ºssen in CI gr√ºn sein; keine Umgehung au√üer explizit dokumentierter Ausnahme/Allowlist.\n\nDB Determinism: db-determinism Workflow muss laufen (Migrations-Linter, Schema-Manifest/Deprecated-Regeln, deterministische Seeds sofern relevant).\n\nRLS Verification (R-DB-009): scripts/db/verify-rls-policies.ps1 ist Gate; Allowlist: docs/canon/rls-allowlist.json; Verst√∂√üe = CI fail.\n\nTypeGen Hard Gate (R-DB-007): scripts/db/typegen.ps1 ist die einzige Typegen-Quelle (pinned npx supabase@2.63.1, mode --local), db:typegen:verify muss passen; bei Drift: -Generate ausf√ºhren und lib/types/supabase.ts committen.\n\nEvidence-first: Bei Guardrail-Failures m√ºssen Artefakte/Logs erzeugt werden (mind. artifacts/typegen/* f√ºr Typegen; artifacts/rls-verify/* f√ºr RLS), sodass ein Fix ohne R√§tselraten m√∂glich ist.\n\nAllowlists: √Ñnderungen an Allowlists sind nur mit Begr√ºndung + Link zur Rule-ID im PR/Issue erlaubt.\n[weitere DB-/Auth-Guardrails aus Policy hier erg√§nzen]\n---\n\nQuellen: [AFU-9 CodeFactory Epic Import Briefing]","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":668,"state":"CLOSED","title":"[I2.1] Canonical Patient State v0.1 (Minimal Persistence + Versioning)"},{"body":"**EPIC E2 (v0.7) ‚Äî Patient Loop MVP: Results ‚Üí AMY Dialog ‚Üí Insights (stateful, deterministisch, auditierbar)**\n\n**Intent (Outcome)**\nEin geschlossener Patient-Loop ist testbar und stabil:\nAssessment (E1) ‚Üí Results ‚Üí AMY Dialog ‚Üí Next Steps ‚Üí Personal Insights\nmit minimaler Persistenz, klaren Empty-States, ohne 404/Blank/Redirect-Loops.\n\n**Non-Negotiables (Guardrails)**\n- Evidence-first: jede Route zeigt klare Zust√§nde (loading/empty/error) statt silent fail.\n- Determinism: definierte Canonical Routes + Aliases (Redirects) ohne ‚Äúmagische‚Äù Spr√ºnge.\n- UI 1:1: Screens und Komponenten m√ºssen √ºber /patient/dev/components verifizierbar bleiben; keine ad-hoc UI.\n- PowerShell Verify Steps in jedem Issue.\n- Copilot-first: jedes Issue enth√§lt einen VS-Code Copilot Prompt.\n\n**Out of Scope**\n- Vollwertige medizinische Auswertung (AMY live) ‚Äì stub/mock ist ok.\n- Clinician/Studio Integration.\n- Echte Termin-/Video-Consult Integration (nur ‚Äúdisabled with reason‚Äù oder stub routing).\n- PDF Report Generator ‚Äúvoll‚Äù (nur stub contract).\n\n### üîí Guardrails\n\n**Contract-first / Anti-Drift (verpflichtend)**\n- **Source of Truth:** Repo-√ºbergreifende Contracts sind in `codefactory-control/docs/contracts/*` kanonisch (z.B. `docs/contracts/engine-api.v1.md`). Keine Implementierung/Anbindung ohne Contract-Eintrag.\n- **Engine:** `/api/dev/endpoints` ist **deployte Best√§tigung**, nicht Source of Truth. Neue/√§nderte Engine-Routen m√ºssen im Control-Contract dokumentiert sein; Catalog muss konsistent sein (`count == endpoints.length`, sortiert, optional `purpose`).\n- **UI:** Engine-Calls nur √ºber zentralen `EngineClient`/Adapter. **Keine** direkten `fetch`/HTTP-Aufrufe auf Engine-Endpunkte au√üerhalb des Clients. Wenn Contract-Endpunkt noch nicht deployt ist: expliziter ‚ÄúNot available / Planned‚Äù Zustand oder Mock/Fixture-Mode (kein silent fail, kein Raten).\n- **Fail-closed Gates:** Jede √Ñnderung, die Engine-Routen oder UI‚ÜîEngine Calls betrifft, muss einen Gate-Check aktualisieren/erweitern (script/CI), der uncontracted Routes bzw. direkte Engine-Fetches au√üerhalb `EngineClient` verhindert.\n- **schemaVersion:** F√ºr Contract-Endpunkte muss Response `schemaVersion` enthalten (additiv, kein Breaking Change). UI pr√ºft `schemaVersion` best-effort und zeigt bei Mismatch einen klaren Fehler inkl. `requestId` (falls vorhanden).\n\n[weitere DB-/Auth-Guardrails aus Policy hier erg√§nzen]\n---\n\nQuellen: [AFU-9 CodeFactory Epic Import Briefing]","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"}],"number":667,"state":"CLOSED","title":"EPIC E 72 - Patient Loop MVP: Results ‚Üí AMY Dialog ‚Üí Insights (stateful, deterministisch, auditierbar)"},{"body":"\nZiel\nAssessment ist aus Patient-Dashboard und Assessments-Liste vollst√§ndig und deterministisch nutzbar: Start ‚Üí Flow ‚Üí Abschluss ‚Üí Results/Next Steps ‚Üí R√ºcksprung, ohne Legacy-Deadends.\n\nProblem / Kontext (aktueller Stand)\nRoutes existieren, aber Wiring ist unvollst√§ndig bzw. nicht klar testbar:\n\n/patient/assess Alias existiert\n\nFlow-Route existiert (/patient/assess/[id]/flow)\n\nes gibt /patient/assessments-v2, /patient/results-v2, /patient/assessment-flow-v2, /patient/assessment\n\nDashboard-CTA wurde erg√§nzt (ProgressSummary), aber ist abh√§ngig von ‚Äúno funnels exist‚Äù und damit fragil als Epic-Abschlusskriterium.\n\nDeliverables\n\nEin kanonischer Einstiegspunkt (eine Route), der immer funktioniert.\n\nAssessments Liste mit Status/Progress und ‚ÄúContinue/Start/View Results‚Äù.\n\nFlow kann gestartet/fortgesetzt werden (Mock/Backend je nach v0.7 Stand), aber UI muss nicht ‚Äúleer‚Äù sein.\n\nResults/Next Steps Screen ist erreichbar nach Abschluss (oder Mock-Abschluss) und verlinkt zu Dialog / Report / Next action.\n\nGuardrails\n\nKeine ‚Äúhidden magic redirects‚Äù ohne UI; wenn etwas fehlt ‚Üí klare ‚ÄúNot ready / Missing data‚Äù UI.\n\nKeine Legacy Pfade mehr (nur Aliases, falls n√∂tig) ‚Äì Links m√ºssen auf kanonische Route zeigen.\n\nTasks\n\nA. Canonical Route festlegen und √ºberall verwenden\n\n Definiere eine kanonische Assessment-Entry-Route, z.B. /patient/assessments-v2 (Liste) und /patient/assess/<assessmentId>/flow (Flow)\n\n /patient/assess bleibt Shortcut: redirect ‚Üí Liste oder ‚Äúresume last in-progress‚Äù\n\n Entferne/entkoppel UI-Links von /patient/assessment und /patient/assessment-flow-v2, falls das nur alte Stubs sind (oder mache sie zu klaren Aliases mit Redirect + Hinweis)\n\nB. Dashboard-Wiring (nicht nur ‚Äúno funnels exist‚Äù)\n\n Dashboard-CTA ‚ÄúHealth Assessment‚Äù f√ºhrt deterministisch zur Liste oder Resume-Flow\n\n Wenn keine Daten vorhanden: zeige ‚ÄúNoch keine Assessments verf√ºgbar‚Äù + CTA (statt nichts)\n\nC. Assessments Liste (UI 1:1 nach Design)\n\n Karte pro Assessment: Status (Not started / In progress / Completed), Dauer, Progressbar, CTA\n\n Tabs/Filter (All / Not started / In progress / Completed) gem√§√ü Design\n\n Links:\n\nNot started ‚Üí Start (Flow)\n\nIn progress ‚Üí Continue (Flow)\n\nCompleted ‚Üí View results (/patient/results-v2 oder results per id)\n\nD. Flow UX (Question Screen)\n\n Question Screen entspricht Design (ProgressHeader, OptionRowRadio, Sticky Continue/Skip)\n\n Navigation: Back / Close im TopBar\n\n Minimaler State:\n\nmindestens ‚Äúselect option enables continue‚Äù\n\npersist local (URL param or in-memory) ist ok wenn Backend noch fehlt, aber UI darf nicht blockieren\n\nE. Results & Next Steps\n\n Results Screen entspricht Design (AMY Analysis complete, Situation cards, Actions)\n\n CTA: Continue dialog, Download report (kann stub sein), book video (stub ok)\n\n Return paths: BottomNav/Back f√ºhrt sauber zur√ºck\n\nAcceptance Criteria\n\nDiese drei manuellen Pfade sind durchg√§ngig nutzbar:\n\n/patient/dashboard ‚Üí CTA ‚Üí Assessment Liste/Resume\n\n/patient/assessments-v2 ‚Üí Start/Continue ‚Üí Flow\n\nAbschluss (oder mock completion) f√ºhrt zu /patient/results-v2 (oder results per assessment) mit UI, nicht leer\n\nKeine 404/blank states; wenn Daten fehlen: klare UI.\n\nAlle CTAs nutzen kanonische Routen (Aliases nur als Redirect).\n\nnpm run build gr√ºn.\n\nVerify (PowerShell)\nnpm run build\n\n# Manuelle Checks:\n# /patient/dashboard  -> CTA -> /patient/assessments-v2 (oder resume flow)\n# /patient/assess     -> redirect deterministisch\n# /patient/assessments-v2 -> Start/Continue -> /patient/assess/<id>/flow\n# /patient/results-v2 -> sichtbar, Actions klickbar (stub ok)","labels":[],"number":666,"state":"CLOSED","title":"E71.F3 ‚Äî Assessment-Strecke ‚ÄúEpic-1-ready‚Äù: Wiring, Entry, List, Flow, Results (deterministisch, testbar)"},{"body":"\n\nZiel\nDas Figma‚ÜíReact Export-Paket in docs\\rhythm_mobile_v2 (ZIP: ryhthm_mobile_v2) wird kanonische Quelle f√ºr Mobile-UI (Komponenten, Tokens, Icons, CSS). Wir verhindern ‚Äú√§hnlich aber nicht gleich‚Äù durch Vendor-Import + Visual Gate.\n\nScope\nPatient UI (apps/rhythm-patient-ui) ‚Äì nur UI-Layer (keine Backend-√Ñnderungen).\n\nProblem / Kontext\nDer Export existiert im Repo, wurde aber bisher nicht konsequent als Source of Truth genutzt. Ergebnis: Spacing/Typo/Icons/Gradients weichen ab.\n\nDeliverables\n\nVendor-Import des Pakets unver√§ndert (oder streng nachvollziehbar umbenannt) in App-Code.\n\nDev-Seite /patient/dev/components rendert 5 Referenz-Screens aus Vendor-Komponenten (Screen Gallery) + Component Gallery.\n\nAsset-Fail-Closed: Wenn Spec-Assets existieren, d√ºrfen keine Ersatz-Icons genutzt werden.\n\nVisual Regression Gate: Playwright Screenshot Tests f√ºr die 5 Referenz-Screens (Baseline committed).\n\nUmsetzungsvorgaben (Guardrails)\n\nKeine Re-Implementierung von UI-Komponenten ‚Äúnach Gef√ºhl‚Äù. Vendor-Komponenten sind prim√§r, Wrapper nur delegierend.\n\nKeine neuen Tokens erfinden: Farben/Spacing/Radii/Shadows m√ºssen aus Vendor-Tokens/CSS kommen.\n\nIcons/Grafiken ausschlie√ülich aus Vendor-Assets (SVG/PNG), solange vorhanden.\n\nTasks\n\nA. Vendor import & wiring\n\n Entpacktes Paket als Vendor hinzuf√ºgen: z.B. apps/rhythm-patient-ui/src/vendor/rhythm_mobile_v2/**\n\n Vendor globals.css aktivieren (Patient-App Root/Layout), ohne semantische √Ñnderungen (nur Pfadfixes).\n\n Vendor Tokens (lib/constants.ts o.√§.) als Runtime-Quelle nutzbar machen.\n\nB. Komponenten-Wrappers (Delegation)\n\n Wrapper unter apps/rhythm-patient-ui/src/components/patient-ui/** erstellen, die 1:1 auf Vendor exporte delegieren:\n\nTopBar, BottomNav\n\nHeroCard (AMY Assistant / AMY Analysis)\n\nStatTile / StatCard\n\nAssessmentCard / AssessmentListCard\n\nProgressHeader, OptionRowRadio, BadgePill, IconSquare\n\nButtons (Primary/Secondary/IconButton)\n\nC. /patient/dev/components\n\n Component Gallery: alle relevanten Komponenten inkl. States/Variants\n\n Screen Gallery: 5 Screens (Dashboard, Assessments, Assessment Question, Results/Next Steps, Personal Insights) als echte React-Compositions aus Vendor-Komponenten (mit Mock-Daten).\n\nD. Visual Regression\n\n Falls Playwright vorhanden: @playwright/test Screenshots f√ºr die 5 Screen Compositions\n\n Baselines einmalig erzeugen und committen\n\n CI/Verify so, dass Diffs sichtbar werden\n\nAcceptance Criteria\n\n/patient/dev/components zeigt pixel-nahe Umsetzung (Spacing/Typo/Radii/Shadows/Gradients/Icons) im Vergleich zum Export.\n\nIn Component/Screens Gallery keine lucide/hero/placeholder Icons, wenn Vendor-Assets existieren.\n\nnpm run build ist gr√ºn.\n\n(Wenn Playwright aktiv) npm run test:e2e (oder entsprechender Script) ist gr√ºn und Screenshot-Diffs schlagen fehl, wenn UI abweicht.\n\nVerify (PowerShell)\nnpm run build\n\n# Optional wenn Playwright vorhanden\nnpm run test:e2e\n\n# Manuell\n# /patient/dev/components\n# - Screen Gallery pr√ºfen: Dashboard / Assessments / Question / Results / Insights","labels":[],"number":664,"state":"CLOSED","title":"E71.F2  ‚Äî Design-Paket ryhthm_mobile_v2 als kanonische UI integrieren + 1:1 verifizieren"},{"body":"GitHub Issue (RHYTHM, AFU-9 Style) ‚Äî Systemischer Fix: Mobile v2 Default + Anti-Drift Guardrails\n\nContext / Problem\nWir sehen wiederholt: PR/Preview zeigt Mobile UI v2 (Designpattern sichtbar), aber Prod bzw. Standard-Routes rendern weiter Legacy-Layout/Container. Ergebnis:\n\nv2 Screens werden ‚Äúin‚Äù v1 Layout gerendert\n\nschmale Boxen durch alte max-w/container/mx-auto Wrapper\n\nFixes per Screen (z. B. DialogScreenV2 einf√ºgen) sind rumfuschen und regressieren bei jedem Issue erneut.\n\nGoal / Outcome\nMobile UI v2 ist systemisch der Default f√ºr Patient-Routes. Drift ist technisch unm√∂glich (CI Gate). Die ‚Äúnarrow boxes‚Äù sind dauerhaft beseitigt.\n\nScope (verbindlich)\nA) Einziger Default Entry f√ºr Patient UI v2\n\nIntroduce Route Group: app/patient/(mobile)/layout.tsx\n\ndieses Layout ist die kanonische H√ºlle f√ºr Mobile v2 (Shell + Tokens + Width rules).\n\nAlle v2 Patient-Screens liegen unter (mobile):\n\n/patient/dashboard, /patient/assess, /patient/dialog, /patient/profile\n\nAssessment Flow Routes ebenfalls\n\nLegacy Patient Layouts / Pages d√ºrfen nicht mehr den Default rendern:\n\nentweder entfernen, oder klar redirecten, oder auf allowlist setzen\n\nB) Root Cause Fix: Narrow Boxes\n\nEntferne/neutralisiere zentrierende Width-Constraints im Mobile-Pfad:\n\nverbieten in Mobile Content: container, max-w-*, prose, mx-auto centering wrapper (au√üer explizit dev-only frame)\n\nKanonische Layout-Regeln f√ºr Mobile:\n\nOuter: min-h-[100dvh] w-full\n\nContent: w-full max-w-none flex-1 overflow-y-auto\n\nCards: w-full\n\nPadding √ºber Tokens (z. B. px-4), nicht √ºber mx-auto max-w-*\n\nC) Guardrails: Anti-Drift CI Gates\n\nAdd script scripts/verify-ui-v2.(mjs|ts):\n\nFail wenn Patient Pages au√üerhalb (mobile) entstehen (Allowlist z. B. /patient/login, /patient/auth/* falls n√∂tig)\n\nFail wenn Patient Pages/Layouts Legacy-Container/Layout importieren (Blacklist Imports/Paths)\n\nFail wenn verbotene Width-Patterns in (mobile) pages auftreten (container|max-w-|prose|mx-auto), mit Allowlist nur f√ºr dev / test fixtures\n\nAdd npm script: npm run verify:ui-v2\n\nWire in CI (GitHub Actions / Vercel build step):\n\nverify:ui-v2 muss bei PR und main build laufen und blocken\n\nD) Dev Inspection Surface\n\nAdd /patient/dev/ui-v2 (dev-only)\n\nzeigt alle 5 Screens + states (loading/empty/error), damit visuelle Regressionen schnell auffallen\n\nOut of Scope\n\nKeine neuen Features (Funnel/Agenten/AMY logic)\n\nKein Redesign des Studios (au√üer bereits definierte Sidebar/Nav Fixes in separaten Issues)\n\nKeine Datenmodelle erweitern (nur UI wiring + guardrails)\n\nAcceptance Criteria (Pass/Fail, ohne Interpretation)\n\nA. Default Mobile v2\n\n√ñffne /patient/dialog ‚Üí rendert MobileShellV2 + v2 Tokens (kein Legacy Layout)\n\n√ñffne /patient/dashboard, /patient/assess, /patient/profile ‚Üí dito\n\nRefresh auf jeder Route bleibt v2\n\nB. Narrow boxes fixed\n\nAuf /patient/dialog sind Cards/Container full width wie im Design (keine schmale Spalte)\n\nKeine max-w-* / container constraints im Mobile Content Path\n\nC. Guardrails enforce\n\nnpm run verify:ui-v2 schl√§gt fehl, wenn jemand:\n\neine Patient Page au√üerhalb (mobile) anlegt (nicht allowlisted)\n\nverbotene Width-Patterns einf√ºhrt\n\nLegacy Layout/Container importiert\n\nCI blockt PR zuverl√§ssig bei Fail\n\nD. Repro / Verify\n\nEs existiert eine kurze Verify-Anleitung in docs/v07/E71_UIV2_GUARDRAILS.md oder im Issue Body:\n\nPowerShell commands\n\nmanuelle UI checks\n\nImplementation Notes (guidance, nicht zwingend)\n\nRoute Groups in Next.js App Router sind das sauberste Mittel, um Default Layout zu erzwingen.\n\n‚ÄúPhone frame‚Äù darf nur im Dev Preview existieren, nicht im Produktlayout.\n\nVerify (PowerShell)\nnpm ci\nnpm run build\nnpm run verify:ui-v2\nnpm run start\n# Browser:\n# /patient/dashboard\n# /patient/assess\n# /patient/dialog\n# /patient/profile\n# /patient/dev/ui-v2","labels":[],"number":656,"state":"CLOSED","title":"E71.F1 ‚Äî Systemischer Mobile-v2 Switch: Default Layout erzwingen + ‚Äúnarrow boxes‚Äù fixen + CI Guardrails gegen UI-Drift"},{"body":"### Intent\nEpic ist nur done, wenn Abnahme reproduzierbar dokumentiert ist.\n\n### Scope\nErstelle `docs/v07/E71_SMOKE.md` mit:\n* Setup: commands\n* Patient test flow (step-by-step, expected results)\n* Studio test flow (sidebar scroll, nav config apply, dark-only)\n* Failure checklist (loop, 404, crash)\n* Screenshots optional (oder referenz zu deinen Bildern)\n\n### Acceptance Criteria\n* Dritter kann Epic pr√ºfen und Pass/Fail dokumentieren\n* Enth√§lt exakte URLs und Klickpfade\n\n### Verify\n* Doc einmal selbst durchlaufen und L√ºcken schlie√üen\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":650,"state":"CLOSED","title":"I71.8 ‚Äî Smoke & Acceptance Pack (E71 pr√ºfbar f√ºr Dritte)"},{"body":"### Intent\nMobile v2 ist light-only f√ºr Stabilit√§t/Testbarkeit.\n\n### Scope\n* Entferne theme switching im Patient\n* Ignoriere/cleare persisted theme values\n* Stelle sicher, dass mobile tokens light palette sind\n\n### Acceptance Criteria\n* Kein theme toggle sichtbar\n* Mobile ist immer light\n* Keine Layout-/Color regressions in 5 Screens\n\n### Verify\n* Clear site data, reload, navigate all screens\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":649,"state":"CLOSED","title":"I71.7 ‚Äî Theme Simplification:  Patient Mobile light-only (remove dark/light)"},{"body":"### Intent\nStudio ist arbeitsf√§hig:  Sidebar layout korrekt, Navigation-Feature wirkt real, Theme drift weg.\n\n### Scope A ‚Äî Sidebar Layout\n* Sidebar container: `height: 100dvh`, flex column\n* Nav list: `flex:1; overflow-y:auto`\n* Footer (user/logout): always reachable (sticky or flex-end)\n\n### Scope B ‚Äî Navigation Config Functional\n* `/admin/navigation`:\n  * role tabs: Patient/Clinician/Admin/Nurse\n  * enable/disable item\n  * reorder item (drag or up/down controls)\n  * Save button, clear success/error feedback\n* Persistenz:\n  * `GET/PUT /api/admin/navigation-config?role=...`\n  * Speicherung in DB oder canonical server store\n* Apply:\n  * Sidebar renderer nutzt diese Config als source-of-truth\n  * Default config wenn none exists\n\n### Scope C ‚Äî Dark-only\n* Entferne theme toggle/switch in Studio\n* Force dark theme (keine light drift via stored prefs)\n\n### Acceptance Criteria\n* Sidebar geht visuell bis unten, nav ist scrollbar\n* Navigation Config: \n  * toggle off ‚Üí item weg nach save+reload\n  * reorder ‚Üí neue Reihenfolge nach save+reload\n  * role switch ‚Üí config pro role separat\n* Studio ist immer dark (kein toggle, kein light mode)\n\n### Verify\n* UI: viewport klein machen, sidebar scroll\n* UI: /admin/navigation edit, reload, check sidebar\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":648,"state":"CLOSED","title":"I71.6 ‚Äî Studio Workbench:  Sidebar full-height+scroll, Navigation Config persist+apply, Studio dark-only"},{"body":"### Intent\nPatient ist testbar nur wenn Auth stabil:  Logout bleibt Logout, keine auto-relogin, keine bouncing redirects.\n\n### Scope\n* Finde alle auth/session restore Mechanismen (middleware + client)\n* Setze **single source of truth** f√ºr session state\n* Fix logout: \n  * clear tokens/cookies korrekt\n  * verhindert immediate refresh/restore\n* Redirect policy (verbindlich):\n  * unauth user ‚Üí login\n  * auth user ‚Üí patient shell\n  * nach logout ‚Üí login und nicht zur√ºck springen\n\n### Acceptance Criteria\n* Logout ‚Üí hard reload ‚Üí bleibt logout\n* Kein \"rein/raus\" Loop (Network tab: keine wiederholten /session calls)\n* Keine 401 spam loops\n\n### Verify\n* Login ‚Üí navigate tabs ‚Üí logout ‚Üí reload ‚Üí login screen\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN-0g","name":"auth","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":647,"state":"CLOSED","title":"I71.5 ‚Äî Patient Auth Stabilisierung:  Logout sticks, keine Redirect-Loops"},{"body":"### Intent\nAssessment ist nach Epic 1 **nicht nur UI**:  Antworten persistieren, Flow resume funktioniert.\n\n### Scope\n* Definiere API/Adapter (verbindliche Signaturen):\n  * `loadAssessmentRun(assessmentId): { stepIndex, answersByQuestionId }`\n  * `saveAnswer(assessmentId, questionId, answer, clientMutationId)`\n  * `completeAssessment(assessmentId)`\n* Idempotenz:\n  * `clientMutationId` verhindern doppeltes Speichern bei Double-tap\n* Resume: \n  * Reload zeigt zuletzt gew√§hlte Antwort + korrekten Step\n* Storage:\n  * bevorzugt vorhandene DB/API (Supabase). Falls nicht vorhanden, minimaler server endpoint anlegen (nicht localStorage-only).\n\n### Acceptance Criteria\n* Answer persists across reload\n* Step/progress persists across reload\n* Double tap ‚ÄûContinue\" erzeugt keine doppelten writes\n* Fehler beim Speichern wird als UI error-state angezeigt (retry m√∂glich)\n\n### Verify\n* Start assessment, answer Q3, reload ‚Üí answer vorhanden\n* Toggle offline mid-save ‚Üí error shown, retry works\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqfg","name":"database","description":"","color":"ededed"}],"number":646,"state":"CLOSED","title":"I71.4 ‚Äî Assessment Flow:  Save/Resume (Persistenzadapter + idempotentes Submit)"},{"body":"### Intent\nDie 5 Screens existieren als echte Pages (pixel-nah) und verhalten sich robust.\n\n### Scope (je Screen)\n**(1) Dashboard v2**\n* Greeting (\"Good morning ‚Ä¶\")\n* AMY Assistant Card (CTA \"Chat with AMY\")\n* Health Status cards (4)\n* Quick actions list (3)\n* Weekly trend placeholder block\n* Upcoming appointment card\n\n**(2) Assessments Overview v2**\n* Overall progress card\n* Filter chips (All / Not started / In progress / Completed)\n* Assessment cards: \n  * status tag\n  * duration\n  * progress bar + CTA (Start Now / Continue / View Results)\n\n**(3) Assessment Flow v2**\n* Header: Step x of y + progress %\n* Question card (title + subtitle)\n* Options list (radio)\n* Accordion \"Why we ask this question\"\n* Footer: Skip + Continue\n\n**(4) Results & Next Steps v2**\n* AMY summary card\n* Current Situation list\n* Recommended actions: \n  * Download report\n  * Start video consultation\n  * Book in-person visit\n  * Continue dialog with AMY\n* Data protection card + \"What happens next\" section\n\n**(5) Personal Insights v2**\n* Health score header card\n* Key metrics blocks with charts (Epic 1: UI blocks; klarer empty-state wenn keine Daten)\n* Milestones\n* Recent activity list\n* Export / Generate report CTA\n\n### Data Rules (reduziert Interpretation)\n* Wenn echte Daten fehlen ‚Üí **explicit empty state** (\"No data yet\") pro Bereich\n* Kein random fake (au√üer dev fixtures klar als fixture, z.  B. `__DEV_FIXTURE__` und UI Label \"Demo data\")\n\n### Acceptance Criteria\n* Jede Page hat definierte states: \n  * loading (skeleton oder spinner)\n  * empty (no data)\n  * error (fetch failed)\n* Keine Page darf SSR/RSC crashen (try/catch + guards)\n* Links/CTAs f√ºhren zu existierenden Routes (kein dead navigation)\n\n### Verify\n* Browser:  jede Page √∂ffnen, reload, toggles klicken\n* Dev:  Network offline simulieren ‚Üí error-state, kein crash\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":645,"state":"CLOSED","title":"I71.3 ‚Äî Pages v2 implementieren (5 Screens) inkl. deterministischer Loading/Empty/Error States"},{"body":"### Intent\nEine **kanonische Mobile Shell**, die alle v2 Screens tr√§gt und testbar macht.\n\n### Scope\n* Komponenten: \n  * `MobileShellV2`\n  * `TopBarV2` mit 3 Varianten:\n    * Variant A (Tab Screens): Burger + Title + Bell (+ Avatar optional)\n    * Variant B (Assessment Flow): Back + Title + Close\n    * Variant C (Results): Back + Title + optional overflow/menu\n  * `BottomNavV2` mit 4 Tabs:  Home, Assess, Dialog, Profile\n* Route mapping (verbindlich):\n  * `/patient/dashboard` ‚Üí Home\n  * `/patient/assess` ‚Üí Assess\n  * `/patient/dialog` ‚Üí Dialog\n  * `/patient/profile` ‚Üí Profile\n  * `/patient/assess/[assessmentId]` oder `/patient/assess/[assessmentId]/flow` ‚Üí Flow (Variant B, **BottomNav hidden**)\n* Layout rules:\n  * Tab screens: BottomNav sichtbar\n  * Flow screens: BottomNav hidden\n  * Scroll container korrekt (content scrollt, nav bleibt fix)\n  * Safe area/padding korrekt (mobile viewport)\n\n### Out of Scope\n* Keine Datenlogik\n* Keine Auth-Fixes (separates Issue)\n\n### Acceptance Criteria\n* Deep links:  Direkt auf `/patient/dialog` l√§dt Dialog, BottomNav markiert Dialog\n* Browser back/forward funktioniert ohne UI break\n* Reload auf jeder Route funktioniert (keine unhandled errors)\n* TopBar wechselt korrekt je Screen (A/B/C)\n\n### Verify\n* Manuell: alle 4 Tabs anklicken, reload\n* Manuell: Flow route √∂ffnen, back/close testen\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":644,"state":"CLOSED","title":"I71.2 ‚Äî MobileShellV2: TopBar + BottomNav + Route Wiring (kanonische Navigation)"},{"body":"### Intent\nAus dem Designpaket wird eine **stabile UI-Basis** (Tokens + Primitives), ohne HTML-Export-Spaghetti. \n\ndas Designpaket liegt: docs\\rhythm_mobile_v2\n\n### Input\nReferenzscreens: \n* Dashboard. png\n* Assessment_Select.png\n* Assessment. png\n* Dialog. png\n* PersonalScreen.png\n\n### Scope\n* Lege UI v2 Bereich an (Vorschlag, verbindlich wenn du nichts anderes willst):\n  * `src/ui/mobile-v2/` f√ºr UI primitives + tokens\n  * `public/mobile-v2/` f√ºr assets (icons/illustrations)\n* Tokens: \n  * Farben (Primary gradient/blues, neutral grays)\n  * Radius (cards + pills)\n  * Schatten\n  * Typography scale\n  * Spacing scale\n* Primitives (mindestens):\n  * `Card`, `Button` (primary/secondary/ghost), `Chip`, `Tag/Pill`, `ListRow`\n  * `ProgressBar` (line) + optional ring stub\n  * `Icon` wrapper\n* Entferne/unterbinde: \n  * Inline styles aus HTML export\n  * global CSS, das Studio beeinflusst\n\n### Out of Scope\n* Keine Business-Logik\n* Keine Funnel/Agenten\n* Keine Datenintegration au√üer minimalen props f√ºr UI\n\n### Acceptance Criteria\n* `npm run build` gr√ºn\n* Tokens sind **single source of truth** (keine doppelten Hardcodes in Pages)\n* UI primitives sind im Code wiederverwendet (mindestens 2 Pages nutzen dieselben primitives)\n* Studio UI unver√§ndert (keine Farb-/Font-Regressions)\n\n### Verify (PowerShell)\n```powershell\nnpm ci\nnpm run build\nnpm run start\n# open patient pages (falls noch placeholder): es darf nichts crashen\n```\n\n### Failure Modes (must avoid)\n* Tailwind/CSS Tokens √ºberschreiben Studio global\n* Hardcoded Pixel √ºberall statt Token-Nutzung\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":643,"state":"CLOSED","title":"I71.1 ‚Äî Mobile UI v2: Designpaket importieren und als Token-/Component-Basis normalisieren"},{"body":"## Epic Outcome\n\nNach E71 ist RHYTHM **real testbar**: \n\n* Patient (Mobile v2): Login ‚Üí Dashboard ‚Üí Assessments ‚Üí Assessment Flow ‚Üí Dialog/Results ‚Üí Profile ‚Üí Logout **ohne Crash/Loops**\n* Studio: Sidebar **bis unten** + scroll, Navigation-Config **persistiert + angewendet**, Theme **dark-only**\n* Mobile Theme **light-only**\n* Smoke Pack dokumentiert und reproduzierbar\n\n## Epic Gate (Pass/Fail)\n\n**PASS nur wenn:**\n1. Keine Redirect-/Reload-Loops (Patient + Studio)\n2. Keine RSC-hard-crashes (alle zentralen Seiten)\n3. Alle Screens/Flows aus den 5 Referenz-Screens sind in der App erreichbar\n4. Studio Navigation Config wirkt sichtbar auf das echte Men√º (nach Reload)\n5. Smoke Doc kann von Dritten ausgef√ºhrt werden (ohne Repo-Wissen)","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"}],"number":642,"state":"CLOSED","title":"EPIC E71 ‚Äî Mobile UI v2 + Studio Workbench Cleanup (v0.7)"},{"body":"**Canonical ID:** V061-I03\n**Type:** BUGFIX / INTEGRATION\n**Priority:** P0/P1 (Pilot UX)\n**Area:** Patient UI ‚Üî Engine Content API\n\n### Intent\nContent Tiles d√ºrfen nach dem Split nicht ins Leere laufen. Es gibt **genau einen** kanonischen Resolve-Path, den UI nutzt und Engine bedient.\n\n### Context / Problem\nEs existieren/entstehen leicht mehrere Pfade (`/api/content-pages/[slug]` vs `/api/content/resolve` etc.). Nach dem Split f√ºhren Inkonsistenzen zu 404.\n\n### Scope\n* Einen kanonischen Resolver definieren (UI fetch + engine route).\n* Tiles/Links in Patient UI auf diesen Pfad normalisieren.\n* Minimal Tests (happy path + 404 when missing).\n\n### Non-Goals\n* Kein neues CMS/Content-System.\n* Keine neue Admin UI f√ºr Content.\n* Keine inhaltlichen √Ñnderungen der Tiles, nur Wiring.\n\n### Acceptance Criteria (Pass/Fail)\n1. **Canonical resolver**: Ein Pfad ist kanonisch und dokumentiert.\n2. **UI uses canonical**: Patient Tiles/Content pages nutzen nur diesen Pfad.\n3. **404 semantics**: Missing content => 404 (und nicht 500).\n4. **Tests**: mindestens 1 Test f√ºr resolver happy path oder contract validation.\n\n### Evidence & Verification (PowerShell)\n```powershell\nnpm test\nif ($LASTEXITCODE -ne 0) { throw \"tests failed\" }\n\nnpm run build\nif ($LASTEXITCODE -ne 0) { throw \"build failed\" }\n```\n### Files to Touch (Guideline)\n* `apps/rhythm-patient-ui/**` (tiles, content page loader)\n* `apps/rhythm-engine/app/api/**` (content resolver route)\n* `packages/rhythm-core/contracts/**` (nur falls Contract formalisiert)\n\n### Copilot Prompt\nNormalize content resolution after UI split:\nPick ONE canonical resolver endpoint and align patient UI fetch + engine route.\nEnsure missing content returns 404 (NOT_FOUND) and never 500.\nAdd minimal tests (happy path + missing) and update PILOT_SPINE.md with the canonical resolver path.\nMinimal diff. Verify: npm test, npm run build.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWo0Q","name":"engine","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpPg","name":"integration","description":"","color":"ededed"}],"number":636,"state":"CLOSED","title":"V061-I03 ‚Äî Content Resolver & Tiles: Canonical resolver path, keine 404s nach Split"},{"body":"**Canonical ID:** V061-I02\n**Type:** FEATURE-HARDENING (Pilot Runtime)\n**Priority:** P0\n**Area:** Engine + Patient UI integration\n\n### Intent\nDer Pilot-Spine (cardiovascular-age POC) muss E2E stabil funktionieren: Erstellung, Speichern, Abschlie√üen, Ergebnis abrufen ‚Äì ohne Stub-States, ohne ‚Äúphantom‚Äù Assessments.\n\n### Context / Problem\nNach UI-Split und Contract-Extraction ist das gr√∂√üte Risiko: Lifecycle-Br√ºche (ID fehlt, Save schreibt nicht, Complete ist nicht idempotent, Result wirft 500 statt 409/404).\n\n### Scope\n* Engine Endpoints, die f√ºr cardiovascular-age genutzt werden (Create/Save/Complete/Result).\n* State Machine minimal fixen: deterministic, idempotent wo sinnvoll.\n* Contract-Konformit√§t: response shape und `schemaVersion`/`version` stabil.\n\n### Non-Goals\n* Keine neuen Funnel Features.\n* Keine √Ñnderung an Score/Algorithmus, nur Lifecycle und Persistenz.\n* Keine DB-Schema-Refactors (au√üer minimal additive fix, falls zwingend).\n\n### Acceptance Criteria (Pass/Fail)\n1. **Create**:\n   * Erstellt DB-Record garantiert.\n   * Antwort enth√§lt `assessmentId` (persistente ID), `status`, `version/schemaVersion`.\n2. **Save**:\n   * Persistiert Answers/Step deterministisch (Upsert ok).\n   * Validiert Auth/Ownership (401/403 Semantik korrekt).\n3. **Complete**:\n   * Idempotent (zweiter Call: 200 oder 409, aber nicht 500).\n   * Markiert ‚Äúcompleted‚Äù exakt einmal.\n4. **Result**:\n   * Liefert Ergebnis nur f√ºr completed.\n   * F√ºr missing: 404 (siehe V061-I01).\n   * F√ºr not completed: 409 (oder euer festes Contract-Verhalten; aber **deterministisch**).\n5. **Docs**:\n   * `docs/canon/PILOT_SPINE.md` enth√§lt **konkrete** Step-by-Step Smoke-Sequence.\n\n### Evidence & Verification (PowerShell)\n```powershell\nnpm test\nif ($LASTEXITCODE -ne 0) { throw \"tests failed\" }\n\nnpm run build\nif ($LASTEXITCODE -ne 0) { throw \"build failed\" }\n```\nSmoke-Sequenz (als Teil der Doku; Cookies/Tokens NICHT loggen):\n* create ‚Üí save ‚Üí complete ‚Üí result (mindestens 1x lokal oder preview).\n\n### Files to Touch (Guideline)\n* `apps/rhythm-engine/app/api/**` (Spine endpoints)\n* `packages/rhythm-core/contracts/**` (nur wenn Contract klar erweitert/versioniert wird)\n* `apps/rhythm-patient-ui/**` (nur falls Caller/params angepasst werden m√ºssen)\n* Tests: Engine route tests / contract tests\n\n### Implementation Notes (Guardrails)\n* Behalte `schemaVersion` stabil; wenn Breaking: **version bump** in `rhythm-core`.\n* Fail-closed: Invalid input -> 400, unauthorized -> 401-first.\n* Kein Logging von Answers/Text.\n\n### Copilot Prompt\nMake cardiovascular-age assessment lifecycle deterministic in apps/rhythm-engine:\ncreate -> save -> complete -> result.\nGuarantee DB insert on create and persistent assessmentId.\nSave persists deterministically with auth/ownership enforcement.\nComplete is idempotent.\nResult returns completed only; missing=404, incomplete=409.\nAdd minimal tests and update docs/canon/PILOT_SPINE.md with a PowerShell smoke sequence.\nVerify: npm test, npm run build.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWo0Q","name":"engine","description":"","color":"ededed"}],"number":635,"state":"CLOSED","title":"V061-I02 ‚Äî Pilot-Spine Assessment Lifecycle deterministisch: create ‚Üí save ‚Üí complete ‚Üí result (cardiovascular-age)"},{"body":"**Canonical ID:** V061-I04\n**Type:** BUGFIX / HARDENING\n**Priority:** P0 (Pilot-Blocker wenn Crash)\n**Area:** Patient UI (SSR/RSC)\n\n### Intent\n`/patient/dashboard` darf niemals in Production/Preview durch Server-Component Render crashen. Entweder rendern oder deterministisch redirecten.\n\n### Context / Problem\nNext.js kann in Prod nur ‚Äúdigest‚Äù zeigen. Ursache ist oft: missing env/session, null deref, client-only API in server component, failing fetch.\n\n### Scope\n* Dashboard data loads: guards + try/catch + empty state.\n* Auth/Eligibility: deterministische Redirects/States.\n* PHI-freies Step-Logging (optional).\n\n### Non-Goals\n* Kein UI Redesign.\n* Keine neue Datenarchitektur.\n* Keine neuen Features.\n\n### Acceptance Criteria (Pass/Fail)\n1. **No crash**: Dashboard rendert oder redirectet, aber kein 500 ‚ÄúRSC render error‚Äù.\n2. **Auth semantics**: 401-first/redirect konsistent mit euren Regeln.\n3. **Empty state**: Missing optional data zeigt Empty UI statt Throw.\n4. **No PHI logs**: Log nur step markers / booleans.\n\n### Evidence & Verification (PowerShell)\n```powershell\nnpm test\nif ($LASTEXITCODE -ne 0) { throw \"tests failed\" }\n\nnpm run build\nif ($LASTEXITCODE -ne 0) { throw \"build failed\" }\n```\nOptional: lokale Start & browser smoke, falls vorhanden:\n```powershell\nnpm run dev:patient\n# open /patient/dashboard and verify no crash\n```\n\n### Files to Touch (Guideline)\n* `apps/rhythm-patient-ui/app/patient/dashboard/**`\n* shared fetch helpers, falls vorhanden\n\n### Copilot Prompt\nHarden /patient/dashboard in apps/rhythm-patient-ui:\nAdd guards around server-side data loads, deterministic redirects for missing session/eligibility, and empty states instead of throws.\nAdd PHI-free STEP logging only if needed.\nNo redesign, minimal diff.\nVerify: npm test, npm run build.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRLh6WQ","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"}],"number":634,"state":"CLOSED","title":"V061-I04 ‚Äî Patient Dashboard crash-proof: server render hardening + deterministic redirects/empty states"},{"body":"**Canonical ID:** V061-I05\n**Type:** AUDIT / RELEASE READINESS\n**Priority:** P1 (aber vor Pilot-Start empfohlen)\n**Area:** Repo-weite Wiring/Completeness\n\n### Intent\nNach UI-Split muss sichtbar sein:\n* welche Features tats√§chlich ‚Äúverdrahtet‚Äù sind (UI‚ÜíAPI‚ÜíDB),\n* welche Endpoints/Pages **orphans** sind,\n* und was Pilot-Runtime vs Future ist.\n\n### Scope\n* Evidence-locked Report:\n  * `docs/audit/V061_WIRING_AUDIT.md`\n  * `.audit/v061/wiring-audit.json`\n* Orphan Lists:\n  * API routes ohne UI caller\n  * UI pages mit missing endpoint calls\n* Punchlist f√ºr v0.6.2/v0.7.\n\n### Non-Goals\n* Keine ‚Äúvollautomatische‚Äù perfekte Analyse. Best-effort, aber evidence-locked.\n* Kein Entfernen von Endpoints in diesem Issue.\n\n### Acceptance Criteria (Pass/Fail)\n1. Report enth√§lt **Dateipfade** (1:1 aus code search), keine Fantasie.\n2. JSON ist machine-readable und enth√§lt mindestens:\n   * pages[], apiRoutes[], mappings[], orphans[]\n3. Enth√§lt Smoke-Liste (URLs + expected status class), ohne secrets.\n4. Enth√§lt Punchlist.\n\n### Evidence & Verification (PowerShell)\n```powershell\nnpm test\nif ($LASTEXITCODE -ne 0) { throw \"tests failed\" }\n\nnpm run build\nif ($LASTEXITCODE -ne 0) { throw \"build failed\" }\n```\n### Implementation Notes\n* Nutze `rg`/TypeScript AST nur wenn bereits vorhanden; sonst simple grep-based mapping.\n* Output muss reproduzierbar sein: Script/Command outputs ggf. in `.audit/v061/evidence/`.\n\n### Copilot Prompt\nCreate an evidence-locked wiring audit for v0.6.1:\nGenerate docs/audit/V061_WIRING_AUDIT.md and .audit/v061/wiring-audit.json by scanning:\n- apps/rhythm-studio-ui routes\n- apps/rhythm-patient-ui routes\n- apps/rhythm-engine API routes\nMap UI pages -> API calls (best effort via grep), API -> DB touch points (best effort via imports/queries).\nList orphans and create a punchlist.\nNo PHI. Evidence-first, include file paths.","labels":[],"number":633,"state":"CLOSED","title":"V061-I05 ‚Äî Evidence-locked Wiring Audit: Feature ‚Üí UI ‚Üí API ‚Üí DB + Orphans + Punchlist"},{"body":"**Canonical ID:** V061-I01\n**Type:** BUGFIX / HARDENING\n**Priority:** P0 (Pilot-Blocker)\n**Area:** Engine API, DB error mapping, Response semantics\n\n### Intent\nFehlende Records (0 rows) d√ºrfen **nie** als 500/‚ÄúDatabase error‚Äù sichtbar werden. F√ºr Pilot-Spine muss das deterministisch **404 NOT_FOUND** sein.\n\n### Context / Problem\nSupabase/PostgREST liefert bei `.single()` bei 0 rows typischerweise einen PostgREST Error (z. B. **PGRST116**) oder `null`/error-Kombination je nach Client/Call. Aktuell wird das in mindestens einer Route als generischer DB-Fehler behandelt, was falsche Semantik erzeugt.\n\n### Scope\n* Alle Engine-Stellen, die `.single()` / `.maybeSingle()` nutzen und Ressourcen laden (Assessment, Content, etc.).\n* Zentraler Mapping-Helper f√ºr PostgREST Errors ‚Üí HTTP semantisch korrekt.\n* Tests, die die Abgrenzung ‚Äú0 rows‚Äù vs ‚Äúechter DB Fehler‚Äù beweisen.\n\n### Non-Goals\n* Keine Refactors der Query-Struktur.\n* Keine √Ñnderungen an Business-Logik (nur Semantik/Mapping + Tests).\n* Keine neuen Observability/Telemetry Systeme.\n\n### Acceptance Criteria (Pass/Fail)\n1. **0 rows ‚Üí 404**: Wenn eine Ressource nicht existiert, Response ist 404 mit standardisiertem Error-Envelope + ErrorCode `NOT_FOUND`.\n2. **Real DB failure ‚Üí 500**: Andere PostgREST/DB Fehler bleiben 500 (oder euer bestehendes Mapping), inkl. stabiler ErrorCode (z. B. `INTERNAL_ERROR`).\n3. **No PHI logs**: Logs d√ºrfen keine Inhalte/Answers/PII enthalten.\n4. **Tests**: Mindestens 2 Unit/Route-Tests:\n   * missing resource => 404\n   * forced DB error => 500\n\n### Evidence & Verification (PowerShell)\n```powershell\nnpm test\nif ($LASTEXITCODE -ne 0) { throw \"tests failed\" }\n\nnpm run build\nif ($LASTEXITCODE -ne 0) { throw \"build failed\" }\n```\nOptional (wenn ihr lokale smoke endpoints habt): ein Route-Test, der bewusst eine nicht existente ID abfragt und 404 erwartet.\n\n### Files to Touch (Guideline)\n* `apps/rhythm-engine/**` Route handler(s) mit `.single()`\n* Ein zentraler Helper, z. B. `apps/rhythm-engine/lib/db/postgrestErrors.ts` oder bestehende Error-Mapper\n* Tests: `apps/rhythm-engine/**/__tests__/**` (oder euer Test-Ort)\n\n### Implementation Notes (Guardrails)\n* Implementiere **eine** Funktion: `isNotFoundPostgrestError(err)`.\n* Response envelope muss unver√§ndert bleiben (nur Status + ErrorCode/Message).\n* Keine ‚Äúbest guess‚Äù Codes: explizit anhand Error-Struktur (code/message/details) entscheiden.\n\n### Copilot Prompt\nFix PGRST116 / .single() \"0 rows\" handling across apps/rhythm-engine:\n- Add a single helper to map PostgREST not-found to HTTP 404 + ErrorCode NOT_FOUND.\n- Replace ad-hoc mappings.\n- Add tests proving 404 for missing and 500 for real DB error.\nMinimal diff, no PHI logs, keep response envelope.\nVerify: npm test, npm run build.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRLh6WQ","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"LA_kwDOQfuwnc8AAAACSNWo0Q","name":"engine","description":"","color":"ededed"}],"number":632,"state":"CLOSED","title":"V061-I01 ‚Äî PGRST116 / `.single()` korrekt mappen: 404 statt ‚ÄúDatabase error‚Äù"},{"body":"**Canonical ID:** V061-I06\n**Type:** TOOLING / RELEASE GATE\n**Priority:** P1 (stark empfohlen vor Pilot)\n**Area:** scripts/audit, reproducible evidence\n\n### Intent\nEin einzelner PowerShell-Run soll:\n* (optional) build/tests ausf√ºhren,\n* Kern-URLs smoke testen,\n* Evidence Pack schreiben,\n* Pass/Fail liefern.\n\n### Scope\n* `scripts/audit/run-v061-smoke.ps1`\n* Output: `.audit/v061/<timestamp>/{summary.md,summary.json,http.log}`\n* Update `docs/canon/PILOT_SPINE.md` mit Usage.\n\n### Non-Goals\n* Kein komplettes E2E Framework.\n* Keine Login-Automation mit echten Cookies/Tokens (nicht loggen).\n\n### Acceptance Criteria (Pass/Fail)\n1. Script nimmt `-BaseUrl` und schreibt Evidence Pack.\n2. Es loggt **keine** Cookies/Tokens/Secrets.\n3. Checks enthalten mindestens:\n   * `/patient/dashboard` (expect 200/302, aber nicht 500)\n   * `/admin` (200/302)\n   * `/clinician` (200/302)\n   * `/api/health` oder `/api/ready` falls existiert (script soll entweder discovern oder fallback)\n4. Summary enth√§lt Pass/Fail pro URL + Gesamtstatus.\n\n### Evidence & Verification (PowerShell)\n```powershell\n./scripts/audit/run-v061-smoke.ps1 -BaseUrl http://localhost:3000\n```\n\n### Files to Touch\n* `scripts/audit/run-v061-smoke.ps1`\n* `docs/canon/PILOT_SPINE.md`\n\n### Copilot Prompt\nAdd scripts/audit/run-v061-smoke.ps1 that:\n- accepts -BaseUrl\n- optionally runs npm test and npm run build (switch -SkipBuild)\n- checks key URLs (/patient/dashboard, /admin, /clinician, and /api/health or /api/ready if present)\n- writes .audit/v061/<timestamp>/{summary.md,summary.json,http.log}\n- never logs cookies/tokens/secrets\nUpdate PILOT_SPINE.md with usage.\nMinimal diff. Provide PowerShell verification commands.","labels":[],"number":631,"state":"CLOSED","title":"V061-I06 ‚Äî Pilot Smoke Runner (PowerShell): 1 Command ‚Üí Evidence Pack (Pass/Fail)"},{"body":"### Scope\n- Add contract tests for /api/patient/triage\n- Ensure endpoint catalog includes triage route\n- Ensure dashboard UI calls triage endpoint\n\n### Acceptance Criteria\nAC1: npm run dev:endpoints:verify green.\nAC2: Jest contract tests pass.\nAC3: No unhandled errors / consistent envelope.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":581,"state":"CLOSED","title":"E6.6.10 ‚Äî Triage Endpoint Governance: Contract tests + endpoint catalog + UI reference"},{"body":"### Problem\nF√ºr reproduzierbare Tests braucht ihr deterministische Inputs zum Testen aller Router-Paths.\n\n### Scope\n- 10 canned input examples in docs (INFO/ASSESSMENT/ESCALATE)\n- Optional UI \"dev only\" quick-fill buttons behind env gate\n\n### Acceptance Criteria\nAC1: Each input produces expected nextAction in tests.\nAC2: Dev UI only in non-prod.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":580,"state":"CLOSED","title":"E6.6.9 ‚Äî Dev Harness: Deterministic Triage Test Inputs (INFO/ASSESSMENT/ESCALATE)"},{"body":"### Scope\n- Add consistent text blocks for non-emergency+escalation\n- RedFlag path shows explicit emergency guidance + CTA\n- Wording is stable and reused in escalation offer screen\n\n### Acceptance Criteria\nAC1: Disclaimer visible on dashboard near AMY.\nAC2: Escalation path shows stronger warning.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":579,"state":"CLOSED","title":"E6.6.8 ‚Äî Safety Copy: AMY/Triage disclaimers + emergency guidance (patient-facing, consistent)"},{"body":"### Problem\nWenn Red Flags \"ad hoc\" sind, passieren gef√§hrliche false negatives/positives und Drift. \n\n### Scope\n- Define allowlist enum: CHEST_PAIN, SYNCOPE, SEVERE_DYSPNEA, etc.\n- Map keywords/patterns (simple, conservative)\n- Document in docs/clinical/triage_red_flags_v1.md\n- Tests for each red flag\n\n### Acceptance Criteria\nAC1: Allowlist is the only source of truth.\nAC2: Patterns are conservative; redFlag dominance enforced. \nAC3: Docs exist and match implementation.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":578,"state":"CLOSED","title":"E6.6.7 ‚Äî Red Flag Catalog v1 (Allowlist, keywords/patterns, docs + tests)"},{"body":"### Problem\nF√ºr Pilot-Debug braucht ihr nachtr√§glich:  \"Was war die Triage-Entscheidung?\" ‚Äì aber ohne Freitext/PHI zu speichern.\n\n### Scope\n- Create triage_sessions table:  id, created_at, patient_id, correlation_id, tier, next_action, red_flags[], input_hash, rules_version, optional rationale short bounded\n- No raw inputText storage in v0.6.\n\n### Acceptance Criteria\nAC1: No raw text stored; only hash. \nAC2: Patient can only read own triage sessions; clinician/admin only pilot org.\nAC3: Insert after eligibility and validation. \n\n### Verification\n- Unit test verifies no raw text\n- RLS test:  other patient cannot read","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqfg","name":"database","description":"","color":"ededed"}],"number":577,"state":"CLOSED","title":"E6.6.6 ‚Äî Persist Triage Session (Minimal, PHI-safe, for pilot debugging)"},{"body":"### Problem\nTriage ohne Router ist nur ein JSON.  Der Router ist die Produktlogik. \n\n### Scope\n- In Dashboard, after triage result: \n  - SHOW_CONTENT:  navigate to content, highlight tile\n  - START_FUNNEL_*: start/resume funnel\n  - SHOW_ESCALATION:  open escalation offer\n  - Store last result for rationale/retry\n\n### Acceptance Criteria\nAC1: Each nextAction maps to one route.\nAC2: Router actions are deterministic and tested.\nAC3: Navigation always initiated from dashboard. \n\n### Verification\n- UI smoke:  each nextAction case tested via test inputs","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNN-0w","name":"routing","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":576,"state":"CLOSED","title":"E6.6.5 ‚Äî Router: Apply TriageResult ‚Üí Navigation (Dashboard-first)"},{"body":"### Scope\n- Implement endpoint:  Auth‚Üíeligibility‚Üívalidate request‚Üírun triage engine‚Üíreturn result\n- Rate limiting optional\n- No DB calls before auth\n\n### Acceptance Criteria\nAC1: Unauth‚Üí401 first. \nAC2: Not eligible‚Üí403/404.\nAC3: Request validated; oversize‚Üí413 or 400.\nAC4: Result conforms to schema; rationale bounded; redFlags allowlist enforced.\n\n### Verification (PowerShell example)\n```\n$body = @{ inputText = \"I feel stressed and cannot sleep\" } | ConvertTo-Json\niwr http://localhost:3000/api/patient/triage -Method POST -Body $body -ContentType \"application/json\" -SkipHttpErrorCheck | Select-Object StatusCode\niwr http://localhost:3000/api/patient/triage -Method POST -Body $body -ContentType \"application/json\" -Headers @{ Cookie = $cookie } -SkipHttpErrorCheck\n```","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":575,"state":"CLOSED","title":"E6.6.4 ‚Äî API:  POST /api/patient/triage (401-first, eligibility, bounded, contract-validated)"},{"body":"### Problem\nF√ºr v0.6 darf Triage nicht \"LLM macht Diagnose\" sein.  Sie muss wie ein Gate funktionieren:  deterministische Klassifikation + Red Flag detection + routing decision.\n\n### Scope\n- Implement triage decision pipeline:\n  - Normalize input\n  - Red Flag detection (allowlist keywords/patterns) ‚Üí ESCALATE\n  - Otherwise classify to INFO vs ASSESSMENT (template/rule-based, deterministic)\n  - Decide nextAction:  INFO‚ÜíSHOW_CONTENT, ASSESSMENT‚ÜíSTART_FUNNEL(A/B), ESCALATE‚ÜíSHOW_ESCALATION\n- Determinism: Fixed rule ordering, No randomness, Versioned ruleset\n\n### Acceptance Criteria\nAC1: Same input ‚Üí same output. \nAC2: Red flag always dominates (ESCALATE).\nAC3: No \"medical diagnosis text\"; rationale is generic routing rationale.\nAC4: Unit tests (‚â•10 representative cases).\n\n### Verification\n- Jest tests for rule ordering + redFlag dominance","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNN-0w","name":"routing","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":574,"state":"CLOSED","title":"E6.6.3 ‚Äî Triage Engine v1 (Rule/Template-first, deterministic, pilot-safe)"},{"body":"### Problem\nTriage muss stabil, testbar, und governance-f√§hig sein.  Ohne harten Contract driftet die Logik und f√ºhrt zu Pilot-Instabilit√§t.\n\n### Scope\n- Define TriageRequestV1 + TriageResultV1:\n  - Request: inputText (bounded), optional locale, patientContextLite (age range bucket etc.  optional)\n  - Result: tier (INFO|ASSESSMENT|ESCALATE), nextAction (SHOW_CONTENT|START_FUNNEL_A|START_FUNNEL_B|RESUME_FUNNEL|SHOW_ESCALATION), redFlags (allowlist or empty), rationale (<=280 chars or short bullet list max 3), confidenceBand (optional), version, correlationId (optional)\n\n### Acceptance Criteria\nAC1:  Zod schema (or equivalent runtime validation) exists for request+result.\nAC2: Invalid request returns 400; oversize returns 413 or 400. \nAC3: rationale hard-bounded; redFlags from allowlist only. \n\n### Verification\n- Jest:  schema validation tests\n- Negative tests: oversize input, unknown redFlag ‚Üí sanitized","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":573,"state":"CLOSED","title":"E6.6.2 ‚Äî TriageResult v1 Contract (tier/nextAction/redFlags/rationale bounded)"},{"body":"### Problem\nOhne klare UX und Grenzen wird AMY entweder \"Deko\" oder ein unkontrollierter Chat, der medizinisch/haftungsseitig riskant ist. \n\n### Scope\n- Dashboard integriert AMY Input-Komponente\n- Input bounded (z.B. max 500‚Äì800 chars)\n- UX: \"Describe your concern in 1‚Äì2 sentences\" + Hinweis \"not an emergency service\"\n- Submit button + loading + error state\n- Optional: suggested chips (e.g. \"sleep\", \"stress\", \"palpitations\") als guided helper (nicht n√∂tig)\n\n### Acceptance Criteria\nAC1: Max length enforced client-side + server-side.\nAC2: No chat history needed (single turn) f√ºr v0.6.\nAC3: Clear disclaimer text visible (non-emergency).\nAC4: Submit triggers Triage API call and shows routed result. \n\n### Verification\n- UI smoke:  type > max ‚Üí blocked\n- Submit ‚Üí loading ‚Üí route result displayed","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":572,"state":"CLOSED","title":"E6.6. 1 ‚Äî AMY Composer (Guided Mode) on Dashboard (bounded input + safe UX)"},{"body":"## Epic Goal\n\nAMY ist im v0.6 Pilot keine freie Chat-Assistenz, sondern ein Guided Eingang auf dem Dashboard, der eine Triage v1 ausl√∂st und deterministisch routet zu: \n\n- Content / Info\n- Funnel A oder Funnel B (Start/Resume)\n- Escalation Offer (bei Red Flags)\n\nTriage v1 liefert strukturierte, begrenzte Outputs (tier, nextAction, redFlags, rationale(bounded)), mit klaren Guardrails (401-first, bounded IO, kein PHI-Leak).\n\n### Non-Goals (v0.6)\n- Keine Multi-Agent Diagnose\n- Keine Differentialdiagnosen\n- Kein freier Chatverlauf als \"medical advice\"\n- Kein HITL Review Queue (v0.7)\n\n### Dependencies\n- E6.5 Dashboard Host (AMY slot)\n- E6.4. 6 Escalation Offer Stub\n- E6.4.3 Funnel wiring (Start/Resume)\n- E6.4.8 CorrelationId (optional aber empfohlen)\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"},{"id":"LA_kwDOQfuwnc8AAAACSNN-0w","name":"routing","description":"","color":"ededed"}],"number":571,"state":"CLOSED","title":"E6.6 ‚Äî AMY Guided Input + Triage v1 Router (Dashboard Gate, Pilot-safe) [EPIC]"},{"body":"**Scope:**\n\nAdd a minimal CI check:\n- dashboard endpoint returns valid schema (mocked auth) OR unit-level schema tests\n- endpoint-catalog verify passes\n- Keep it cheap (no full e2e)\n\n**Acceptance Criteria:**\n- AC1: Failing schema change breaks CI.\n- AC2: endpoint catalog verify is required.","labels":[],"number":570,"state":"CLOSED","title":"E6.5.10 ‚Äî CI Gate: Dashboard Contract Smoke + No Dead Endpoints Alignment"},{"body":"**Scope:**\n\nDashboard should refresh on: \n- app focus\n- after funnel completion\n- after follow-up answered\n\nUse E6.2 guidance (pagination/caching) lightly:\n- stale-while-revalidate or simple refetch\n- Avoid duplication/race conditions\n\n**Acceptance Criteria:**\n- AC1: After completing funnel, dashboard reflects new status without hard reload.\n- AC2: Offline/failed fetch shows error state + retry (not blank).","labels":[],"number":569,"state":"CLOSED","title":"E6.5.9 ‚Äî Dashboard Refresh Strategy (Mobile-friendly, Retry-safe)"},{"body":"**Scope:**\n\nNextStep CTA routes to:\n- resume funnel\n- start funnel A/B\n- workup follow-ups\n- escalation offer stub\n\nEnsure route guards keep dashboard-first policy intact.\n\n**Acceptance Criteria:**\n- AC1: No broken links (no 404 fetch inside page).\n- AC2: Resume always lands on correct step. \n- AC3: Back returns to dashboard with updated state.","labels":[],"number":568,"state":"CLOSED","title":"E6.5.8 ‚Äî Navigation Wiring: Dashboard ‚Üî Funnels ‚Üî Workup ‚Üî Escalation (Patient)"},{"body":"**Scope:**\n\nRoute /patient/content/[slug]\n- Render markdown/rich text safe (no XSS)\n- 404 on unknown slug\n\n**Acceptance Criteria:**\n- AC1: Unknown slug ‚Üí 404 (not 500).\n- AC2: No PHI, no user-specific data required.\n- AC3: Back navigation to dashboard. ","labels":[],"number":567,"state":"CLOSED","title":"E6.5.7 ‚Äî Content Page Rendering (Read-only MVP, Patient-safe)"},{"body":"**Scope:**\n\nMinimal content tile model:\n- id/slug\n- title\n- summary\n- category\n- href (internal)\n\nSource: static JSON or DB table (choose simplest)\n\nDeterministic ordering:  explicit rank numeric, no localeCompare drift\n\n**Acceptance Criteria:**\n- AC1: Max tiles N (e.g. 6‚Äì12).\n- AC2: Deterministic ordering (rank asc, slug asc).\n- AC3: Tile click navigates to content page.\n\n**Verification:**\n- UI smoke + unit test for ordering","labels":[],"number":566,"state":"CLOSED","title":"E6.5.6 ‚Äî Content Tiles MVP (Stub Source, Deterministic Ordering, No CMS Yet)"},{"body":"**Problem:**\n\n\"Ohne Next Step\" ist Dashboard nur Content.  Next Step muss deterministisch entscheiden, was Patient: in als n√§chstes tun soll.\n\n**Scope:**\nImplement deterministic priority rules (example order):\n- If onboarding incomplete ‚Üí complete_onboarding\n- Else if workup needs_more_data ‚Üí answer_followups\n- Else if funnel in progress ‚Üí resume_funnel\n- Else if no funnel started ‚Üí start_funnel (choose A by default or based on triage output)\n- Else if red flag ‚Üí escalation_offer\n- Else ‚Üí view_content (fallback)\n\nRules must be versioned:  nextStepRulesVersion:  1.\n\n**Acceptance Criteria:**\n- AC1: Same inputs ‚Üí same nextStep. \n- AC2: Unit tests cover all branches.\n- AC3: nextStep output is minimal (type, label, target).\n\n**Verification:**\n- Jest tests for resolver","labels":[],"number":565,"state":"CLOSED","title":"E6.5.5 ‚Äî Next Step Resolver v1 (Deterministic Priority Rules)"},{"body":"**Scope:**\n\nImplement dashboard sections:\n- Header (greeting optional)\n- AMY slot (placeholder component; E6.6 will wire)\n- Next Step card\n- Content tiles grid/list\n- \"Your progress\" (funnels/workup summary)\n- Loading/empty/error states\n\n**Acceptance Criteria:**\n- AC1: Empty states render gracefully (no crashes).\n- AC2: Mobile responsive (shell).\n- AC3: NextStep CTA always visible when available. \n\n**Verification:**\n- UI smoke on desktop + mobile widths","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"}],"number":564,"state":"CLOSED","title":"E6.5.4 ‚Äî UI: Patient Dashboard Layout (Header + AMY Slot + NextStep + Tiles + Status)"},{"body":"**Problem:**\n\nDashboard UI braucht einen stabilen API-Endpunkt mit korrekten Semantics.  H√§ufigster Fehler: Auth/DB Reihenfolge, RLS L√ºcken, unbounded data fetch.\n\n**Scope:**\n- Implement GET /api/patient/dashboard\n- Ensure ordering:  Auth ‚Üí eligibility ‚Üí RLS-safe fetch\n- Bounded result sizes\n\n**Acceptance Criteria:**\n- AC1: Unauth ‚Üí 401 (no DB calls).\n- AC2: Non-eligible ‚Üí 403/404 (policy) with envelope.\n- AC3: Eligible patient sees only own data (RLS).\n- AC4: Payload bounded (tiles max N, funnels max 2‚Äì5 summaries).\n\n**Verification (PowerShell):**\n- iwr http://localhost:3000/api/patient/dashboard -SkipHttpErrorCheck | Select-Object StatusCode\n- With patient cookie: iwr http://localhost:3000/api/patient/dashboard -Headers @{ Cookie = $cookie } -SkipHttpErrorCheck\n","labels":[],"number":563,"state":"CLOSED","title":"E6.5.3 ‚Äî API:  GET /api/patient/dashboard (401-first, RLS, bounded IO)"},{"body":"**Problem:**\n\nDashboard ben√∂tigt ein stabiles, versioniertes Datenmodell, sonst wird UI inkonsistent und mobile Integration bricht.\n\n**Scope:**\nDefine a single response model:  DashboardViewModelV1:\n- onboardingStatus\n- nextStep object (type + target + label)\n- funnelSummaries[] (2 pilot funnels min)\n- workupSummary (state + counts)\n- contentTiles[] (MVP)\n- meta. version + meta.correlationId (E6.4.8 alignment)\n\n**Acceptance Criteria:**\n- AC1: Contract ist als zod schema (oder TS type + runtime check) vorhanden.\n- AC2: Response envelope + error semantics standardisiert.\n- AC3: Version Marker (e.g. dashboardVersion:  1) vorhanden. \n\n**Verification:**\n- Jest tests:  schema validate happy path + empty states\n- Endpoint appears in endpoint catalog + used in UI","labels":[],"number":562,"state":"CLOSED","title":"E6.5.2 ‚Äî Dashboard Data Contract v1 (NextStep + Tiles + Status)"},{"body":"**Problem:**\n\nWenn \"Dashboard-first\" nicht technisch erzwungen wird, entstehen wieder direkte Einstiege in Funnels/Results und der Flow driftet. \n\n**Scope:**\n- Patient Dashboard Page / Route (Web + Mobile Shell)\n- Policy: \"Dashboard-only entry\" f√ºr Patient (redirect oder block)\n- Post-login und post-onboarding landing ‚Üí Dashboard\n\n**Acceptance Criteria:**\n- AC1: Nach Login landet Patient auf Dashboard (oder wird dorthin weitergeleitet).\n- AC2: Patient kann Funnel/Workup/Result nicht als ‚ÄûStartseite\" √∂ffnen (policy consistent): Redirect ‚Üí Dashboard oder block mit 404/403 (entscheidet ihr, aber fix).\n- AC3: Unauth 401-first (keine DB calls).\n\n**Verification (PowerShell):**\n- Unauth:  `iwr http://localhost:3000/patient/dashboard -SkipHttpErrorCheck | Select-Object StatusCode`\n- (After auth) open a direct deep link (example)\n- Start on /patient/funnels/<id> should redirect or block per policy\n\n**Dependencies:**\n- Auth/session (E6.2. 6)\n- Mobile shell route patterns (E6.1.7)","labels":[],"number":561,"state":"CLOSED","title":"E6.5. 1 ‚Äî Dashboard Route:  Default Entry + Redirect Policy (Patient)"},{"body":"**Epic Goal:**\n\nPatient: in kommt immer √ºber Dashboard in die App (web + mobile shell). Dashboard zeigt: \n- Content-Kacheln (Info/Programm)\n- Status (Onboarding, Funnel progress, Workup status)\n- \"Next Step\" CTA (Continue/Start Funnel, Follow-up Questions, Escalation Offer)\n- AMY Composer ist oben (Triage Epic E6.6), aber Dashboard muss ihn hosten. \n\n**Non-Goals (v0.6):**\n- Kein CMS Vollausbau\n- Keine Personalisierungs-Engine\n- Keine komplexe Search\n- Keine Terminlogik (nur Offer-Stub in E6.4. 6)\n\n**Definition of Done (Epic):**\n- Dashboard ist Default Landing nach Login/Onboarding\n- No-dead-endpoints:  alle Dashboard APIs sind UI-referenced\n- 5-Smoke in Runbook deckt Dashboard/NextStep ab (E6.4.7)","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"}],"number":560,"state":"CLOSED","title":"E6.5 ‚Äî Dashboard Entry + Content Hub (Dashboard-first + Next Step + Content Tiles) [EPIC]"},{"body":"üÜï E6.4.8 ‚Äî Minimal Telemetry: CorrelationId + State Transitions (Non-blocking)\n\n\nProblem\n\nF√ºr den Pilot braucht ihr ein Minimum an Observability, um Probleme reproduzierbar zu machen (ohne ein KPI-Dashboard oder komplexe Analytics zu bauen). Ziel ist Debuggability + Audit-lite, nicht ‚ÄúBusiness KPIs‚Äù.\n\nOhne CorrelationId und definierte State-Transition-Events ist ‚Äúwas ist beim Testpatient passiert?‚Äù sp√§ter kaum nachvollziehbar.\n\nGoal / Non-Goals\nGoal\n\nJede Pilot-Session/Flow-Aktion erzeugt eine CorrelationId.\n\nTriage und Workup schreiben deterministische State-Transition Events.\n\nEvents sind PHI-safe (keine Freitexte, keine Rohsymptome, keine Prompt dumps).\n\nEvents sind f√ºr Dev/Clinician/Admin (intern) einsehbar (minimaler Viewer reicht), oder zumindest per DB/API abrufbar.\n\nNon-Goals (v0.6)\n\nKein KPI-Dashboard\n\nKein PDF/Export\n\nKein ‚ÄúSupport Case / Task‚Äù System\n\nKeine externe Telemetry-Plattform-Integration zwingend (Sentry o.√§. optional)\n\nScope / Deliverables\n1) CorrelationId Standard\n\nCorrelationId wird pro Request/Flow-Aktion gesetzt:\n\nWenn Client X-Correlation-Id sendet ‚Üí √ºbernehmen (validieren, bounded length).\n\nSonst serverseitig generieren (UUID v4) und in Response zur√ºckgeben.\n\nCorrelationId wird:\n\nin Response Envelope aufgenommen (falls ihr schon Envelope habt: meta.correlationId)\n\nin server logs als structured field gesetzt (ohne PHI)\n\nGuardrails\n\nBounded length (z.B. max 64)\n\nNur [a-zA-Z0-9-_] erlauben oder UUID-Format validieren\n\nFail-closed: invalid incoming correlation id ‚Üí neue generieren (nicht request failen)\n\n2) Minimal Event Model (DB oder Append-only Store)\n\nImplementiere eine append-only Tabelle (oder bestehendes Audit/Event-System minimal erweitern), z.B.:\n\nTable: pilot_flow_events\n\nid (uuid)\n\ncreated_at (timestamptz, default now())\n\norg_id (uuid, nullable falls nicht verf√ºgbar)\n\npatient_id (uuid, nullable; wenn PHI-policy streng: pseudonymisierte id)\n\nactor_role (patient|clinician|admin|system)\n\ncorrelation_id (text)\n\nevent_type (enum)\n\nentity_type (text, e.g. triage|workup|funnel)\n\nentity_id (uuid/text)\n\nfrom_state (text, nullable)\n\nto_state (text, nullable)\n\npayload_json (jsonb) PHI-safe, strikt begrenzt\n\npayload_hash (text, optional, deterministic integrity)\n\nEvent Types (v0.6)\n\nTRIAGE_SUBMITTED\n\nTRIAGE_ROUTED (to nextAction)\n\nFUNNEL_STARTED\n\nFUNNEL_RESUMED\n\nFUNNEL_COMPLETED\n\nWORKUP_STARTED\n\nWORKUP_NEEDS_MORE_DATA\n\nWORKUP_READY_FOR_REVIEW\n\nESCALATION_OFFER_SHOWN\n\nESCALATION_OFFER_CLICKED\n\nPHI-safe payload rules\n\nKein Freitext aus AMY\n\nKeine Symptomtexte\n\nErlaubt: nextAction, tier, boolean redFlag, counts (z.B. missingDataCount), stable identifiers (funnel slug)\n\nPayload size bound: z.B. max 2KB; sonst truncate oder reject fields (nicht failen)\n\n3) Event Emission Points (Minimal)\n\nEvents werden in folgenden Momenten geschrieben:\n\nNach Triage Submit / Route (E6.6)\n\nFunnel start/resume/complete (E6.4.3)\n\nWorkup state transition (E6.4.5)\n\nEscalation offer shown/clicked (E6.4.6)\n\nImportant\n\nEmission darf nicht den Flow brechen: wenn event write fehlschl√§gt ‚Üí log warn + continue (best-effort), au√üer ihr wollt fail-closed (f√ºr Pilot eher nicht).\n\n4) Minimal Retrieval (API + optional Viewer)\n\nAPI Endpoint: GET /api/admin/pilot/flow-events?patientId=...&limit=...\n\nAuth: admin/clinician only\n\nOrdering: deterministic (created_at ASC, id ASC)\n\nOptional Minimal UI (wenn schnell):\n\nDev/Admin page ‚ÄúPilot Events‚Äù zeigt last 100 events, filter by patientId/correlationId\n\nAcceptance Criteria (testable)\n\nAC1 CorrelationId propagation: Jede relevante API Response enth√§lt CorrelationId (Header oder Envelope).\n\nAC2 Event coverage: F√ºr jeden der Event Types gibt es mindestens einen Integration-Test oder E2E Smoke Schritt, der Event erzeugt.\n\nAC3 PHI-safe: Keine Event payload enth√§lt Felder, die aus Freitext stammen; nur allowlist keys.\n\nAC4 Deterministic ordering: API liefert Events stabil sortiert (created_at ASC, id ASC).\n\nAC5 Best-effort: Event write failure blockiert nicht Triage/Funnel/Workup (aber wird geloggt).\n\nAC6 Endpoint governance: Telemetry endpoints sind im Endpoint Catalog und von UI/Admin-dev Seite referenziert (oder internal + getestet).\n\nVerification (PowerShell)\n\n(Beispiele; konkrete Endpoints anpassen)\n\nnpm test\nnpm run build\nnpm run dev:endpoints:verify\n\n# Example: call an endpoint and inspect correlation id\n$r = iwr http://localhost:3000/api/patient/dashboard -Headers @{ Cookie = $cookie } -SkipHttpErrorCheck\n$r.Headers[\"X-Correlation-Id\"]\n\n# Fetch events (admin)\niwr \"http://localhost:3000/api/admin/pilot/flow-events?limit=20\" -Headers @{ Cookie = $adminCookie } -SkipHttpErrorCheck\n\n\nUI smoke (minimal):\n\nPatient: Dashboard ‚Üí AMY submit ‚Üí routed to funnel\n\nComplete funnel\n\nWorkup transitions to needs_more_data\n\nAdmin: open Pilot Events page ‚Üí see sequence with same correlationId\n\nImplementation Notes / Guardrails\n\nUse existing response envelope helpers and error semantics (401-first, 403/404 policy).\n\nEvent payload schema versioning: include payloadVersion: 1 in payload_json.\n\nAvoid storing raw IDs in logs; events can store patient_id if DB is already protected by RLS and admin-only access.\n\nDependencies\n\nE6.4.3 (Funnel wiring emits events)\n\nE6.4.5 (Workup emits transitions)\n\nE6.4.6 (Escalation emits shown/clicked)\n\nE6.2.8 (Correlation IDs + breadcrumbs) ‚Üí align fields/names; avoid duplication\n\nDone Definition\n\nCorrelationId standard implemented + documented\n\nEvents persisted + retrievable\n\nTests/Smoke steps prove event sequence\n\nNo PHI leakage in payload/logs","labels":[],"number":558,"state":"CLOSED","title":"E6.4.8 ‚Äî Minimal Telemetry: CorrelationId + Triage/Workup State Transitions (Non-blocking, Pilot-safe)"},{"body":"üÜï NEW ISSUE: E6.4.6 ‚Äî Escalation Offer Stub (Red Flags ‚Üí Video/Doctor CTA) [v0.6 P0/P1]\n\nTitle (new):\n\nProblem\n\nDer Flow braucht eine sichere Abzweigung bei Red Flags: Patient:in muss klare Hinweise + Option zur Eskalation bekommen ‚Äì ohne dass ihr v0.6 schon Termin-/Task-System baut.\n\nScope\n\nRed Flag (aus Triage oder Workup) ‚Üí UI zeigt:\n\nNotfallhinweis / Disclaimer\n\nCTA: ‚ÄúVideo consultation‚Äù / ‚ÄúDoctor appointment‚Äù (Placeholder)\n\nLogging/Audit minimal (event type + timestamp + correlationId)\n\nKein Scheduling, keine Queue, keine Tasks.\n\nAcceptance Criteria\n\nAC1: RedFlag ‚Üí Escalation Offer wird angezeigt (deterministisch).\n\nAC2: CTA klickbar, f√ºhrt zu Placeholder Screen / External link stub.\n\nAC3: Event wird geloggt (ohne PHI), correlationId vorhanden.\n\nAC4: Kein Support-Task System erforderlich.\n\nVerification (UI)\n\nSimuliere RedFlag √ºber Triage (test input) ‚Üí Offer erscheint.\n\nKlick ‚Üí Placeholder.\n\nDependencies\n\nE6.6 Triage Router (oder vorhandene routing layer)\n\nE6.4.4 Surface\n\nDone Definition\n\nOffer stub vorhanden + logged\n\nKeine Terminlogik implementiert","labels":[],"number":557,"state":"CLOSED","title":"E6.4.6 ‚Äî Escalation Offer Stub: Red Flags ‚Üí Video/Doctor CTA (No Scheduling, Logged)"},{"body":"üÜï NEW ISSUE: E6.4.5 ‚Äî Workup Stub (Data Sufficiency + Loopback Questions) [v0.6 P0]\n\n\nProblem\n\nDer neue Flow braucht einen ‚ÄúWorkup‚Äù-Schritt. F√ºr v0.6 darf das keine Arbeitsdiagnose ausgeben. Es muss nur deterministisch entscheiden:\n\nSind Daten ausreichend?\n\nWelche Daten fehlen?\n\nWelche Follow-up Questions/Tests m√ºssen zur√ºck in die Anamnese?\n\nScope / Deliverables\n\nWorkup Model (persisted)\n\nEntity: workups (oder bestehendes Konzept erweitern)\n\nStates:\n\nworkup_started\n\nneeds_more_data\n\nready_for_review\n\nStored fields:\n\nevidence_pack_hash (hash √ºber inputs)\n\nmissing_data[]\n\nfollow_up_questions[]\n\ncreated_at/updated_at\n\nsource_version (ruleset version)\n\nData Sufficiency Check (deterministic)\n\nRule/template based (kein kreatives LLM)\n\nInputs: funnel answers + available uploads/wearable flags\n\nOutput: missing_data + follow_up_questions\n\nLoopback\n\nWorkup erzeugt Follow-ups, die als ‚Äûnext funnel step‚Äú oder ‚Äúfollow-up mini-step‚Äù im Funnel erscheinen\n\nPatient kann direkt aus Workup/Next Step Surface zur√ºck in Funnel\n\nNo patient-visible diagnosis\n\nKeine Differentiale, keine Hypothesen, keine ‚ÄúArbeitsdiagnose‚Äù-Textausgabe.\n\nAcceptance Criteria\n\nAC1: Workup state transitions deterministisch und testbar.\n\nAC2: needs_more_data enth√§lt mindestens 1 Follow-up Frage wenn Daten fehlen.\n\nAC3: ready_for_review setzt keine Diagnoseausgabe, nur Status.\n\nAC4: evidence_pack_hash ist stabil (gleiches input ‚Üí gleicher hash).\n\nAC5: Endpoints sind im endpoint catalog und von UI aufgerufen.\n\nVerification\n\nUnit tests: data sufficiency rules (given input ‚Üí expected missing_data)\n\nUI smoke: Funnel completion ‚Üí Workup shows follow-ups ‚Üí user continues ‚Üí missing_data shrinks ‚Üí ready_for_review.\n\nPowerShell (Beispiel):\n\nnpm test\nnpm run dev:endpoints:verify\n\nDependencies\n\nE6.4.3 Funnel completion must trigger workup\n\nE6.4.4 Surface must display workup content\n\nDone Definition\n\nNo patient-visible diagnosis outputs in any response/screen\n\nDeterministic tests exist for sufficiency rules","labels":[],"number":556,"state":"CLOSED","title":"E6.4.5 ‚Äî Workup Stub: Data Sufficiency Check + Follow-up Questions + Loopback (No Diagnosis)"},{"body":"‚úÖ E6.4.10 ‚Äî #551 Seed/Fixture: Minimal Pilot Data Setup (Org, Roles, Test Patients)\n\nTitle (update):\nE6.4.10 ‚Äî Seed/Fixture: Pilot Org + Test Patients + 2 Funnels + Workup States\n\nProblem\n\nOhne deterministische Seeds ist der Pilot nicht reproduzierbar (f√ºr dev/stage/demo).\n\nScope\n\nSeed/fixture erzeugt:\n\nPilot Org\n\nRollen (patient/clinician/admin)\n\n1‚Äì3 Testpatienten (eligible)\n\n2 Pilot Funnels (oder references)\n\nWorkup default states\n\nDashboard tiles minimal (stub content)\n\nAcceptance Criteria\n\nAC1: Seed ist deterministisch (identische slugs/ids, keine random drift).\n\nAC2: db:seed (oder euer Prozess) erzeugt lauff√§higen Pilot.\n\nAC3: Nach Seed kann man Happy Path (E6.4.2) in 5 min durchspielen.\n\nVerification (PowerShell)\n# example\nnpm run db:reset\nnpm run db:migrate\nnpm run db:seed\n\nnpm run dev:endpoints:gen\nnpm run dev:endpoints:verify\n\nDone Definition\n\nSeed ist dokumentiert in Runbook\n\nOne-command path exists","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNHiA","name":"cleanup","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":551,"state":"CLOSED","title":"E6.4.10 ‚Äî Seed/Fixture: Minimal Pilot Data Setup (Org, Roles, Test Patients)"},{"body":"### Ziel\nF√ºr Pilotbetrieb: minimal KPIs + verhindern, dass unverdrahtete endpoints verloren gehen.\n\n#### Scope\n- Extend usage tracker views or admin endpoint usage to surface:\n  - funnel starts/completes\n  - review decisions\n  - support case volume\n- Ensure endpoint catalog + allowlist remains deterministic; add pilot-specific ‚Äúmust be used‚Äù list.\n\n#### Acceptance Criteria\n- Admin can see usage for pilot-relevante Routen (mindestens eine Minimal-Liste).\n- Doc section definiert, welche Routen w√§hrend des Pilot-Tests non-zero zeigen m√ºssen.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":550,"state":"CLOSED","title":"E6.4.9 ‚Äî Pilot Telemetry/KPIs (Minimal) + ‚ÄúUnused Endpoints‚Äù Gate Alignment"},{"body":"### Ziel\nNach dem Pilot braucht ihr auswertbare Artefakte.\n\n#### Scope\nAudit:\n- /api/patient-measures/export\n- /api/reports/[reportId]/pdf\n- Define export format + data minimization (PHI).\n- Document: docs/pilot/EXPORTS.md\n\n#### Acceptance Criteria\n- Export endpoint returns consistent file + correct headers.\n- One example export per patient.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":549,"state":"CLOSED","title":"E6.4.8 ‚Äî Data Export for Pilot Evaluation (Measures/Reports/PDF)"},{"body":"‚úÖ E6.4.7 ‚Äî #548 Operational Runbook + Smoke Tests (PowerShell) for Pilot\n\nTitle (update):\nE6.4.7 ‚Äî Pilot Runbook + Flow Smoke Tests (PowerShell, Dashboard-first)\n\nProblem\n\nPilot scheitert nicht an Features, sondern an ‚Äûes bricht irgendwo‚Äú. Wir brauchen ein kurzes Runbook + reproduzierbare Smoke Tests, die den Flow end-to-end beweisen.\n\nScope\n\ndocs/runbooks/PILOT_SMOKE_TESTS.md (oder existing location)\n\nPowerShell commands + UI steps\n\n5 Pflicht-Smokes:\n\nAcceptance Criteria (5 Smokes)\n\nDashboard loads (auth ok, eligible ok)\n\nAMY submit routes (triage returns nextAction)\n\nStart/Resume funnel works\n\nWorkup needs_more_data shows follow-ups\n\nBack to dashboard shows updated Next Step\n\nVerification (PowerShell template)\nnpm test\nnpm run build\n\n# Start dev (or use existing)\nnpm run dev\n\n# (Optional) hit endpoints if available\niwr http://localhost:3000/api/health -SkipHttpErrorCheck\n\nDone Definition\n\nRunbook exists, short, copy/paste-ready\n\nSomeone else can run it and get same outcome","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":548,"state":"CLOSED","title":"E6.4.7 ‚Äî Operational Runbook + Smoke Tests (PowerShell) for Pilot"},{"body":"### Ziel\nOperativer Loop f√ºr Pilot: patient/clinician support case, escalation erzeugt task, auditbar.\n\n#### Scope\nAudit endpoints:\n- /api/support-cases\n- /api/support-cases/[id]\n- /api/support-cases/[id]/escalate\n- /api/tasks, /api/tasks/[id]\n- Verify: escalation creates task + audit trail; role gating correct.\n\n#### Acceptance Criteria\n- One scripted scenario in docs: create support case ‚Üí escalate ‚Üí task appears for clinician.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":547,"state":"CLOSED","title":"E6.4.6 ‚Äî Support Cases + Escalation ‚Üí Tasks (Ops loop MVP)"},{"body":"### Ziel\nClinician QA-Review ist pilotstabil inkl. Audit.\n\n#### Scope\nHardening of:\n- /api/review/queue\n- /api/review/[id]\n- /api/review/[id]/details\n- /api/review/[id]/decide\n- Ensure:\n  - auth-first\n  - role gating\n  - 404/409 semantics\n  - audit event emitted on decide.\n\n#### Acceptance Criteria\n- Route-level tests cover key semantics (existing tests extended if needed).\n- Decide produces audit event record.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfMbEA","name":"Clinican","description":"","color":"a5f4a5"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":546,"state":"CLOSED","title":"E6.4.5 ‚Äî Review Workflow Hardening (Queue ‚Üí Details ‚Üí Decide) + Audit Trail"},{"body":"‚úÖ E6.4.4 ‚Äî #545 Result/Report Surface (Patient View) + Clinician View Consistency\n\nTitle (REPLACE):\nE6.4.4 ‚Äî Workup / Next Step Surface (Patient + Clinician Minimal, No Queue)\n\nProblem\n\n‚ÄúReport‚Äù klingt nach medizinischem Ergebnis. In v0.6 braucht ihr eine Workup/Next Step Oberfl√§che: Status, Datenl√ºcken, n√§chste Schritte ‚Äì konsistent in Patient- und Clinician/Admin-View, aber ohne Review-Queue.\n\nScope / Deliverables\n\nPatient View:\n\nWorkup Status (needs_more_data/ready_for_review)\n\nMissing data list\n\nFollow-up questions CTA (loopback)\n\nEscalation Offer CTA (stub)\n\nClinician/Admin View:\n\ngleiche Statuswerte + Datenl√ºcken sichtbar\n\nkeine ‚ÄúDecide‚Äù-Queue Logik (kommt v0.7)\n\nAcceptance Criteria\n\nAC1: Patient sieht keine ‚ÄúDiagnose‚Äù/Differentiale in v0.6.\n\nAC2: Patient sieht klare Next Steps:\n\n‚ÄúAnswer follow-up questions‚Äù\n\noptional ‚ÄúVideo/Doctor offer‚Äù\n\nAC3: Clinician/Admin sieht konsistente Statuswerte (kein drift).\n\nAC4: Error semantics korrekt (401/403/404/500) und im Envelope.\n\nVerification (UI)\n\nPatient completes funnel ‚Üí sees workup status and next steps\n\nClinician opens same patient record ‚Üí sees same workup status and missing data\n\nDependencies\n\nE6.4.5 Workup Stub\n\nAuth role resolution (E6.2.6)\n\nDone Definition\n\nKeine patient-visible ‚ÄúArbeitsdiagnose‚Äù Outputs\n\nScreens wired from dashboard with stable navigation","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":545,"state":"CLOSED","title":"E6.4.4 ‚Äî Result/Report Surface (Patient View) + Clinician View Consistency"},{"body":"‚úÖ E6.4.3 ‚Äî #544 Funnel Wiring Completion for Pilot Funnels (2 Funnels, Patient UI-first)\n\nTitle (REPLACE):\nE6.4.3 ‚Äî Patient Flow Wiring (Dashboard ‚Üí Triage ‚Üí 2 Pilot Funnels ‚Üí Workup Stub ‚Üí Dashboard)\n\nProblem\n\nIm bisherigen Stand sind Funnels/Patient-Verdrahtung fragil. F√ºr Pilot braucht es E2E: vom Dashboard getrieben, resume-f√§hig, eindeutige Completion-States, und sauberer R√ºcksprung zum Dashboard.\n\nScope / Deliverables\n\n2 Pilot Funnels werden vollst√§ndig im Patient Flow verdrahtet:\n\nStart (from dashboard)\n\nResume (from dashboard)\n\nPersist answers\n\nCompletion state\n\nFunnel entry wird nicht als ‚ÄûStartseite‚Äú genutzt.\n\nNach Abschluss: Workup Status wird gesetzt oder ‚Äúneeds_more_data‚Äù ausgel√∂st.\n\nAcceptance Criteria\n\nAC1: Funnel Start ist nur √ºber Dashboard/Router m√∂glich (oder dashboard-deeplink).\n\nAC2: Resume funktioniert: App zeigt ‚ÄúContinue‚Äù und f√ºhrt in korrekten Step.\n\nAC3: Completion setzt deterministischen Zustand (completed_at, funnel_state=completed).\n\nAC4: Nach Completion f√ºhrt Flow zur√ºck ins Dashboard und zeigt Next Step.\n\nAC5: Keine ‚Äûtoten‚Äú Funnel APIs: alle endpoints sind von UI referenziert.\n\nVerification (UI)\n\nDashboard ‚Üí Start Funnel A\n\n2‚Äì3 Steps beantworten ‚Üí Exit ‚Üí Dashboard zeigt ‚ÄúContinue‚Äù\n\nContinue ‚Üí letzter Step\n\nAbschluss ‚Üí Dashboard zeigt ‚ÄúWorkup: needs_more_data / ready‚Äù\n\nRepeat for Funnel B\n\nDependencies\n\nE6.6 AMY/Triage (wenn Router schon davor liegt)\n\nE6.4.5 Workup Stub (Status setzen)\n\nDone Definition\n\nDeterministische states + keine 404 fetches\n\nEndpoint catalog shows funnel endpoints + UI references","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":544,"state":"CLOSED","title":"E6.4.3 ‚Äî Funnel Wiring Completion for Pilot Funnels (2 Funnels, Patient UI-first)"},{"body":"‚úÖ E6.4.2 ‚Äî #543 Patient Onboarding ‚ÄúPilot Happy Path‚Äù (Consent + Onboarding Status + First Funnel)\n\nTitle (update):\nE6.4.2 ‚Äî Pilot Happy Path: Onboarding ‚Üí Dashboard ‚Üí Next Step (Consent + Status)\n\nProblem\n\nPilot muss einen einzigen stabilen Happy Path haben: Patient:in kommt rein, consent/onboarding wird gespeichert, und landet immer auf Dashboard, wo ‚ÄúNext Step‚Äù klar angeboten wird.\n\nScope / Deliverables\n\nOnboarding/Consent minimal (bestehende Mechanik nutzen)\n\nPersistenter onboarding_status (z.B. not_started | in_progress | completed)\n\nPost-onboarding redirect ‚Üí Dashboard\n\nDashboard zeigt ‚ÄúNext Step‚Äù: Start/Continue Funnel oder Info Content\n\nAcceptance Criteria\n\nAC1: Nach Abschluss Onboarding wird onboarding_status=completed persistiert.\n\nAC2: Nach Onboarding ist Dashboard die Landing-Page (kein Funnel direct start ohne Dashboard).\n\nAC3: Dashboard zeigt:\n\n‚ÄúContinue‚Äù wenn Funnel in progress\n\n‚ÄúStart Funnel A/B‚Äù wenn none started\n\nAC4: Zust√§nde sind deterministisch (kein ‚Äúsometimes‚Äù abh√§ngig von race conditions).\n\nVerification (UI + PowerShell)\n\nUI smoke:\n\nLogin als Testpatient\n\nOnboarding/Consent abschlie√üen\n\nErwartung: Redirect Dashboard\n\nErwartung: Dashboard zeigt Next Step CTA\n\nPowerShell (wenn API vorhanden):\n\n# Example: read onboarding status\niwr http://localhost:3000/api/patient/onboarding-status -Headers @{ Cookie = $cookie } -SkipHttpErrorCheck\n\nDependencies\n\nE6.4.10 Seed: Testpatient + onboarding defaults\n\nE6.1.7 Mobile Shell (UI stability)\n\nDone Definition\n\nHappy Path dokumentiert (kurz) in Runbook (E6.4.7)\n\nRegression test (Playwright falls vorhanden, sonst Jest route tests)","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":543,"state":"CLOSED","title":"E6.4.2 ‚Äî Patient Onboarding ‚ÄúPilot Happy Path‚Äù (Consent + Onboarding Status + First Funnel Entry)"},{"body":"‚úÖ E6.4.1 ‚Äî #542 Define Pilot Scope + Eligibility Gate (Org/Role/Data Boundaries)\n\nTitle (update):\nE6.4.1 ‚Äî Pilot Scope + Eligibility Gates (Dashboard-only Entry, Guided AMY, Data Boundaries)\n\nProblem\n\nv0.6 Pilot muss fail-closed sein: nur definierte Testpatient:innen/Org/Rollen d√ºrfen den Pilot-Flow nutzen. Zus√§tzlich muss der validierte Flow erzwungen werden: Entry immer Dashboard, AMY nur Guided, neue Endpoints d√ºrfen nicht ‚Äúverwaisen‚Äù.\n\nScope / Deliverables\n\nEligibility Gate\n\nPilot-Org(s) allowlist\n\nTestpatient allowlist (oder Flag in DB)\n\nRollen-Gate (Patient vs Clinician/Admin)\n\nUmgebungsgate (z.B. staging only, optional)\n\nFlow Gates\n\nDashboard ist der einzige erlaubte Einstieg f√ºr Patient-Flows.\n\nDeep Links/Routes d√ºrfen existieren, m√ºssen aber:\n\nentweder zum Dashboard redirecten, oder\n\nfail-closed blocken (policy entscheiden, siehe AC)\n\nData Boundaries\n\nPatient sieht nur eigene Daten (RLS enforced)\n\nClinician/Admin sieht nur Pilot-Org Daten (RLS/Server-side checks)\n\nNo PHI leakage in logs\n\nGovernance\n\nNeue Endpoints m√ºssen im Endpoint Catalog erscheinen und von UI referenziert sein (oder internal + getestet).\n\nAcceptance Criteria (testable)\n\nAC1 (Auth ordering): Unauthenticated ‚Üí 401 (401-first), ohne DB/IO calls.\n\nAC2 (Eligibility): Authenticated aber nicht eligible ‚Üí 403 (oder 404, aber konsistent) mit standardisiertem Error Envelope.\n\nAC3 (Dashboard-only entry): Patient kann nicht ‚Äúdirekt‚Äù in Funnel/Workup/Result routes einsteigen (redirect oder block ‚Äì entscheidet ihr, aber deterministisch).\n\nAC4 (RLS): Patient kann keine fremden records lesen; Clinician/Admin nur Pilot-Org.\n\nAC5 (Endpoint governance): F√ºr alle v0.6 neuen APIs gilt: endpoint-catalog generator + CI Gate ist gr√ºn.\n\nVerification (PowerShell)\n# 1) Unauth ‚Üí 401-first\niwr http://localhost:3000/api/patient/dashboard -SkipHttpErrorCheck | Select-Object StatusCode\n\n# 2) Eligibility negative: login as non-pilot user (existing helper/cookie)\n# Expect 403/404\niwr http://localhost:3000/api/patient/dashboard -Headers @{ Cookie = $cookie } -SkipHttpErrorCheck | Select-Object StatusCode\n\n# 3) Endpoint catalog determinism/gates\nnpm test\nnpm run build\nnpm run dev:endpoints:gen\nnpm run dev:endpoints:verify\n\nDependencies\n\nE6.3 Endpoint Governance (already done)\n\nAuth/session robustness (E6.2.6)\n\nDB seed for pilot org/test patients (E6.4.10)\n\nDone Definition\n\nTests for auth/eligibility ordering exist\n\nLocal verify commands above pass\n\nNo dead endpoints: every new endpoint is called from UI (or explicit internal + test)","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":542,"state":"CLOSED","title":"E6.4.1 ‚Äî Define Pilot Scope + Eligibility Gate (Org/Role/Data Boundaries)"},{"body":"## Version  \nv0.6\n\n## Area  \nPilotbetrieb (wenige Testpatienten)\n\n### Motivation (SOLL ‚Üí IST):\n\n**SOLL:** In v0.6 sind die Kernfl√ºsse so stabil und operational abgesichert, dass wenige Testpatienten sicher durchlaufen k√∂nnen (Onboarding ‚Üí Assessment(s) ‚Üí Ergebnis/Report ‚Üí Support/Follow-up), inkl. minimaler klinischer/operativer Werkzeuge (Clinician View, Review Queue, Support Cases, Audit/Logging, Export).\n\n**IST:** Viele Bausteine existieren (Funnels, Review/QA, Support Cases, Tasks, Shipments, Usage Tracking), aber es fehlt eine Pilot-gerechte End-to-End Verdrahtung, klare Rollen-/Zugriffsmodelle f√ºr den Pilot, sowie ein ‚ÄúOps Playbook‚Äù (was tun bei Fehlern, wie triage, welche KPIs, welche Datenexporte).\n\n## Ziele\n- End-to-End Pilot Flow (Patient): Onboarding/Consent ‚Üí Funnel start/resume ‚Üí completion ‚Üí result/report view.\n- Clinician Minimal Toolkit: Review Queue, Patient Snapshot, Support Case Handling, Task/Eskalation, Delivery basics.\n- Operational Guardrails: Audit trail, PHI-safe logs, correlation IDs, clear error semantics.\n- Pilot Governance: Rollen/Org scoping, Datenzugriff klar und getestet.\n- Runbook + KPI Dashboard (minimal): Was √ºberwachen, wie reagieren, wie exportieren.\n\n## Nicht-Ziele (0.6)\n- Vollst√§ndiges klinisches Produkt (voller EHR-Workflow).\n- Skalierung/Performance-Optimierung f√ºr viele Nutzer.\n- Vollautomatisierte Reminders/Notifications (nur minimal/ready).\n\n## Acceptance Criteria (Epic)\n- Es gibt einen dokumentierten Pilot Runbook + Smoke Test Script (PowerShell) f√ºr die wichtigsten Pfade.\n- Mindestens 1 vollst√§ndiger Funnel ist patientseitig verdrahtet und testbar inkl. Result/Report Darstellung (und nicht nur Backend).\n- Clinician kann: Review Queue sehen, Review Details abrufen, entscheiden, Support Case eskalieren ‚Üí Task entsteht.\n- Exporte funktionieren (mind. patient measures export oder report pdf signed url) f√ºr Pilot-Analyse.\n- npm test + npm run build + CI gates gr√ºn.\n\n## Child Issues (E6.4.x)\nE6.4.1 ‚Äî Define Pilot Scope + Eligibility Gate (Org/Role/Data Boundaries)\nE6.4.2 ‚Äî Patient Onboarding ‚ÄúPilot Happy Path‚Äù (Consent + Onboarding Status + First Funnel Entry)\nE6.4.3 ‚Äî Funnel Wiring Completion for Pilot Funnels (2 Funnels, Patient UI-first)\nE6.4.4 ‚Äî Result/Report Surface (Patient View) + Clinician View Consistency\nE6.4.5 ‚Äî Review Workflow Hardening (Queue ‚Üí Details ‚Üí Decide) + Audit Trail\nE6.4.6 ‚Äî Support Cases + Escalation ‚Üí Tasks (Ops loop MVP)\nE6.4.7 ‚Äî Operational Runbook + Smoke Tests (PowerShell) for Pilot\nE6.4.8 ‚Äî Data Export for Pilot Evaluation (Measures/Reports/PDF)\nE6.4.9 ‚Äî Pilot Telemetry/KPIs (Minimal) + ‚ÄúUnused Endpoints‚Äù Gate Alignment\nE6.4.10 ‚Äî Seed/Fixture: Minimal Pilot Data Setup (Org, Roles, Test Patients)","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"}],"number":541,"state":"CLOSED","title":"EPIC: E6.4 ‚Äî Pilot Readiness (Testpatienten) + Clinical Ops Minimal Set"},{"body":"**Ziel:** Verhindert Drift zwischen Code & Docs/Schemas.\n\n### Scope\n- Script-Export: scripts/dev/mobile-contract/export.js ‚Üí docs/dev/mobile-contracts.v1.json\n- CI-Verify: scripts/ci/verify-mobile-contracts.ps1\n\n### Acceptance Criteria\n- Deterministischer Export; CI-Fail enth√§lt Regenerate-Befehl\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":539,"state":"CLOSED","title":"E6.2.10 ‚Äî Optional Gate: Verify Mobile Contract Exports Are Up To Date (CI)"},{"body":"**Ziel:** Ein Dokument, das iOS Umsetzung in 0.7 beschleunigt.\n\n### Scope\n- docs/mobile/IOS_INTEGRATION_PACK.md\n- Links zu allen vorherigen Docs\n- Happy Path-Sequenzen\n- Curl & PowerShell Examples\n- Troubleshooting/Error-Mapping\n\n### Acceptance Criteria\n- 5+ End-to-End-Beispiel-Sequenzen\n- Ready-to-implement Checklist f√ºr iOS\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":538,"state":"CLOSED","title":"E6.2.9 ‚Äî ‚ÄúiOS Integration Pack‚Äù Doc + Example Calls"},{"body":"**Ziel:** Mobile Bugreports sind nachvollziehbar.\n\n### Scope\n- Add Correlation-ID Middleware (X-Request-Id, Response Header+Meta, Logs)\n- Docs: docs/mobile/OBSERVABILITY.md\n\n### Acceptance Criteria\n- Jeder API Response: Correlation Id enthalten\n- 1 Debug-Session-Doku in den Docs\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNWpyg","name":"observability","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":537,"state":"CLOSED","title":"E6.2.8 ‚Äî Observability: Correlation IDs + Client Debug Breadcrumbs"},{"body":"**Ziel:** iOS braucht klare Regeln: was kann gecacht werden, wie invalidieren, wie paginieren.\n\n### Scope\n- F√ºr Catalog/List-Endpunkte:\n    - Pagination shape (cursor/limit)\n    - Caching Header (ETag/last-modified)\n- Docs: docs/mobile/CACHING_PAGINATION.md\n\n### Acceptance Criteria\n- Funnels catalog: deterministische Pagination + Caching Guidance\n- Response: Stable Sort Order Guarantee\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":536,"state":"CLOSED","title":"E6.2.7 ‚Äî Mobile-Friendly Caching & Pagination Contract"},{"body":"**Ziel:** iOS kann verl√§sslich session-handlen (expiry/refresh) ohne ‚Äúmystery states‚Äù.\n\n### Scope\n- Review/Harden:\n    - /api/auth/resolve-role\n    - callback flow\n    - patient session endpoints\n- Contract: Bei Session Expiry immer 401 + code SESSION_EXPIRED\n- Docs: docs/mobile/AUTH_SESSION.md\n\n### Acceptance Criteria\n- Konsistent 401-first und error code\n- Keine uneinheitlichen Status f√ºr gleiche Szenarios\n\n### Verification\n- Tests f√ºr 401 mit expected error codes\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNN-0g","name":"auth","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":535,"state":"CLOSED","title":"E6.2.6 ‚Äî Auth/Session Robustness for Mobile (Refresh, Expiry, Role Resolution)"},{"body":"**Ziel:** Definiertes Deep-Linking, das iOS in v0.7 implementieren kann.\n\n### Scope\n- docs/mobile/DEEP_LINKS.md:\n    - rhythm:// oder https-based universal link contract\n    - Entry points: open funnel, resume assessment, open result, open notification center\n    - Parameter rules, validation, auth gating\n    - Optional: Web fallback routes/redirects\n\n### Acceptance Criteria\n- Jeder Deep Link: Pfad, Params, Auth-Rule, Behavior\n- Sicherheit: Keine sensiblen Daten in URL, Lookup √ºber IDs\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":534,"state":"CLOSED","title":"E6.2.5 ‚Äî Deep Link Contract (Routes + Params + Security)"},{"body":"**Ziel:** Mobile Clients k√∂nnen safe retryen (Netz weg, App kill, duplicate submits).\n\n### Scope\n- Idempotency-Key handling f√ºr Write-Endpunkte:\n    - Idempotency-Key Header (uuid)\n    - Store key+result f√ºr window (oder deterministic dedupe by (assessmentId, stepId, payloadHash))\n    - save answers, step submit, complete\n- Docs: docs/mobile/IDEMPOTENCY.md\n\n### Acceptance Criteria\n- Double submit mit gleichem key: gleiche Antwort, keine Duplikate\n- Konflikt: 409 mit klarem error code\n\n### Verification\n- Zwei gleiche Requests mit Key liefern identisches Resultat","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":533,"state":"CLOSED","title":"E6.2.4 ‚Äî Idempotency + Retry-Safe Writes (Mobile Offline/Retry Readiness)"},{"body":"**Ziel:** Explizite, versionierte Schemas (request/response), exportierbar f√ºr iOS.\n\n### Scope\n- lib/api/contracts/patient/* (zod schemas)\n- Jede Response enth√§lt schemaVersion: \"v1\" (oder semver string).\n- Update route handlers to validate + type against schema.\n\n### Acceptance Criteria\n- Kern-Endpunkte: start assessment, save answers, resume, complete, result haben schemas.\n- Runtime validation: requests validated (where needed), responses shaped deterministisch.\n\n### Verification\n- npm test\n- npm run build","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":532,"state":"CLOSED","title":"E6.2.3 ‚Äî Contract Schemas (zod/TS) + Version Marker for Patient Endpoints"},{"body":"**Ziel:** Konsistente Antwortstruktur + Fehlercodes, so dass Mobile Clients deterministisch reagieren k√∂nnen.\n\n### Scope\n- F√ºr Patient APIs: standard envelope (success/data + error/code/message + details).\n- Status codes:\n  - 401 unauth\n  - 403 forbidden (role/ownership)\n  - 404 not found\n  - 409 state conflict (z.B. assessment bereits complete, version mismatch)\n  - 422 validation failed (wenn genutzt) oder 400 (wenn standard)\n- Dokumentation: docs/mobile/API_ERRORS.md\n\n### Acceptance Criteria\n- Mindestens die Kern-Endpunkte (assessment start/save/resume/complete/result) verwenden die gleiche Envelope und error codes.\n- Keine ‚Äúsilent‚Äù failures; alle errors sind maschinenlesbar.\n\n### Verification\n- npm test\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":531,"state":"CLOSED","title":"E6.2.2 ‚Äî Standardize Response Envelopes + Error Semantics for Patient APIs"},{"body":"**Ziel:** Festlegen, welche Endpoints die iOS-App in v0.7 sicher braucht + welche Guarantees gelten.\n\n### Scope\n- Neue Datei: docs/mobile/MOBILE_API_SURFACE.md\n- Liste der Endpoints (patient flow) aus endpoint catalog\n- Muss-Felder: auth required?, idempotent?, cacheable?, pagination?, rate limits?\n- ‚ÄúMust support‚Äù matrix (v0.7 iOS) + ‚Äúnice to have‚Äù\n\n### Acceptance Criteria\n- Matrix enth√§lt mindestens: funnels catalog, assessment start/resume, step submit/save, complete, result fetch, patient profile, onboarding status.\n- Jede Zeile enth√§lt ‚ÄúContract owner‚Äù (route file) + schema version field.\n\n### Verification\n- Docs vorhanden, referenziert konkrete route files.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":530,"state":"CLOSED","title":"E6.2.1 ‚Äî Define Patient Mobile API Surface (Inventory + ‚ÄúMust Support‚Äù Matrix)"},{"body":"## Version\nv0.6\n\n## Area\nMobile readiness (Patient-first)\n\n## Motivation (SOLL ‚Üí IST)\n\n**SOLL**: v0.6 macht das Backend + Web so stabil/vertraglich, dass in v0.7 eine iOS-App (native oder RN) ohne √úberraschungen umgesetzt werden kann: klare API-Contracts, stabile Auth, Deep Links, konsistente Errors, deterministische Flows.\n\n**IST**: Patient-Flows existieren, aber mobile-spezifische Anforderungen (Contract-Stabilit√§t, Session/Auth, Deep-Linking, Offline/Retry, Push-Readiness, Observability, Versioning) sind nicht als zusammenh√§ngende ‚ÄúMobile Readiness‚Äù Schicht umgesetzt.\n\n## Ziele\n- **API-Contracts & Versioning**: stabile Request/Response Schemas f√ºr alle Patient-relevanten Endpoints (v1), inkl. Fehlercodes.\n- **Auth/Session Robustness**: Token refresh / session expiry sauber, klare 401/403/409 Semantik.\n- **Deep Links**: definierte URL-Schemata f√ºr Entry Points (Funnel, Resume, Result, Notifications).\n- **Offline/Retry-f√§hig**: idempotente Writes, Retry-Safe Endpoints, Client-Cache Strategie dokumentiert.\n- **Observability**: Trace/Correlation IDs, mobile-freundliche Logs, Debug-Endpoints nur dev/admin.\n- **Release Artifact**: ‚ÄúiOS Integration Pack‚Äù (Docs + JSON schemas + example calls).\n\n## Nicht-Ziele (0.6)\n- Implementierung der iOS App selbst (v0.7).\n- Vollst√§ndige Offline-App (nur readiness + idempotency + docs).\n- Push-Versand in Produktion (nur Contract + ‚Äúready hooks‚Äù).\n\n## Acceptance Criteria (Epic)\n- `docs/mobile/IOS_INTEGRATION_PACK.md` existiert und deckt Entry Points, Auth, Contracts, Errors, Deep Links, Retry/Offline, Observability ab.\n- Patient-relevante Endpoints haben explizite zod/TS schemas + version marker (mindestens response schema version).\n- Es gibt mindestens 5 Example Calls (PowerShell) f√ºr Kernfl√ºsse: start assessment, save answers, resume, complete, fetch result.\n- Deterministische ‚Äúcontract export‚Äù (JSON) ist m√∂glich (optional gate).\n- `npm test` + `npm run build` gr√ºn.\n\n## Verification (PowerShell)\n- npm test\n- npm run build\n- node scripts/dev/endpoint-catalog/generate.js --repo-root . --out-dir docs/dev --allowlist docs/dev/endpoint-allowlist.json\n- pwsh -NoProfile -File scripts/ci/verify-endpoint-catalog.ps1\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"},{"id":"LA_kwDOQfuwnc8AAAACSNN-0g","name":"auth","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpyg","name":"observability","description":"","color":"ededed"}],"number":529,"state":"CLOSED","title":"E6.2 ‚Äî iOS App Readiness (API Contract, Auth, Deep Links, Offline-friendly, Observability)"},{"body":"**Ziel:** Gate gegen Token-Drift via CI.\n\n###### Scope\n- `scripts/ci/verify-design-tokens.ps1`:\n  * Export in temp dir\n  * Vergleich mit committed JSON\n  * Fail + Guidance\n\n###### Acceptance Criteria\n- CI Fail zeigt \"Run command then commit\"\n- Deterministisch (2 L√§ufe in CI identisch)\n- Verification: pwsh -NoProfile -File scripts/ci/verify-design-tokens.ps1\n\n**Files**:\nscripts/ci/verify-design-tokens.ps1","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":527,"state":"CLOSED","title":"E6.1.10 ‚Äî (Optional Gate) Verify Design Tokens Are Up To Date (CI)"},{"body":"**Ziel:** Proof, dass neues System funktioniert, ohne Komplettumbau.\n\n###### Auswahl Beispiel-Screens\n- Patient: app/patient/funnels, app/patient/funnel/[slug]/intro\n- Clinician: app/clinician/tasks, app/clinician/funnels\n- Admin: app/admin/navigation, app/admin/content\n\n###### Acceptance Criteria\n- Screens nutzen neue Tokens + Core Components\n- Keine Regression\n- \"Before/After\" dokumentiert in MIGRATION_PLAN.md\n- Verification: npm run build, npm test, manueller Smoke-Test Navigation/CRUD\n\n**Files**: \napp/patient/*\napp/clinician/*\napp/admin/*\ndocs/design-system/MIGRATION_PLAN.md","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":526,"state":"CLOSED","title":"E6.1.9 ‚Äî Migration:  Convert 3 Representative Screens (Patient + Clinician + Admin)"},{"body":"**Ziel:** Clinician und Admin Layouts harmonisieren (Sidebar, Header, Container, Tables/Forms).\n\n###### Acceptance Criteria\n- Gleiche Spacing/Gridregeln, typografische Skala\n- Seiten haben konsistente Page Header und Action Bars (Admin/Clinician)\n- Mindestens 2 Clinician- und 2 Admin-Seiten gepr√ºft\n- Verification manuell\n\n**Files**\nlib/ui/DesktopLayout.tsx (falls vorhanden)\napp/clinician/*\napp/admin/*","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDsGw","name":"layout","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":525,"state":"CLOSED","title":"E6.1.8 ‚Äî Layout Patterns:  Clinician/Admin Desktop Shell Consistency"},{"body":"**Ziel:** Patient UI als Mobile-First Shell konsolidieren (Navigation, Header, Progress, Safe Areas).\n\n###### Scope\n- Pattern definieren: Top header + content + bottom nav (optional)\n- Step progress pattern f√ºr Funnel\n- Typische spacing/radius rules\n- Implementierung in app/patient/* Layout/Components\n\n###### Acceptance Criteria\n- Patient Funnel Screens nutzen gemeinsames Layout/Spacing\n- Keine visuellen \"jumps\"\n- Doku in `docs/design-system/LAYOUT_PATTERNS.md` (inkl. Placeholders f√ºr Screenshots/ASCII)\n- End-to-End Smoke-Test √ºber zentrale Patient-Funnel\n\n**Files**\napp/patient/* Layout\napp/components/Patient*","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDsGw","name":"layout","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":524,"state":"CLOSED","title":"E6.1.7 ‚Äî Layout Patterns: Patient Mobile Shell (0.7 iOS Blueprint)"},{"body":"**Ziel:** Standard-Komponenten vereinheitlichen, token-driven.\n\n###### Components (Minimum)\n- Button (primary/secondary/ghost/destructive)\n- Input + Label + HelperText + ErrorText\n- Card\n- Alert/Callout\n- Badge\n- Modal/Dialog wrapper\n- Tabs (falls relevant)\n\n###### Acceptance Criteria\n- Komponenten nutzen nur semantische tokens/CSS vars\n- Einheitliche States:  hover/focus/disabled, error states\n- Mindestens 1 Screen nutzt die neuen Komponenten\n- Verification: `npm test`, `npm run build` + manuell\n\n**Files**\napp/components/ui/* oder lib/ui/components/* (siehe Konvention)","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":523,"state":"CLOSED","title":"E6.1.6 ‚Äî Component Baseline: Core Primitives on Tokens"},{"body":"**Ziel:** Tokens im UI nutzbar machen, ohne Token-Duplikation. \n\n###### Scope\n- Map semantische Tokens ‚Üí CSS Variables (`:root`, `[data-theme=dark]`)\n- Tailwind config nutzt CSS vars (`var(--color-surface-1)` etc.)\n- Alternativ minimal:  nur CSS vars + Komponenten nutzen diese direkt\n\n###### Acceptance Criteria\n- Es gibt eine definierte Stelle, wo Tokens ‚Üí CSS vars geschrieben werden (z.B. `app/globals.css` oder `lib/ui/theme/applyCssVars.ts`)\n- Keine zweite Wahrheit (keine separate Palette im Tailwind config, au√üer Fallback)\n- 3‚Äì5 Komponenten zeigen korrekte Farben in light/dark\n\n**Files**\napp/globals.css (oder styles/theme.css), ggf. tailwind.config.*","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDsGw","name":"layout","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":522,"state":"CLOSED","title":"E6.1.5 ‚Äî Tailwind/Shadcn Bridging (CSS Variables / Mapping)"},{"body":"**Ziel:** Tokens/Theme als deterministisch sortierte JSON exportieren.\n\n###### Implementation Notes\n- Script:  scripts/dev/design-tokens/export. js\n- Input: lib/ui/tokens\n- Output: docs/dev/design-tokens.json\n- Deterministische Sortierung (kein localeCompare)\n- Optional: scripts/ci/verify-design-tokens.ps1\n\n###### Acceptance Criteria\n- `node scripts/dev/design-tokens/export.js --out docs/dev/design-tokens.json` erzeugt stabiles, sortiertes JSON (mehrfach identisch)\n- Export enth√§lt light, dark, brand overlay/resolved tokens\n- Verification: Script ausf√ºhren, zweimal git diff\n\n**Files:**\nscripts/dev/design-tokens/export.js, docs/dev/design-tokens.json (committed)","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":521,"state":"CLOSED","title":"E6.1.4 ‚Äî Token Export Script (Deterministic JSON for iOS)"},{"body":"**Ziel:** Theme-Konfiguration (Light/Dark + Accent) definieren und im UI verf√ºgbar machen.\n\n###### Scope\n- lib/ui/theme/\n  * themeConfig.ts (default theme, allowed values)\n  * ThemeProvider.tsx (Context + hook)\n  * useTheme.ts\n  * Optional:  Persistierung (localStorage), client-only\n\n###### Acceptance Criteria\n- Theme kann im Client gew√§hlt werden (z.B. Admin Dev Page oder Settings Panel)\n- Default:  System-Preference oder dokumentierte Standardeinstellung\n- Keine Server/Client mismatch warnings\n- `npm run build` ohne Hydrations-Warnings (im Test:  `npm run dev`, Theme toggle)\n\n**Files:**\nlib/ui/theme/* und ggf. app/admin/dev/* f√ºr Toggle UI","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":520,"state":"CLOSED","title":"E6.1.3 ‚Äî Theme Config + Runtime Switching (Light/Dark/Accent)"},{"body":"**Ziel**:  Eine zentrale Tokenquelle im Code, die Theme-Varianten unterst√ºtzt.\n\n###### Implementation Notes\n- Lege `lib/ui/tokens/` an: \n  * `tokenTypes.ts` (TypeScript types / zod optional)\n  * `tokens.base.ts` (Baseline Skalen:  spacing, radius, typography scale)\n  * `tokens.light.ts`, `tokens.dark.ts` (semantische Token-Werte)\n  * `tokens.brand.ts` (Accent/Brand overrides als Partial)\n  * `index.ts` exports\n- Tokens nicht Tailwind-abh√§ngig, aber Tailwind konsumiert sie\n- Nur Token-Definitionen selbst referenzieren Rohwerte\n\n###### Acceptance Criteria\n- `getTokens(themeConfig)` liefert deterministisch das Token-Objekt\n- Keine Komponente referenziert \"raw\" Farben o.√§.  (au√üer in Token-Definition)\n- `npm test`, `npm run build` erfolgreich\n\n**Files:**\nlib/ui/tokens/* neu","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":519,"state":"CLOSED","title":"E6.1.2 ‚Äî Implement Semantic Tokens in Code (Source of Truth)"},{"body":"I6.1.1 ‚Äî Design Tokens v1: Source of Truth + Export Pipeline\n\nProblem: Tokens sind verteilt/uneinheitlich; Parametrisierung nicht sauber.\n\nScope\n\nDefiniere docs/design/TOKENS.md als kanonische Token-Spezifikation:\n\nColor tokens (semantic: surface/bg/text/border/primary/critical/‚Ä¶)\n\nTypography tokens (font family, sizes, weights, line-height)\n\nSpacing/radius/shadow tokens\n\nImplementiere lib/design/tokens.ts (single source of truth f√ºr App)\n\nOptional: scripts/design/export-tokens.ts f√ºr JSON export (z.B. f√ºr iOS sp√§ter)\n\nNon-goals\n\nKein vollst√§ndiges Rebranding\n\nKein Figma-Automation-Workflow (nur strukturelle Basis)\n\nAcceptance Criteria\n\nTokens sind semantisch (keine ‚Äúblue500‚Äù hardcodings in UI)\n\nTokens werden in Tailwind/CSS vars oder einem Theme Provider verf√ºgbar gemacht\n\nDokumentation existiert und referenziert die zentralen Token-Keys\n\nFiles/Areas\n\nlib/design/tokens.ts\n\nstyles/globals.css oder tailwind.config.(js|ts) (je nachdem was ihr nutzt)\n\ndocs/design/TOKENS.md\n\nOptional scripts/design/export-tokens.ts\n\nVerification (PowerShell)\n\nnpm test\nnpm run build","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":518,"state":"CLOSED","title":"E6.1. 1 ‚Äî Canonical Token Schema + Folder Structure"},{"body":"**Version:** v0.6\n**Area:** UI/Design System (Patient/Clinician/Admin)\n\n---\n\n### Motivation (SOLL ‚Üí IST):\n\n**SOLL:** Konsistentes, parametrisierbares UI (Design Tokens + Theme) als Single Source of Truth, damit in v0.7 die iOS-App sauber (token-first, semantic) aufgesetzt werden kann.\n\n**IST:** UI funktioniert, aber Styling/Patterns sind verteilt; Tokens existieren punktuell (z.B. Admin design-tokens), aber kein durchg√§ngiges, semantisches Token- und Theme-System inkl. komponentenbasierter Baseline und Layout-Patterns.\n\n---\n\n### Ziele\n- Semantische Tokens als kanonische Quelle (Farben, Typografie, Spacing, Radius, Shadows, Z-Index etc.)\n- Theme-Parametrisierung (Light/Dark, Accent/Brand, High-Contrast optional)\n- Component Baseline auf Tokens (Buttons/Inputs/Cards/Alerts/Badges/Tabs/Modal/Toast etc.)\n- Layout Patterns:  patient mobile shell + clinician/admin desktop shell konsistent\n- Exportf√§higkeit: Tokens/Theme als JSON exportierbar (iOS/RN mapping in 0.7)\n- Migration Plan: Umstellung ausgew√§hlter Kern-Screens in 0.6 (nicht komplett) + Backlog f√ºr 0.7\n\n#### Nicht-Ziele (0.6)\n- Vollst√§ndiger Redesign aller Screens\n- Neue iOS-App Implementierung (kommt in 0.7)\n- Gro√üe UI-Rewrites ohne Nutzenbeleg\n\n---\n\n#### Acceptance Criteria (Epic)\n- `docs/design-system/` enth√§lt kanonische Spezifikation (Tokens, Theme, Komponentenkontrakte, Layout Patterns, Migration Plan)\n- Tokens sind semantisch (z.B. color. surface, color.text. primary, color.brand, ‚Ä¶), nicht nur \"blue-500\"\n- Token Export existiert (`docs/dev/design-tokens.json` oder `docs/design-system/tokens.json`)\n- Min. 3 repr√§sentative Screens umgestellt (mind. 1 Patient + 1 Clinician + 1 Admin screen)\n- Build + Tests laufen:  `npm test`, `npm run build`\n- Optionaler Gate (wenn implementiert): CI check, dass Tokens/Export aktuell sind\n\n#### Verification (PowerShell)\n```\nnpm test\nnpm run build\nnode scripts/dev/endpoint-catalog/generate. js --repo-root .  --out-dir docs/dev --allowlist docs/dev/endpoint-allowlist.json\npwsh -NoProfile -File scripts/ci/verify-endpoint-catalog.ps1\n# (ggf. zus√§tzlicher Token-Verify Schritt, falls Gate erg√§nzt wird)\n```\n\n---\n\n#### Risiken / Guardrails\n- Keine \"ad-hoc\" Token-Namen:  alle semantisch, zentral definiert\n- Keine gro√üfl√§chigen Refactors, Migration in kleinen PRs\n- iOS-Readiness: Tokens m√ºssen ohne Tailwind-spezifische Semantik exportierbar sein\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDsGw","name":"layout","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"}],"number":517,"state":"CLOSED","title":"E6.1 ‚Äî Design System Foundation (Tokens ‚Üí Theme ‚Üí Components ‚Üí Layout Patterns) [EPIC]"},{"body":"### Problem\nAlle artifacts m√ºssen nach den Fixes sauber, deterministisch neu erzeugt und committed werden.\n\n### Anforderung\n- docs/dev/ENDPOINT_CATALOG.md, endpoint-catalog.json, ORPHAN_ENDPOINTS.md, UNKNOWN_CALLSITES.md, endpoint-allowlist.json neu generieren (bei Format-/Stub√§nderung)\n- Commit-Message: chore(docs): update endpoint catalog artifacts (deterministic)\n\n### Acceptance Criteria\n- verify-endpoint-catalog.ps1 l√§uft clean in CI und lokal\n- Git diff nur bei echten √Ñnderungen\n\n#### Files\n- docs/dev/ENDPOINT_CATALOG.md\n- docs/dev/endpoint-catalog.json\n- docs/dev/ORPHAN_ENDPOINTS.md\n- docs/dev/UNKNOWN_CALLSITES.md\n- docs/dev/endpoint-allowlist.json (bei Bedarf)\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":515,"state":"CLOSED","title":"I6.3.6 ‚Äî Regenerate docs/dev Artifacts + Lock-in Determinism"},{"body":"### Problem\nDev-UI f√ºr Endpoints fehlt ‚Äì Ziel: sofort alle unverdrahteten Endpoints sichtbar machen.\n\n### Anforderung\n- UI-Route: /admin/dev/endpoints\n- Quelle: docs/dev/endpoint-catalog.json (serverseitig lesen); alternativ API\n- Features: Filter (role, method, UsedBy), Suche, Unused/Manual/Orphan/Unknown-Toggles\n- Anzeige: alle Felder inkl. UsedByList (collapsible)\n- Keine PII/PHI enthaltend\n\n### Acceptance Criteria\n- Seite l√§dt schnell in dev/prod\n- Nur generated-data/Repo-Daten anzeigen\n\n#### Files\n- app/admin/dev/endpoints/page.tsx\n- ggf. EndpointCatalogClient.tsx\n- ggf. docs/dev/endpoint-catalog.json Helper\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":514,"state":"CLOSED","title":"I6.3.5 ‚Äî Endpoint Catalog UI Page (Admin Dev)"},{"body":"### Problem\n`verify-endpoint-catalog.ps1` gibt bei Fehlschlag oft zu wenig Diagnoseinfos.\n\n### Anforderung\n- Ausgabe: git commit SHA, branch, node version, OS info\n- Bei Fail: Dateiliste (existiert), diff-stat (existiert), 1. N Zeilen von ENDPOINT_CATALOG.md\n- Ausgabe CI-freundlich, informativ\n\n### Acceptance Criteria\n- Fail-Output direkt actionable\n- Script bleibt CI-tauglich\n\n#### Files\n- scripts/ci/verify-endpoint-catalog.ps1","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":513,"state":"CLOSED","title":"I6.3.4 ‚Äî Verify Script Hardening + Better Diagnostics"},{"body":"### Problem\nEs fehlen CLI-Integrationstests f√ºr generatormodes (Allowlist, Determinismus).\n\n### Anforderung\n- Jest-Test, der Generator via spawn testet\n- Szenarien:\n  - --allowlist ohne Wert\n  - --allowlist <Pfad>\n  - Optional: Doppel-Run -> identische Outputs\n- Verwendung Tempdir-Mini-App/Fixture\n\n### Acceptance Criteria\n- Test l√§uft stabil im CI\n- Keine Dependency auf echtes Repo-Layout\n\n#### Files\n- scripts/dev/endpoint-catalog/__tests__/generate.cli.test.ts\n- ggf. test-fixtures unter __tests__/fixtures/","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpPg","name":"integration","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":512,"state":"CLOSED","title":"I6.3.3 ‚Äî Jest ‚ÄúCLI Integration‚Äù Tests for Generator"},{"body":"### Problem\nlocaleCompare f√ºhrt zu CI-Output-Drift. Sortierung ist nicht stabil plattform√ºbergreifend.\n\n### Anforderung\n- √úberall stabile Codepoint-Sortierung (cmpStr, ggf. cmpTuple)\n- Keine locale-/case-insensitive Sorts\n- Vor Sort ggf. Normalisierung (z.B. f√ºr Pfade)\n\n### Acceptance Criteria\n- Generator produziert plattform- und lauf-√ºbergreifend gleiche Dateiinhalte\n- Doppellauf erzeugt leeres git diff\n\n#### Files\n- scripts/dev/endpoint-catalog/core.js\n- scripts/dev/endpoint-catalog/generate.js\n- ggf. neue Helper-Datei","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":511,"state":"CLOSED","title":"I6.3.2 ‚Äî Deterministic Sorting (No localeCompare Drift)"},{"body":"### Problem\n`generate.js` interpretiert --allowlist aktuell als \"flag mit required value\" und frisst das n√§chste argv unconditionally. Ohne Wert wird allowlistPath=undefined ‚Üí Crash.\n\n### Anforderung\n- --allowlist (ohne Wert): Allowlist aktiv mit Default-Pfad: ${outDir}/endpoint-allowlist.json\n- --allowlist some/path.json: Allowlist aktiv mit exakt diesem Pfad\n- kein --allowlist: Allowlist deaktiviert (wie leere Allowlist)\n- Bei aktiver Allowlist, aber fehlender Datei: kein Crash; Stub-Datei deterministisch anlegen (`{\"allow\":[]}`)\n- `parseArgs` robuster machen, nie undefined lesen\n- Logging: aktiviert/deaktiviert samt Pfadangabe\n\n### Acceptance Criteria\n- Outputs ohne Crash (Default/benutzerdefinierter Pfad)\n- Fehlende Datei ‚â† Exit Code 1\n- Tests f√ºr beide Modi\n- Powershell-Verification: siehe Angabe\n\n#### Files\n- scripts/dev/endpoint-catalog/generate.js\n- ggf. scripts/dev/endpoint-catalog/core.js\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":510,"state":"CLOSED","title":"I6.3.1 ‚Äî Fix --allowlist CLI Semantics + Fail-Closed I/O"},{"body":"## Zielbild (SOLL)\nWir haben eine deterministische, CI-gesicherte Inventarisierung aller Next API Routes (app/api/**/route.ts) inkl.:\n- Methoden, Pfad-Parametern, Access-Level (Role/Guard), ‚ÄúIntent‚Äù/Kurzbeschreibung (falls vorhanden)\n- In-Repo Callsites (UI/Server) ‚Üí ‚ÄúUsed by‚Äù-Z√§hlung + Referenzen\n- Orphan-/Unknown-Listen (Orphan Endpoints / Unknown Callsites)\n- UI-Seite im Admin-Dev Bereich, die das sauber filterbar darstellt (Role/Method/Used/Unused/Allowlisted/Orphan)\n- Workflow-Gate (verify-endpoint-catalog), der nur failt, wenn wirklich Quellcode sich ge√§ndert hat ‚Äì nicht wegen Locale/OS/Node-Varianten.\n\n### Ist-Probleme (IST)\n- --allowlist Flag ist fehleranf√§llig\n- CI driftet: docs/dev wird ‚Äúout of date‚Äù, obwohl lokal ‚Äú2 L√§ufe direkt nacheinander‚Äù stabil wirken.\n- Cleanup/Locks auf Windows st√∂ren sauberen Reset/clean\n- Verifier-Ausgabe ist nur teilweise hilfreich (Diagnose: SHA, branch, node version, diff stat)\n\n### Nicht-Ziele (v0.6)\n- Kein gro√ües Refactor Monitoring/Usage-System\n- Kein kompletter ‚ÄúAPI contract registry‚Äù im Backend\n\nDiese Epic b√ºndelt alle Teilaufgaben zur Governance, Konsistenz und dev-orientierten GUI des Endpoint-Katalogs.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"}],"number":509,"state":"CLOSED","title":"E6.3 ‚Äî Endpoint Catalog Governance (Determinismus + UI + CI Gate)"},{"body":"## Zielbild (SOLL)\nWir haben eine deterministische, CI-gesicherte Inventarisierung aller Next API Routes (app/api/**/route.ts) inkl.:\n- Methoden, Pfad-Parametern, Access-Level (Role/Guard), ‚ÄúIntent‚Äù/Kurzbeschreibung (falls vorhanden)\n- In-Repo Callsites (UI/Server) ‚Üí ‚ÄúUsed by‚Äù-Z√§hlung + Referenzen\n- Orphan-/Unknown-Listen (Orphan Endpoints / Unknown Callsites)\n- UI-Seite im Admin-Dev Bereich, die das sauber filterbar darstellt (Role/Method/Used/Unused/Allowlisted/Orphan)\n- Workflow-Gate (verify-endpoint-catalog), der nur failt, wenn wirklich Quellcode sich ge√§ndert hat ‚Äì nicht wegen Locale/OS/Node-Varianten.\n\n### Ist-Probleme (IST)\n- --allowlist Flag ist fehleranf√§llig\n- CI driftet: docs/dev wird ‚Äúout of date‚Äù, obwohl lokal ‚Äú2 L√§ufe direkt nacheinander‚Äù stabil wirken.\n- Cleanup/Locks auf Windows st√∂ren sauberen Reset/clean\n- Verifier-Ausgabe ist nur teilweise hilfreich (Diagnose: SHA, branch, node version, diff stat)\n\n### Nicht-Ziele (v0.6)\n- Kein gro√ües Refactor Monitoring/Usage-System\n- Kein kompletter ‚ÄúAPI contract registry‚Äù im Backend\n\nDiese Epic b√ºndelt alle Teilaufgaben zur Governance, Konsistenz und dev-orientierten GUI des Endpoint-Katalogs.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"}],"number":508,"state":"CLOSED","title":"E6.3 ‚Äî Endpoint Catalog Governance (Determinismus + UI + CI Gate)"},{"body":"Du bist GitHub Copilot (Chat) im Repo adaefler-art/rhythmologicum-connect. Ziel: v0.5 P0 abschlie√üen. Evidence-first, minimal diff, keine UI-Refactors au√üerhalb des Notwendigen.\n\nPROD Evidence (Vercel Logs):\nA) /api/content/resolve?funnel=stress-assessment&category=intro -> 404 FUNNEL_NOT_FOUND\n   requestId: 2366f0d8-df89-4d25-a4b1-99551b5c9287\n   log: [Content Resolver Funnel Not Found] { funnel:'stress-assessment', category:'intro' }\n\nB) /api/funnels/stress-assessment/definition -> 200 (direkt im gleichen Flow)\n   => Source-of-truth mismatch (definition says exists, resolver says not found)\n\nC) /api/funnels/stress-assessment/content-pages -> 500\n   requestId: aa04627e-f1f6-4530-b7f2-78d54f9c2136\n   log: [Funnel Content Pages Catalog Lookup Failed] { effectiveSlug:'stress-assessment', errorCode: undefined }\n   => fallback/catalog path throws or returns unclassified error ‚Üí must not 500 for ‚Äúno pages‚Äù.\n\nD) UI log:\n   [INTRO_PAGE] Manifest validation failed ‚Ä¶ steps expected array, received undefined\n   => intro validates wrong object or wrong key (likely wrapper vs data).\n\nAUFGABEN (Acceptance Criteria):\n1) Make source-of-truth consistent:\n   - /api/content/resolve MUST treat funnels that exist in the funnel registry (same one used by /api/funnels/[slug]/definition) as ‚Äúknown‚Äù.\n   - If funnel is known but intro content is missing: return 200 with ‚Äúmissing content / empty state‚Äù (NOT 404 FUNNEL_NOT_FOUND).\n   - Only return 404 FUNNEL_NOT_FOUND if funnel is unknown to BOTH registry and DB.\n\n2) Fix /api/funnels/[slug]/content-pages:\n   - Never 500 on ‚Äúcatalog lookup failed‚Äù if the real situation is ‚Äúno content pages‚Äù.\n   - Behavior matrix:\n     a) known funnel, DB has no content pages -> 200 []\n     b) known funnel, DB schema mismatch (e.g. deleted_at missing) -> retry without soft-delete filter, then 200 [] or 200 pages\n     c) unknown funnel -> 404 FUNNEL_NOT_FOUND\n     d) true DB error (permission/RLS/etc) -> 500 with consistent error shape + server log includes supabase error code+message (no PHI)\n\n3) Fix Intro manifest validation:\n   - Identify where ‚Äúmanifest‚Äù is validated in app/patient/funnel/[slug]/intro (client/server).\n   - Ensure the validated object contains steps array (likely definition.data.steps).\n   - After fix: intro page loads without manifest validation error for stress-assessment.\n\n4) Tests:\n   - Add/update route tests to cover:\n     - resolver: known funnel but missing intro content -> 200 (not 404)\n     - content-pages: known funnel but no DB pages -> 200 []\n     - content-pages: unknown funnel -> 404\n   - npm test + npm run build must be green.\n\nFILES TO INVESTIGATE (likely):\n- app/api/content/resolve/route.ts\n- app/api/funnels/[slug]/content-pages/route.ts\n- app/api/funnels/[slug]/definition/route.ts (registry usage)\n- app/patient/funnel/[slug]/intro/page.tsx and/or intro/client.tsx (manifest validation site)\n- any funnel registry module (e.g. lib/funnels/*)\n\nDELIVERABLE:\n- A single PR with minimal diffs implementing the above + tests.\n- Provide PowerShell verification commands.\n\nPOWERHELL VERIFICATION (must run and paste results in PR):\nnpm test\nRemove-Item -Recurse -Force .next -ErrorAction SilentlyContinue\nnpm run build\n","labels":[],"number":497,"state":"CLOSED","title":"Fix Issue"},{"body":"\n\nGoal\nWire the V05-I06.2 Content Block Renderer into actual patient-facing routes so content manifests render in the app (intro/content pages), without introducing new routes/types.\n\nProblem\nRenderer exists but is not used by real pages yet, so mobile content remains disconnected from the manifest-driven model.\n\nScope\n\nIntegrate renderer into existing patient routes only:\n\nPatient funnel intro pages (existing route(s))\n\nStandalone content pages (existing route(s), if present)\n\nLoad manifest server-side (existing patterns: DB fetch via funnel_versions.content_manifest, etc.)\n\nRender:\n\nPages ‚Üí sections ‚Üí blocks via renderer\n\nCorrect filtering by pageSlug/section\n\nFail-closed:\n\nIf manifest missing/invalid ‚Üí return correct HTTP semantics (404/422 as per existing patterns)\n\nUnknown block type ‚Üí controlled error UI; PHI-free logging only\n\nNon-goals\n\nNo new SECTION_TYPE values\n\nNo new manifest schema changes\n\nNo editor (that‚Äôs I06.4)\n\nNo redesign; just integration + minimal layout compliance with mobile shell\n\nAcceptance Criteria\n\nExisting patient pages render manifest-driven content via renderer\n\nDeterministic output (manifest order preserved; stable ordering rules)\n\nServer/client boundaries respected (manifest fetch server-side; rendering per existing component split)\n\nFail-closed behavior for missing/invalid manifests\n\nTests:\n\nOne integration test for funnel intro route rendering expected blocks\n\nOne integration test for standalone content page rendering (if route exists)\n\nUnknown block type causes controlled failure (not silent)\n\nEvidence in PR: npm test, npm run build\n\nTasks\n\nIdentify which existing patient routes correspond to ‚Äúintro‚Äù and ‚Äúcontent pages‚Äù.\n\nImplement server-side manifest load and pass to renderer.\n\nAdd minimal error handling for missing manifest / invalid schema.\n\nAdd deterministic pageSlug selection (no new slugs).\n\nAdd tests for integration and fail-closed behavior.\n\nAdd short doc note in docs/mobile/ that renderer is live on those routes.\n\nVerify (PowerShell)\n\nnpm test\n\nnpm run build","labels":[],"number":470,"state":"CLOSED","title":"V05-I06.5 ‚Äî Integrate Content Block Renderer into Patient Pages"},{"body":"\nGoal\nProvide an internal UI to compose and edit funnel content manifests (pages ‚Üí sections ‚Üí blocks) using the existing registry + contracts, enabling non-code iteration of mobile content.\n\nProblem\nV05-I06.2 provides a renderer, but content creation/editing is still code-only. A minimal editor is required to build and maintain manifests safely and deterministically.\n\nScope\n\nCreate a basic editor UI for the existing FunnelContentManifest shape:\n\nList pages, sections, blocks\n\nAdd/remove/reorder blocks within a section\n\nEdit block fields according to block type schema\n\nValidate with existing Zod contracts (strict, bounded)\n\nPersist changes to the existing storage location (whatever is canonical in repo: e.g., funnel_versions.content_manifest), via existing APIs/actions/patterns.\n\nDeterminism:\n\nStable ordering (explicit order indices or array order preserved)\n\nCanonical serialization for save (stable key ordering if needed)\n\nFail-closed:\n\nUnknown block types cannot be edited; show controlled error UI, no silent coercion\n\nNon-goals\n\nNo new SECTION_TYPE values\n\nNo new permissions model\n\nNo WYSIWYG rich text beyond what already exists (e.g., markdown text area is fine)\n\nNo ‚Äúpublish workflow‚Äù unless already present; this is an editor MVP\n\nAcceptance Criteria\n\nEditor supports existing section/block types only (registry-driven)\n\nStrict validation prevents saving invalid manifests\n\nFail-closed on unknown types\n\nChanges persist and reload correctly\n\nNo PHI is introduced into manifests (enforced by schema)\n\nTests for:\n\nSchema validation gating save\n\nDeterministic ordering / stable serialization\n\nFail-closed behavior for unknown types\n\nEvidence in PR: npm test, npm run build\n\nTasks\n\nIdentify canonical manifest source-of-truth and update mechanism.\n\nBuild editor shell page (likely under clinician/admin tools) using existing routes only.\n\nImplement block form components per existing schemas.\n\nImplement reorder (up/down) with deterministic behavior.\n\nAdd validation + fail-closed error handling.\n\nAdd tests for validation + determinism + unknown type handling.\n\nAdd brief docs under docs/mobile/ describing editor usage and constraints.\n\nVerify (PowerShell)\n\nnpm test\n\nnpm run build","labels":[],"number":469,"state":"CLOSED","title":"V05-I06.4 ‚Äî Visual Block Editor (Manifest-based Section/Block Builder)"},{"body":"## GitHub Issue: V05-FIXOPT-01 ‚Äî Fix & Optimize: Patient Landing + Catalog Consistency + Broken Funnel Links + Post-Assessment Content/Results\n\n### Summary\n\nMehrere patient-facing UX/Flow-Probleme in v0.5.x f√ºhren aktuell zu:\n\n* falschem Post-Login Entry,\n* inkonsistenter Katalog-/Pillar-Kategorisierung,\n* ‚Äútoten‚Äù Funnel-Detailseiten (404),\n* und 404s nach Abschluss des Stress-Fragebogens (Content/Result-Aufl√∂sung).\n\nZiel: **Deterministisch konsistenter Patient-Funnel-Flow** (Catalog ‚Üí Funnel Detail ‚Üí Questionnaire ‚Üí Result/Report), ohne Request-Spam, mit sauberen HTTP-Semantiken und fail-closed UX.\n\n---\n\n## Context / Guardrails\n\n* PowerShell-only Verify\n* No PHI/secrets in logs; keine Roh-Errors/IDs+Patientendaten-Kombos\n* DB metadata (pg_*/information_schema) nur via SECURITY DEFINER RPC (falls √ºberhaupt n√∂tig)\n* Determinism: Slugs/Keys/Counts nur via Registry/Seeds, keine Hardcodes\n* Auth-first / RBAC-first bei schreibenden Endpoints\n* HTTP semantics: 401 unauth-first; 404 vs 403 korrekt; 422 f√ºr Domain-Validation; optional: 413/415 etc. wo passend\n\n---\n\n## Observed Issues\n\n### A) Post-Login Landing ist falsch\n\n* Ist: nach Login landet Patient auf `/patient/assessment`\n* Soll: Patient landet auf `/patient/funnels` (Katalog / Pillar-Gruppierung)\n\n### B) Katalog-Kategorisierung inkonsistent (‚ÄúWeitere Assessments‚Äù)\n\n* Assessments wie ‚ÄûCardiovascular Age Assessment‚Äú, ‚ÄûHeart Health Nutrition‚Äú tauchen unten separat auf und nicht in Pillar-Kategorien.\n* Erwartung: Funnels sind deterministisch Pillars zugeordnet oder bewusst als ‚ÄúUnkategorisiert/Coming soon‚Äù markiert.\n\n### C) Broken Funnel Detail (404) f√ºr mehrere Slugs\n\nRepro/Observed 404:\n\n* `/patient/funnel/cardiovascular-age`\n* `/patient/funnel/heart-health-nutrition`\n* `/patient/funnel/sleep-quality`\n\nConsole:\n\n* `GET /api/funnels/<slug>/definition 404`\n* `GET /api/funnels/<slug>/content-pages 404`\n\nErwartung: Kein ‚Äútoter Link‚Äù aus Katalog. Entweder verf√ºgbar (200) oder explizit nicht verf√ºgbar (disabled/coming-soon + saubere Detail-UX).\n\n### D) Stress Assessment: nach Fragebogen 404 bei Content/Result\n\nNach Abschluss von `stress-assessment`:\n\n* `GET /api/content/resolve?funnel=stress-assessment&category=intro 404`\n* `GET /api/funnels/stress-assessment/content-pages 404`\n* UI: ‚ÄúFehler beim Laden der Ergebnisse.‚Äù\n\nErwartung: deterministische Result/Report-Ansicht oder ‚ÄúContent noch nicht verf√ºgbar‚Äù-UX (ohne 404-Spam).\n\n---\n\n## Goals\n\n1. Patient Login f√ºhrt deterministisch zu `/patient/funnels`.\n2. Katalog listet nur Funnels, die tats√§chlich startbar sind **oder** markiert sie explizit als nicht verf√ºgbar (coming soon/disabled).\n3. Funnel Detail ist robust: keine Render-/Fetch-Schleifen; 404 wird in klare UX √ºbersetzt.\n4. Stress Assessment Post-Completion l√§dt Result/Content stabil (keine unhandled 404s).\n\n---\n\n## Proposed Implementation (minimal-diff)\n\n### 1) Post-Login Redirect vereinheitlichen\n\n* Patient-Redirect nach Login auf `/patient/funnels`.\n* Entscheidung:\n\n  * **Preferred**: `/patient/assessment` redirectet auf `/patient/funnels` (302/redirect), um Doppelpfade zu vermeiden.\n  * Alternative: `/patient/assessment` bleibt ‚ÄúPilot Shortcut‚Äù, aber nicht Default Landing.\n\n### 2) Catalog Availability & Kategorisierung deterministisch machen\n\n* Beim Erzeugen der Patient-Katalog-Response:\n\n  * Funnels m√ºssen entweder:\n\n    * `AVAILABLE` (startbar) sein **nur wenn** Definition (und ggf. Content) existiert, oder\n    * `COMING_SOON/NOT_AVAILABLE` explizit markiert (UI zeigt disabled), oder\n    * gar nicht ausgeliefert werden.\n* Pillar-Zuordnung:\n\n  * Jeder Funnel hat validen `pillar_key` aus Registry **oder** expliziten `UNCATEGORIZED` Bucket (mit PHI-free Diagnose/Warnung).\n* Keine stillen ‚ÄúWeitere Assessments‚Äù ohne belastbaren Backend-Status.\n\n### 3) Funnel Detail: Gate by Definition, handle 404 cleanly\n\n* Client:\n\n  * `/definition` ist Gate; wenn 404 ‚Üí zeige ‚ÄúNicht verf√ºgbar‚Äù UI + CTA zur√ºck zum Katalog.\n  * `/content-pages` nur fetchen, wenn Definition erfolgreich geladen wurde.\n  * Keine retries/render-loops.\n* Server/Routes:\n\n  * Falls `content-pages` optional: 200 mit `[]` statt 404.\n  * Falls required: Catalog muss den Funnel als nicht verf√ºgbar markieren bis Content existiert.\n\n### 4) Stress Assessment Result/Content Resolve contract stabilisieren\n\n* `/api/content/resolve`:\n\n  * Wenn Route fehlt: implementieren oder Client auf kanonischen Endpoint umstellen.\n  * Wenn Content optional: 200 mit `content: null` + status field (versioned schema) statt 404.\n  * Wenn Content required: UI zeigt ‚ÄúContent noch nicht verf√ºgbar‚Äù statt generischem Fehler.\n* `/api/funnels/stress-assessment/content-pages`:\n\n  * Analog: optional ‚áí 200 mit leerer Liste statt 404; andernfalls Availability im Catalog korrekt.\n\n---\n\n## Acceptance Criteria\n\n### AC-1 Landing\n\n* Nach Patient-Login landet der User auf **`/patient/funnels`**.\n* `/patient/assessment` ist **nicht** mehr Default Landing (Redirect oder klarer optionaler Shortcut).\n\n### AC-2 Catalog Consistency\n\n* Katalog zeigt keine startbaren Links zu Funnels ohne Definition.\n* Funnels sind deterministisch kategorisiert:\n\n  * in Pillar-Kategorien **oder** explizit als ‚ÄúUnkategorisiert/Coming soon‚Äù (kein stilles Wegdriften).\n\n### AC-3 Broken Funnels behoben (3 Slugs)\n\nF√ºr `cardiovascular-age`, `heart-health-nutrition`, `sleep-quality` gilt:\n\n* Kein unhandled 404-Fehlerzustand mehr.\n* Entweder:\n\n  * verf√ºgbar ‚áí Detailseite l√§dt ohne console errors, oder\n  * nicht verf√ºgbar ‚áí im Katalog disabled/coming-soon + Detailseite zeigt ‚ÄúNicht verf√ºgbar‚Äù.\n\n### AC-4 Stress Post-Completion stabil\n\n* Nach Abschluss von `stress-assessment`:\n\n  * Result/Report l√§dt **oder** es erscheint ein definierter ‚ÄúContent fehlt‚Äù-State.\n  * Keine 404-Spam-Requests; keine Render-Schleifen.\n\n### AC-5 Guardrails / Semantik\n\n* 401 unauth-first bleibt erhalten; 404/403/422 korrekt.\n* Keine PHI/secrets in Logs; keine raw error dumps.\n* Determinism: Slugs/Keys/Enums aus Registry/Seed; keine UI-Hardcodes.\n\n### AC-6 Tests\n\n* Unit tests (table-driven) f√ºr:\n\n  * Catalog availability mapping (AVAILABLE vs COMING_SOON vs hidden)\n  * Funnel detail gating (bei 404 definition ‚Üí kein content-pages call, ‚ÄúNot available‚Äù UI)\n  * Content resolve ‚Äúmissing content‚Äù handling\n* `npm test` und `npm run build` sind gr√ºn.\n\n---\n\n## Definition of Done\n\n* Patient Landing korrekt\n* Catalog liefert nur konsistente, deterministisch markierte Funnels\n* Funnel Detail robust (keine dead links, kein request spam)\n* Stress Assessment Abschluss f√ºhrt zu stabiler Result/Content UX\n* Tests + Build gr√ºn, Dokumentation aktualisiert\n\n---\n\n## PowerShell Verify / Smoke\n\n```powershell\nnpm test\nnpm run build\nnpm run dev\n```\n\n**Manual smoke checklist (Browser, narrow viewport):**\n\n1. Login als Patient ‚Üí landet auf `/patient/funnels`\n2. Katalog:\n\n   * die genannten Funnels sind entweder startbar & funktionieren, oder disabled/coming soon\n3. Klick auf:\n\n   * `/patient/funnel/cardiovascular-age`\n   * `/patient/funnel/heart-health-nutrition`\n   * `/patient/funnel/sleep-quality`\n     ‚Üí keine generischen 404-Fehlerzust√§nde / keine console-spam loops\n4. `stress-assessment` komplett durchf√ºhren ‚Üí Ergebnis/Empty-State erscheint deterministisch, ohne 404 spam.\n\n---\n\n## Notes / Links\n\n* Production URLs (Repro):\n\n  * `/patient/assessment` (current landing)\n  * `/patient/funnels` (expected landing)\n  * `/patient/funnel/cardiovascular-age`\n  * `/patient/funnel/heart-health-nutrition`\n  * `/patient/funnel/sleep-quality`\n","labels":[],"number":448,"state":"CLOSED","title":"V05-FIXOPT-01 ‚Äî Fix & Optimize: Patient Landing + Catalog Consistency + Broken Funnel Links + Post-Assessment Content/Results"},{"body":"This section details on the original issue you should resolve\n\n<issue_title>TV05_03-HEALTHCHECK ‚Äî Environment Self-Check Endpoint (Supabase URL/Keys/Project)</issue_title>\n<issue_description>\n\nProblem\nFehlerbilder wie ‚ÄúInvalid API key‚Äù f√ºhren zu 500ern und sind schwer zu debuggen; DB cleanup l√∂st das nicht. Ein deterministischer Env-Self-Check reduziert Diagnosezeit massiv.\n\nZiel\nGET /api/health/env (server-only, admin-gated) pr√ºft:\n\nEnv vars vorhanden (SUPABASE_URL, anon/service role falls genutzt)\n\nPlausibilit√§tschecks (Format, kein Whitespace)\n\nOptional: ‚Äúcan query pillars via authenticated server client‚Äù (ohne PHI; nur existence check)\n\nAcceptance Criteria\n\n401/403 korrekt.\n\nJSON Output enth√§lt checks[] mit pass/fail + message (keine Secrets).\n\nBei Fail: konkrete Hinweise (z. B. ‚Äúservice role key missing/invalid format‚Äù).\n\nTests f√ºr gating + redaction.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build</issue_description>","labels":[],"number":439,"state":"CLOSED","title":"TV05_03 Healthcheck"},{"body":"\n\nZiel: Das Thomas-Konzept (Tier 1/2.5/2) wird im Produkt als konfigurierbarer, versionierbarer Contract abgebildet (ohne schon die ganze Ops-UI zu bauen).\n\nScope (MVP)\n\nEin ‚ÄûProgram Tier‚Äú Contract (JSON/TS + Validierung), der pro Tier definiert:\n\naktivierte Pillars\n\nerlaubte/empfohlene Funnels (slugs + version constraints)\n\n(optional) minimaler ‚ÄûSchedule Skeleton‚Äú (Calls/Nurse Touchpoints als placeholders)\n\nSeeds / default config: Tier 1 (Essential) initial nur die v0.5 Stress/Resilienz-Flows.\n\nDokumentation: wie Tier-Konfig sp√§ter in V05-Issues (Triage/Nurse/Settings) erweitert wird.\n\nAcceptance Criteria\n\n Contract + Validator + Beispielkonfiguration eingecheckt\n\n Catalog API kann optional ‚Äûtier=‚Ä¶‚Äú filtern (nur wenn trivial; sonst nur Contract liefern)\n\n Keine PHI/PII\n\n Tests\n\nWarum das wichtig ist: Thomas‚Äô SOP ist Tier-getrieben \n\nPatient Journey Rhythmologicum ‚Ä¶\n\n, w√§hrend eure Plattform-Module √ºber Pillars/Funnels organisiert sind \n\nTV05_CLEANUP_AUDIT_ISSUE_MAP\n\n. Ohne diese Br√ºcke bleibt die S√§ulenlogik ‚Äûtechnisch da‚Äú, aber nicht als Programmlogik steuerbar.","labels":[],"number":434,"state":"CLOSED","title":"TV05_01D-TIERS-TO-PILLARS-CONTRACT ‚Äî Thomas‚Äô 3-Tier Journey als deterministischer Contract (Tier ‚Üî Pillars/Funnels)"},{"body":"\nZiel: Admin/Clinician Funnels sollen dieselbe Source of Truth verwenden wie Patient /api/funnels/catalog (Pillars/Catalog/Versions). Keine gemischten Modelle mehr.\n\nAcceptance Criteria\n\n /api/admin/funnels liest aus funnels_catalog (+ pillar) und liefert stabile IDs/Slugs.\n\n Admin/Clinician Detail (z. B. /api/admin/funnels/[id] bzw. besser slug-basiert) liest aus funnel_versions.manifest (oder √ºber eine klare Adapter-Schicht).\n\n UI-Linking ist konsistent: Liste ‚Üí Detail funktioniert ohne ‚ÄûGhost IDs‚Äú.\n\n Fehlersemantik:\n\n‚Äûnot found‚Äú ‚áí 404\n\n‚Äûunauth‚Äú ‚áí 401\n\n‚Äûforbidden role‚Äú ‚áí 403\n\nKeine 500er f√ºr erwartbare Zust√§nde.\n\n Tests f√ºr list+detail + RBAC.\n\nVerification (PowerShell)\n\nnpm test\nnpm run build\n# minimal smoke:\n# - clinician funnels page loads\n# - open a funnel detail","labels":[],"number":433,"state":"CLOSED","title":"TV05_01C-ADMIN-FUNNELS-CONVERGENCE ‚Äî Clinician/Admin Funnels: API+UI auf Catalog/V2 vereinheitlichen"},{"body":"\nZiel: Ein reproduzierbarer, deterministischer Audit/Diag-Pfad, der beweist: Welche Supabase-Instanz nutzt die App? Existieren Pillars/Catalog/Versions? Seeds vorhanden? RLS/Policies konsistent?\n\nAcceptance Criteria\n\n Script oder Admin-Diagnostics Endpoint (server-only) liefert:\n\nSupabase Project URL (redacted), env name, ob SUPABASE_SERVICE_ROLE_KEY/ANON gesetzt (nur bool, keine Values)\n\nto_regclass f√ºr public.pillars, public.funnels_catalog, public.funnel_versions\n\nrelkind (table/view), relrowsecurity, Policy count\n\nRow counts (pillars, catalog, versions), plus ‚Äûseed present?‚Äú (z. B. Stress-Funnel vorhanden)\n\n Output ist PHI-frei und stabil/maschinenlesbar (JSON).\n\n Dokumentation: ‚ÄûWenn das rot ist ‚Üí welches Fix (Vercel env / Supabase keys / migrations)‚Äú.\n\nVerification (PowerShell)\n\nnpm test\nnpm run build\n.\\scripts\\verify-pillars-sot-audit.ps1\n\n\nCopilot Prompt (optional, aber praktisch)\n\nDu bist mein VS-Code GitHub Copilot. Implementiere TV05_02-PILLARS-SOT-AUDIT ‚Ä¶ (AC wie oben) ‚Ä¶ fail-closed, PHI-frei, PowerShell-only verification, Tests inklusive.","labels":[],"number":431,"state":"CLOSED","title":"TV05_01B-PILLARS-SOT-AUDIT ‚Äî Pillar/Catalog Source-of-Truth Audit + Drift Check (PHI-frei)"},{"body":"\nProblem\nEs existiert eine gro√üe Menge offener V05 Issues (I03.2 ‚Ä¶ I10.4). Ohne Dependency-Map riskieren wir Parallelit√§t ohne kritischen Pfad, und ‚ÄúWalking Skeleton Pillar 4 ‚Üí Report ‚Üí Clinician‚Äù verz√∂gert sich.\n\nZiel\nEin Planning-Artefakt, das:\n\ndie offenen Issues in 2‚Äì3 Milestones gruppiert,\n\nDependencies/Prereqs explizit macht,\n\nden Minimalpfad ‚ÄúPatient completes assessment ‚Üí processing ‚Üí report ‚Üí clinician sees triage‚Äù definiert.\n\nAcceptance Criteria\n\ndocs/V05_MILESTONES_CRITICAL_PATH.md existiert.\n\nEnth√§lt: Milestones, Issues pro Milestone, Dependencies, Definition of Done pro Milestone.\n\nKeine neuen Begriffe/Slugs; nur aus bestehenden Issue-Titeln/Repo-Realit√§t ableiten.\n\nVerify (PowerShell)\n\nTest-Path .\\docs\\V05_MILESTONES_CRITICAL_PATH.md","labels":[],"number":430,"state":"CLOSED","title":"TV05_05-PLAN ‚Äî Milestones/Dependency Map f√ºr offene V05 Issues (Critical Path)"},{"body":"\nProblem\nRepo hat repo-weite ESLint Errors (pre-existing). Dadurch ist ‚Äúlint‚Äù als Guardrail aktuell nicht verl√§sslich bzw. blockiert unrelated PRs.\n\nZiel\nCI Lint wird so angepasst, dass PRs nur auf ge√§nderte Files gelintet werden (interim), plus ein Debt-Tracking (separat). Dadurch bleibt ‚Äúno new lint regressions‚Äù enforced, ohne Altlasten zu blocken.\n\nAcceptance Criteria\n\nCI l√§uft lint nur auf changed TS/TSX Files; bei none ‚Üí skip.\n\nLokal bleibt npm run lint unver√§ndert (kann weiter failen).\n\nDokumentation: docs/LINT_POLICY.md erkl√§rt interim gate + Plan.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n# CI verifies lint gate on changed files","labels":[],"number":429,"state":"CLOSED","title":"TV05_04-LINT-GATE ‚Äî ESLint Baseline & CI Gate (Changed-Files)"},{"body":"\n\nProblem\nFehlerbilder wie ‚ÄúInvalid API key‚Äù f√ºhren zu 500ern und sind schwer zu debuggen; DB cleanup l√∂st das nicht. Ein deterministischer Env-Self-Check reduziert Diagnosezeit massiv.\n\nZiel\nGET /api/health/env (server-only, admin-gated) pr√ºft:\n\nEnv vars vorhanden (SUPABASE_URL, anon/service role falls genutzt)\n\nPlausibilit√§tschecks (Format, kein Whitespace)\n\nOptional: ‚Äúcan query pillars via authenticated server client‚Äù (ohne PHI; nur existence check)\n\nAcceptance Criteria\n\n401/403 korrekt.\n\nJSON Output enth√§lt checks[] mit pass/fail + message (keine Secrets).\n\nBei Fail: konkrete Hinweise (z. B. ‚Äúservice role key missing/invalid format‚Äù).\n\nTests f√ºr gating + redaction.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build","labels":[],"number":428,"state":"CLOSED","title":"TV05_03-HEALTHCHECK ‚Äî Environment Self-Check Endpoint (Supabase URL/Keys/Project)"},{"body":"\n\nProblem\nAudit weist darauf hin, dass externe Aufrufer (mobile app, scripts, integrations) in der Repo-Suche nicht sichtbar sind und empfiehlt eine Client-Registry. \n\nTV05_CLEANUP_AUDIT_UNUSED\n\n Ohne Registry riskieren wir das Entfernen scheinbar ‚Äúungenutzter‚Äù Endpoints (z. B. AMY) obwohl sie extern genutzt werden. \n\nTV05_CLEANUP_AUDIT_UNUSED\n\nZiel\nKanonische Dokumentation: welche API-Routen existieren, wer sie nutzt (Owner), ob extern erlaubt, und ob Deletion/Deprecation safe ist.\n\nAcceptance Criteria\n\ndocs/EXTERNAL_CLIENTS.md existiert: Clients + Owner + auth method + environment.\n\ndocs/API_ROUTE_OWNERSHIP.md existiert: route pattern ‚Üí owner ‚Üí externalAllowed (yes/no) ‚Üí notes.\n\n‚ÄúCleanup Audit‚Äù README verweist auf Registry als Pflichtinput f√ºr Entscheidungen. \n\nTV05_CLEANUP_AUDIT_UNUSED\n\nTasks\n\nInitialer Eintrag f√ºr die im Audit markierten Bereiche: AMY, Consent APIs, Content Resolvers. \n\nTV05_CLEANUP_AUDIT_UNUSED\n\nProzessregel: Jede neue Route muss ownership/externalAllowed angeben (PR template update falls vorhanden).\n\nVerify (PowerShell)\n\nTest-Path .\\docs\\EXTERNAL_CLIENTS.md\nTest-Path .\\docs\\API_ROUTE_OWNERSHIP.md\n\n\nUnd noch dieses Zusatzissue: Usage Telemetry Toggle Defaults (Dev ON / Prod OFF)\n\nProblem\nDie Runtime Usage Telemetry l√§uft aktuell ‚Äúeinfach mit‚Äù. Da es kein Staging gibt, soll Telemetrie in der Dev-Phase aktiv sein, aber in Production standardm√§√üig deaktiviert bleiben (um irref√ºhrende Daten durch ephemeres Storage und unn√∂tigen Overhead zu vermeiden).\n\nZiel\nEin deterministischer Toggle, der Telemetrie in Dev standardm√§√üig aktiviert und in Production standardm√§√üig deaktiviert, ohne dass Feature-Funktionalit√§t jemals durch Telemetrie fehlschl√§gt.\n\nAcceptance Criteria\n\nTelemetrie ist standardm√§√üig ON, wenn NODE_ENV=development und kein explizites Override gesetzt ist.\n\nTelemetrie ist standardm√§√üig OFF in Production/Preview, wenn kein Override gesetzt ist.\n\nExplizites Override via Env var USAGE_TELEMETRY_ENABLED:\n\n\"true\" => ON\n\n\"false\" => OFF\n\nunset => Default-Logik (AC1/AC2)\n\nWenn Telemetrie OFF ist:\n\nes wird nichts geschrieben,\n\nAdmin Endpoint /api/admin/usage bleibt erreichbar, liefert aber klar enabled:false (und ggf. leere Daten), ohne 500.\n\nTelemetrie darf niemals Requests brechen (Errors werden geschluckt, h√∂chstens warn-log).\n\nTasks\n\nImplementiere isUsageTelemetryEnabled() (z. B. in lib/monitoring/usageTracker.ts oder lib/monitoring/config.ts).\n\nNutze die Funktion in recordUsage(...) bzw. Wrapper so, dass bei OFF fr√ºh return erfolgt.\n\nAdmin Endpoint erg√§nzt enabled Flag im Response.\n\nTests:\n\nDefault dev => enabled\n\nDefault prod/preview => disabled\n\nOverride true/false\n\nOFF => keine writes (mock fs)\n\nOFF => admin usage response enth√§lt enabled:false\n\nVerify (PowerShell)\nnpm test\nnpm run build\n\n# optional: quick runtime sanity (dev)\n$env:USAGE_TELEMETRY_ENABLED = \"true\"\nnpm run dev\n# Browser: /api/admin/usage (eingeloggt)","labels":[],"number":427,"state":"CLOSED","title":"TV05_02-REGISTRY ‚Äî External Client Registry + Route Ownership"},{"body":"\n\nProblem\nDer Cleanup-Audit identifiziert ‚Äúpotenziell ungenutzte‚Äù Endpoints nur heuristisch (statische Referenzen) und empfiehlt explizit Runtime-Analyse. \n\nTV05_CLEANUP_AUDIT_UNUSED\n\n Das f√ºhrt zu unsicheren Entscheidungen (Integrate vs Remove), besonders bei /api/amy/*, Consent APIs und Content Resolvers. \n\nTV05_CLEANUP_AUDIT_UNUSED\n\nZiel\nMinimaler, PHI-freier Usage-Tracker, der pro Route/Operation z√§hlt: count, lastSeenAt, statusCodeBucket, optional env. Damit kann der n√§chste Audit ‚Äúunused‚Äù datenbasiert entscheiden.\n\nScope (In)\n\nServerseitige Telemetrie (API routes) als kleine Utility.\n\nSpeicherung: bevorzugt DB-Tabelle nur falls bereits geeignet vorhanden; sonst file/log-basierter Store (deterministisch, low risk) oder Supabase table via migration (nur wenn unbedingt n√∂tig).\n\nDashboard/Report: simples JSON Endpoint /api/admin/usage (auth-gated).\n\nOut of scope\n\nVollst√§ndiges Analytics/KPI System (kommt sp√§ter).\n\nClient-Side tracking.\n\nAcceptance Criteria\n\nJeder Request auf ausgew√§hlte Routen (mindestens: /api/amy/*, /api/consent/*, /api/content/resolve*) erzeugt einen Usage-Event ohne PHI. \n\nTV05_CLEANUP_AUDIT_UNUSED\n\nGET /api/admin/usage liefert aggregierte Metriken.\n\nAuth: unauth ‚Üí 401; non-admin ‚Üí 403.\n\nKeine PHI im Payload/Logs (nur routeKey, requestId, status bucket).\n\nEvidence: Script/commands + Screenshot/JSON response.\n\nTasks\n\nUtility: recordUsage({ routeKey, statusCodeBucket, env }).\n\nMinimal aggregation store + read endpoint.\n\nAdd hooks in target routes.\n\nTests: aggregation + auth gating + ‚Äúno PHI fields‚Äù.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n# optional: run dev and curl admin usage endpoint (logged-in)","labels":[],"number":425,"state":"CLOSED","title":"TV05_01-AUDIT-RUNTIME ‚Äî Runtime Usage Telemetry (PHI-frei) f√ºr API/Views"},{"body":"\nProblem\nIm RHYTHM v0.5.x Repo existieren bereits implementierte Artefakte (Pages/Views, API Routes, Server Actions, Contracts, Seeds, Docs), die derzeit nicht genutzt oder nicht in den User-Flow integriert sind (z. B. Funnels View). Zus√§tzlich fehlt ein systematischer Abgleich zwischen bereits bearbeiteten/geschlossenen GitHub Issues/PRs und dem tats√§chlichen Repo-Stand. Das erzeugt ‚ÄúZombie-Code‚Äù, Scope-Drift und erschwert QA/Release-Abschluss.\n\nZiel\nEin deterministisches ‚ÄúCleanup Audit‚Äù durchf√ºhren, das:\n\nalle implementierten, aber ungenutzten/ungenutzten Pfade identifiziert,\n\nRepo-Stand gegen geschlossene Issues/PRs mappt (Canonical IDs),\n\ndaraus einen konkreten Aufr√§um-Backlog ableitet (Integrate / Remove / Defer), ohne in diesem Issue selbst zu integrieren oder zu l√∂schen.\n\nScope (In)\n\nRepo-weite Inventarisierung:\n\napp/** Pages/Layouts\n\napp/api/** API routes\n\nlib/actions/**, lib/contracts/**, registries\n\nsupabase/migrations/**, seeds/fixtures (nur lesen)\n\ndocs/**\n\nGitHub-Abgleich:\n\nClosed/Merged Issues/PRs, die v0.5.x betreffen\n\nCanonical IDs (V05-I‚Ä¶) aus Titles/Bodies/Docs/Commits\n\nErgebnis-Artefakte (Reports) + Script zur Reproduzierbarkeit.\n\nOut of Scope\n\nFeature-Integration in Flows (separate Issues)\n\nEntfernen von Code/DB-Objekten (separate Issues)\n\nNeue Begriffe/Slugs/Tabellen (No Fantasy Names)\n\nAcceptance Criteria\n\nUnused/Unintegrated Inventory Report existiert:\n\ndocs/V05_CLEANUP_AUDIT_UNUSED.md\n\nPro Item: Path, Typ, Status (unused/unlinked/unreachable), Evidence (grep/findings), Empfohlene Aktion (Integrate/Remove/Defer), Risiko.\n\nIssue‚ÜîRepo Map Report existiert:\n\ndocs/V05_CLEANUP_AUDIT_ISSUE_MAP.md\n\nTabelle: Issue (Canonical ID) ‚Üí PR/Commit/Files ‚Üí Status: complete, partial, present-but-unused, missing, inkl. kurzer Notes.\n\nAufr√§um-Backlog ist abgeleitet und priorisiert (Top 10):\n\nim selben Report oder als docs/V05_CLEANUP_BACKLOG.md\n\njedes Backlog-Item hat: Titel, Scope, AC, Verify, Risiko.\n\nRepro Script existiert und erzeugt/aktualisiert die Reports deterministisch:\n\nscripts/cleanup-audit.ps1\n\nEvidence: Script-Run + Reports im PR aktualisiert.\n\nTasks\nA) GitHub-Abgleich (Closed Issues/PRs ‚Üî Repo)\n\nPer gh Issues/PRs f√ºr v0.5.x identifizieren (Labels/Milestone/Prefix V05-/v0.5/Rhythm v0.5).\n\nCanonical IDs aus Issue/PR Titel+Body extrahieren.\n\nPR‚ÜíMerge commit (SHA) bestimmen, optional Files-List per GitHub API (wenn verf√ºgbar).\n\nReport: Issue Map erzeugen.\n\nB) Implementiert-aber-ungenutzt Inventar (Repo Analyse)\n\nDeterministische Heuristiken (ohne AST, kein Raten):\n\nAPI Routes ohne Referenz:\n\napp/api/**/route.ts finden, dann repo-wide nach \"/api/<path>\" bzw. fetch(/server-action usage suchen.\n\nPages/Views ohne Entry:\n\napp/**/page.tsx finden; pr√ºfen, ob irgendwo Link href/navigation/redirect darauf zeigt.\n\nServer Actions ohne Aufrufer:\n\nlib/actions/** exports; repo-wide references z√§hlen.\n\nDocs ohne Integration:\n\nImplementationsdocs (docs/V05_*IMPLEMENTATION*) ohne Verlinkung aus einem ‚ÄúEntry doc‚Äù oder ohne verwendete Route/UI.\n\nErgebnis pro Finding mit ‚ÄúEvidence‚Äù: grep hits / absence.\n\nC) Backlog-Ableitung\n\nF√ºr jedes Finding: Empfehlung Integrate/Remove/Defer.\n\nTop 10 priorisieren nach:\n\nUser Value (Flow-relevant)\n\nRisiko (Security/PHI, RLS, Auth)\n\nWartungs-/Komplexit√§tskosten\n\nVerify (PowerShell)\ngit status\n.\\scripts\\cleanup-audit.ps1\nnpm test\nnpm run build\n\nNotes / Guardrails\n\nKeine neuen DB-Objekte, keine neuen Slugs/Keys/Enums.\n\nAlle Findings m√ºssen eine konkrete Referenz (Path + Evidence) haben.\n\nOutput muss in PR nachvollziehbar sein (Reports + Script).","labels":[],"number":423,"state":"CLOSED","title":"TV05-CLEANUP & AUDIT ‚Äî Repo Cleanup Audit: Implementiert aber ungenutzt + Issue‚ÜîRepo Abgleich (Aufr√§um-Backlog)"},{"body":"Issue 3 ‚Äî V05-HYGIENE-C: Repo-weite ‚ÄúZero Violations‚Äù Migration + Guardrails finalisieren (keine Drift mehr)\n\nZiel\nAlle verbleibenden DB-Access Violations (aktuell ~47 Dateien) werden migriert. Danach ist der Repo-Zustand stabil: ein Pattern, keine Abweichungen, CI blockt alles.\n\nScope\n\nAlle restlichen Dateien, die db:access-verify als Violations meldet\n\nEntferne/neutralisiere Legacy Helper, falls sie noch Clients bauen (nur re-export erlaubt)\n\nOptional: Script-/Env-Hygiene, falls DB-URLs noch missverst√§ndlich sind (nur wenn im Repo vorhanden und nachweislich relevant)\n\nAcceptance Criteria\n\nnpm run db:access-verify ‚Üí 0 violations\n\nKeine direkten createClient/createServerClient Imports au√üerhalb von lib/db/*\n\nsupabase.admin.ts server-only bleibt enforced, keine Client-import Kette.\n\nCanon Docs + Guardrails Doc sind aktuell und spiegeln Realit√§t.\n\nTests/Build gr√ºn.\n\nVerify (PowerShell)\n\nnpm ci\nnpm run db:access-audit\ngit diff -- docs/canon/DB_ACCESS_*.md\nnpm run db:access-verify\nnpm test\nnpm run build\n\n\nCopilot Prompt\n\nImplementiere V05-HYGIENE-C (Zero Violations).\n1) Starte mit npm run db:access-verify und liste alle violators.\n2) Migriere file-by-file in kleinen, logischen Gruppen auf canonical DB clients aus lib/db.\n3) Entferne direkte createClient/createServerClient usage komplett au√üerhalb lib/db.\n4) Stelle sicher, dass keine neuen Ausnahmen entstehen; wenn eine Ausnahme n√∂tig ist, dokumentiere sie canon + f√ºge eine explicit allowlist Regel hinzu.\n5) Am Ende: db:access-verify muss 0 violations liefern; tests/build gr√ºn.\nMinimal diff, keine Feature √Ñnderungen.","labels":[],"number":419,"state":"CLOSED","title":"V05-HYGIENE-C: Repo-weite ‚ÄúZero Violations‚Äù Migration + Guardrails finalisieren (keine Drift mehr)"},{"body":"Issue 2 ‚Äî V05-HYGIENE-B: Patient + Clinician Funnel Surfaces migrieren (Katalog/Funnel-Views stabil)\n\nZiel\nPatient Funnels Katalog und Clinician Views sollen konsistent Daten anzeigen. Keine inkonsistenten DB-Reads, keine Service-role Leaks, keine RLS-√úberraschungen.\n\nScope\n\nPatient Funnel Katalog/Pages: z. B. /patient/funnels, /patient/funnel/**\n\nClinician Funnel Views: z. B. /clinician/** (die Bereiche, die aktuell ‚Äúleer‚Äù sind)\n\nZugeh√∂rige APIs: app/api/funnels/**, app/api/clinician/** (oder wie im Repo benannt)\n\nAcceptance Criteria\n\n/patient/funnels zeigt Katalog + Funnels in Prod (ohne 500).\n\nClinician Seiten zeigen Daten (mindestens ‚Äúbaseline list‚Äù) in Prod.\n\nDB Zugriff ausschlie√ülich √ºber canonical layer (keine direkten client constructions).\n\nKorrekte Auth Semantik:\n\nPatient: cookie-based SSR client f√ºr eigene Daten\n\nClinician: SSR client + RLS / Assignments; keine ‚Äústill silent empty‚Äù\n\nnpm run db:access-verify zeigt keine Violations mehr in den betroffenen Surfaces.\n\nTests/Build gr√ºn.\n\nVerify (PowerShell)\n\nnpm ci\nnpm run db:access-verify\nnpm test\nnpm run build\n\n\nCopilot Prompt\n\nImplementiere V05-HYGIENE-B.\n1) Identifiziere alle Patient/Clinician Funnel Pages und deren API Routes.\n2) Ersetze alle direkten Supabase Client-Erzeugungen durch lib/db canonical clients.\n3) Stelle sicher, dass Catalog/Funnel Reads deterministisch sind (ordering tie-breakers).\n4) Error Handling + x-request-id muss konsistent sein.\n5) Erg√§nze route-level tests f√ºr die wichtigsten Endpoints:\n   - GET /api/funnels/catalog (success + schema-not-ready + forbidden + config-error)\n   - Clinician endpoint(s) analog.\nMinimal diff, keine neuen Features.","labels":[],"number":418,"state":"CLOSED","title":"V05-HYGIENE-B: Patient + Clinician Funnel Surfaces migrieren (Katalog/Funnel-Views stabil)"},{"body":"Issue 1 ‚Äî V05-HYGIENE-A: Admin Funnels DB-Access standardisieren (wie /admin/content) + 500 fix\n\nZiel\nAdmin Funnel Seiten/APIs sollen in Prod zuverl√§ssig laden (kein 500), mit dem neuen canonical DB client layer (lib/db/*) und konsistenter Auth/RLS-Strategie.\n\nScope\n\nAdmin Funnel UI Seiten (z. B. /admin/funnels, ggf. Unterseiten)\n\nAPI Routes rund um Admin Funnels (z. B. app/api/admin/funnels/**, plus ‚Äúpillars‚Äù/catalog dependencies falls genutzt)\n\nEntferne/ersetze alle direkten Supabase Client-Erzeugungen in diesen Bereichen (keine createClient/createServerClient direkt)\n\nAcceptance Criteria\n\n/admin/funnels l√§dt in Prod (Vercel) ohne 500; Daten sichtbar.\n\nAdmin Funnel APIs liefern:\n\n401/403 korrekt, wenn nicht autorisiert\n\n503 SCHEMA_NOT_READY bei fehlender Relation/Column\n\n500 CONFIGURATION_ERROR bei leerer Supabase env\n\nAlle betroffenen Files nutzen ausschlie√ülich lib/db/supabase.server|admin|public (je nach Bedarf).\n\nnpm run db:access-verify zeigt keine Violations mehr in den Admin-Funnel Files.\n\nnpm test + npm run build sind gr√ºn.\n\nVerify (PowerShell)\n\nnpm ci\nnpm run db:access-verify\nnpm test\nnpm run build\n# optional local\nnpm run dev\n\n\nCopilot Prompt\n\nImplementiere V05-HYGIENE-A.\n1) Finde alle Admin-Funnel Pages/Routes (app/admin/**funnels**, app/api/admin/funnels/**).\n2) Vergleiche DB-Zugriffsmuster mit der funktionierenden Referenzseite /admin/content.\n3) Migriere Admin-Funnel Code auf canonical DB clients aus lib/db:\n   - server: supabase.server.ts f√ºr user/session basierte Reads/Writes\n   - admin: supabase.admin.ts nur falls n√∂tig und nur metadata tables (begr√ºndet)\n4) Vereinheitliche Error Handling (FORBIDDEN/UNAUTHORIZED/SCHEMA_NOT_READY/CONFIGURATION_ERROR/INTERNAL_ERROR) + x-request-id.\n5) Erg√§nze/aktualisiere route-level tests f√ºr die Admin-Funnel API(s), sodass 500s nicht mehr maskiert auftreten.\nMinimal diff, keine neuen Features.","labels":[],"number":417,"state":"CLOSED","title":"V05-HYGIENE-A: Admin Funnels DB-Access standardisieren (wie /admin/content) + 500 fix"},{"body":"\n\nTitel: V05-HYGIENE ‚Äî DB Access Patterns Audit ‚Üí Canonical Client Pattern ‚Üí Repo-wide Refactor ‚Üí Hard Guardrails (CI/Lint)\nType: Hygiene / Stabilization (Bug class prevention)\nMotivation: In Prod funktionieren einzelne Admin-Seiten (z. B. /admin/content), w√§hrend Funnel-/Clinician-Seiten brechen. Ursache ist sehr wahrscheinlich inkonsistente DB-Client-Erzeugung/Env-Nutzung/RLS-Bypass. Wir wollen ein einziges ‚Äúrichtiges‚Äù Muster definieren, repo-weit anwenden und anschlie√üend hart automatisiert verhindern, dass Copilot/LLM wieder abweicht.\n\nZiel (Outcome)\n\nEine kanonische Art, wie im Repo auf DB gelesen/geschrieben wird (Supabase) ‚Äì klar getrennt nach:\n\nBrowser/Public (anon)\n\nServer/SSR (cookie-based user session)\n\nServer/Admin (service role, strikt scoped, metadata-only falls n√∂tig)\n\nRepo-weit sind alle Routes/Pages/Libs auf dieses Muster umgestellt.\n\nGuardrails wirken wirklich: neue inkonsistente DB-Zugriffe werden durch CI/Lint blockiert (nicht nur ‚ÄúDoku‚Äù).\n\nScope\nIn Scope\n\nVollst√§ndige Inventur aller DB-Zugriffe (read/write) in:\n\napp/api/**\n\napp/** (server components, pages)\n\nlib/** (helpers, loaders)\n\nscripts/** (nur dokumentieren/standardisieren, nicht zwingend refactor)\n\nStandardisierung der Client-Factories + env usage\n\nRefactor der betroffenen Stellen (mindestens alle Funnel-/Clinician-/Admin-Flows)\n\nCI/Lint Gates + Canon Docs + CODEOWNERS/PR-Template Anpassung\n\nOut of Scope\n\nNeue Features, neue Tabellen, neue Funnels\n\nRLS-Neudesign ‚Äúfrom scratch‚Äù (nur soweit n√∂tig, um Canon-Pattern konsistent zu betreiben)\n\npr√ºfe auch erledigte Issues/PRs und ber√ºcksichtige die Erkenntnisse.\n\nDeliverables\nD1 ‚Äî DB Access Inventory Report (maschinenlesbar + lesbar)\n\ndocs/canon/DB_ACCESS_PATTERNS.md (Report + Decision)\n\ndocs/canon/DB_ACCESS_MATRIX.md (Table: Surface ‚Üí Endpoint ‚Üí Client Type ‚Üí Tables ‚Üí RLS expectations)\n\ndocs/canon/DB_ACCESS_DECISION.md (Canon: ‚Äúthe right way‚Äù + rationale)\n\nD2 ‚Äî Canonical DB Client Layer (einheitlich)\n\nEinf√ºhrung/Finalisierung von genau diesen Factories (Namen an Repo anpassen, aber Prinzip fix):\n\nlib/db/supabase.public.ts ‚Üí Browser/Public client (anon, keine service keys)\n\nlib/db/supabase.server.ts ‚Üí SSR server client (cookie/session-based user)\n\nlib/db/supabase.admin.ts ‚Üí server-only service role (strikt begr√ºndet/scoped)\n\nWichtig: supabase.admin.ts muss ‚Äûserver-only‚Äú erzwingen (z. B. Import server-only / runtime guard), und zentral loggen + requestId weiterreichen.\n\nD3 ‚Äî Repo-wide Refactor\n\nAlle API Routes und Pages d√ºrfen Supabase nur √ºber diese Factories initialisieren.\n\nKein ‚Äúwildes‚Äù createClient(...) in einzelnen Routes.\n\nEinheitliche Fehlerklassifizierung + x-request-id Handling √ºber Shared Helpers.\n\nD4 ‚Äî Hard Guardrails (wirksam, CI-blocking)\n\nESLint Gate: verbietet direkten Import/Call von createClient aus @supabase/supabase-js au√üerhalb der 3 Factory Files.\n\nImport Gate: verbietet Import von lib/db/supabase.admin.ts au√üerhalb von:\n\napp/api/** (server routes)\n\noptional: lib/** server-only modules\n(definiert via eslint overrides / path rules)\n\nEnv Gate: Alle DB-relevanten envs nur √ºber lib/env.ts; verbiete process.env.* au√üerhalb erlaubter Dateien.\n\nCI Workflow: npm test, npm run build + ‚Äúdb-access-verify‚Äù step, der die Regeln deterministisch pr√ºft (Exit 1 bei Versto√ü).\n\nD5 ‚Äî Tests/Evidence\n\nUnit/route-level Tests, die mindestens sicherstellen:\n\nadmin client nicht im Browser bundle landen kann\n\nroutes nutzen factories (mock/spy)\n\nenv guard greift (blank env ‚Üí CONFIGURATION_ERROR)\n\nEvidence Doc mit PowerShell Verify Commands.\n\nAcceptance Criteria (Pass/Fail)\n\nInventory vollst√§ndig: Jeder DB-Zugriff ist in DB_ACCESS_MATRIX.md erfasst (Route/Page/Lib ‚Üí Client Type ‚Üí Tables).\n\nSingle Canon: In DB_ACCESS_DECISION.md ist eindeutig beschrieben, welches Pattern f√ºr welche Surface gilt.\n\nNo Stray Clients: rg \"createClient\\(\" au√üerhalb der Factory Files findet 0 Treffer (oder nur explizit erlaubte, dokumentierte Ausnahmen).\n\nService Role Safety:\n\nService-role wird nur server-only verwendet.\n\nScope dokumentiert (welche Tabellen/warum).\n\nHard Gates aktiv: PRs, die dagegen versto√üen, schlagen in CI fehl.\n\nnpm ci, npm test, npm run build sind gr√ºn.\n\nImplementation Plan (phasenweise, ohne Chaos)\nPhase 1 ‚Äî Audit (nur lesen, nichts refactor)\n\nScript/Tooling: scripts/db/access-audit.ps1 (oder TS tool) erzeugt:\n\nListe aller Stellen mit Supabase-Client Erstellung\n\nListe aller Tabellenzugriffe (heuristisch via .from('...'))\n\nListe der env usages (SUPABASE_, NEXT_PUBLIC_, process.env)\n\nErgebnis in docs/canon/DB_ACCESS_PATTERNS.md + Matrix.\n\nPhase 2 ‚Äî Canonical Layer + Helpers\n\nFactories + shared helpers f√ºr:\n\nrequestId propagation\n\ntyped error mapping (FORBIDDEN/SCHEMA_NOT_READY/CONFIGURATION_ERROR/INTERNAL_ERROR)\n\ndeterministic ordering conventions (wenn relevant)\n\nPhase 3 ‚Äî Refactor Surfaces\n\nPriorit√§t: Funnels + Clinician + Admin funnels\n\nDanach alle restlichen Admin APIs/Pages\n\nPhase 4 ‚Äî Guardrails harden\n\nESLint rules + CI step + CODEOWNERS/PR template update","labels":[],"number":415,"state":"CLOSED","title":"Repo-weite DB-Access Analyse + Standardisierung + Hard Guardrails (verhindert inkonsistente Supabase-Nutzung)"},{"body":"GitHub Issue ‚Äî RHYTHM v0.5\n\nTitle: I505 (V0.5) ‚Äî Hard Guardrails: DB Schema Manifest + Migration Linter (No Fantasy DB Objects)\n\nProblem\nCopilot/LLM-generated changes keep introducing ‚Äúplausible‚Äù but non-canonical DB objects (tables/enums/columns), e.g. duplicate tables like funnels instead of canonical funnels_catalog. Current guardrails (registry/env/CODEOWNERS) are not sufficient because they do not hard-block schema invention at the migration layer.\n\nGoal\nIntroduce a hard, machine-enforced guardrail that blocks any PR introducing non-canonical DB objects unless they are explicitly added to a canonical allowlist.\n\nNon-negotiables\n\nMigration-first discipline stays intact.\n\nPowerShell-only operational scripts/snippets.\n\nDeterministic CI gates: no manual judgement required.\n\nClear, actionable failure output (file + line + offending identifier).\n\nScope\n1) Canonical Allowlist\n\nCreate docs/canon/DB_SCHEMA_MANIFEST.json as the single source of truth for allowed schema objects.\n\nMinimum structure:\n\ntables: list of allowed table names\n\nenums: list of allowed enum/type names\nOptional (recommended):\n\ncolumns: per-table allowed/required columns\n\nconstraints: per-table unique constraints / indexes (names optional)\n\nPopulate it with the current v0.5 core schema (from existing supabase/migrations/*.sql that define the canonical schema).\n\n2) Migration Linter (PowerShell)\n\nCreate scripts/db/lint-migrations.ps1 that:\n\nScans supabase/migrations/*.sql\n\nExtracts identifiers from:\n\nCREATE TABLE <name>\n\nCREATE TYPE <name> AS ENUM\n\nALTER TABLE <name> ...\n\n(at least) ADD COLUMN, DROP, RENAME, CREATE INDEX, CREATE POLICY\n\nFails if:\n\nA table/enum is referenced that is not in the manifest\n\nA forbidden alias appears (e.g. funnels if canonical is funnels_catalog)\n\nA migration creates an already-existing canonical object in a conflicting way (e.g. CREATE TABLE funnel_versions when it must be ALTER TABLE)\n\nOutput must include:\n\nfile path\n\nline number\n\noffending identifier\n\nrule violated\n\nExit codes:\n\n0 = pass\n\n1 = fail (block CI)\n\n3) CI Workflow Gate\n\nAdd .github/workflows/db-schema-guard.yml:\n\nTriggers on PRs changing supabase/migrations/** and/or docs/canon/DB_SCHEMA_MANIFEST.json\n\nRuns:\n\nnpm ci\n\npwsh scripts/db/lint-migrations.ps1\n\nnpm run db:diff (drift gate)\n\nnpm run db:typegen (type sync gate)\n\nThe workflow must fail fast and block merges.\n\n4) PR Template & Docs\n\nUpdate .github/PULL_REQUEST_TEMPLATE.md:\n\nRequire evidence that db-schema-guard passed (CI link is fine).\n\nUpdate docs/canon/DB_MIGRATIONS.md:\n\nBriefly explain the manifest + linter and how to add new canonical objects (process).\n\nAcceptance Criteria\n\nManifest exists (docs/canon/DB_SCHEMA_MANIFEST.json) and is populated with current v0.5 canonical schema objects.\n\nscripts/db/lint-migrations.ps1 blocks any migration that introduces a table/enum not in the manifest.\n\nLinter output is actionable (file + line + identifier + rule).\n\n.github/workflows/db-schema-guard.yml runs on relevant PRs and blocks merge on failure.\n\nAll scripts/snippets are PowerShell (no Bash).\n\nAt least two tests/fixtures exist to validate the linter:\n\none ‚Äúallowed‚Äù migration passes\n\none ‚Äúforbidden‚Äù migration fails (e.g. creates funnels)\n\nImplementation Tasks (suggested)\n\n Create docs/canon/DB_SCHEMA_MANIFEST.json (initial v0.5 schema allowlist)\n\n Implement scripts/db/lint-migrations.ps1\n\n Add linter fixtures under scripts/db/fixtures/ (allowed.sql, forbidden.sql)\n\n Add minimal test runner script (PowerShell) or node-based test invoking the PS linter on fixtures\n\n Add .github/workflows/db-schema-guard.yml\n\n Update PR template with evidence checklist\n\n Update docs/canon/DB_MIGRATIONS.md with ‚ÄúSchema Guardrail‚Äù section\n\nVerification (PowerShell)\nnpm ci\npwsh scripts/db/lint-migrations.ps1\nnpm run db:diff\nnpm run db:typegen\nnpm test\nnpm run build\n\n\nNotes\n\nThe manifest is the explicit, reviewable mechanism to allow controlled schema evolution.\n\nThis issue intentionally prevents ‚ÄúLLM guesswork‚Äù at the DB layer.","labels":[],"number":406,"state":"CLOSED","title":"I505 (V0.5) ‚Äî Hard Guardrails: DB Schema Manifest + Migration Linter (No Fantasy DB Objects)"},{"body":"SOP/Checkliste f√ºr flagged Reports + sampling; dokumentiert + im System abbildbar (mind. Status/Queue).\n\n**Acceptance Criteria:**\n- SOP/Checkliste f√ºr flagged Reports + sampling.\n- Dokumentiert + im System abbildbar (mind.  Status/Queue).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":398,"state":"CLOSED","title":"V05-I10.4 ‚Äî Content Safety Ops: Review Queue SLA + Sampling Rules (MVP SOP)"},{"body":"KPI/Usage-Metriken erfasst (mind. completion/drop-off/time-to-report).\n\n**Acceptance Criteria:**\n- KPI/Usage-Metriken erfasst (mind. completion/drop-off/time-to-report).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":397,"state":"CLOSED","title":"V05-I10.3 ‚Äî Observability: Error Tracking + KPI Events (Completion, Drop-off, Time-to-report)"},{"body":"Deletion/Retention Workflow (MVP) dokumentiert + technisch umgesetzt; Audit Events vorhanden.\n\n**Acceptance Criteria:**\n- Deletion/Retention Workflow (MVP) dokumentiert + technisch umgesetzt.\n- Audit Events vorhanden.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":396,"state":"CLOSED","title":"V05-I10.2 ‚Äî Account Deletion/Retention + Audit Coverage"},{"body":"Consent gespeichert + exportierbar; Export Funktion (MVP) vorhanden.\n\n**Acceptance Criteria:**\n- Consent gespeichert + exportierbar.\n- Export Funktion (MVP) vorhanden.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":395,"state":"CLOSED","title":"V05-I10.1 ‚Äî Consent Management (Versioned) + Data Export (JSON) MVP"},{"body":"**Intent:** Consent, Export, Deletion/Retention, Audit Logging; stabile UI; Fehlertracking + KPI/Usage. \n\n**v0.5 Definition of Done:**\nv0.5 ist \"Done\", wenn: \n- Multi-Funnelf√§hig:  Pillars sichtbar + mind.  Stress/Resilienz + 2‚Äì3 zus√§tzliche Funnels im Katalog. \n- E2E Patient Flow: Auswahl ‚Üí Consent ‚Üí Adaptive Questionnaire (save/resume) ‚Üí optional Upload/Confirm ‚Üí Processing ‚Üí Report/Tasks. \n- Processing Pipeline inkl. Medical Validation L1+L2 + Review Queue + PDF + Delivery.\n- Rollen aktiv:  Clinician + neue Nurse Rolle + Admin-Konfiguration (Men√ºs/Blocks/Funnels).\n- Versionierung durchg√§ngig (Funnel/Algo/Prompt/Report) + RLS + Audit + Pilot-Readiness Basics.\n\n**Sub-Issues:**\n- [ ] V05-I10.1 ‚Äî Consent Management (Versioned) + Data Export (JSON) MVP\n- [ ] V05-I10.2 ‚Äî Account Deletion/Retention + Audit Coverage\n- [ ] V05-I10.3 ‚Äî Observability:  Error Tracking + KPI Events (Completion, Drop-off, Time-to-report)\n- [ ] V05-I10.4 ‚Äî Content Safety Ops:  Review Queue SLA + Sampling Rules (MVP SOP)","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"}],"number":394,"state":"CLOSED","title":"EPIC V05-E10 ‚Äî Pilot-Readiness (5‚Äì10 ‚Üí 50‚Äì100): Compliance + Reliability + Observability"},{"body":"Basic Templates + Scheduling-Regeln; gespeichert & auditierbar.\n\n**Acceptance Criteria:**\n- Basic Templates + Scheduling-Regeln. \n- Gespeichert & auditierbar.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":393,"state":"CLOSED","title":"V05-I09.4 ‚Äî Operational Settings (Notification Templates, Re-assessment Rules, KPI thresholds)"},{"body":"Admin kann Funnel aktivieren/deaktivieren, default_version setzen, Rollout neuer Algo/Prompt-Versionen steuern.\n\n**Acceptance Criteria:**\n- Admin kann Funnel aktivieren/deaktivieren, default_version setzen. \n- Rollout neuer Algo/Prompt-Versionen steuern.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":392,"state":"CLOSED","title":"V05-I09.3 ‚Äî Funnel Management (Activate/Deactivate + Set Versions + Rollouts)"},{"body":"Token-Datei/Config kann √ºberschrieben werden (tenant/clinic); UI konsumiert Tokens.\n\n**Acceptance Criteria:**\n- Token-Datei/Config kann √ºberschrieben werden (tenant/clinic).\n- UI konsumiert Tokens. ","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":391,"state":"CLOSED","title":"V05-I09.2 ‚Äî Design Tokens Parameterisierung (tenant/clinic override vorbereitet)"},{"body":"Admin UI: Items aktivieren/deaktivieren, Reihenfolge, Labels/Icons; per Rolle getrennt.\n\n**Acceptance Criteria:**\n- Admin UI: Items aktivieren/deaktivieren, Reihenfolge, Labels/Icons; per Rolle getrennt. ","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":390,"state":"CLOSED","title":"V05-I09.1 ‚Äî Admin Navigation/Layouts Config (Top/Bottom Menus + Block Layouts)"},{"body":"**Intent:** Admin kann Men√ºs/Layouts, Content Blocks, Design Tokens, Funnel Aktivierung/Version-Rollout, Operational Settings konfigurieren.\n\n**Sub-Issues:**\n- [ ] V05-I09.1 ‚Äî Admin Navigation/Layouts Config (Top/Bottom Menus + Block Layouts)\n- [ ] V05-I09.2 ‚Äî Design Tokens Parameterisierung (tenant/clinic override vorbereitet)\n- [ ] V05-I09.3 ‚Äî Funnel Management (Activate/Deactivate + Set Versions + Rollouts)\n- [ ] V05-I09.4 ‚Äî Operational Settings (Notification Templates, Re-assessment Rules, KPI thresholds)","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"}],"number":389,"state":"CLOSED","title":"EPIC V05-E09 ‚Äî Admin:  Konfiguration statt Code (Navigation/Blocks/Tokens/Funnels/Ops)"},{"body":"Supportf√§lle dokumentierbar; Eskalation erzeugt Task/Audit.\n\n**Acceptance Criteria:**\n- Supportf√§lle dokumentierbar. \n- Eskalation erzeugt Task/Audit.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":388,"state":"CLOSED","title":"V05-I08.4 ‚Äî Support Notes + Escalation to Clinician"},{"body":"Versandstatus-Tracking + Reminder events (notifications).\n\n**Acceptance Criteria:**\n- Versandstatus-Tracking + Reminder events (notifications).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":387,"state":"CLOSED","title":"V05-I08.3 ‚Äî Logistics: Test/Device Versandstatus + R√ºcklauf + Reminders"},{"body":"Script-gest√ºtzter Erstkontakt:  Eignung/Red Flags/Tier-Empfehlung protokollierbar.\n\n**Acceptance Criteria:**\n- Script-gest√ºtzter Erstkontakt:  Eignung/Red Flags/Tier-Empfehlung protokollierbar.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":386,"state":"CLOSED","title":"V05-I08.2 ‚Äî Pre-screening Call Script UI (MVP)"},{"body":"Nurse kann zugewiesene Patienten/Tasks sehen, RLS-konform. \n\n**Acceptance Criteria:**\n- Nurse kann zugewiesene Patienten/Tasks sehen, RLS-konform.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqfg","name":"database","description":"","color":"ededed"}],"number":385,"state":"CLOSED","title":"V05-I08.1 ‚Äî Nurse Role + Views (Case Queue / Assigned Tasks)"},{"body":"**Intent:** Neue Rolle Nurse f√ºr operative Aufgaben (Logistik, Support, Follow-ups).\n\n**Sub-Issues:**\n- [ ] V05-I08.1 ‚Äî Nurse Role + Views (Case Queue / Assigned Tasks)\n- [ ] V05-I08.2 ‚Äî Pre-screening Call Script UI (MVP)\n- [ ] V05-I08.3 ‚Äî Logistics:  Test/Device Versandstatus + R√ºcklauf + Reminders\n- [ ] V05-I08.4 ‚Äî Support Notes + Escalation to Clinician","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"}],"number":384,"state":"CLOSED","title":"EPIC V05-E08 ‚Äî Nurse Flow (Pre-screening ‚Üí Logistics ‚Üí Support ‚Üí Follow-up)"},{"body":"Clinician kann Tasks anlegen (LDL nachmessen, Video-Call, Device Versand) + assigned_to (nurse/clinician).\n\n**Acceptance Criteria:**\n- Clinician kann Tasks anlegen (LDL nachmessen, Video-Call, Device Versand).\n- assigned_to (nurse/clinician).","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":383,"state":"CLOSED","title":"V05-I07.4 ‚Äî Actioning: Aufgaben definieren + Eskalationsregeln + Dokumentation"},{"body":"Sicht auf Contraindications/Plausibility + safety_score; Approve/Reject setzt Audit + Status.\n\n**Acceptance Criteria:**\n- Sicht auf Contraindications/Plausibility + safety_score. \n- Approve/Reject setzt Audit + Status. ","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":382,"state":"CLOSED","title":"V05-I07.3 ‚Äî QA Panel (Layer 1 Findings + Layer 2 Score) + Review Actions"},{"body":"Detail zeigt \"Key Labs\", funnel-specific findings, scores, interventions.\n\n**Acceptance Criteria:**\n- Detail zeigt \"Key Labs\", funnel-specific findings, scores, interventions. ","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":381,"state":"CLOSED","title":"V05-I07.2 ‚Äî Patient Detail (Anamnese/Medikamente/Labs + Findings/Scores)"},{"body":"Liste aktiver Patienten/Funnels + Status. \n\n**Acceptance Criteria:**\n- Liste aktiver Patienten/Funnels + Status.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":380,"state":"CLOSED","title":"V05-I07.1 ‚Äî Triage/Overview (Status: incomplete/processing/report ready/flagged)"},{"body":"**Intent:** Triage-Status, Patient Detail, QA-Layer Sicht, Review Workflow, Aufgaben/Entscheidungen auditierbar.\n\n**Sub-Issues:**\n- [ ] V05-I07.1 ‚Äî Triage/Overview (Status:  incomplete/processing/report ready/flagged)\n- [ ] V05-I07.2 ‚Äî Patient Detail (Anamnese/Medikamente/Labs + Findings/Scores)\n- [ ] V05-I07.3 ‚Äî QA Panel (Layer 1 Findings + Layer 2 Score) + Review Actions\n- [ ] V05-I07.4 ‚Äî Actioning:  Aufgaben definieren + Eskalationsregeln + Dokumentation","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"}],"number":379,"state":"CLOSED","title":"EPIC V05-E07 ‚Äî Clinician View (Triage ‚Üí Patient Detail ‚Üí QA ‚Üí Actioning)"},{"body":"V05-I06.3 ‚Äî Role-specific Menus (Patient vs Clinician vs Nurse)\n\nGoal\nMake navigation menus role-aware so that patient/clinician/nurse see only their intended menu items, using existing role checks and existing routes.\n\nProblem\nEven with a shared shell/navigation, menus are currently not role-scoped, which risks exposing navigation links to routes a user shouldn‚Äôt access (even if backend guards exist).\n\nScope\n\nImplement a role-aware menu model that:\n\nFilters top/bottom menus by role\n\nUses existing role/guard utilities (no new role enums/keys)\n\nPatient: uses patient shell menu items\n\nClinician/Admin/Nurse: show only their respective items, but do not invent IA‚Äîonly map to existing pages/routes\n\nNon-goals\n\nNo new roles\n\nNo new permissions system\n\nNo UI redesign‚Äîonly filtering/visibility logic\n\nNo backend auth changes (assume existing guards remain)\n\nAcceptance Criteria\n\nMenu items shown/hidden based on role using existing role checks/helpers\n\nUnauthenticated users do not receive role menus (must not render authenticated navigation)\n\nNo fantasy names: roles and route targets must already exist in repo\n\nFail-closed: if role cannot be determined, do not show privileged items\n\nTests cover:\n\nPatient sees patient items, not clinician/admin items\n\nClinician/admin sees clinician/admin items\n\nNurse sees nurse items if nurse role exists; otherwise fail-closed and document what‚Äôs missing\n\nUnauthenticated/unknown role: privileged items hidden\n\nTasks\n\nLocate canonical role check helpers (e.g., admin/clinician checks; nurse helper if present).\n\nDefine menu config structure mapping role ‚Üí items referencing existing routes only.\n\nIntegrate filtering into existing menu components introduced/used in V05-I06.1.\n\nAdd tests for role filtering (mock session/role per existing patterns).\n\nEnsure fail-closed behavior and no rendering of authenticated nav for unauthenticated users.\n\nEvidence in PR: npm test, npm run build.\n\nVerify (PowerShell)\n\nnpm test\n\nnpm run build","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":378,"state":"CLOSED","title":"V05-I06.3 ‚Äî Role-specific Menus (Patient vs Clinician vs Nurse)"},{"body":"V05-I06.2 ‚Äî Content Block Renderer (Cards/Sections Stack)\n\nZiel\nImplementiere einen manifest-driven Content Block Renderer f√ºr die Mobile UI v0.5, der aus bestehenden content_manifest / funnel_versions Daten deterministisch UI-Bl√∂cke rendert (Cards/Sections Stack). Fokus: Patient-View (und sp√§ter wiederverwendbar f√ºr Clinician/Nurse), ohne neue Begriffe/Slugs/DB-Objekte zu erfinden.\n\nGitHub Issue Text\n\nTitel\nV05-I06.2 ‚Äî Content Block Renderer (Cards/Sections Stack)\n\nProblem / Kontext\nWir haben v0.5 Datenmodell + Funnel Versioning + Manifest-Konzept. F√ºr die Mobile Shell (V05-I06.1) und role-spezifische Men√ºs (V05-I06.3) fehlt ein einheitlicher Renderer, der content_manifest (versioniert) in eine UI-Stack-Darstellung √ºbersetzt. Aktuell sind Views/Pages noch teilweise hardcoded oder ohne konsistente Block-Render-Engine.\n\nScope\n\nRenderer-Komponente(n) f√ºr Card/Section Stack (Read-only Rendering).\n\nInput: manifest content blocks (nur aus bestehenden Contracts/Registry; keine Fantasie-Typen).\n\nOutput: konsistente UI-Struktur, die in Patient- und sp√§ter Clinician/Nurse-Views eingebunden werden kann.\n\nKeine Editor-Funktionalit√§t (kein Block-Builder), nur Anzeige.\n\nNicht im Scope (explizit)\n\nKein neues DB-Schema, keine neuen Tabellen/Enums/Slugs.\n\nKein neues Content-DSL. Nur bestehende Manifest-Strukturen.\n\nKein PDF-Export (geh√∂rt zu I05.8).\n\nKein ‚ÄúReport Generation‚Äù (geh√∂rt zu I05.x / I03.4).\n\nAcceptance Criteria\n\nAC1 ‚Äî Manifest-driven, keine Fantasie-Namen\n\nRenderer akzeptiert ausschlie√ülich Block-Typen aus Registry/Contracts (z. B. CONTENT_BLOCK_TYPE o. √§. ‚Äì genau wie im Repo definiert).\n\nUnbekannter Block-Typ ‚áí kontrollierter Fehlerpfad (422/‚ÄùUnsupported block type‚Äù), kein Silent Fallback.\n\nAC2 ‚Äî Deterministische Darstellung\n\nGleicher Manifest-Input ‚áí identische Render-Reihenfolge und Struktur.\n\nKeine zuf√§llige Sortierung; Reihenfolge kommt aus Manifest.\n\nAC3 ‚Äî UI Stack Pattern\n\nDarstellung als Sections (optional) mit Cards darunter.\n\nMinimal-UI: Titel, optional Subheading, Body/Content (je nach Block-Typ), optional CTA/Link falls im Manifest vorhanden.\n\nAC4 ‚Äî Server-only Boundaries / Data Loading\n\nManifest wird serverseitig geladen (bestehender Loader), Renderer ist UI-seitig pure (keine Secrets/DB Clients in Client Components).\n\nKein direkter Zugriff auf service role in Client.\n\nAC5 ‚Äî Test Coverage\n\nUnit/Integration Tests f√ºr:\n\nSupported block types rendern korrekt\n\nUnknown type ‚áí controlled error\n\nDeterministische Reihenfolge\n\n‚ÄúEmpty manifest‚Äù ‚áí leere, g√ºltige UI\n\nAC6 ‚Äî Evidence\n\nnpm test gr√ºn\n\nnpm run build gr√ºn\n\nKurzer UI-Smoke: Seite mit Beispiel-Manifest zeigt Stack (Screenshot optional).\n\nTasks\n\nContracts/Registry pr√ºfen\n\nWelche Block-Typen sind im Repo bereits kanonisch definiert (Registry)?\n\nWelche Felder sind im bestehenden content_manifest vorgesehen?\n\nRenderer implementieren\n\nContentBlockRenderer (Root)\n\nSectionRenderer / CardRenderer (je nach manifest structure)\n\nBlock-spezifische Renderer (switch via registry type guard)\n\nIntegration Point (minimal)\n\nEinen existierenden Screen (z. B. patient funnel detail / content pages) so anbinden, dass er den Renderer nutzt (minimal diff).\n\nTests\n\ndeterministic order test\n\nunknown type test\n\nempty manifest test\n\n‚Äúgolden manifest‚Äù snapshot/artifact test (wenn Repo das Muster hat)\n\nDocs\n\nKurz: docs/V05_I06_2_CONTENT_BLOCK_RENDERER.md mit Input/Output + Integration-Hinweis + Verify Commands (PowerShell).\n\nVerify (PowerShell)\nnpm test\nnpm run build\n\n\nOptional UI Smoke (falls vorhanden im Repo):\n\nnpm run dev\n# dann Patient Flow √∂ffnen und Content Stack Seite pr√ºfen\n\nCopilot Prompt (f√ºr sp√§ter, wenn du es angehst)\n\nDu bist mein VS-Code GitHub Copilot im Repo rhythmologicum-connect. Implementiere V05-I06.2 Content Block Renderer (Cards/Sections Stack).\n\nNicht verhandelbar:\n\nKeine Fantasie-Namen: nutze ausschlie√ülich Block Types / Keys aus lib/contracts/registry und bestehenden Contracts (content_manifest).\n\nKeine neuen Tabellen/Enums/Slugs.\n\nDeterministisch, fail-closed: unknown block types ‚Üí controlled error (keine Defaults).\n\nServer-only Boundaries: DB/Secrets bleiben serverseitig.\n\nAufgaben:\n\nFinde den bestehenden Content-Manifest Contract (Zod/TS) und die Registry f√ºr Block Types.\n\nImplementiere ContentBlockRenderer + ggf. SectionRenderer/CardRenderer als UI-Komponenten.\n\nImplementiere Block Renderer f√ºr alle bereits im Repo definierten Block Types.\n\nIntegriere den Renderer minimal in einen bestehenden Screen, der Content aus Manifest anzeigt (keine neuen Routen).\n\nSchreibe Tests: supported types, unknown type, empty manifest, deterministic order.\n\nDokumentiere Integration + Verify in docs/V05_I06_2_CONTENT_BLOCK_RENDERER.md (PowerShell-only).\n\nVerify:\n\nnpm test\nnpm run build\n\n\nDone Definition:\n\nTests gr√ºn, Build gr√ºn\n\nKeine neuen Begriffe/Types\n\nRenderer funktioniert mit vorhandenem Manifest und ist wiederverwendbar f√ºr Patient/Clinician/Nurse.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":377,"state":"CLOSED","title":"V05-I06.2 ‚Äî Content Block Renderer (Cards/Sections Stack)"},{"body":"V05-I06.1 ‚Äî Mobile Shell: Fixed Top Menu + Fixed Bottom Menu (GH Issue Text)\n\nGoal\nIntroduce a stable ‚ÄúMobile Shell‚Äù layout for RHYTHM v0.5 that provides a fixed top navigation and fixed bottom navigation, so patient flows (onboarding, assessment, history, funnels) run inside the same app frame.\n\nProblem\nCurrent patient UI pages render without a consistent shell. This causes layout inconsistency, duplicated navigation logic, and makes later role-specific menus harder.\n\nScope\n\nAdd a single canonical layout wrapper (mobile-first) with:\n\nFixed Top Menu\n\nFixed Bottom Menu\n\nContent area with safe spacing (no overlap)\n\nWire existing patient pages into the shell without changing their business logic.\n\nKeep terminology and roles strictly from existing registry/contracts (no new slugs/roles/keys).\n\nNon-goals\n\nNo new design token system (that‚Äôs V05-I09.2).\n\nNo content block renderer (that‚Äôs V05-I06.2).\n\nNo new role model‚Äîonly reuse existing guards/utilities.\n\nAcceptance Criteria\n\nFixed Top Menu is present on all patient pages in scope; does not overlap content.\n\nFixed Bottom Menu is present on all patient pages in scope; active state reflects current route.\n\nNavigation is deterministic and does not introduce new route names/slugs beyond what exists.\n\nNo fantasy names: menu items/labels/route keys come from existing code/constants.\n\nWorks on small viewport sizes (mobile) and does not break desktop rendering.\n\nTests: at least basic rendering + route active-state tests for shell.\n\nEvidence: npm test, npm run build output captured in PR description.\n\nTasks\n\nIdentify canonical patient routes to include in bottom nav (must already exist).\n\nImplement app/patient/layout.tsx (or equivalent existing layout boundary) that wraps patient routes with the shell.\n\nImplement top/bottom components (server/client as appropriate) with minimal state.\n\nAdd tests for:\n\nshell renders\n\nbottom nav highlights current route\n\nUpdate any existing patient pages only as needed for layout compatibility (minimal diff).\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n\n\nCopilot Prompt (VS Code / GitHub Copilot)\nYou are my GitHub Copilot for the RHYTHM repo. Implement V05-I06.1 ‚Äî Mobile Shell: Fixed Top Menu + Fixed Bottom Menu with minimal diff.\n\nConstraints (non-negotiable):\n\nPowerShell-only verification commands in docs/comments.\n\nNo fantasy names: do not invent new roles, slugs, menu keys, route names, or registry entries. Reuse existing routes/constants/utilities in the repo. If you can‚Äôt find canonical values, stop and point out what is missing.\n\nKeep changes scoped: this issue is only ‚Äúshell + fixed menus‚Äù, not content blocks or design tokens.\n\nImplementation requirements:\n\nCreate/modify the patient route layout (prefer app/patient/layout.tsx if present) so all patient pages render inside a common shell:\n\nFixed Top Menu (header area)\n\nFixed Bottom Menu (tab bar)\n\nMain content area with safe padding so it never overlaps fixed menus.\n\nBottom menu must reflect active route deterministically.\n\nDo not change business logic of existing patient pages; only wrap them.\n\nAdd tests:\n\nShell renders for patient routes\n\nActive-state behavior for at least 2 routes\n\nUpdate docs only if needed, but keep it minimal.\n\nFiles to inspect first:\n\napp/patient/** routes and any existing layout\n\nexisting navigation/menu components if any\n\nrole/auth helpers (do not hardcode roles)\n\nDefinition of Done:\n\nnpm test passes\n\nnpm run build succeeds\n\nPatient pages render within the shell with top/bottom fixed menus\n\nNo new invented constants/roles/slugs\n\nMinimal diff","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNF3A","name":"UX","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":376,"state":"CLOSED","title":"V05-I06.1 ‚Äî Mobile Shell: Fixed Top Menu + Fixed Bottom Menu"},{"body":"**Intent:** Standardisierte Mobile Shell:  fixed header/footer; Scroll Area als konfigurierbare Content-Blocks.\n\n**Sub-Issues:**\n- [ ] V05-I06.1 ‚Äî Mobile Shell:  Fixed Top Menu + Fixed Bottom Menu\n- [ ] V05-I06.2 ‚Äî Content Block Renderer (Cards/Sections Stack)\n- [ ] V05-I06.3 ‚Äî Role-specific Menus (Patient vs Clinician vs Nurse)","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF3A","name":"UX","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"}],"number":375,"state":"CLOSED","title":"EPIC V05-E06 ‚Äî Mobile UI v0.5: Fixed Top/Bottom Menus + Content Blocks (Admin-driven)"},{"body":"V05-I05.9 ‚Äî Delivery: Dashboard + Notification/Email + Follow-up Sequences (MVP)\n\nTitle\nV05-I05.9 ‚Äî Delivery MVP: Dashboard + Notifications/Email + Follow-up Sequences (status-driven, consent-aware)\n\nKontext\nNach PDF/Approval braucht es Zustellung: Patient/Clinician sehen Status, erhalten Benachrichtigungen, und es gibt einen minimalen Follow-up Mechanismus (z. B. ‚Äúreport ready‚Äù, ‚Äúreview requested‚Äù, ‚Äúaction recommended‚Äù). Zustellung darf nicht ‚Äúblind‚Äù sein: RBAC/Consent muss respektiert werden; Telemetry/Logging PHI-frei.\n\nZiel\n\nDelivery Status pro Processing Job und ein MVP Dashboard (mindestens Clinician/Admin; Patient optional je nach existierendem UI).\n\nNotification Mechanismus: Email/Notification nur wenn bereits Infrastruktur vorhanden und consent/regeln existieren. Sonst MVP als ‚Äúin-app status‚Äù.\n\nScope\n\nDelivery State Machine (versioniert): NOT_READY ‚Üí READY ‚Üí DELIVERED (‚Üí optional FAILED).\n\nDashboard: list der Jobs/Reports mit Status, last update, actions (download via signed url).\n\nNotifications:\n\nWenn Email infra vorhanden: send ‚ÄúReport ready‚Äù an definierte Empf√§nger nach existierendem Contract.\n\nWenn nicht vorhanden: create placeholder ‚Äúnotification record‚Äù im System (kein externer Versand).\n\nFollow-up sequences (MVP): minimaler scheduler/trigger basierend auf Status + timestamps (ohne neue Plattform, wenn nicht vorhanden).\n\nAcceptance Criteria\n\nStatus-driven: Delivery basiert ausschlie√ülich auf pipeline status (approved + pdf ready).\n\nRBAC/Ownership: dashboard/list ist rollenbasiert und restrictet; download links nur berechtigt.\n\nConsent-aware: wenn Consent/Prefs im Repo existieren, werden sie respected; wenn nicht, default fail-closed (kein Email-Versand).\n\nNo PHI: notifications/logs enthalten keine sensitiven Inhalte; nur referenzierte IDs + redacted display fields.\n\nIdempotent delivery: mehrfacher trigger ‚Üí kein mehrfacher Versand / keine Duplikate.\n\nTests + Build gr√ºn.\n\nTasks\n\n Delivery schema v1 definieren.\n\n DB records f√ºr delivery status/notifications (nach DB_SCHEMA_MANIFEST).\n\n Dashboard API + minimal UI page (falls UI im Scope).\n\n Notification adapter (email vs in-app record) gem√§√ü vorhandener Infrastruktur.\n\n Follow-up scheduling policy (deterministisch, minimal): z. B. ‚Äúafter X days if not viewed‚Äù nur wenn view-tracking existiert; sonst weglassen.\n\n Tests: RBAC, consent gating, idempotent send, status transitions.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n\n\nDoD\n\nReports haben einen klaren Delivery-Status, sind im Dashboard sichtbar, und ‚Äúready‚Äù f√ºhrt zu einer sicheren Zustellung (mindestens in-app, optional email wenn erlaubt).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":374,"state":"CLOSED","title":"V05-I05.9 ‚Äî Delivery: Dashboard + Notification/Email + Follow-up Sequences (MVP)"},{"body":"V05-I05.8 ‚Äî PDF Assembly (HTML ‚Üí PDF) + Signed URLs + Storage\n\nTitle\nV05-I05.8 ‚Äî PDF Assembly: HTML ‚Üí PDF + Signed URLs + Storage (secure, deterministic, redacted metadata)\n\nKontext\nDer pipeline output muss als PDF bereitgestellt werden (Report). PDF-Erstellung ist h√§ufig fehleranf√§llig (rendering, storage, signing) und muss sicher sein (keine offenen Buckets, keine PHI in URLs/paths).\n\nZiel\n\nErzeuge PDF aus HTML (oder Template) deterministisch.\n\nSpeichere PDF in Storage nach Repo-Standard (Supabase storage / S3 / etc. ‚Äì nur vorhandene Infrastruktur nutzen).\n\nLiefere Signed URL(s) f√ºr Download, zeitlich begrenzt.\n\nScope\n\nHTML Rendering: aus ReportSections + final approvals (I05.7) ein HTML Document erstellen (server-side).\n\nPDF Generation: nutze bestehende, bereits verwendete PDF tooling im Repo; wenn neu, minimal und dokumentiert.\n\nStorage:\n\nPfad/Key ohne personenbezogene Daten (keine emails, keine patientId im Klartext).\n\nMetadaten redacted.\n\nSigned URL issuance: nur f√ºr berechtigte Rollen/Owner; expiry konfigurierbar.\n\nAcceptance Criteria\n\nDeterministischer Output: gleiches approved input ‚Üí gleiche PDF bytes (oder zumindest stabiler hash innerhalb tolerierter non-determinism; muss dokumentiert sein).\n\nSecure Storage: Objekt ist nicht public; Zugriff nur via signed URLs.\n\nNo PHI in paths: storage keys enthalten keine direkten Identifiers.\n\nRBAC/Ownership: Patient bekommt nur eigene PDFs; Clinician nur berechtigte F√§lle.\n\nFailure handling: wenn PDF generation fails ‚Üí klare stage FAILED, kein partial publish.\n\nTests + Build gr√ºn (mindestens unit tests f√ºr key generation + signing policy + HTML render schema).\n\nTasks\n\n HTML template + renderer implementieren (strict schema).\n\n PDF generator integrieren (repo-konform).\n\n Storage adapter implementieren (upload + signed url).\n\n Key policy definieren (PHI-free).\n\n API endpoints: get signed url (auth+ownership).\n\n Tests: key policy, signed url gating, renderer schema validation.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n\n\nDoD\n\nPDF wird erzeugt, gespeichert, und kann berechtigt via signed URL abgerufen werden (ohne PHI leaks).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":373,"state":"CLOSED","title":"V05-I05.8 ‚Äî PDF Assembly (HTML ‚Üí PDF) + Signed URLs + Storage"},{"body":"V05-I05.7 ‚Äî Review Queue (alle flagged + Sampling) + Approve/Reject\n\nTitle\nV05-I05.7 ‚Äî Review Queue: flagged items + deterministic sampling, Approve/Reject workflow (RBAC, audit trail)\n\nKontext\nMedical QA ben√∂tigt eine Review Queue: alle flagged Jobs (aus I05.5/I05.6) plus ein Sampling-Anteil (Qualit√§tssicherung). Review Aktionen m√ºssen auditierbar sein und RBAC-respektierend (Clinician/Admin, ggf. Nurse nur read/triage je nach existierender Policy).\n\nZiel\n\nQueue-Mechanismus + minimaler Review State: PENDING, APPROVED, REJECTED, CHANGES_REQUESTED (nur wenn mit bestehenden State Patterns kompatibel).\n\nAudit trail f√ºr Entscheidungen (wer, wann, warum-code, keine PHI).\n\nScope\n\nPersistenz eines Review Records pro Job (idempotent).\n\nDeterministic Sampling: definierte Regel (z. B. N% oder 1-of-K) basierend auf stable hash (jobId/correlationId), nicht random pro Request.\n\nAPI Endpoints:\n\nlist queue (RBAC)\n\nget review details (redacted)\n\napprove/reject (write, RBAC before write)\n\nStatuscodes strikt (401/403/404/422).\n\nAcceptance Criteria\n\nQueue enth√§lt: alle FLAG/BLOCK + sampled PASS F√§lle (deterministisch).\n\nRBAC: nur erlaubte Rollen d√ºrfen approve/reject; unauthorized ‚Üí 403.\n\nAudit trail: Decision record speichert reviewer identity reference (ohne PHI), timestamps, decision, reason codes.\n\nNo PHI: Queue/List responses sind redacted; keine raw answers.\n\nIdempotent writes: approve/reject doppelt senden ‚Üí kein inkonsistenter Zustand.\n\nTests + Build gr√ºn.\n\nTasks\n\n Review schema v1 definieren.\n\n DB migration (nach SOT) f√ºr review records.\n\n Deterministic sampling function implementieren (stable hash).\n\n API routes implementieren (list/get/decide).\n\n Tests: RBAC, idempotency, sampling determinism, status codes.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n\n\nDoD\n\nReview Queue ist funktionsf√§hig, sicher, deterministisch, und kann sp√§tere UI/Delivery steuern.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":372,"state":"CLOSED","title":"V05-I05.7 ‚Äî Review Queue (alle flagged + Sampling) + Approve/Reject"},{"body":"V05-I05.6 ‚Äî Medical Validation Layer 2 (AI self-check ‚Üí safety_score)\n\nTitle\nV05-I05.6 ‚Äî Medical Validation Layer 2: AI self-check ‚Üí safety_score (guardrailed, PHI-free, auditable)\n\nKontext\nZus√§tzlich zu Regeln braucht es eine zweite QA-Schicht: ein LLM-basierter Self-Check (‚Äúis this safe, consistent, non-harmful?‚Äù). Dieser Layer muss streng guardrailed sein (keine Diagnosen), PHI-frei, und auditierbar (prompt+version+score gespeichert).\n\nZiel\n\nErzeuge einen safety_score + structured findings aus Sections Drafts.\n\nErgebnis steuert Review/Sampling (I05.7).\n\nScope\n\nSelf-check Prompt(s) versioniert (reuse Prompt Versioning aus I05.4).\n\nInputs: ausschlie√ülich redacted Sections (keine patient identifiers, keine raw answers).\n\nOutputs: SafetyCheckV1 (score, severity, reasons, recommended action: PASS/FLAG/BLOCK).\n\nLogging: nur structured outputs, keine raw completions speichern, au√üer repo-policy erlaubt und PHI-sicher (default: minimal).\n\nAcceptance Criteria\n\nPHI-frei: Prompt/Inputs enthalten keine Identifiers; Outputs enthalten keine PHI.\n\nVersionierung: promptVersion + model config reference wird gespeichert.\n\nGuardrails: Self-check ist strikt ‚Äúsafety assessment‚Äù, keine Diagnosen, keine neuen Empfehlungen generieren.\n\nDeterministische Speicherung: gleicher content + gleiche promptVersion ‚Üí stable evaluation record (idempotent record, nicht unbounded duplicates).\n\nFail-closed: wenn self-check nicht verf√ºgbar ‚Üí Ergebnis ‚ÄúUNKNOWN‚Äù und Review required (nicht ‚ÄúPASS‚Äù).\n\nTests + Build gr√ºn.\n\nTasks\n\n SafetyCheckV1 Schema definieren + validator.\n\n Prompt(s) implementieren (versioned).\n\n Execution: LLM client gem√§√ü Repo-Konfiguration verwenden (keine neuen Provider-Namen).\n\n Persistenz + stage transition: PASS ‚Üí next stage, FLAG/BLOCK ‚Üí Review queue.\n\n Tests: schema validation, fail-closed, prompt version recorded.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n\n\nDoD\n\nLayer 2 liefert einen auditierbaren safety_score, steuert Review deterministisch, und ist PHI-sicher.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWrwg","name":"agent","description":"","color":"ededed"}],"number":371,"state":"CLOSED","title":"V05-I05.6 ‚Äî Medical Validation Layer 2 (AI self-check ‚Üí safety_score)"},{"body":"V05-I05.5 ‚Äî Medical Validation Layer 1 (rules: contraindications/plausibility)\n\nTitle\nV05-I05.5 ‚Äî Medical Validation Layer 1: rules-based checks (contraindications/plausibility), fail-closed flags\n\nKontext\nVor Review/PDF m√ºssen Inhalte und Empfehlungen durch eine erste, regelbasierte medizinische Plausibilit√§ts- und Contraindication-Schicht laufen. Das ist deterministic, testbar und ‚Äúfail-closed‚Äù: problematische Inhalte werden geflaggt oder blockieren.\n\nZiel\n\nImplementiere MedicalValidationV1 Layer 1, der auf Regeln arbeitet (keine LLM).\n\nOutput: flags, severity, reasons (coded), und ein ‚Äúpass/fail‚Äù pro section + overall.\n\nScope\n\nValidation Rules als SOT (files/registry/db) gem√§√ü bestehender Repo-Konvention (keine Fantasie-Rule-Engine).\n\nChecks (minimal, aber strukturiert):\n\nContraindication conflicts (z. B. recommendation vs risk signals) ‚Äì als rule references, nicht als freie medizinische Behauptungen\n\nPlausibility: widerspr√ºchliche Aussagen / out-of-bound claims (pattern-based)\n\nErgebnis wird persisted und beeinflusst Status:\n\nCritical ‚Üí job stage flagged, Review required.\n\nAcceptance Criteria\n\nDeterministisch: gleiche Inputs ‚Üí gleiche Flags.\n\nVersioniert: Validation Rules/Engine version wird im Output gespeichert.\n\nFail-closed: unknown rule keys / missing rule set ‚Üí validation FAIL mit klarer error (keine ‚Äúpass by default‚Äù).\n\nNo PHI: flags enthalten keine patient identifiers; nur references (jobId, sectionKey, ruleId).\n\nTests + Build gr√ºn.\n\nTasks\n\n MedicalValidationResultV1 Schema definieren.\n\n Rule storage implementieren (align mit Repo).\n\n Rule evaluation implementieren.\n\n Persistenz + stage transition: PASS ‚Üí next stage, FAIL/FLAG ‚Üí Review queue (I05.7).\n\n Tests: rule fixtures, fail-closed behavior.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n\n\nDoD\n\nLayer 1 produziert reproduzierbare Flags und blockiert/flaggt korrekt f√ºr Review.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWrwg","name":"agent","description":"","color":"ededed"}],"number":370,"state":"CLOSED","title":"V05-I05.5 ‚Äî Medical Validation Layer 1 (rules:  contraindications/plausibility)"},{"body":"V05-I05.4 ‚Äî Content Generation: modulare Sections + Prompt Versioning\n\nTitle\nV05-I05.4 ‚Äî Content Generation: modulare Sections + Prompt Versioning (contract-first, no fantasy)\n\nKontext\nDer Report braucht strukturierte, modulare Sections (z. B. Overview, Findings, Recommendations), generiert aus Ranking/Risk und manifestierten Inputs. Prompts m√ºssen versioniert sein, damit Content reproduzierbar und reviewbar ist.\n\nZiel\n\nDefiniere ein Sections-Modell (Contract) und eine Prompt-Versionierung (SOT).\n\nGeneriere Section Drafts (LLM oder templated), aber strikt ‚Äúguardrailed‚Äù: keine neuen medizinischen Behauptungen ohne Quellen/Constraints.\n\nScope\n\nReportSectionsV1 Schema: array von Sections mit sectionKey, inputs, draft, citations/refs (nur interne refs), promptVersion.\n\nPrompt Registry (versioniert):\n\nSpeicherung als files oder DB, abh√§ngig von bestehender Repo-Policy (keine neue Plattform).\n\nJede Generierung speichert promptId + promptVersion + model config reference (nur wenn bereits im Repo konfiguriert).\n\nRedaction: keinerlei PHI in prompts (nur abgeleitete, coded signals).\n\nNicht-Ziele\n\nKein finaler PDF Output (I05.8).\n\nKein Review UI (I05.7).\n\nAcceptance Criteria\n\nPrompt Versioning: jede Generation referenziert eine konkrete prompt version (immutable).\n\nNo PHI: prompts enthalten nur allowlisted derived data (codes/scores), keine rohen Antworten/Freitext.\n\nNo fantasy medical claims: generierter Text muss an Constraints gebunden sein (z. B. ‚Äúinformational, not diagnosis‚Äù, rule-based boundaries).\n\nDeterministische Inputs: Section inputs stammen ausschlie√ülich aus RiskBundle/Ranking + tier + funnel_version references.\n\nRetry behavior: bei LLM failure klare Fehlerpfade, keine silent partials.\n\nTests + Build gr√ºn.\n\nTasks\n\n Sections schema v1 definieren + validator.\n\n Prompt storage entscheiden anhand Repo-Praxis (Docs/Registry/DB); implementieren ohne neue Fantasie-Strukturen.\n\n Generator implementieren: generateSections(jobContext) (guardrailed).\n\n Persistenz: sections drafts speichern pro jobId + prompt versions.\n\n Tests: prompt version recorded; PHI redaction; schema validation.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n\n\nDoD\n\nPipeline kann modulare Section Drafts erzeugen, versioniert speichern, ohne PHI und mit klarer Guardrail-Policy.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWrwg","name":"agent","description":"","color":"ededed"}],"number":369,"state":"CLOSED","title":"V05-I05.4 ‚Äî Content Generation: modulare Sections + Prompt Versioning"},{"body":"V05-I05.3 ‚Äî Priority Ranking (Impact √ó Feasibility) + Top-Interventions\n\nTitle\nV05-I05.3 ‚Äî Priority Ranking (Impact √ó Feasibility) + Top-Interventions (deterministisch, nachvollziehbar)\n\nKontext\nNach der Risikoberechnung braucht der Report eine priorisierte Auswahl: welche Themen/Interventionen zuerst. Das Ranking muss nachvollziehbar, deterministic und regelbasiert sein (kein LLM), damit Medical QA sp√§ter pr√ºfen kann.\n\nZiel\n\nErzeuge ein PriorityRankingV1 aus RiskBundleV1 + (falls vorhanden) program tier constraints.\n\nLiefere ‚ÄúTop Interventions‚Äù als strukturierte Liste (ohne neue Fantasie-Interventionsnamen: ausschlie√ülich aus vorhandenen Content/Registry Quellen oder neutralen placeholders, die sp√§ter durch Content Gen ersetzt werden).\n\nScope\n\nRanking-Algorithmus (deterministisch) mit Score-Komponenten: Impact, Feasibility (jeweils numerisch + Begr√ºndung).\n\nOutput Contract (versioniert) inkl. ‚Äúwhy‚Äù Felder als strukturierte Codes (kein Freitext erforderlich).\n\nPersistenz an Job gekoppelt.\n\nNicht-Ziele\n\nKein endg√ºltiger Text-Content (kommt I05.4).\n\nKeine UI, au√üer optional debug read.\n\nAcceptance Criteria\n\nDeterminismus: Ranking ist reproduzierbar (Snapshot/fixture).\n\nExplainability: Jede Top-Item Entscheidung enth√§lt: input signals (codes), partial scores, final score.\n\nNo fantasy: Items referenzieren existierende Registry IDs/Slugs/Content keys ‚Äì oder sind generische ‚Äútopics‚Äù ohne erfundene medizinische Inhalte.\n\nTier constraints: Wenn program tier existiert, wird Ranking korrekt gefiltert/gewichtet (nur nach validiertem Contract).\n\nTests + Build gr√ºn.\n\nTasks\n\n Contract PriorityRankingV1 definieren.\n\n Ranking function implementieren: rankInterventions(riskBundle, tier?).\n\n Mapping von Risk Signals ‚Üí Candidate topics (aus Registry/Manifest/Content keys).\n\n Persistenz hinzuf√ºgen.\n\n Tests: determinism + explainability + tier filtering.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n\n\nDoD\n\nPipeline kann nach Risk Bundle ein Ranking erzeugen, speichern, und sp√§ter f√ºr Content/QA nutzen.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWrwg","name":"agent","description":"","color":"ededed"}],"number":368,"state":"CLOSED","title":"V05-I05.3 ‚Äî Priority Ranking (Impact x Feasibility) + Top-Interventions"},{"body":"V05-I05.2 ‚Äî Risk Calculation Bundle (deterministisch, versioniert, getestet)\n\nTitle\nV05-I05.2 ‚Äî Risk Calculation Bundle (deterministisch, versioniert, getestet)\n\nKontext\nDie Pipeline ben√∂tigt eine deterministische Risikoberechnung als Grundlage f√ºr Ranking/Interventionen und QA. Diese Berechnung muss versioniert sein (damit Re-Processing reproduzierbar ist) und streng testen/validieren.\n\nZiel\n\nEin ‚ÄúRisk Bundle‚Äù (Contract) wird aus Assessment Answers + Registry/Manifest berechnet.\n\nDas Bundle ist reproduzierbar und tr√§gt eine riskBundleVersion (und ggf. references auf registry/funnel_version).\n\nScope\n\nDefinition eines versionierten Risk-Bundle Schemas (z. B. RiskBundleV1).\n\nDeterministische Berechnung: nur aus erlaubten Inputs (Answers, scoring rules aus Registry/Manifest), kein LLM.\n\nPersistenz: Risk Bundle wird einem Processing Job zugeordnet (JobId/AssessmentId).\n\nValidierung: unknown operator/type/rule ‚Üí fail-closed (422/processing FAILED).\n\nNicht-Ziele\n\nKeine medizinische ‚ÄúInterpretation‚Äù durch LLM (kommt sp√§ter in Content/Validation).\n\nKein UI, au√üer minimalen Debug-Read endpoint falls bereits Pattern existiert.\n\nAcceptance Criteria\n\nVersionierung: Risk Bundle enth√§lt eine klare Version + references auf Input-Versionen (mindestens funnel_version/registry identifiers, sofern vorhanden).\n\nDeterminismus: gleicher Input ‚Üí exakt gleicher Output (Snapshot-Test oder Hash).\n\nFail-closed: unknown/unsupported rule/operator/type ‚Üí kein Partial Output; klarer Fehlerpfad.\n\nPersistenz: Output ist gespeichert und einem Job zugeordnet; Re-Processing kann vorhandenes Bundle wiederverwenden (idempotent oder overwrite mit neuer version ‚Äì klar definiert).\n\nPHI-frei: Bundle enth√§lt keine rohen Freitextantworten, sofern nicht zwingend im Assessment enthalten; wenn Freitext existiert, dann nur redacted/derived (Policy).\n\nTests + Build gr√ºn.\n\nTasks\n\n Contract RiskBundleV1 (Schema + JSON representation) definieren.\n\n Calculator implementieren (pure function): computeRiskBundle(input).\n\n Input mapping aus Assessment Answers (aus vorhandener Answer-Struktur) ableiten.\n\n Persistenz-Layer: speichern/lesen pro jobId.\n\n Tests:\n\ngolden fixtures (determinism)\n\nfail-closed f√ºr unknown rules\n\nregression tests f√ºr boundary conditions\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n\n\nDoD\n\nRisk Bundle wird im Orchestrator-Flow als Stage berechnet und persisted.\n\nDeterminism + versioning + strict validation sind test-evident.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWrwg","name":"agent","description":"","color":"ededed"}],"number":367,"state":"CLOSED","title":"V05-I05.2 ‚Äî Risk Calculation Bundle (deterministisch, versioniert, getestet)"},{"body":"V05-I05.1 ‚Äî Processing Orchestrator (job/edge function) + Status Tracking\n\nTitle\nV05-I05.1 ‚Äî Processing Orchestrator (job/edge function) + Status Tracking (funnel-unabh√§ngig, deterministisch, idempotent)\n\nKontext\nNach I03.x (Assessment/Save/Resume) braucht der Walking Skeleton einen verl√§sslichen ‚ÄúProcessing‚Äù-Pfad: aus einem abgeschlossenen Assessment wird ein verarbeitbarer Job, der deterministisch durch definierte Stages l√§uft (Risk ‚Üí Ranking ‚Üí Content ‚Üí Validation ‚Üí Review ‚Üí PDF ‚Üí Delivery). Daf√ºr ist ein Orchestrator + Status Tracking notwendig, funnel-unabh√§ngig und evidence-first.\n\nZiel\n\nEin Orchestrator, der Processing-Jobs erstellt, ausf√ºhrt (synchron/async je nach bestehender Infrastruktur) und ihren Status nachvollziehbar persistiert.\n\nEin Statusmodell, das UI/Clinician/Admin sp√§ter auslesen kann (ohne PHI-Leaks).\n\nScope\n\nProcessing Job Contract (versioniert)\n\nDefiniere ein versioniertes Schema (z. B. ProcessingJobV1, ProcessingStatusV1) in lib/schemas/... (Zod o. √§.).\n\nMinimale Felder (ohne Fantasie): jobId, assessmentId, createdAt, updatedAt, status, stage, attempt, correlationId, errors[] (redacted).\n\nKeine patient-identifizierenden Daten im Job-Payload, au√üer wenn bereits im DB-Schema zwingend vorgesehen (dann redaction/allowlist).\n\nOrchestrator Entry\n\nImplementiere einen Startpunkt (API route / edge function / server action) nur auf Basis vorhandener Architektur im Repo (keine neuen Plattformannahmen).\n\nStarten eines Jobs ist idempotent (gleicher assessmentId + correlationId ‚Üí kein Duplikat).\n\nStatus Tracking\n\nPersistiere Status√§nderungen (inkl. stage transitions) in DB gem√§√ü bestehender Migrations-/Schema-Konventionen (DB_SCHEMA_MANIFEST als SOT).\n\nStatus ist deterministisch: gleiche Inputs ‚Üí gleiche Stage-Reihenfolge; Retries sind begrenzt und nachvollziehbar.\n\nNicht-Ziele\n\nNoch kein kompletter Content/Risk/PDF Output (das kommt in I05.2‚ÄìI05.9).\n\nKeine neue Observability-Plattform; nur das minimale Tracking, das sp√§ter genutzt wird.\n\nAcceptance Criteria\n\nIdempotenz: Starten desselben Jobs (identische Inputs) erzeugt keine Duplikate; es wird derselbe Job referenziert oder sauber abgewiesen (422/409 je nach bestehender Semantik).\n\nDeterministische Stages: Stage-Mapping ist als Enum/Registry definiert; unbekannte Stage ‚Üí fail-closed.\n\nStatus Persistenz: Jobs und Status√§nderungen sind persistent und querybar (f√ºr sp√§tere Dashboards).\n\nPHI-frei: Job-Logs/Errors enthalten keine Request-Bodies, keine Freitexteingaben, keine Identifiers au√üerhalb allowlist.\n\nAuth/RBAC:\n\nPatient darf nur eigene Jobs triggern/sehen (Ownership .eq(...)).\n\nClinician/Admin Zugriff nur √ºber existierende RBAC-Mechanik.\n\nHTTP Semantik:\n\nMissing assessment/resource ‚Üí 404\n\ninvalid state (z. B. assessment nicht abgeschlossen) ‚Üí 422\n\nunauth ‚Üí 401, forbidden ‚Üí 403\n\nTests + Build gr√ºn.\n\nTasks\n\n Vorhandene Muster finden: Jobs/Queues/Edge Functions/Background Processing im Repo (ohne neue Annahmen).\n\n ProcessingJob + ProcessingStatus Schema v1 implementieren (versioniert).\n\n DB: Tabelle(n) / Spalten / Indizes √ºber Migration anlegen (Name/Struktur strikt nach DB_SCHEMA_MANIFEST + bestehendem Naming).\n\n API/Function: startProcessing(assessmentId, correlationId?) implementieren (idempotent).\n\n Status transitions + retry policy minimal (z. B. attempt++, lastError redacted).\n\n Tests: idempotency, ownership gating, status transitions, schema validation.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\n\n\nOptional (nur falls im Repo vorhanden):\n\nnpm run db:access-verify\n\n\nDoD\n\nEin Processing Job kann erstellt werden und besitzt persisted Status/Stage.\n\nIdempotenz, Auth/RBAC, PHI-freie Errors, Statuscodes sind getestet.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWoow","name":"architecture","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":366,"state":"CLOSED","title":"V05-I05.1 ‚Äî Processing Orchestrator (job/edge function) + Status Tracking"},{"body":"**Intent:** Gemeinsamer Workflow:  Scores ‚Üí Ranking ‚Üí Report Sections ‚Üí Safety L1/L2 ‚Üí Review ‚Üí PDF ‚Üí Delivery.\n\n**Sub-Issues:**\n- [ ] V05-I05.1 ‚Äî Processing Orchestrator (job/edge function) + Status Tracking\n- [ ] V05-I05.2 ‚Äî Risk Calculation Bundle (deterministisch, versioniert, getestet)\n- [ ] V05-I05.3 ‚Äî Priority Ranking (Impact x Feasibility) + Top-Interventions\n- [ ] V05-I05.4 ‚Äî Content Generation:  modulare Sections + Prompt Versioning\n- [ ] V05-I05.5 ‚Äî Medical Validation Layer 1 (rules:  contraindications/plausibility)\n- [ ] V05-I05.6 ‚Äî Medical Validation Layer 2 (AI self-check ‚Üí safety_score)\n- [ ] V05-I05.7 ‚Äî Review Queue (alle flagged + Sampling) + Approve/Reject\n- [ ] V05-I05.8 ‚Äî PDF Assembly (HTML ‚Üí PDF) + Signed URLs + Storage\n- [ ] V05-I05.9 ‚Äî Delivery: Dashboard + Notification/Email + Follow-up Sequences (MVP)","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWrwg","name":"agent","description":"","color":"ededed"}],"number":365,"state":"CLOSED","title":"EPIC V05-E05 ‚Äî Processing Pipeline + Medical QA + PDF + Delivery (funnel-unabh√§ngig)"},{"body":"V05-I04.3 ‚Äî Confirmation UI (Patient best√§tigt/korrigiert extrahierte Werte) (#364)\nGH Issue Text\n\nGoal\nPatient can review extracted values, see confidence, and confirm/correct them. Confirmations are persisted and become the canonical ‚Äúpatient-confirmed‚Äù dataset for downstream reporting.\n\nScope\n\nPatient UI page(s) to review extraction results per document.\n\nConfidence-aware UX:\n\nhighlight low-confidence fields\n\nallow correction with validation\n\nPersist confirmation:\n\nconfirmed_json + per-field status (accepted/edited/rejected)\n\naudit event (PHI-free)\n\nDownstream APIs return confirmed values preferentially (if present), otherwise extracted values (explicitly marked).\n\nAcceptance Criteria\n\nPatient can open a ‚ÄúReview extracted values‚Äù screen for a document with extraction results.\n\nFields are grouped per existing contracts (no new categories); low-confidence is visually flagged.\n\nPatient actions:\n\nAccept all\n\nEdit individual fields\n\nMark ‚Äúnot applicable/unknown‚Äù where supported by contracts\n\nPersisted deterministically and idempotently:\n\nre-opening shows previous confirmations\n\nsaving twice doesn‚Äôt create duplicates\n\nSecurity:\n\nRLS ensures user can only see/confirm their own documents\n\nserver-only save action\n\nTests: UI integration (basic), server action validation, idempotent persistence, auth gating.\n\nTasks\n\nLocate extraction result schema from I04.2 and map to confirmation model.\n\nImplement patient route + client component rendering fields based on contracts.\n\nImplement server action/API for saving confirmation with validation.\n\nAdd docs + PowerShell verification.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\nnpm run db:reset\nnpm run db:diff\nnpm run db:typegen","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":364,"state":"CLOSED","title":"V05-I04.3 ‚Äî Confirmation UI (Patient best√§tigt/korrigiert extrahierte Werte)"},{"body":"V05-I04.2 ‚Äî AI Extraction Pipeline + Confidence Metadata (#363)\nGH Issue Text\n\nGoal\nGiven an uploaded & parsed document, run an AI extraction pipeline that writes structured extracted values plus per-field confidence metadata, deterministically versioned.\n\nScope\n\nPipeline trigger (manual/API) for a given document_id (or canonical doc reference).\n\nExtraction result persisted with:\n\nextractor_version (versioned)\n\ninput_hash (deterministic; same input ‚Üí same output idempotent behavior)\n\nextracted_json (structured)\n\nconfidence_json (per-field confidence + evidence pointers that are PHI-safe)\n\nIdempotency: same document + same extractor_version + same input_hash must not create duplicates.\n\nNo patient confirmation UI yet (that is I04.3).\n\nAcceptance Criteria\n\nExtraction pipeline can be triggered for a document in PARSED state; other states ‚Üí 409/422 (deterministic errors).\n\nWrites extraction result + confidence metadata to DB; idempotent upsert by (document_id, extractor_version, input_hash) (or existing canonical constraint).\n\nExtractor is versioned and must be referenced via registry/contracts (no free strings).\n\nPHI-safe logs + audit events: requestId, document_id (UUID), versions, status; no document text in logs.\n\nTests: invalid states, idempotency, schema validation, auth gating.\n\nTasks\n\nLocate existing AMY/LLM extraction utilities + contracts (no new DSL).\n\nDefine/confirm canonical extraction result schema (Zod + DB).\n\nImplement orchestrator route/action:\n\nfetch parsed payload (existing storage/table)\n\ncompute input_hash\n\nrun extractor (LLM) with deterministic prompt versioning\n\npersist results idempotently\n\nAdd docs + PowerShell verification.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\nnpm run db:reset\nnpm run db:diff\nnpm run db:typegen","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWrwg","name":"agent","description":"","color":"ededed"}],"number":363,"state":"CLOSED","title":"V05-I04.2 ‚Äî AI Extraction Pipeline + Confidence Metadata"},{"body":"V05-I04.1 ‚Äî Document Upload (Storage) + Typisierung + Parsing Status (#362)\nGH Issue Text\n\nGoal\nPatient can upload a document, it is stored securely, recorded in DB with typed metadata, and a deterministic parsing status is tracked end-to-end.\n\nScope\n\nUpload UI (patient) + API route(s) for upload initiation/completion.\n\nSupabase Storage (private bucket) + DB record for each upload.\n\nParsing status state machine (e.g. UPLOADED ‚Üí PARSING ‚Üí PARSED ‚Üí FAILED) stored in DB.\n\nNo PDF parsing/extraction logic here beyond status + placeholder hook (that is I04.2).\n\nAcceptance Criteria\n\nPatient can upload a PDF (or allowed mime types) and sees an upload success state.\n\nFile ends up in private Supabase Storage; no public bucket access; signed URLs only (if needed for preview/download).\n\nDB record exists for each upload with:\n\nuser ownership (RLS-safe)\n\nstorage path + original filename + mime + size\n\ndeterministic parsing_status\n\nStatus transitions are deterministic and auditable; failures are recorded without leaking PHI.\n\nNo new ‚Äúfantasy‚Äù table/enum/keys:\n\nUse only objects from DB_SCHEMA_MANIFEST / existing migrations / registry.\n\nIf missing: add migration + update schema manifest + tests (migration-first).\n\nTests cover: auth gating, RLS scoping, allowed file types, DB record creation, status transitions.\n\nTasks\n\nInspect DB_SCHEMA_MANIFEST and current schema to find existing doc tables/status enums.\n\nImplement server-only upload endpoint(s):\n\nvalidate session (401) and user scope (RLS)\n\nvalidate mime/size allowlist\n\ncreate storage object + DB record\n\nImplement status update helper (server-only) with allowed transitions.\n\nAdd docs: how to verify locally, PowerShell-only.\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\nnpm run db:reset\nnpm run db:diff\nnpm run db:typegen","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":362,"state":"CLOSED","title":"V05-I04.1 ‚Äî Document Upload (Storage) + Typisierung + Parsing Status"},{"body":"**Intent:** Upload ‚Üí (optional OCR) ‚Üí AI Extraction ‚Üí Patient best√§tigt/korrigiert ‚Üí bessere Genauigkeit.\n\n**Sub-Issues:**\n- [ ] V05-I04.1 ‚Äî Document Upload (Storage) + Typisierung + Parsing Status\n- [ ] V05-I04.2 ‚Äî AI Extraction Pipeline + Confidence Metadata\n- [ ] V05-I04.3 ‚Äî Confirmation UI (Patient best√§tigt/korrigiert extrahierte Werte)","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWrwg","name":"agent","description":"","color":"ededed"}],"number":361,"state":"CLOSED","title":"EPIC V05-E04 ‚Äî Document Upload + Extraction + Patient Confirmation (optional)"},{"body":"Du bist mein VS Code GitHub Copilot. Implementiere Issue #360 (V05-I03.4) in minimalem Diff.\n\nHard Rules:\n- Keine Fantasie-Namen: Reports/Results/Outcomes nur aus DB_SCHEMA_MANIFEST + bestehenden Contracts. Wenn nicht vorhanden: STOP und schlage migration-first oder eine ‚Äúread-only placeholder‚Äù UI mit empty state vor (ohne neue Tabellen).\n- Version Binding: nutze die bestehenden version fields (algorithm_bundle_version, prompt_version etc.) wie im aktuellen Contract.\n- Evidence-first + PowerShell Verify.\n\nZiel:\n- Result Screen im Patient Flow:\n  - Report Library (list + open/download per existing pattern)\n  - Key Outcomes (summary)\n  - Initial Tasks nur wenn manifest/content-getrieben bereits existiert\n  - Robust: empty states\n\nArbeitsauftrag:\n1) Finde bestehende Result/Report Speicherung + APIs (oder server queries) im Repo.\n2) Implementiere server loader/query: list reports + outcomes summary for current user and current run/funnel/version.\n3) Implementiere Results UI + navigation from questionnaire completion.\n4) Add tests: server query + UI empty/non-empty rendering.\n\nDone Definition:\n- npm test/build/db gates gr√ºn.\n- UI Smoke: complete questionnaire ‚Üí results page with correct states.\n- Keine neuen schemas/keys ohne Manifest/Migration.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":360,"state":"CLOSED","title":"V05-I03.4 ‚Äî Result Screen: Report Library + Key Outcomes + initial Tasks"},{"body":"Du bist mein VS Code GitHub Copilot. Implementiere Issue #359 (V05-I03.3) in minimalem Diff.\n\nHard Rules:\n- Keine Fantasie-Namen: Persistenz nutzt ausschlie√ülich vorhandene Tabellen/Spalten aus DB_SCHEMA_MANIFEST/Contracts. Wenn etwas fehlt: STOP und lege migration-first (Migration + Manifest + Typegen + Tests) vor.\n- Upsert/Idempotenz ist Pflicht (keine Duplikate).\n- UI muss robuste loading/error/retry states haben.\n- PowerShell Verify.\n\nZiel:\n- Save/Resume f√ºr Questionnaire Runs + robuste States:\n  - Save answers deterministisch (upsert)\n  - Resume loads last saved state and rehydrates runner\n  - UI shows loading/error/retry; retry works\n\nArbeitsauftrag:\n1) Finde bestehende Persistenz-Modelle (assessment/run/answers) im DB schema manifest + code.\n2) Implementiere server handlers: saveAnswer(s) + loadRunState (latest for user/funnel/version).\n3) Integriere in runner: persist on Next (oder bestehendes Autosave Pattern), resume on entry.\n4) Add tests: server save/load + one retry/error scenario.\n\nDone Definition:\n- npm test/build/db gates gr√ºn.\n- UI Smoke: Answer 5 Qs ‚Üí reload ‚Üí resume; error ‚Üí retry works.\n- Keine neuen Entities ohne migration/manifest update.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":359,"state":"CLOSED","title":"V05-I03.3 ‚Äî Save/Resume + robuste States (loading/error/retry)"},{"body":"Du bist mein VS Code GitHub Copilot. Implementiere Issue #358 (V05-I03.2) in minimalem Diff.\n\nHard Rules:\n- Keine Fantasie-Namen: Question Types, Logic Keys, Step IDs ausschlie√ülich aus Registry/Contracts/DB_SCHEMA_MANIFEST.\n- Conditional Logic NICHT neu erfinden. Implementiere genau das, was die vorhandenen Zod Schemas/Contracts bereits ausdr√ºcken.\n- Server-only loader bleibt server-only; kein Import in Client.\n- Tests verpflichtend (logic + sequencing).\n\nZiel:\n- Manifest-driven Questionnaire Runner: Step/Question Rendering + Conditional Logic + Validation + Next/Back (ohne Persistenz).\n- Robust: Unknown question type => controlled error path.\n- Deterministisch: gleiche Antworten => gleiche Step-Sequenz.\n\nArbeitsauftrag:\n1) Finde die bestehenden Manifest/Questionnaire Contracts (Zod) und Registry der Question Types.\n2) Implementiere Runner UI + internal state machine (currentStep, answers, visibleSteps).\n3) Implementiere Conditional Logic Evaluation + Tests (mind. 5 F√§lle).\n4) Integriere in Patient Flow f√ºr einen vorhandenen Funnel (Pillar 4 Stress).\n\nDone Definition:\n- npm test/build/db gates gr√ºn.\n- UI Smoke: Stress Funnel Questionnaire durchlaufbar mit Branching.\n- Keine neuen Types/DSL.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":358,"state":"CLOSED","title":"V05-I03.2 ‚Äî Adaptive Questionnaire Engine (40‚Äì50 Fragen, Conditional Logic)"},{"body":"Issue #357 ‚Äî V05-I03.1 ‚Äî Onboarding/Consent + Baseline Profile\nGH Issue Text\n\nContext\n\nEpic: V05-E03 Patient Journey Core (#356)\n\nZiel: Walking-Skeleton Startpunkt f√ºr Patient Journey: Onboarding ‚Üí Consent ‚Üí Baseline Profile als Voraussetzung f√ºr Questionnaire Run.\n\nProblem\n\nEs fehlt ein konsistenter Einstieg, der (a) Consent erfasst und (b) ein minimales Baseline-Profil speichert, bevor ein manifest-driven Questionnaire gestartet wird.\n\nScope (In)\n\nOnboarding Flow (UI) mit:\n\nConsent Screen(s)\n\nBaseline Profile (minimales Set, nur aus bestehenden Contracts/Schema)\n\nPersistenz serverseitig (RLS-konform)\n\nWire-up an bestehenden Patient Flow / Routing (keine neue Navigation-Paradigmen erfinden)\n\nAudit Events f√ºr Consent + Profile Update (nur bestehende Audit-Mechanik)\n\nScope (Out)\n\nKein Clinician UI\n\nKeine neue Datenmodell-Erfindung ohne DB_SCHEMA_MANIFEST-Migration\n\nKein ‚Äúvollst√§ndiges‚Äù Profil ‚Äì nur baseline minimal\n\nAcceptance Criteria\n\n Patient kann Onboarding durchlaufen und Consent abgeben; Status wird persistiert (idempotent).\n\n Patient kann Baseline Profile speichern; Reload zeigt gespeicherte Werte.\n\n RLS: Patient sieht/√§ndert nur eigene Daten; keine Cross-User Reads.\n\n UI zeigt klare Validation Errors (client) und serverseitige Errors (ohne sensitive Details).\n\n Evidence: Commands + kurzer UI-Smoke (Screenshots optional).\n\nImplementation Tasks\n\n Vorhandene Contracts/Registry/DB_SCHEMA_MANIFEST pr√ºfen: Wo werden Consent/Baseline Profile gespeichert (bestehende Tabellen/Spalten nutzen).\n\n Falls Felder fehlen: Migration-first (neue Spalten/Constraints nur via Migration + Manifest Update + Tests).\n\n Server Actions / API Route: Upsert Consent + Upsert Baseline Profile (idempotent).\n\n UI Pages/Components f√ºr Consent + Baseline Profile (nur registrierte Labels/Keys).\n\n Tests: Zod/Contracts + Server handler tests (mind. happy path + RLS/unauthorized).\n\n Audit: Consent/Baseline Update erzeugt Audit Event (√ºber vorhandenes Audit-System; keine neuen Keys).\n\nVerify (PowerShell)\n\nnpm test\nnpm run build\nnpm run db:reset\nnpm run db:diff\nnpm run db:typegen\n# optional (wenn vorhanden): npm run lint\n\n\nUI Smoke (lokal):\n\n Patient Flow starten ‚Üí Onboarding/Consent ‚Üí Baseline Profile speichern ‚Üí Reload ‚Üí Werte vorhanden.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":357,"state":"CLOSED","title":"V05-I03.1 ‚Äî Onboarding/Consent + Baseline Profile"},{"body":"**Intent:** Standardpfad funnel-unabh√§ngig, parametrisiert durch Plugin-Definition.\n\n**Sub-Issues:**\n- [ ] V05-I03.1 ‚Äî Onboarding/Consent + Baseline Profile\n- [ ] V05-I03.2 ‚Äî Adaptive Questionnaire Engine (40‚Äì50 Fragen, Conditional Logic)\n- [ ] V05-I03.3 ‚Äî Save/Resume + robuste States (loading/error/retry)\n- [ ] V05-I03.4 ‚Äî Result Screen:  Report Library + Key Outcomes + initial Tasks","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"}],"number":356,"state":"CLOSED","title":"EPIC V05-E03 ‚Äî Patient Journey Core (Onboarding ‚Üí Questionnaire ‚Üí Save/Resume ‚Üí Results)"},{"body":"Du bist mein GitHub Copilot Implementation-Co-Pilot f√ºr RHYTHM ‚Äî Issue 523 (V05-I02.3):\n‚Äúv0.5 Funnel Set: 2‚Äì3 zus√§tzliche Funnels in den Katalog‚Äù.\n\nZiel\nErweitere den Funnel-Katalog um mindestens 2‚Äì3 zus√§tzliche Funnels (zus√§tzlich zum Stress/Resilienz Funnel), jeweils mit:\n- funnels_catalog entry (pillar, slug, title, description, duration, outcomes)\n- mind. 1 funnel_version (questionnaire_config stub + content_manifest stub)\n- algorithm_bundle_version + prompt_version gesetzt (Stub/Default ok)\nDiese Funnels sollen im Patient Catalog sichtbar und startbar sein (mind. bis Intro/Questionnaire stub).\n\nKandidaten (falls im Repo/Executive Summary vorgesehen)\n- 7.1 CV Age\n- 4.6 Post-AFib Ablation Optimization\n- 7.8 Women‚Äôs CV Longevity\nWenn bereits andere priorisierte Funnels existieren, nutze die ‚Äî aber keine Fantasie-Namen: nur aus Exec Summary/Contracts.\n\nArbeitsreihenfolge (strikt)\n1) Slug/Contracts festlegen\n- Definiere canonical slugs (kebab-case) und hinterlege sie in Registry/Contracts.\n- Ensure legacy alias mapping falls n√∂tig.\n\n2) Seed/Insert Mechanismus\n- Implementiere deterministisches Seed:\n  - Entweder Migration mit INSERTs (idempotent upsert via ON CONFLICT)\n  - oder ein seeds script (db:seed) ‚Äî aber deterministisch und CI-safe.\nBevorzugt: SQL migration mit idempotent inserts:\n  - INSERT INTO funnels_catalog ... ON CONFLICT (slug) DO UPDATE ...\n  - INSERT INTO funnel_versions ... ON CONFLICT (funnel_id, version) DO UPDATE ...\n\n3) Plugin stubs\n- questionnaire_config stub:\n  - 3‚Äì5 steps, wenige questions, placeholder text\n- content_manifest stub:\n  - intro page + 1‚Äì2 content pages placeholders\n- algorithm_bundle_version/prompt_version:\n  - set to ‚Äúv0.5.0‚Äù (oder repo standard) ‚Äî konsistent mit Versioning Contract.\n\n4) UI validation\n- Patient funnel catalog zeigt neue Funnels.\n- Clicking ‚ÄúStart‚Äù navigiert zur intro page und l√§dt manifest ohne Fehler.\n\n5) Tests & Evidence\n- Test: GET catalog returns the new slugs.\n- Test: loader resolves each new funnel manifest successfully (Zod passes).\n- PR commands (PowerShell): db reset/diff/typegen/test/build.\n\nAcceptance Criteria\n- 2‚Äì3 zus√§tzliche Funnels sind im Katalog sichtbar.\n- F√ºr jeden existiert mind. 1 funnel_version mit manifest stubs.\n- Slugs sind canonical und in Contracts/Registry dokumentiert.\n- Deterministische Seeds/Upserts, keine Duplikate.\n- Evidence in PR: API output + UI screenshot.\n\nDeliverables\n- Migration/Seed SQL\n- Manifest stubs (JSONB)\n- Registry/Contracts updates\n- Tests\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":355,"state":"CLOSED","title":"V05-I02.3 ‚Äî v0.5 Funnel Set:  Aufnahme 2‚Äì3 zus√§tzlicher Funnels in den Katalog"},{"body":"Du bist mein GitHub Copilot Implementation-Co-Pilot f√ºr RHYTHM ‚Äî Issue 522 (V05-I02.2):\n‚ÄúFunnel Plugin Manifest‚Äù.\n\nZiel\nDefiniere und implementiere ein versioniertes ‚ÄúPlugin Manifest‚Äù pro Funnel-Version:\n- questionnaire_config (JSONB): Steps/Questions/Logic\n- content_manifest (JSONB): Content Pages/Sections/Assets\n- algorithm bundle pointer: algorithm_bundle_version (string) + optional config jsonb\n- prompt_version (string) f√ºr content/report generation\nAlles muss in DB gespeichert und im Code typisiert/validiert sein.\n\nArbeitsreihenfolge (strikt)\n1) Contracts/Types\n- Lege TypeScript Schemas an (Zod empfohlen):\n  - FunnelQuestionnaireConfigSchema\n  - FunnelContentManifestSchema\n- Definiere minimale Pflichtfelder:\n  Questionnaire:\n    - steps[]: { id, title, questions[] }\n    - questions[]: { id, type, label, required, options?, validation? }\n    - conditionalLogic? (optional)\n  Content Manifest:\n    - pages[]: { slug, title, sections[] }\n    - sections[]: { key, type, contentRef? }\n- ‚ÄúNo fantasy names‚Äù: question types, section types, step types m√ºssen aus Registry/Contracts kommen.\n\n2) DB Fields\n- Pr√ºfe funnel_versions columns:\n  - questionnaire_config jsonb NOT NULL default '{}'::jsonb\n  - content_manifest jsonb NOT NULL default '{}'::jsonb\n  - algorithm_bundle_version text NOT NULL\n  - prompt_version text NOT NULL\nFalls fehlen: Migration.\n\n3) Load/Resolve Layer\n- Implementiere server-only loader:\n  - lib/funnels/loadFunnelVersion.ts\n    - loads funnel + version by slug (canonical)\n    - validates JSON with Zod\n    - returns typed manifest\n- API endpoint:\n  - GET /api/funnels/catalog/[slug]/manifest (or included in detail)\n    - returns version_id + typed manifest (or server-only consumption, if you prefer)\n  Entscheidung: Prefer server-only consumption to avoid leaking internal config? (Default: API returns minimal to client; full manifest used server-side during flow.)\n\n4) Wiring into Patient Flow\n- Ensure patient funnel pages use manifest for:\n  - rendering intro/outcomes\n  - building questionnaire steps\n- Minimal: one funnel (stress) uses the manifest end-to-end.\n\n5) Evidence & Tests\n- Unit tests:\n  - Zod schemas accept valid manifest and reject invalid (unknown question type)\n  - loader normalizes slug and loads correct version\n- PR commands (PowerShell): db reset/diff/typegen/test/build.\n\nAcceptance Criteria\n- funnel_versions contains versioned plugin manifest (questionnaire_config + content_manifest + algorithm_bundle_version + prompt_version).\n- Typed validation exists (Zod).\n- One end-to-end usage in patient flow for stress funnel (at least).\n- No magic strings for question/section types.\n\nDeliverables\n- Migration (if needed)\n- Zod schemas + registry integration\n- Loader + API minimal\n- Tests\n- Minimal docs update in docs/canon/CONTRACTS.md for manifest contract\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWoow","name":"architecture","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":354,"state":"CLOSED","title":"V05-I02.2 ‚Äî Funnel Plugin Manifest (questionnaire_config + content_manifest + algorithm bundle)"},{"body":"Du bist mein GitHub Copilot Implementation-Co-Pilot f√ºr RHYTHM ‚Äî Issue 521 (V05-I02.1):\n‚ÄúS√§ulen-/Funnel-Katalog: UI + API‚Äù.\n\nZiel\nImplementiere einen sichtbaren, nutzbaren Funnel-Katalog:\n- S√§ulen (Pillars) als Taxonomie\n- Funnels als Eintr√§ge mit slug, Titel, Kurzbeschreibung, Dauer, Outcomes\n- API + UI f√ºr Patient (Browse/Select) und optional Admin/Clinician (Read)\n- Multi-Tenant ready (org_id), RLS-konform.\n\nArbeitsreihenfolge (strikt)\n1) DB/Contracts pr√ºfen\n- Pr√ºfe, ob Tabellen existieren: pillars (oder pillar enum), funnels_catalog, funnel_versions.\n- Pr√ºfe Contract Registry/CONTRACTS.md: canonical slugs, statuses.\n- Falls pillars Tabelle fehlt: Migration anlegen:\n  - pillars(id, key, title, description, sort_order, created_at)\n  - Unique: key\n- Funnels:\n  - funnels_catalog: (id, org_id nullable oder org-scoped, pillar_id FK, slug unique (pro org), title, description, est_duration_min, outcomes jsonb, is_active, created_at)\n  - funnel_versions: referenziert funnels_catalog.id\n\n2) API Routes (server-only)\n- Implementiere minimal:\n  - GET /api/funnels/catalog\n    - returns pillars + funnels (active) mit minimalen Feldern + default_version_id\n  - GET /api/funnels/catalog/[slug]\n    - returns funnel detail + active/default version summary\n- Optional (admin): GET /api/admin/funnels (same data)\n- Enforce RLS / auth: Patient darf catalog lesen (ohne PHI), org scoping korrekt.\n\n3) UI (Patient)\n- Neue Seite: /patient/funnels (oder bestehendes Muster)\n- Anzeige:\n  - Pillar Sections (Accordion oder grouped list)\n  - Funnel cards (title, description, duration, outcomes tags)\n  - CTA: ‚ÄúStart‚Äù ‚Üí f√ºhrt in funnel intro (uses slug)\n- Loading/empty/error states.\n\n4) Determinism / Idempotency\n- Slugs m√ºssen √ºber Registry/Contracts validiert werden.\n- Keine hardcoded magic strings im UI/API.\n- API Sorting deterministisch: pillars.sort_order, funnels.title oder funnels.sort_order.\n\n5) Evidence\n- PR Description: PowerShell Commands:\n  - npm ci\n  - npm run db:reset\n  - npm run db:diff\n  - npm run db:typegen\n  - npm test\n  - npm run build\n- Screenshot/UI evidence: Funnel catalog page shows grouped pillars.\n\nAcceptance Criteria\n- Katalog ist im UI sichtbar und kommt aus API.\n- Funnels sind S√§ulen zugeordnet.\n- Slug ist canonical, deterministisch und unique.\n- Default/active Version wird angezeigt (mind. id/version).\n- Tests mindestens f√ºr API response shape + ordering.\n\nDeliverables\n- Migration(en) falls pillars/funnels fields fehlen\n- API routes + types\n- UI page + basic styling\n- Tests\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":353,"state":"CLOSED","title":"V05-I02.1 ‚Äî S√§ulen-/Funnel-Katalog: UI + API"},{"body":"**Intent:** S√§ulen als Taxonomie sichtbar; Funnels als Plugins, die ohne Core-√Ñnderungen ausrollbar sind. \n\n**Sub-Issues:**\n- [ ] V05-I02.1 ‚Äî S√§ulen-/Funnel-Katalog: UI + API\n- [ ] V05-I02.2 ‚Äî Funnel Plugin Manifest (questionnaire_config + content_manifest + algorithm bundle)\n- [ ] V05-I02.3 ‚Äî v0.5 Funnel Set: Aufnahme 2‚Äì3 zus√§tzlicher Funnels in den Katalog","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"}],"number":352,"state":"CLOSED","title":"EPIC V05-E02 ‚Äî Funnel Catalog + Plugin Runtime (7 S√§ulen ‚Üí Funnels ‚Üí Plugin)"},{"body":"Du bist mein GitHub Copilot Implementation-Co-Pilot f√ºr RHYTHM ‚Äî Issue V05-I01.4:\n‚ÄúAudit Log (entscheidungsrelevante Events)‚Äù (Supabase/Postgres).\n\nZiel\nImplementiere ein Audit Logging, das jede relevante Entscheidung/√Ñnderung nachvollziehbar macht:\n- Report generation + review approve/reject\n- Task creation/assignment/status change\n- Config changes (funnel activation/version rollout, navigation/layout config)\n- Consent record changes (falls im Scope)\nAudit muss actor, role, org, entity refs, action, diff/payload und timestamp enthalten.\n\nArbeitsreihenfolge (strikt)\n1) Repo scan\n   - Pr√ºfe: audit_log Tabelle existiert schon aus V05-I01.1? Wenn ja: erweitern statt duplizieren.\n   - Finde alle Stellen im Code, die ‚Äúdecision events‚Äù sind (API routes, processing orchestrator, admin config endpoints, clinician actions).\n\n2) Define canonical audit event contract (DB + code)\n   DB: audit_log columns (minimal):\n   - id (uuid)\n   - org_id\n   - actor_user_id (nullable for system jobs)\n   - actor_role (enum/text; must include nurse)\n   - source (e.g. 'api', 'job', 'admin-ui')\n   - entity_type (text/enum: 'assessment','report','task','funnel_version','config',...)\n   - entity_id (uuid/text)\n   - action (text: 'create','update','approve','reject','generate','flag','assign',...)\n   - diff jsonb (before/after or patch-like)\n   - metadata jsonb (request_id, prompt_version, algorithm_version, report_version, correlation ids)\n   - created_at default now()\n\n   Implement a small TS helper:\n   - lib/audit/log.ts: logAuditEvent({ ... }) with strict types, no magic strings (registry-backed where applicable).\n\n3) Implement logging in critical paths (minimal set)\n   - Report lifecycle:\n     - report generated (include versions)\n     - report flagged (include safety findings summary)\n     - report approved/rejected (include reviewer role, reason)\n   - Tasks:\n     - created/assigned/status change\n   - Admin config changes:\n     - funnel activation/version rollouts\n     - navigation/layout config updates\n   - Optional: consent changes\n\n4) Ensure no PHI in audit payload by default\n   - diff should reference ids + status transitions + versions, not raw clinical text.\n   - If necessary, store redacted summaries.\n\n5) RLS policy alignment\n   - Patient: typically read own audit for own entities (optional)\n   - Clinician/Nurse: read audit in org for assigned patients\n   - Admin: read config audit only\n\n6) Evidence\n   - Add at least one test or a minimal integration proof:\n     - Call endpoint that generates a report and shows an audit_log entry created.\n     - Call endpoint approve/reject and shows second audit entry.\n   - Include output in PR.\n\nAcceptance Criteria\n- audit_log exists and stores required fields.\n- Critical actions create audit entries.\n- Audit is queryable and linked to entities.\n- Typegen updated.\n- Evidence included (queries/logs/tests).\n- No PHI leakage in audit payload by default.\n\nPowerShell Verify Commands\n- npm ci\n- npm run db:reset\n- npm run db:diff\n- npm run db:typegen\n- npm test\n- npm run build\n\nDeliverables\n- Migration(s) for audit_log (if needed) + indexes\n- TS audit helper + integrations in key routes/jobs\n- Minimal doc note in docs/canon/CONTRACTS.md (‚ÄúAudit Event Contract‚Äù)\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqfg","name":"database","description":"","color":"ededed"}],"number":351,"state":"CLOSED","title":"V05-I01.4 ‚Äî Audit Log (entscheidungsrelevante Events)"},{"body":"Du bist mein GitHub Copilot Implementation-Co-Pilot f√ºr RHYTHM ‚Äî Issue V05-I01.3:\n‚ÄúVersioning Contract: Funnel-Version / Algorithm-Version / Prompt-Version / Report-Version‚Äù (reproduzierbar).\n\nZiel\nStelle sicher, dass jeder erzeugte Output (Scores, Ranking, Report, Sections) eindeutig auf:\n- funnel_version\n- algorithm_version (bundle)\n- prompt_version\n- report_version\nreferenziert. Ziel ist Reproduzierbarkeit: ‚ÄúWas wusste das System damals?‚Äù muss rekonstruierbar sein.\n\nArbeitsreihenfolge (strikt)\n1) Repo scan\n   - Finde aktuelle Tabellen: funnels_catalog, funnel_versions, calculated_results, reports, report_sections.\n   - Finde vorhandene version fields oder TODOs in Code (processing pipeline).\n   - Pr√ºfe, ob es bereits eine ‚Äúversion registry‚Äù im Code gibt.\n\n2) Define the canonical version fields (DB + code)\n   - funnel_versions: version (string/semver), questionnaire_config jsonb, content_manifest jsonb, algorithm_bundle_version, prompt_version, is_default, rollout_percent\n   - calculated_results: algorithm_version (not null), funnel_version_id (FK), computed_at, inputs_hash (optional)\n   - reports: report_version (not null), prompt_version (not null), funnel_version_id (FK), algorithm_version, status, safety_score, citations_meta\n   - report_sections: section_key, prompt_version, content, citations_meta\n\n   Add unique constraints for idempotency:\n   - calculated_results unique (assessment_id, algorithm_version)\n   - reports unique (assessment_id, report_version)\n   - report_sections unique (report_id, section_key)\n\n3) Implement migrations\n   - Wenn Felder fehlen: ALTER TABLE add columns + NOT NULL defaults (oder backfill) + constraints.\n   - Optional: add ‚Äúinputs_hash‚Äù (sha256 of normalized inputs) to detect re-run equivalence.\n\n4) Implement code path wiring\n   - In processing orchestrator / report generator:\n     - When generating results, persist algorithm_version + prompt_version + report_version.\n     - Ensure all downstream reads use these refs (not ‚Äúlatest‚Äù).\n   - Provide a helper to compute report_version deterministically:\n     - e.g. report_version = `${funnelVersion.version}-${algorithmVersion}-${promptVersion}-${date or increment}`\n     - Or: explicit increment per assessment (v1, v2...) stored in DB.\n   Choose a simple deterministic rule and document it.\n\n5) Evidence\n   - Create one example flow (seed or test) that produces:\n     - a calculated_results row with algorithm_version set\n     - a report row with report_version + prompt_version set\n     - sections with prompt_version\n   - Show DB rows in logs or test output.\n\nAcceptance Criteria\n- All four version references exist and are persisted end-to-end.\n- Reports are reproducible via stable version references (no ‚Äúlatest implicit‚Äù).\n- Unique constraints guarantee retry-safety (idempotent re-runs).\n- Typegen updated.\n- Evidence: example row(s) + migration diff.\n\nPowerShell Verify Commands\n- npm ci\n- npm run db:reset\n- npm run db:diff\n- npm run db:typegen\n- npm test\n- npm run build\n\nDeliverables\n- Migration(s)\n- Updated processing code paths\n- Minimal doc update: docs/canon/CONTRACTS.md (‚ÄúVersioning Contract‚Äù section)\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqfg","name":"database","description":"","color":"ededed"}],"number":350,"state":"CLOSED","title":"V05-I01.3 ‚Äî Versioning Contract: Funnel-Version / Algorithm-Version / Prompt-Version / Report-Version"},{"body":"Du bist mein GitHub Copilot Implementation-Co-Pilot f√ºr RHYTHM ‚Äî Issue V05-I01.2:\n‚ÄúRLS Policies: Patient vs Clinician/Nurse vs Admin (tenant-isoliert)‚Äù (Supabase/Postgres).\n\nZiel\nImplementiere robuste Row Level Security (RLS) auf den v0.5 Core-Tabellen. Patienten sehen nur eigene Daten, Clinician/Nurse nur F√§lle ihrer Organization (oder explizit zugewiesene), Admin nur tenant-konfigurierbare Daten. Keine offenen ‚ÄúSELECT *‚Äù Leaks.\n\nArbeitsreihenfolge (strikt)\n1) Repo scan & Ist-Stand\n   - Finde alle Tabellen aus V05-I01.1.\n   - Pr√ºfe: Welche RLS/Policies existieren bereits? Welche Tabellen haben RLS enabled?\n   - Pr√ºfe Auth-Setup: Supabase auth users + profiles? Welche JWT claims werden genutzt (auth.uid(), role claim, org_id claim, membership table)?\n\n2) Decide the RLS access model (minimal, aber korrekt)\n   Implementiere ein simples, deterministisches Modell:\n   - organizations: tenant\n   - user_org_membership: mapping user_id -> org_id + role (patient/clinician/nurse/admin)\n   - patient_profiles: besitzt user_id + org_id\n   - Clinician/Nurse Zugriff: gleiche org_id ODER assignment (optional, falls vorhanden)\n   - Admin Zugriff: nur org-config tables (nicht patient health data), sofern role=admin innerhalb org.\n\n   Wenn assignment table fehlt, lege minimal an:\n   - clinician_patient_assignments (org_id, clinician_user_id, patient_user_id, created_at)\n   (Nurse analog oder nurse sieht alle im org_id)\n\n3) Implementiere RLS in migrations\n   - Erstelle neue Migration: enable RLS f√ºr relevante Tabellen:\n     - user_profiles, patient_profiles (falls getrennt), funnels_catalog (read), funnel_versions (read), patient_funnels, assessments, assessment_answers, documents, calculated_results, reports, report_sections, tasks, notifications, audit_log\n   - Schreibe Policies (SELECT/INSERT/UPDATE/DELETE) mit klaren Regeln:\n     A) Patient:\n        - SELECT eigene rows (patient_user_id = auth.uid())\n        - INSERT/UPDATE nur eigene rows (mit check)\n     B) Clinician:\n        - SELECT rows f√ºr Patienten aus gleicher org_id (oder assignment)\n        - UPDATE nur in clinician-berechtigten Tabellen (z.B. reports review status, tasks)\n     C) Nurse:\n        - SELECT tasks/patients in org_id\n        - UPDATE tasks status (assigned_to_role nurse) und support notes\n     D) Admin:\n        - SELECT/UPDATE org config (menus, tokens, funnel activation), kein Zugriff auf patient-sensitive Tabellen au√üer explizit erlaubt (default: NO)\n   - Achte auf ‚ÄúWITH CHECK‚Äù bei INSERT/UPDATE.\n\n4) Add helper SQL functions (optional, empfohlen)\n   - Erstelle stable functions:\n     - is_member_of_org(org_id)\n     - current_user_role(org_id)\n   Damit Policies weniger dupliziert sind.\n\n5) Tests / Evidence\n   - Schreibe mindestens 1‚Äì2 DB-level smoke tests (falls ihr DB tests habt) oder ein script, das Policies probeweise validiert.\n   - Evidence muss zeigen: patient kann nicht fremde assessment lesen; clinician kann in anderer org nicht lesen.\n\nAcceptance Criteria\n- RLS ist aktiviert (ALTER TABLE ... ENABLE ROW LEVEL SECURITY) f√ºr alle sensiblen Tabellen.\n- Policies sind pro Tabelle definiert, minimal korrekt, kein ‚Äúpublic read‚Äù f√ºr Patientendaten.\n- Patient sieht nur eigene Daten.\n- Clinician/Nurse sehen nur org-gebunden oder assigned Patienten.\n- Admin sieht nur org-config (default no PHI).\n- Evidence: SQL/Migration + kurze Verify-Kommandos + Beispiel-Queries.\n\nPowerShell Verify Commands (in PR)\n- npm ci\n- npm run db:reset\n- npm run db:diff\n- npm run db:typegen\n- npm test\n- npm run build\n\nDeliverables\n- Neue Migration(en) mit RLS enable + policies + ggf. assignment table/functions\n- Kurze Doku-Erg√§nzung: docs/canon/DB_MIGRATIONS.md oder docs/canon/CONTRACTS.md (nur Regeln, keine Romane)\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqfg","name":"database","description":"","color":"ededed"}],"number":349,"state":"CLOSED","title":"V05-I01.2 ‚Äî RLS Policies: Patient vs Clinician/Nurse vs Admin (Tenant-isoliert)"},{"body":"```text\nDu bist mein GitHub Copilot Implementation-Co-Pilot f√ºr RHYTHM (Rhythmologicum Connect) ‚Äî Issue V05-I01.1:\n‚ÄúDB Schema v0.5: Core Tables + JSONB Fields‚Äù (Supabase/Postgres).\n\nZiel\nImplementiere das v0.5 Core-Datenmodell als Supabase migrations (migration-first, deterministisch), mit JSONB f√ºr variable Inhalte und klaren Foreign Keys. Das Schema muss die v0.5 Executive Summary unterst√ºtzen: Multi-Funnel, Assessments, Document Upload + Extraction, Processing Results, Reports/Sections, Tasks/Notifications, Audit Log, Rollen/Org/RLS-ready.\n\nNicht verhandelbare Guardrails\n- Keine DB-√Ñnderung ohne Migration (supabase/migrations/*.sql).\n- Keine Fantasie-Namen: wenn neue Status/Enums/Keys ben√∂tigt werden, lege sie bewusst an und dokumentiere sie kurz in docs/canon/CONTRACTS.md (oder dem Contract-Doc im Repo).\n- Idempotency: Enforce Unique Keys f√ºr retry-sichere Upserts (z.B. report per assessment+version).\n- Determinism: Nach Umsetzung muss `npm run db:verify` (oder euer √Ñquivalent) in CI gr√ºn sein (drift + typegen).\n- PowerShell-only in allen Runbook-Snippets, keine Bash.\n\nArbeitsreihenfolge (strikt)\n1) Repo scan & Plan\n   - Finde bestehenden DB-Stand: supabase/migrations, schema snapshots, bestehende Tabellen.\n   - Pr√ºfe ob schon Tabellen existieren, die wir erweitern m√ºssen (keine Duplikate).\n   - Erstelle einen kurzen Plan: ‚Äúnew tables / altered tables / indexes / constraints‚Äù.\n\n2) Migration(s) erstellen\n   - Erstelle eine neue Migration mit sauberem Timestamp-Namen.\n   - Implementiere folgende Core-Entities (minimale Spalten + FKs + JSONB):\n     A) Identity & Access (RLS-ready)\n        - organizations (tenant)\n        - users (optional: wenn Supabase auth genutzt wird, dann profiles statt users)\n        - user_profiles\n        - user_roles (role enum oder table), user_org_membership\n     B) Funnels / Versions / Sessions\n        - funnels_catalog (slug, title, pillar_id, description, is_active)\n        - funnel_versions (funnel_id, version, questionnaire_config jsonb, content_manifest jsonb, algorithm_bundle_version text, prompt_version text, is_default, rollout_percent)\n        - patient_funnels (patient_id, funnel_id, active_version_id, status, started_at, completed_at)\n     C) Assessments / Answers / State\n        - assessments (patient_id, funnel_version_id, state, current_step_id, started_at, completed_at)\n        - assessment_answers (assessment_id, step_id, question_id, answer jsonb, updated_at)\n        - assessment_events (assessment_id, event_type, payload jsonb, created_at)  # optional but useful for auditability\n     D) Documents / Extraction\n        - documents (assessment_id, storage_path, doc_type, parsing_status, extracted_data jsonb, confidence jsonb, confirmed_data jsonb, confirmed_at)\n     E) Calculated Results / Ranking\n        - calculated_results (assessment_id, algorithm_version, scores jsonb, risk_models jsonb, priority_ranking jsonb, created_at)\n     F) Reports / Sections / Delivery\n        - reports (assessment_id, report_version, prompt_version, status, safety_score, safety_findings jsonb, html_path, pdf_path, citations_meta jsonb, created_at)\n        - report_sections (report_id, section_key, prompt_version, content text, citations_meta jsonb, created_at)\n     G) Tasks / Notifications\n        - tasks (patient_id, assessment_id, created_by_role, assigned_to_role, task_type, payload jsonb, status, due_at, created_at)\n        - notifications (user_id, channel, template_key, payload jsonb, scheduled_at, sent_at, status)\n     H) Audit\n        - audit_log (actor_user_id, actor_role, entity_type, entity_id, action, diff jsonb, created_at)\n\n   - Setze sinnvolle Indizes:\n     - funnels_catalog.slug unique\n     - funnel_versions (funnel_id, version) unique\n     - assessments (patient_id, funnel_version_id, started_at)\n     - reports unique per (assessment_id, report_version)\n     - report_sections unique per (report_id, section_key)\n     - tasks index by (assigned_to_role, status, due_at)\n     - audit_log index by (entity_type, entity_id, created_at)\n\n   - Setze Constraints / enums:\n     - role enum: patient/clinician/nurse/admin (muss nurse enthalten)\n     - status enums: minimal, aber konsistent (assessment_state, report_status, task_status, parsing_status)\n     - Timestamps default now()\n\n3) Seeds/Types/Verification\n   - Wenn das Repo typegen nutzt: `npm run db:typegen` aktualisieren (lib/types/supabase.ts o.√§.).\n   - Stelle sicher, dass drift check sauber bleibt.\n\n4) Doku kurz erg√§nzen\n   - docs/canon/DB_MIGRATIONS.md: falls neue Scripts/Verifikationen n√∂tig sind, nur minimal.\n   - docs/canon/CONTRACTS.md: nur falls neue Status/Enums definiert wurden (kein Roman).\n\nAcceptance Criteria (m√ºssen erf√ºllt sein)\n- Neue Migration(en) liegen unter supabase/migrations/.\n- ‚ÄúBlank DB ‚Üí apply migrations‚Äù l√§uft ohne Fehler.\n- Tabellen decken mindestens ab: users/profiles/roles, funnels_catalog/funnel_versions, assessments/answers, documents/extraction, calculated_results, reports/report_sections, tasks/notifications, audit_log.\n- JSONB Felder vorhanden f√ºr questionnaire_config/content_manifest/extracted_data/scores/risk_models/priority_ranking/citations_meta etc.\n- Unique constraints f√ºr idempotente Generierung (reports per assessment+version, sections per report+key).\n- Evidence in PR: Schema diff output + typegen diff (PowerShell).\n\nDeliverables in PR\n- Migration SQL\n- Updated generated TS types file (falls genutzt)\n- Kurze PR Beschreibung mit Evidence\n\nPowerShell Verify Commands (in PR angeben)\n- npm ci\n- npm run db:reset\n- npm run db:diff\n- npm run db:typegen\n- git diff -- lib/types/supabase.ts\n- npm test\n- npm run build\n```\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqfg","name":"database","description":"","color":"ededed"}],"number":348,"state":"CLOSED","title":"V05-I01.1 ‚Äî DB Schema v0.5: Core Tables + JSONB Fields"},{"body":"**Intent:** Stabiler Core + JSONB Variabilit√§t + konsequente Versionierung (Funnel/Algorithm/Prompt/Report) + RLS-Isolation + Audit. \n\nDiese Epic umfasst: \n- Datenmodell- und Tabellenstruktur inkl.  JSONB-Felder\n- RLS-Policies f√ºr Zugriffssteuerung\n- Vollst√§ndige Versionierung aller fachlich kritischen Entities\n- Audit-Logging entscheidungsrelevanter Events\n\n**Sub-Issues:**\n- [ ] V05-I01.1 ‚Äî DB Schema v0.5: Core Tables + JSONB Fields\n- [ ] V05-I01.2 ‚Äî RLS Policies: Patient vs Clinician/Nurse vs Admin (Tenant-isoliert)\n- [ ] V05-I01.3 ‚Äî Versioning Contract:  Funnel-Version / Algorithm-Version / Prompt-Version / Report-Version\n- [ ] V05-I01.4 ‚Äî Audit Log (entscheidungsrelevante Events)\n\n**Labels:** epic, database","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqfg","name":"database","description":"","color":"ededed"}],"number":347,"state":"CLOSED","title":"EPIC V05-E01 ‚Äî Data Model + RLS + Versioning + Audit (Supabase/Postgres)"},{"body":"**Ziel**\nv0.4: Ist-Release dokumentiert inkl. finalem verdict.json + Evidence-Links\nv0.5: Gate-Plan + DoD + Risiken + initial HOLD\n\n**Acceptance Criteria**\ndocs/releases/v0.4/verdict.json: finaler Status + Evidence-Links\nv0.5/RELEASE.md: Scope + DoD + Gate-Plan + Next actions.\n","labels":[],"number":344,"state":"CLOSED","title":"I504 (E50) Release Verdict Workflow: v0.4 finalisieren + v0.5 Gate-Plan"},{"body":"**Problem**\nSchema-Drift und ‚Äústille‚Äù DB-√Ñnderungen (lokal/remote) f√ºhren zu nicht reproduzierbaren Zust√§nden. F√ºr v0.5 brauchen wir deterministische Migrations- und Types-Disziplin.\n\n**Ziel**\nCI blockt PRs, wenn:\n- Migration fehlt\n- Drift entsteht\n- Generated types nicht aktuell sind\n\n**Tasks**\n- DB Stack erkennen (Supabase CLI? Prisma? Knex? plain SQL?); Entscheidung in docs/canon/DB_MIGRATIONS.md dokumentieren\n- Migration-first Regeln dokumentieren\n- CI Job: Apply/Reset Migrations, Drift Check, Typegen + git diff\n- Runbook in PowerShell in docs/canon/DB_MIGRATIONS.md\n- CODEOWNERS f√ºr Migrationsverzeichnis sicherstellen\n\n**Acceptance Criteria**\n- PR ohne Migration bei Schema√§nderung = CI Fail\n- Drift/Typegen = CI Fail\n- Doku in docs/canon/DB_MIGRATIONS.md\n\n**Verify (PowerShell)**\nsupabase start\nsupabase db reset\nsupabase gen types typescript --local > .\\src\\types\\supabase.ts\ngit diff --exit-code\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNNISw","name":"db","description":"","color":"ededed"}],"number":343,"state":"CLOSED","title":"I503 (E50) DB Determinism: Migration-first + Drift Check + Typegen Gate in CI"},{"body":"**Problem**\nCopilot/Dev k√∂nnen neue Strings/IDs/Env-Keys ‚Äúerfinden‚Äù (Statuses, Funnel IDs, Feature Flags, process.env.*), was zu Drift/Inkonsistenz f√ºhrt.\n\n**Ziel**\nEin einziger kanonischer Ort f√ºr kritische Identifier + strikte Env-Validierung + Review-Gates.\n\n**Tasks**\n- src/contracts/registry.ts anlegen (TS const arrays + union types)\n- src/env.ts anlegen (zod) und direkte process.env.* Nutzung auf env.* umstellen\n- .github/CODEOWNERS erg√§nzen (docs/canon/**, docs/releases/**, src/contracts/**, src/env.ts, supabase/migrations/**)\n- .github/pull_request_template.md erg√§nzen (Evidence/Registry/Env/Memory Entry Pflicht)\n\n**Acceptance Criteria**\n- Neue Identifier √ºber registry.ts\n- Neue Env Vars √ºber env.ts\n- CODEOWNERS greift f√ºr Guardrail-Dateien\n- PR Template erzwingt Evidence + Memory Entry\n\n**Verify (PowerShell)**\nrg -n \"process\\.env\\.\" .\nrg -n \"registry\\.(ts)|src/contracts/registry\" .\n","labels":[],"number":342,"state":"CLOSED","title":"I502 (E50) ‚ÄúNo Fantasy Names‚Äù: Contract Registry + Env Schema + PR/CODEOWNERS Guardrails"},{"body":"**Problem**\nAktuell sind Release-Artefakte und \"kanonische\" Regeln nicht klar getrennt; Versionsstand (v0.4 vs v0.5) ist nicht sofort ersichtlich.\n\n**Zielzustand (Struktur)**\ndocs/\n  canon/\n    PRINCIPLES.md\n    REVIEW_CHECKLIST.md\n    GLOSSARY.md\n    DB_MIGRATIONS.md\n    CONTRACTS.md\n  releases/\n    CURRENT.md\n    v0.4/\n      RELEASE.md\n      verdict.json\n      changelog.md\n    v0.5/\n      RELEASE.md\n      verdict.json\n      backlog.md   (oder issues. json ‚Äì w√§hlt 1 Format und bleibt dabei)\n  memory/\n    INDEX.md\n    entries/\n    incidents/\n\n**Tasks**\n- docs/ Struktur anlegen wie oben\n- docs/releases/CURRENT.md erstellen (Single Entry Point:  \"Current is v0.4 / Next is v0.5\")\n- Bestehende Inhalte so einsortieren, dass v0.4=Ist, v0.5=Planung\n- docs/memory/INDEX.md + Ordner entries/ & incidents/ erstellen\n\n**Acceptance Criteria**\n- docs/releases/CURRENT.md existiert und zeigt eindeutig auf v0.4 und v0.5 Dateien\n- Keine \"v0.1\"-Artefakte/Referenzen im Repo\n- v0.4 und v0.5 haben jeweils RELEASE.md + verdict.json\n- docs/canon/* ist kurz, pr√§zise, zeitlos\n- Evidence:  PR mit tree-Ausgabe & Link auf verschobene Dateien\n\n**Verify (PowerShell)**\ntree .\\docs /f\nrg -n \"v0\\. 1|0\\.1\" .\\docs\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"}],"number":341,"state":"CLOSED","title":"I501 (E50) Docs Reorg: Canon vs Releases (v0.4 IST / v0.5 NEXT) + Memory Index"},{"body":"**Ziel:** RHYTHM Repo so strukturieren und absichern, dass (a) v0.4 Ist und v0.5 Next jederzeit eindeutig sind und (b) Copilot/Dev keine Fantasie-Namen einf√ºhrt und DB/Migrations deterministisch bleiben.\n\n**Labels**: type:epic, area:repo, prio:P0\n**Milestone**: v0.5 (oder v0.5-prep)\n\nEnth√§lt Issues:\n- I501 (Docs Reorg: Canon vs Releases + Memory Index)\n- I502 (‚ÄúNo Fantasy Names‚Äù: Contract Registry + Env Schema + PR/CODEOWNERS Guardrails)\n- I503 (DB Determinism: Migration-first + Drift Check + Typegen Gate)\n- I504 (Optional: Release Verdict Workflow)\n\nAkzeptanzkriterien:\n- Repo-Struktur unterscheidet eindeutig v0.4 Ist vs v0.5 Next\n- Keine Fantasie-Namen/IDs\n- DB/Migrations deterministisch, CI blockt Drift\n- Evidence und Verify-Commands dokumentiert\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"}],"number":340,"state":"CLOSED","title":"E50 ‚Äî Repo Guardrails & Release-Discipline (v0.5 Prep)"},{"body":"CONTEXT:\nProjekt: Rhythmologicum Connect (Rhythm)\nFrontend: Next.js (App Router), React, TypeScript, Tailwind CSS, shadcn/ui\nKomponente: Assessment-Auswahl / Funnel-Card (Patient View)\n\nZIEL:\nErsetze das aktuelle statische Icon (Yoga-Figur) in der ‚ÄûStress & Resilienz‚Äú-Assessment-Card durch ein pulsierendes Herz-Icon, das Ruhe + Vitalit√§t signalisiert (medizinisch, nicht verspielt).\n\nANFORDERUNGEN:\n- Verwende ein Heart-Icon (pr√§feriert: lucide-react `Heart` oder `HeartPulse`)\n- Implementiere eine subtile, kontinuierliche Puls-Animation:\n  - leichte Skalierung (z.B. 1.0 ‚Üí 1.08 ‚Üí 1.0)\n  - sanfte Opacity- oder Glow-Variation\n  - Dauer ca. 1.8‚Äì2.2s, ease-in-out, infinite\n- Animation soll ruhig, medizinisch und hochwertig wirken (kein ‚ÄûGamification‚Äú-Look)\n- Animation darf NICHT vom CTA ablenken\n- Muss in Dark- und Light-Mode gut funktionieren\n- Barrierefreiheit beachten:\n  - prefers-reduced-motion ber√ºcksichtigen (Animation deaktivieren oder stark reduzieren)\n- Icon bleibt innerhalb der bestehenden Icon-Card / Rounded-Container (Layout unver√§ndert)\n\nTECHNISCHE HINWEISE:\n- Nutze Tailwind-Animation oder CSS keyframes (keine externe Lib n√∂tig)\n- Optional: leichte rote Akzentfarbe (#E11D48 / rose-600 o.√§.), aber dezent\n- Komponente soll wiederverwendbar bleiben (kein Hardcoding nur f√ºr Stress-Funnel)\n\nERWARTETES ERGEBNIS:\n- Code-√Ñnderung in der entsprechenden Card/Icon-Komponente\n- Sauberer, gut benannter CSS-/Tailwind-Animation-Keyframe\n- Kurze Inline-Kommentare, warum Animation so gew√§hlt ist\n- Keine funktionalen √Ñnderungen am Funnel-Flow\n\nBITTE:\nImplementiere die √Ñnderung vollst√§ndig und idiomatisch zum bestehenden Code-Stil im Repo.\n","labels":[],"number":338,"state":"CLOSED","title":"Icon √§ndern"},{"body":"\nType: chore / release\nMilestone: v0.4\nStatus-Ziel: Done = v0.4 shipped & frozen\n\n1Ô∏è‚É£ Code & Repo-Status\n\n main enth√§lt ausschlie√ülich v0.4-Scope (keine offenen v0.5-Commits)\n\n Alle v0.4-Issues geschlossen oder explizit verschoben (Label v0.5)\n\n Keine offenen TODOs / FIXME im v0.4-Scope\n\n Repo-Struktur final (kein ‚Äûwir r√§umen sp√§ter auf‚Äú)\n\n2Ô∏è‚É£ Dokumentation (Repo-intern)\n\n CHANGES.md\n\nv0.4 Abschnitt final erg√§nzt\n\nklare Trennung: Added / Changed / Fixed\n\n PR_SUMMARY.md gepr√ºft & konsistent\n\n QA-Artefakte final:\n\n MANUAL_TEST_PLAN.md\n\n TESTING_GUIDE.md\n\n THEME_TESTING_CHECKLIST.md\n\n CONTENT_QA_CHECKLIST.md\n\n PATIENT_LAYOUT_AUDIT.md\n\nüëâ Diese Dateien gelten nach Abschluss als v0.4 Referenz.\n\n3Ô∏è‚É£ Funktionale Abnahme (Smoke Tests)\n\nPatient\n\n Login ‚Üí korrektes Routing\n\n Funnel Start ‚Üí Abschluss ‚Üí History sichtbar\n\n Dark / Light Mode konsistent\n\n Mobile Layout (kein ‚Äûsmall table‚Äú-Regression)\n\nClinician\n\n Einheitliche Navigation (Dashboard / Funnels / Content)\n\n Funnel- & Content-Verwaltung stabil\n\n Keine 500er in Kernpfaden\n\n4Ô∏è‚É£ Infrastruktur & Betrieb\n\n Supabase Migrations in Prod angewendet\n\n RLS aktiv und gepr√ºft (Patient vs. Clinician)\n\n .env.example = real genutzte Variablen\n\n Error-Visibility gegeben (Logs / Vercel Errors)\n\n5Ô∏è‚É£ Release-Markierung\n\n Git Tag erstellt: v0.4.0\n\n GitHub Release angelegt (Release Notes aus CHANGES.md)\n\n main gilt ab jetzt als v0.4 frozen\n\n Neue Arbeit nur noch unter v0.5-Milestone\n\n‚úÖ Definition of Done (wichtig)\n\nv0.4 ist abgeschlossen, reproduzierbar und referenzierbar\n\nKein Feature-Carryover ohne explizite Entscheidung\n\nv0.5 startet nicht auf unsauberem Fundament","labels":[],"number":336,"state":"CLOSED","title":"üéØ Issue: v0.4 Release Closure & Final Review"},{"body":"\nTitel\nv0.4 ‚Äî Theme System Fix: deterministischer Light/Dark Mode (Login + Clinician + Patient) inkl. konsistenter Layouts\n\nPriorit√§t\nHigh (blockiert Testbarkeit)\n\nScope\n\n/login (Login-Seite)\n\n/clinician/* (Arzt-/Klinik-Seiten)\n\n/patient/* (Patienten-Flows inkl. Funnel/Content/History)\n\nGlobal Theme/Design Tokens\n\nAusgangslage / Symptome\nA) Login-Seite\n\nIst:\n\nStandard: Dark Mode (dunkelblauer Hintergrund, hellblaue Schrift, Login-Screen abgesetzt)\n\nToggle oben rechts:\n\nLight Mode: Textfeld wei√ü\n\nDark Mode: Textfeld-Hintergrund wird schwarz\n\nProblem:\n\nSwitch toggelt nicht zwischen ‚Äûechtem Light‚Äú und ‚Äûechtem Dark‚Äú wie bei System-Einstellung\n\nEs wirkt, als w√ºrde nur ein Teil (Inputs) umgef√§rbt, nicht das Theme\n\nZiel:\n\nSaubere Umschaltung Light ‚Üî Dark auf der Login-Seite, identisch zum System-Verhalten\n\nB) Arzt-/Klinik-Seite (Clinician)\n\nIst:\n\nDark Mode per System: sieht gut und lesbar aus\n\nToggle: keine Wirkung (es passiert gar nichts)\n\nZus√§tzlich: Auf Inhaltsseite ist eine √úbersicht wei√ü (wie Light), obwohl Dark aktiv sein m√ºsste\n\nProblem:\n\nTheme-Switch greift nicht / ist nicht an globales Theme gekoppelt\n\n‚ÄûHybrid‚Äú-Zust√§nde (Dark-Umgebung, Light-Content)\n\nZiel:\n\nSwitch muss zuverl√§ssig zwischen Light und Dark wechseln\n\nDark-Mode darf keine Light-Fl√§chen/Typo ‚Äûdurchleaken‚Äú\n\nC) Patienten-Seite\n\nIst:\n\nTheme visuell defekt (Verlauf: oben wei√ü, Mitte schwarz, unten wei√ü)\n\nTop-Men√º schwarz, Unterseiten inkonsistent/fehlerhaft\n\nInsgesamt unprofessionelle Darstellung, keine klare Logik\n\nProblem:\n\nKeine Konsistenz, vermutlich konkurrierende Styles/Layouts/Theme-Wrapper\n\nDark/Light wird nicht als vollst√§ndiger Theme-Kontext umgesetzt\n\nZiel:\n\nKlare Trennung Light vs. Dark, konsistent √ºber alle Patient-Seiten\n\nSteuerbar prim√§r √ºber System (v. a. Clinician), zus√§tzlich in Dev-Phase testbar\n\nWeitere Anforderungen\nD) Saubere Editierbarkeit / Design-Konfiguration\n\nAnforderung:\n\nFarben sollen √ºber Admin-Dashboard anpassbar sein\n\nKeine ‚Äûmanuelle Programmierung pro √Ñnderung‚Äú\n\nHinweis (Scope Split empfohlen):\n\nv0.4 Pflicht: Theme-Logik & Tokens zentralisieren (technische Voraussetzung)\n\nv0.4 Optional / v0.5: Admin-UI zur Token-Editierbarkeit + Persistenz (erfordert Konzept/DB/Preview)\n\nZielbild (Definition of Done)\n\nDeterministische Theme-Logik\n\nEine zentrale Quelle der Wahrheit f√ºr Theme\n\nKein unterschiedliches Verhalten ‚ÄûSwitch vs. System‚Äú\n\nVollst√§ndige Themes\n\nLight: konsistente Backgrounds, Textfarben, Surfaces\n\nDark: konsistente Backgrounds, Textfarben, Surfaces\n\nKeine Hybrid-Fl√§chen (Dark Shell + Light Card etc.), au√üer bewusst definiert\n\nSwitch-Verhalten\n\nToggle funktioniert auf:\n\nLogin\n\nClinician\n\nPatient\n\nIn Dev/testbar (Override m√∂glich), im Betrieb Systemsteuerung ber√ºcksichtigt\n\nKonsistenz √ºber Rollen/Layouts\n\nGemeinsame Theme-Infrastruktur\n\nRollen-spezifische Layouts d√ºrfen Theme nicht brechen\n\nTechnische Leitplanken / L√∂sungsvorschlag (umsetzungsorientiert)\n1) Theme-Strategie festlegen (muss entschieden werden)\n\nOption A (empfohlen): themeMode = auto | light | dark\n\nauto folgt prefers-color-scheme\n\nlight/dark override System\n\nToggle wechselt zwischen light und dark (oder auto ‚Üí light ‚Üí dark je nach UX)\n\n2) Single Source of Truth\n\nEin globaler Theme Provider (einheitlich f√ºr alle Routes)\n\nTheme-State persisted (z. B. localStorage / Cookie) und sauber auf html/body angewendet (class=\"dark\" etc.)\n\n3) Semantische Tokens statt ad-hoc Farben\n\n--bg, --surface-1/2, --text-primary/secondary/muted, --border, --input-bg, --input-text\n\nPro Theme definieren (Light/Dark)\n\n4) Layout/Wrapper harmonisieren\n\nSicherstellen, dass Login/Patient/Clinician denselben Theme-Kontext bekommen\n\nGradient-Hintergr√ºnde nur, wenn Token-gesteuert und in beiden Themes sauber\n\nTasks (Child-Issues empfohlen)\nCH1 ‚Äî Theme Architektur & Switch konsolidieren (global)\n\nTheme Provider zentralisieren\n\nauto|light|dark implementieren\n\nSwitch an globalen State binden\n\nPersistenz & initialer Load (SSR/CSR) ohne Flackern\n\nCH2 ‚Äî Login-Theme korrekt machen\n\nLogin-Seite auf Tokens umstellen (Surface, Input, Text)\n\nToggle muss tats√§chlich Light/Dark wechseln (nicht nur Inputs)\n\nCH3 ‚Äî Clinician Theme-Fix (inkl. ‚Äûwei√ües Overview‚Äú-Leak)\n\nPr√ºfen, wo Light-Fl√§chen im Dark Mode entstehen\n\nAlle Clinician Pages tokenisieren\n\nToggle muss wirken\n\nCH4 ‚Äî Patient Theme-Fix (Gradient/Hybrid/Topbar)\n\nUrsache des Verlaufs finden (doppelte Background-Layer, falscher Container)\n\nGlobal Shell + Unterseiten vereinheitlichen\n\nTabellen/Content-Seiten in Dark korrekt\n\nCH5 ‚Äî QA Matrix & Abnahme\n\nTestf√§lle:\n\nSystem Light ‚Üí App load ‚Üí Switch Dark ‚Üí Persist ‚Üí Reload\n\nSystem Dark ‚Üí App load ‚Üí Switch Light ‚Üí Persist ‚Üí Reload\n\nLogin/Clinician/Patient jeweils pr√ºfen\n\nScreenshots/Checkliste als Abnahmeprotokoll\n\nOptional (v0.4, wenn Zeit) / sonst v0.5\nOPT1 ‚Äî Admin-editierbare Theme Tokens\n\nDB Schema f√ºr Theme Tokens (oder JSON in Settings)\n\nAdmin UI (Preview + Publish)\n\nRollout-Mechanismus (Versionierung / Fallback)\n\nAkzeptanzkriterien (konkret)\n\n Login: Toggle schaltet vollst√§ndig zwischen Light und Dark (wie System)\n\n Clinician: Toggle wirkt; Light Theme erscheint vollst√§ndig; keine wei√üen Leaks im Dark\n\n Patient: keine Verlauf/Hybrid-Bugs; Topbar und Unterseiten konsistent pro Theme\n\n Systemsteuerung + App-Switch ergeben konsistente Ergebnisse\n\n Tokens zentral, keine Seite ‚Äûhardcoded‚Äú gegen Theme","labels":[],"number":331,"state":"CLOSED","title":"Epic / Fix Issue (v0.4): Grundlegende Bereinigung Dark-/Light-Mode-Logik (Login, Clinician, Patient)"},{"body":"Betroffene URL\n\nhttps://rhythmologicum-connect.vercel.app/clinician\n\nalle Unterseiten im Clinician-Bereich (Dashboard, Funnels, Content)\n\nProblembeschreibung\n1) Dark Mode (System/Browser-getriggert) ‚Äì schlechte Lesbarkeit\n\nWenn der Dark Mode √ºber System- bzw. Browser-Einstellungen aktiv ist:\n\nTexte sind zu dunkel ‚Üí schlechter Kontrast auf dunklem Hintergrund\n\nUnterschiedliche Graut√∂ne ohne klare semantische Logik\n\nTabellen, KPIs, Secondary Text und Meta-Infos nicht sauber unterscheidbar\n\nInsgesamt inkonsistente Typografie/Farbgebung √ºber Seiten hinweg\n\nProblemkern:\nEs gibt keine klare, semantische Farbordnung f√ºr Text im Dark Mode (Primary / Secondary / Muted / Disabled etc.).\n\nErwartung:\n\nGut lesbarer Dark Mode mit klaren Kontraststufen\n\nTextfarben logisch nach Kontext:\n\nPrimary Content (Headlines, Kernwerte): hell (z. B. near-white)\n\nSecondary Content (Labels, Meta): hellgrau\n\nMuted / Hint: dunkleres Grau, aber noch WCAG-konform\n\nEinheitlich √ºber alle Clinician-Seiten\n\n2) Light Mode ‚Äì korrekt dargestellt, aber nicht schaltbar\n\nWenn der Browser/System Light Mode erzwingt:\n\nUI ist visuell korrekt (siehe heller Screenshot)\n\nAber: Der Software-Switch (Light/Dark Toggle) hat keine Wirkung\n\nMan kann den Modus nicht manuell umschalten\n\nProblemkern:\n\nSoftware-Theme-Switch ist nicht korrekt mit System/Browser-Theme synchronisiert\n\nVermutlich konkurrierende Theme-Quellen (System vs. App State)\n\nErwartung:\n\nFunktionierender Theme-Switch im Clinician:\n\nUmschalten zwischen Light und Dark unabh√§ngig vom System oder\n\ndefinierter ‚ÄûAuto/System / Light / Dark‚Äú-Modus\n\nDeterministisches Verhalten (kein ‚ÄûHybrid‚Äú-Zustand)\n\nZielbild (Soll-Zustand)\nTheme-Architektur\n\nSingle Source of Truth f√ºr Theme-State\n\nKlare Entscheidung:\n\nOption A: App-Switch √ºberschreibt System-Theme\n\nOption B: App-Switch = auto | light | dark\n\nKein paralleles oder implizites Umschalten\n\nDark Mode (Clinician)\n\nMedizinisch-seri√∂se, gut lesbare Farbpalette\n\nKlare Text-Hierarchie:\n\nHeadings / KPIs\n\nTabellen-Header vs. Tabellen-Body\n\nStatus-Badges (Niedrig, Ausstehend, etc.)\n\nKonsistent √ºber Dashboard, Tabellen, Navigation, Buttons\n\nLight Mode (Clinician)\n\nAktueller Zustand beibehalten (optisch korrekt)\n\nZus√§tzlich: zuverl√§ssig per Software-Switch aktivierbar\n\nAufgaben / To-Dos\nA) Theme-Logik konsolidieren\n\n Theme-Strategie festlegen (Override vs. Auto)\n\n System prefers-color-scheme sauber integrieren\n\n App-Theme-Switch an globalen Theme-State koppeln\n\n Keine doppelten Theme-States (z. B. CSS + JS getrennt)\n\nB) Dark Mode visuell √ºberarbeiten (Clinician)\n\n Textfarben neu definieren (Primary / Secondary / Muted)\n\n Kontraste WCAG-tauglich machen\n\n Tabellen, Cards, KPI-Tiles explizit pr√ºfen\n\n Status-Badges im Dark Mode anpassen\n\nC) Konsistenz & QA\n\n Alle Clinician-Seiten pr√ºfen\n\n Umschalten via:\n\nSystem/Browser\n\nApp-Switch\n\n Keine Unterschiede im Rendering je nach Trigger\n\nAkzeptanzkriterien\n\nDark Mode im Clinician ist gut lesbar und konsistent\n\nLight Mode bleibt visuell korrekt und ist per Switch aktivierbar\n\nTheme-Verhalten ist deterministisch und nachvollziehbar\n\nKein Mischzustand aus System- und App-Theme\n\nEinheitliche Darstellung √ºber alle Clinician-Seiten\n\nPriorit√§t: High\nTyp: Bug / UX / Theme-System\nScope: Clinician UI (global)","labels":[],"number":328,"state":"CLOSED","title":"Clinician UI: Inkonsistenter Dark/Light Mode (Lesbarkeit + Software-Switch nicht wirksam)"},{"body":"Betroffene URLs (Beispiele)\n\nhttps://rhythmologicum-connect.vercel.app/patient/funnel/stress-assessment/content/intro-vorbereitung\n\nhttps://rhythmologicum-connect.vercel.app/patient/funnel/stress-assessment/content/intro-vorbereitung\n (Content Pages allgemein)\n\nProblembeschreibung\n1) ‚ÄûKaputte‚Äú / schmale Tabellen in Content-Pages\n\nAuf Content-Seiten innerhalb des Patient-Funnels werden Tabellen erneut falsch gerendert:\n\nTabelle extrem schmal bzw. auf minimale Breite kollabiert\n\nInhalt schlecht/gar nicht lesbar\n\nInkonsistentes Verhalten zwischen verschiedenen Pages\n\nRegressionsverdacht: Problem war bereits adressiert, tritt aber wieder auf\n\nErwartung:\n\nTabellen nutzen die volle verf√ºgbare Content-Breite\n\nHorizontaler Overflow sauber gel√∂st (scrollbar oder responsive Breakpoints)\n\nEinheitliches Verhalten f√ºr alle Content-Renderer (Intro, Vorbereitung, edukative Seiten)\n\n2) Dark-Mode-Switch funktioniert inkonsistent\n\nDer App-interne Dark-Mode-Switch verh√§lt sich anders als der Dark-Mode √ºber Browser/OS-Einstellungen:\n\nApp-Switch toggelt nicht den gleichen visuellen Zustand wie OS/Browser Dark-Mode\n\nBei aktivem Browser-Dark-Mode (Default beim Nutzer) f√ºhrt App-Switch zu inkonsistentem Theme-State\n\nErgebnis: unerwarteter Light/Dark-Mix (Farben, Hintergr√ºnde, Kontraste)\n\nErwartung:\n\nSingle Source of Truth f√ºr Theme (System ‚Üî App)\n\nKlar definierte Priorit√§t:\n\nOption A: App-Switch √ºberschreibt System-Theme\n\nOption B: App-Switch = ‚ÄûAuto/System / Light / Dark‚Äú\n\nGleiche visuelle Resultate, egal ob Dark-Mode √ºber App oder Browser/OS gesetzt wird\n\nVermutete Ursachen\n\nTabellen:\n\nFehlende oder √ºberschreibende max-width, w-full, overflow-x-auto\n\nUnterschiedliche Wrapper/Layouts zwischen Funnel-Pages und Content-Pages\n\nContent-Renderer nutzt nicht die gleichen UI-Constraints wie Assessment-Screens\n\nDark-Mode:\n\nGetrennter State f√ºr Theme (z. B. useTheme vs. CSS prefers-color-scheme)\n\nFehlende Synchronisation zwischen globaler Theme-Config und Switch\n\nTailwind/Dark-Classes nicht konsistent angewendet\n\nAufgaben / To-Dos\nA) Tabellen ‚Äì globaler Fix\n\n Einheitliche Table-Styles definieren (z. B. TableContainer)\n\n w-full, sinnvolle min-width, overflow-x-auto erzwingen\n\n Sicherstellen, dass alle Content-Renderer diese Styles nutzen\n\n Regression-Check auf allen Patient-Content-Pages\n\nB) Dark-Mode ‚Äì Konsolidierung\n\n Theme-Strategie festlegen (System vs. App-Override)\n\n App-Switch technisch mit prefers-color-scheme synchronisieren\n\n Einen globalen Theme-State verwenden (keine parallelen Mechanismen)\n\n Visuelle Pr√ºfung: Patient Funnel, Content Pages, Assessments\n\nC) QA / Abnahme\n\n Desktop + Mobile\n\n Dark-Mode via App-Switch\n\n Dark-Mode via Browser/OS\n\n Alle Stress-Assessment Content-Pages\n\nAkzeptanzkriterien\n\nTabellen sind auf allen Content-Seiten korrekt, lesbar und responsiv\n\nDark-Mode verh√§lt sich deterministisch und konsistent\n\nKein Unterschied im Rendering zwischen App-Switch und System-Dark-Mode\n\nKeine Regressionen in anderen Patient-Views\n\nPriorit√§t: High\nTyp: Bug / UI-Fix / Tech-Debt\nScope: Patient Funnel (Content + Theme)","labels":[],"number":323,"state":"CLOSED","title":"Patient Funnel UI: Kaputte Tabellen (Content-Seiten) + inkonsistenter Dark-Mode-Switch"},{"body":"Quelle: AFU-9 Control Center\n\nFeature-Briefing\nDas untere Men√º in der mobile ansicht liegt ueber den inhalt der seite, damit wird immer der untere Teil verdeckt bitte fixen\n\nTechnische Spezifikation\nTechnische Spezifikation: Fixierung des unteren Men√ºs in der mobilen Ansicht\n1. Kurzbeschreibung\nDas untere Men√º in der mobilen Ansicht des Projekts \"rhythmologicum-connect\" √ºberlagert derzeit den Inhalt der Seite, was zu einer schlechten Benutzererfahrung f√ºhrt. Diese Spezifikation beschreibt die notwendigen Anpassungen, um sicherzustellen, dass das untere Men√º nicht mehr den sichtbaren Inhalt √ºberdeckt und die Benutzerinteraktion verbessert wird.\n\n2. Akzeptanzkriterien\nDas untere Men√º bleibt stets am unteren Rand des Bildschirms sichtbar, ohne den Inhalt der Seite zu √ºberdecken.\nDer Inhalt der Seite ist vollst√§ndig sichtbar und zug√§nglich, ohne dass Benutzer scrollen m√ºssen, um wichtige Informationen zu sehen.\nDie Navigation √ºber das untere Men√º ist intuitiv und reaktionsschnell.\nDas Design ist konsistent mit dem vorhandenen UI/UX-Style-Guide des Projekts.\nDie L√∂sung funktioniert auf allen g√§ngigen mobilen Endger√§ten und in verschiedenen Bildschirmgr√∂√üen.\nDie √Ñnderungen verursachen keine regressiven Fehler in anderen Teilen der Anwendung.\n3. Technische Hinweise\nFrontend\nAnpassung des CSS/SCSS f√ºr das untere Men√º, um es fixiert am unteren Rand des Viewports zu positionieren.\nImplementierung von Media Queries, um sicherzustellen, dass das Design auf verschiedenen Bildschirmgr√∂√üen korrekt dargestellt wird.\n√úberpr√ºfung und Anpassung des z-Index, um sicherzustellen, dass das Men√º √ºber dem Inhalt, aber nicht st√∂rend wirkt.\nBackend\nKeine √Ñnderungen erforderlich, da die Anpassungen rein frontendbezogen sind.\nDB\nKeine √Ñnderungen an der Datenbankstruktur erforderlich.\n4. Eventuelle DB-√Ñnderungen\nEs sind keine √Ñnderungen an der Datenbankstruktur oder den Datenbankinhalten erforderlich, da das Problem ausschlie√ülich im Frontend besteht.\n5. Risiken / Edge Cases\nRisiko der √úberlappung: Falls das Layout nicht korrekt implementiert wird, k√∂nnte es weiterhin zu √úberlappungen kommen, insbesondere bei dynamischem Inhalt.\nBrowser-Kompatibilit√§t: Unterschiede in der Darstellung zwischen verschiedenen mobilen Browsern k√∂nnten das Design beeintr√§chtigen.\nPerformance: Zu viele CSS-Regeln oder komplexe Media Queries k√∂nnten die Ladezeit der Seite negativ beeinflussen.\nBenutzerinteraktion: Benutzer k√∂nnten Schwierigkeiten haben, das Men√º zu erreichen, wenn es nicht richtig positioniert oder skaliert ist.\nZug√§nglichkeit: Sicherstellen, dass das Men√º auch f√ºr Benutzer mit besonderen Bed√ºrfnissen (z. B. Screenreader-Nutzer) gut zug√§nglich ist.\nDiese Spezifikation dient als Grundlage f√ºr die Implementierung der notwendigen √Ñnderungen, um die Benutzererfahrung in der mobilen Ansicht von \"rhythmologicum-connect\" zu verbessern.","labels":[],"number":319,"state":"CLOSED","title":"Menue mobile fixen"},{"body":"Problem\nAuf der Patient-Seite Stress-Assessment Intro klebt der CTA-Button ‚ÄûAssessment starten ‚Üí‚Äú dauerhaft am unteren Viewport-Rand (fixed/sticky). Dadurch wirkt das Layout ‚Äûabgeschnitten‚Äú/unruhig und √ºberlagert den nat√ºrlichen Content-Flow.\n\nBetroffene Seite\n\n/patient/funnel/stress-assessment/intro\n(auch beobachtet im Patient-Funnel-Kontext)\n\nReproduktion\n\nSeite √∂ffnen: /patient/funnel/stress-assessment/intro\n\nNach unten scrollen\n\nBeobachten: Der Button bleibt unten ‚Äûfixed‚Äú sichtbar statt mit dem Content mitzuscrollen.\n\nIst-Verhalten\n\nCTA ist permanent am unteren Bildschirmrand fixiert.\n\nSoll-Verhalten\n\nCTA-Button soll im normalen Dokumentfluss bleiben und mit dem Content scrollen.\n\nOptional (falls gew√ºnscht): Der Button kann am Ende der Seite zus√§tzlich klar als Abschluss-CTA platziert sein, aber nicht als fixed bottom bar.\n\nAkzeptanzkriterien\n\n Auf /patient/funnel/stress-assessment/intro ist der CTA nicht position: fixed / sticky am Viewport-Bottom.\n\n CTA erscheint am Ende des Inhalts und scrollt normal mit.\n\n Kein √úberdecken von Content (auch nicht bei kleinen Viewports).\n\n Mobile + Desktop gepr√ºft (Chrome/Safari iOS, Responsive).\n\nTechnische Hinweise / Vermutete Ursache\n\nIrgendein Wrapper/Component nutzt vermutlich position: fixed (z.B. ‚ÄúBottomBar‚Äù, ‚ÄúStickyCTA‚Äù, ‚ÄúFunnelFooter‚Äù, ‚ÄúMobileFooterCTA‚Äù) oder globale Styles f√ºr Patient-Funnel-Seiten.\n\nVorschlag zur Umsetzung\n\nEntfernen/abschalten der fixed/sticky-Variante f√ºr diese Intro-Seite (oder generell im Patient-Funnel-Intro).\n\nCTA stattdessen als normaler Block am Seitenende rendern (z.B. innerhalb des Content-Containers / Cards).\n\nFalls es eine wiederverwendete Komponente ist: Prop/Variant einf√ºhren, z.B. sticky={false} / layout=\"inline\" f√ºr Intro-Seiten.\n\nDefinition of Done\n\nPR mit Fix + kurzer Notiz, welche Komponente/Styles der Ausl√∂ser waren und wie der CTA k√ºnftig gesteuert wird.","labels":[],"number":317,"state":"CLOSED","title":"Issue: Patient Funnel Intro ‚Äì ‚ÄúAssessment starten‚Äù Button darf nicht unten festkleben"},{"body":"\nType\nArchitecture / UI Bug\n\nPriority\nHigh (core patient flow)\n\nProblem\n\nIm Patient Funnel (/patient/funnel/stress-assessment, besonders mit skipIntro=true) wird der Question Screen in einem legacy centered Card / max-width layout gerendert, w√§hrend Navigation und Tabs bereits ein full-width Patient Layout nutzen.\n\nDas f√ºhrt zu:\n\nschmalem Question Content\n\nungenutztem Viewport\n\ninkonsistenter UX\n\nTable-/Scale-Komponenten wirken ‚Äûkaputt‚Äú, sind es aber nicht\n\nRoot Cause\n\nParallel existierende Funnel-Layouts:\n\nneues full-width Patient Layout\n\naltes centered Card Layout f√ºr Questions\n\nDer Question Screen nutzt noch das alte Pattern.\n\nFix (mandatory)\n\nRemove legacy Card / max-w / mx-auto wrappers from Patient Question Screens\n\nIntroduce and enforce a single PatientContentShell (full width)\n\nEnsure skipIntro does not switch layout paths\n\nQuestion components must rely on parent width, not define their own\n\nAcceptance Criteria\n\nQuestion Screen uses same width logic as Patient Nav & Tabs\n\nNo centered narrow card for patient questionnaires\n\n/stress-assessment and ?skipIntro=true render identically\n\nNo per-page width hacks","labels":[],"number":315,"state":"CLOSED","title":"Patient Funnel uses legacy centered Card layout ‚Üí breaks full-width Question UI"},{"body":"Type:\nBug / UI Consistency / Layout\nPriority:\nHigh (UX-breaking, affects multiple pages)\nScope:\nPatient + Clinician UI (global)\n\nProblem\nAuf mehreren Seiten wird Content ‚Äì insbesondere Tabellen bzw. tabellenartige Layouts ‚Äì unn√∂tig schmal gerendert, obwohl ausreichend Viewport-Breite verf√ºgbar ist.\nDas Problem tritt seiten√ºbergreifend auf (nicht nur an einer Stelle) und deutet auf globale Layout-Constraints hin (Container, Wrappers, max-width, responsive Breakpoints).\nTypische Symptome:\n\n\nTabellen wirken wie ‚Äûmobile small tables‚Äú, auch auf Desktop\n\n\nViel ungenutzter Raum links/rechts\n\n\nUnterschiedliches Verhalten je nach Route (alt vs. neu)\n\n\nInkonsistenz zwischen Patient- und Clinician-Bereich\n\n\nDas ist kein Einzelfehler, sondern ein strukturelles Layout-Problem.\n\nBetroffene Bereiche (nicht abschlie√üend)\n\n\n/patient/assessment\n\n\n/patient/funnel/*\n\n\n/patient/history\n\n\nggf. weitere Patient-Flows\n\n\neinzelne Clinician-Views mit Tabellen / Listen\n\n\n\nVermutete Ursachen\n\n\n√úbergreifende Container mit:\n\n\nmax-w-* (z. B. max-w-md, max-w-lg)\n\n\nfesten Width-Constraints\n\n\nvererbten Mobile-Layouts\n\n\n\n\nInkonsistente Nutzung von:\n\n\ncontainer\n\n\nmx-auto\n\n\npx-*\n\n\n\n\nAlte Layout-Wrapper werden noch verwendet\n\n\nNeue Mobile-Components sind vorhanden, aber nicht √ºberall aktiv\n\n\nTabellen sind nicht explizit auf w-full + overflow-x-auto ausgelegt\n\n\n\nZiel / Expected Outcome\nEin einheitliches, konsistentes Tabellen- und Content-Layout √ºber alle Seiten hinweg:\n\n\nTabellen nutzen standardm√§√üig die volle verf√ºgbare Breite\n\n\nDesktop: inhaltlich sinnvoll breit\n\n\nMobile: horizontal scrollbar, nicht gequetscht\n\n\n\n\nKlare Trennung der Layout-Ebenen\n\n\nGlobal App Shell (Header / Nav / Content)\n\n\nSeiten-Container\n\n\nKomponenten (Table, Cards, Lists)\n\n\n\n\nEin globaler, wiederverwendbarer Standard\n\n\nKeine individuellen Table-Fixes pro Seite\n\n\nEine L√∂sung f√ºr alle aktuellen & zuk√ºnftigen Tabellen\n\n\n\n\n\nKonkrete Tasks\n1. Layout-Audit\n\n\nAlle globalen Layout-Wrapper pr√ºfen (layout.tsx, App Shell, Page Wrappers)\n\n\nIdentifizieren:\n\n\nfeste max-width\n\n\nmobile-only Constraints\n\n\ndoppelte Container\n\n\n\n\n2. Globales Content-Container-Pattern definieren\n\n\nz. B.:\n\n\nDesktop: w-full max-w-[<design-token>]\n\n\nMobile: w-full\n\n\n\n\nEinheitlich f√ºr Patient & Clinician\n\n\n3. Table-Baseline definieren\n\n\nStandard-Table-Wrapper:\n\n\nw-full\n\n\noverflow-x-auto\n\n\n\n\nKeine impliziten Breiten\n\n\nOptional: Sticky Header / Column Handling vorbereiten\n\n\n4. Alte / redundante Layouts entfernen\n\n\nNicht mehr genutzte Wrapper l√∂schen\n\n\nSicherstellen, dass neue Mobile-Patient-Layouts wirklich verwendet werden\n\n\n5. Regression-Check\n\n\nAlle bekannten betroffenen Seiten manuell pr√ºfen\n\n\nSicherstellen:\n\n\nKein R√ºckfall ins ‚Äûsmall table‚Äú-Layout\n\n\nKonsistentes Verhalten auf Mobile & Desktop\n\n\n\n\n\nAkzeptanzkriterien\n\n\n‚ùå Keine schmalen Tabellen mehr ohne fachlichen Grund\n\n\n‚úÖ Tabellen f√ºllen den verf√ºgbaren Content-Bereich sinnvoll aus\n\n\n‚úÖ Einheitliches Verhalten auf allen betroffenen Seiten\n\n\n‚úÖ L√∂sung ist global, nicht seitenweise geflickt\n\n\n‚úÖ Neue Seiten profitieren automatisch vom Fix\n\n\n\nNotes\n\n\nKein Quick-Fix pro Tabelle\n\n\nKein rein kosmetischer Patch\n\n\nZiel ist ein robustes Layout-Fundament f√ºr v0.4+\n\n\n\nWenn du m√∂chtest, kann ich daraus im n√§chsten Schritt:\n\n\nein Epic + Child-Issues schneiden\n\n\noder ein Copilot-optimiertes Issue mit klarer Arbeitsanweisung formulieren\n\n\noder eine Layout-Referenz (Soll-Struktur) skizzieren\n\n","labels":[],"number":313,"state":"CLOSED","title":"Fix global table width & layout constraints (mobile + desktop)"},{"body":"Problem\n\nPatient-Mobile entspricht nicht dem Figma-Design; einzelne Routen zeigen alte Layouts/Komponenten.\n\nTabellen werden ‚Äûsmall‚Äú gerendert.\n\nNach Login falscher Default-Redirect.\n\nZiel\n\n/patient/** nutzt immer die neue Mobile-Shell + Tokens und ist visuell konsistent mit Figma.\n\nAlte Patient-Layouts werden entfernt oder per Redirect stillgelegt.\n\nScope\n\nImplement ‚ÄúPatient Mobile Shell Layout‚Äù (Single Source of Truth)\n\nTokens/Styles f√ºr Patient konsolidieren (keine Legacy-Overrides)\n\nRoute Cleanup (keine doppelten Implementierungen)\n\nFix Tabellen/Width/Overflow\n\nFix Post-Login Redirect\n\nTasks\n\n app/(patient)/patient/layout.tsx erstellen/standardisieren (Header, Container, Safe-Area)\n\n Patient Design Tokens anbinden (CSS variables / Tailwind theme), legacy styles entfernen\n\n Alle Patient Routes auf neue Komponenten umstellen:\n\n/patient/assessment\n\n/patient/funnel/** inkl. intro\n\n/patient/history\n\n Legacy Patient Pages/Layouts entfernen oder redirecten\n\n Table rendering: overflow-x-auto wrapper + Container widths fixen\n\n Login flow: router.replace(\"/patient\") nach success (Whitelist f√ºr returnTo)\n\n Smoke tests: Mobile viewport 390√ó844 + 428√ó926 (iOS) + Android 360√ó800\n\nAcceptance Criteria\n\n Jeder /patient/** Screen zeigt neue Mobile-UI (keine Alt-Komponenten mehr auffindbar in Runtime)\n\n Tabellen sind lesbar, kein ‚Äúsmall table‚Äù Effekt\n\n Dark/Light konsistent gem√§√ü Tokens (keine hardcoded Farben in Patient Screens)\n\n Nach Login landet der User auf /patient/ (au√üer validierter Deep Link)","labels":[],"number":306,"state":"CLOSED","title":"Patient Mobile UI ‚Äî Figma Parity (Hard Switch + Cleanup)"},{"body":"\nLabels (Vorschlag): frontend, patient, routing, layout, bug, v0.4\nPriority: P0 (blockiert Mobile/Patient UX)\nScope: /patient/** (inkl. Funnel + History + Assessment Hub)\n\nProblem Statement\n\nAktuell laufen mehrere Patient-Routen weiterhin in einer Legacy-Layout-Shell und/oder in einem Layout, das den Content in eine schmale rechte Spalte (‚Äúsmall table‚Äù/narrow column) zwingt. Dadurch sind Navigation, Tabs und Content-Breite inkonsistent oder unbrauchbar.\n\nBetroffene URLs (reproduzierbar):\n\nGET /patient/funnel/stress-assessment?skipIntro=true\n‚úÖ Erwartung: neue Patient-Shell + korrekte Breite\n‚ùå Ist: altes Layout + ‚Äúsmall table‚Äù Problem\n\nGET /patient/history\n‚úÖ Erwartung: neue Patient-Shell (Patient Tabs/Nav konsistent)\n‚ùå Ist: wirkt wie Legacy-Layout (Header/Tabs/Spacing inkonsistent)\n\nZus√§tzlich bestehen Hinweise, dass neue Patient-Mobile Komponenten bereits existieren, aber nicht konsistent verwendet werden. Au√üerdem gibt es vermutlich doppelte/parallel existierende Routen & Layouts, wodurch ‚Äúalte‚Äù Seiten weiterhin gerendert werden.\n\nZiel / Outcome\n\nAlle Patient-Routen unter /patient/** verwenden eine einzige, neue Patient-Shell (Layout + Container + Tabs/Nav).\n\nDas ‚Äúsmall table‚Äù Layoutproblem wird zentral behoben (kein rechts klebender schmaler Content; sinnvolle max-width + responsive).\n\nAlle Verweise (Links, redirects, router.push, middleware, Nav) zeigen auf die konsolidierten Routen.\n\nLegacy Patient Pages/Layouts werden identifiziert und gel√∂scht, sofern nicht mehr ben√∂tigt.\n\nVerhalten nach Login / Default Patient Entry ist konsistent: Patient landet auf /patient/ (oder definierter Hub-Route), nicht auf einem Legacy Funnel Link.\n\nNon-Goals (bewusst nicht in diesem Issue)\n\nGro√üer UI-Refactor / Design-Overhaul\n\nDark Mode Redesign\n\nFunnel-Logik/Backend-√Ñnderungen (nur Routing/Layout/Navigation/Width)\n\nReproduction Steps\nCase A ‚Äî Funnel mit skipIntro\n\nLogin als Patient\n\n√ñffne https://rhythmologicum-connect.vercel.app/patient/funnel/stress-assessment?skipIntro=true\n\nBeobachte: altes Layout, Content in schmaler Spalte, links viel Leerraum\n\nCase B ‚Äî History\n\n√ñffne https://rhythmologicum-connect.vercel.app/patient/history\n\nBeobachte: wirkt wie Legacy Layout, Patient UI inkonsistent\n\nRoot Cause Hypothesen (zu verifizieren)\n\nEs existieren mehrere Layout-Trees (z.B. app/patient/layout.tsx + Route-Groups wie app/(...)/patient/...) und die betroffenen Pages h√§ngen nicht am neuen Tree.\n\nEs existieren doppelte Pages f√ºr dieselbe Route in unterschiedlichen Route Groups, sodass Next.js eine ‚Äúandere‚Äù Page rendert.\n\nDas ‚Äúsmall table‚Äù Problem entsteht durch ein Parent-Layout mit:\n\nmax-w-*, w-80, max-w-sm, container, prose\n\noder grid-cols-[1fr_360px] / Sidebar Pattern mit leerer linker Spalte\n\noder justify-end, ml-auto, place-items-end\n\nRequirements\nR1 ‚Äî Audit: Was ist neu, was ist alt?\n\nErstelle im PR/Issue-Comment eine kurze Auflistung:\n\nNeue Patient-Mobile Komponenten (bereits vorhanden):\n\nDateien/Komponentenpfade\n\nWof√ºr sie gedacht sind (Shell, Question Screen, Funnel Cards, etc.)\n\nLegacy Patient Pages/Layout:\n\nDateien/Komponentenpfade\n\nWo sie noch referenziert werden\n\nAkzeptanz: Es ist eindeutig dokumentiert, welche Dateien entfernt/ersetzt werden.\n\nR2 ‚Äî ‚ÄúOne Patient Shell‚Äù: Layout-Konsolidierung f√ºr /patient/**\n\nSicherstellen, dass folgende Routen garantiert das neue Layout nutzen:\n\n/patient/ (Patient Hub / Einstieg)\n\n/patient/assessment (falls vorhanden)\n\n/patient/history\n\n/patient/funnel/* inkl. Query Params (skipIntro=true)\n\nImplementation Guideline:\n\nVerwende eine Route Group, die nur Patient betrifft, z.B.\n\napp/(patient)/patient/layout.tsx (neue Patient-Shell)\n\ndarunter alle Patient Pages\n\nAlternativ: app/patient/layout.tsx so anpassen, dass es definitiv die neue Shell ist\n(aber Route Group ist meist robuster gegen Collisions mit Admin/Clinician).\n\nAkzeptanz: Jede Patient-Route zeigt exakt dieselbe Shell (Header/Tabs/Spacing konsistent).\n\nR3 ‚Äî Globaler Container Fix: ‚Äúsmall table‚Äù beseitigen\n\nImplementiere einen zentralen Container/Wrapper (z.B. PatientPageContainer) und nutze ihn in der Patient-Shell.\n\nContainer Spezifikation:\n\nOuter: mx-auto w-full max-w-6xl px-4 sm:px-6\n\nInner: w-full min-w-0\n\nKeine Sidebars / 2-Spalten-Grids, die ohne linken Content eine rechte Spalte erzwingen.\n\nFalls Sidebar n√∂tig:\n\nflex flex-col gap-8 lg:flex-row\n\nleft: flex-1 min-w-0\n\nright: w-full lg:w-[360px] max-w-none\n\nAkzeptanz:\n\nDesktop: Inhalt ist nicht auf ~360px begrenzt und nicht rechts ‚Äúeingeklemmt‚Äù.\n\nMobile: volle Breite mit sauberem Padding.\n\nGilt f√ºr /patient/funnel/stress-assessment und /patient/history.\n\nR4 ‚Äî Navigation/Tabs konsistent (Patient)\n\nDefiniere 1 Men√ºkonzept und setze es um:\n\nDesktop: Top Tabs (Assessments / Verlauf)\n\nMobile: optional Bottom Tabs (md:hidden) oder gleiche Top Tabs (wenn MVP)\n\nWichtig:\n\nKeine doppelte Navigation (nicht einmal im Layout + einmal in Page)\n\nActive State korrekt\n\nLinks zeigen auf konsolidierte Routen (/patient/ bzw. /patient/history)\n\nAkzeptanz: Tabs sind konsistent und visuell korrekt; keine ‚Äúfalsche obere Auswahl‚Äù.\n\nR5 ‚Äî Verweise korrigieren & Legacy entfernen\n\nSuche und aktualisiere alle Verweise:\n\nhref=\"/patient/funnel/stress-assessment\" (wenn das nicht mehr Default ist)\n\nrouter.push(...), redirect(...)\n\nmiddleware.ts role-based redirects\n\nServer actions / auth callbacks\n\nEntferne Legacy Dateien (Pages/Layout/Components), die nicht mehr gebraucht werden.\n\nAkzeptanz:\n\nKeine alte Patient-Shell wird noch gerendert.\n\nRepo enth√§lt keine toten Legacy Patient Pages/Layout (oder sie sind klar als deprecated markiert und unreferenziert).\n\nTest Plan\nAutomated\n\nnpm run lint\n\nnpm run build\n\nManual (must pass)\n\nGET /patient/funnel/stress-assessment?skipIntro=true\n\nneue Shell, richtige Breite\n\nGET /patient/funnel/stress-assessment/intro\n\nneue Shell, richtige Breite\n\nGET /patient/history\n\nneue Shell, richtige Breite\n\nGET /patient/\n\nneue Shell, Einstieg/Hub funktioniert\n\nLogin Flow (Patient):\n\nPost-login redirect geht zu /patient/ (oder definierter Hub), nicht zu Legacy Funnel URL\n\nDeliverables (Definition of Done)\n\n Layout audit dokumentiert (neu vs alt)\n\n Neue Patient-Shell ist einziges Layout f√ºr /patient/**\n\n Zentraler Container Fix eliminiert ‚Äúsmall table‚Äù √ºberall\n\n Tabs/Nav konsistent und korrekt\n\n Alle internen Links/Redirects konsolidiert\n\n Legacy Patient Layout/Pages entfernt\n\n Lint + Build gr√ºn\n\n Manual checks bestanden (s.o.)\n\nNotes / Hinweise f√ºr Umsetzung\n\nQuery Params (skipIntro=true) d√ºrfen keine andere Page/Layout ausw√§hlen ‚Äî nur die gleiche Route mit gleicher Shell.\n\nFalls doppelte Routes existieren (Route Groups), muss klar entschieden werden, welche ‚ÄúSource of Truth‚Äù ist und die andere gel√∂scht werden.","labels":[],"number":299,"state":"CLOSED","title":"Patient-Routing & Layout-Konsolidierung ‚Äî Legacy-Shell entfernen, neue Patient-Shell √ºberall erzwingen"},{"body":"\nProblem\n\nDie Mobile-Patient-UI entspricht nicht dem geplanten Design, obwohl neue Mobile-Komponenten (Header, Funnel Cards, Question Screen etc.) im Repository vorhanden sind.\nUrsache ist sehr wahrscheinlich inkonsistentes Route-Wiring, doppelte Implementierungen (lib/ui vs. app/components) sowie ein fehlendes oder uneinheitliches zentrales Patient-Layout.\n\nDies ist kein Feature-Thema, sondern ein Cleaning- und Konsolidierungsproblem.\n\nZiel\n\nEine konsistente, stabile Mobile-Patient-UI √ºber alle /patient/*-Routen hinweg, mit:\n\ngenau einer Quelle f√ºr Mobile-Komponenten (Single Source of Truth)\n\nklarer Layout-Architektur (zentrale Patient-Shell)\n\nreproduzierbarem Mobile-Rendering\n\nScope\n\nAlle Patient-Routen:\n\n/patient\n\n/patient/assessment/*\n\nAssessment Start\n\nQuestion Screens\n\nResults\n\nMobile Breakpoint: < 640px\n\nFestgestellte Hauptprobleme\n\nDoppelte Mobile-Komponenten\n\nlib/ui/MobileHeader.tsx\n\napp/components/MobileHeader.tsx\n\nUnklar, welche Komponenten von den Patient-Routen tats√§chlich genutzt werden\n\nKein eindeutig definiertes zentrales Patient-Layout\n\nPotenziell fehlerhafte Nutzung von useIsMobile() (Server/Client-Mix)\n\nDokumentation ‚â† Runtime (Komponenten vorhanden, aber UI live inkonsistent)\n\nAkzeptanzkriterien\n\nSingle Source of Truth\n\nGenau eine MobileHeader-Implementierung\n\nEinheitlicher Importpfad f√ºr alle Patient-Pages\n\nZentrales Patient-Layout\n\nAlle /patient/*-Routen laufen √ºber eine gemeinsame Shell\n\nKeine Page-spezifischen Mobile-Hacks\n\nSauberes Route-Wiring\n\n/patient/assessment nutzt nachweislich die neuen Mobile-Komponenten\n(z. B. MobileQuestionScreen)\n\nStabiles Mobile-Rendering\n\nKeine Nutzung von useIsMobile() in Server Components\n\nKein Hydration-Flicker\n\nUI-Konsistenz\n\nEinheitliches Look & Feel f√ºr:\n\nPatient Home\n\nAssessment Start\n\nQuestion Screen\n\nResults\n\nTasks (Cleaning-Auftrag)\n\nInventory aller Mobile-Komponenten inkl. Importpfade\n\nEntscheidung & Umsetzung: eine MobileHeader-Implementierung beibehalten\n\nDoppelte / Legacy-Komponenten entfernen oder konsolidieren\n\napp/patient/layout.tsx pr√ºfen oder neu einf√ºhren (zentrale Patient-Shell)\n\nPatient-Routen (page.tsx, client.tsx) konsequent auf neue Komponenten umstellen\n\nInkonsistenten Einsatz von useIsMobile() entfernen\n\nManuelle Smoke-Tests im Mobile-Viewport (< 640px)\n\nDefinition of Done\n\nMobile-Patient-UI ist konsistent, reproduzierbar und entspricht dem geplanten Design\n\nKeine doppelte Mobile-Komponenten-Implementierung mehr im Repository\n\nAlle /patient/*-Seiten nutzen dieselbe Layout- und Component-Architektur\n\nKlassifizierung\n\nType: Cleaning / Refactoring\n\nExplizit kein Feature, kein Redesign, kein Scope-Creep","labels":[{"id":"LA_kwDOQfuwnc8AAAACRLh6WQ","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"}],"number":296,"state":"CLOSED","title":"Patient Mobile UI ‚Äî Cleaning & Route-Wiring (Single Source of Truth)"},{"body":"\n\nProblem\nIm Clinician-Bereich l√§sst sich die linke Sidebar einklappen, aber der Content-Bereich (alle Clinician-Seiten) bleibt weiterhin bis zum linken Fensterrand gerendert. Dadurch ‚Äûklebt‚Äú der Content nicht dynamisch am rechten Rand der Sidebar, sondern l√§uft unter/gegen den Sidebar-Bereich.\n\nZiel\nWenn die Sidebar ein-/ausgeklappt wird, muss sich der Content-Bereich automatisch anpassen (Offset/Width), sodass Layout und Scrollfl√§chen korrekt sind.\n\nScope\n\nBetroffen: alle Seiten unter /clinician/* (Dashboard, Funnels, Content, Patient-Details etc. ‚Äì alles was das Clinician-Layout nutzt)\n\nSidebar: collapsible, Zustand wird bereits getoggelt ‚Üí Layout muss darauf reagieren\n\nAkzeptanzkriterien\n\nContent startet immer rechts neben der Sidebar, egal ob Sidebar expanded oder collapsed. Kein Rendering bis zum linken Fensterrand.\n\nKein Overlap: Content liegt nie unter der Sidebar (auch nicht bei Scroll, kleinen Viewports).\n\nSmooth Transition beim Toggle (optional, aber w√ºnschenswert): keine Layout-Jumps.\n\nEinheitliche Implementierung √ºber ein zentrales Clinician-Layout (keine Page-spezifischen Fixes).\n\nMobile/kleine Screens: Verhalten bleibt konsistent (z. B. Sidebar overlay ‚Üí Content full width; oder Sidebar docked ‚Üí Content offset). Wichtig: definierte Regel, nicht zuf√§llig.\n\nUmsetzungsvorschlag (technisch)\n\nClinician Shell als CSS Grid oder Flex mit expliziten Spalten:\n\ngrid-template-columns: var(--sidebar-w) 1fr\n\n--sidebar-w abh√§ngig vom Sidebar-State (expanded/collapsed)\n\nSidebar-State zentral halten (z. B. Context/Provider) und am Root-Container als data-collapsed=\"true|false\" oder CSS-Variable setzen.\n\nContent-Wrapper nutzt keine fixed margins pro Seite, sondern bekommt Layout √ºber die Shell.\n\nTasks\n\n Clinician root layout/shell identifizieren (z. B. app/clinician/layout.tsx oder components/ClinicianLayout.tsx)\n\n Sidebar-State (collapsed) als Source-of-Truth im Layout verf√ºgbar machen\n\n Layout auf Grid/Flex umbauen (Sidebar + Content)\n\n CSS-Variable / data-attribute f√ºr Sidebar-Breite implementieren\n\n QA: Dashboard + mindestens 2 weitere Clinician-Seiten testen (expanded/collapsed, scroll, resize)\n\nDefinition of Done\n\nAlle Clinician-Seiten passen sich korrekt an Sidebar-Breite an, kein Content am linken Fensterrand, kein Overlap, reproduzierbar auf Desktop + kleinerem Viewport.","labels":[],"number":292,"state":"CLOSED","title":"Clinician Layout ‚Äî Content Area an Sidebar-Breite binden (collapsible)"},{"body":"Context\n\nIm Clinician Dashboard gibt es Layout-Probleme (Content-Breite), unn√∂tige Header-Elemente (User/Abmelden) und es fehlt ein zentral steuerbarer Dark-Mode Switch, der per globaler Variable (Parameterdatei) aktiviert/deaktiviert werden kann. Screenshot als Referenz.\n\nScope / Fixes\n1) Dark Mode Switch √ºber globale Variable (Feature Flag)\n\nZiel: Dark Mode soll zentral aktivierbar/deaktivierbar sein (ohne UI-Toggle n√∂tig), idealerweise √ºber eine Parameter-/Config-Datei.\n\nVorschlag Implementierung\n\nNeue Datei, z. B. src/config/ui.ts oder src/config/features.ts\n\nexport const UI_CONFIG = {\n  enableDarkMode: false,\n} as const;\n\n\nDark Mode Mechanik abh√§ngig von Setup:\n\nWenn next-themes genutzt wird: forcedTheme=\"light\" setzen, wenn enableDarkMode === false\n\nWenn Tailwind per class arbeitet: niemals dark auf <html> setzen, wenn Flag aus ist\n\nAcceptance Criteria\n\nWenn enableDarkMode=false: App rendert immer im Light Mode, unabh√§ngig von OS/Browser.\n\nWenn enableDarkMode=true: Dark Mode funktioniert wie bisher (oder via bestehender Logik).\n\n√Ñnderung erfolgt zentral √ºber eine Config-Variable, ohne Code-Suche √ºber mehrere Stellen.\n\n2) Clinician Dashboard: Content-Breite korrekt (Fensterbreite minus Sidebar)\n\nProblem: Dashboard-Content nutzt faktisch Vollbreite des Fensters, statt Viewport - Sidebar. Dadurch wirkt es ‚Äúzu breit‚Äù und nicht sauber aligned (siehe Screenshot).\n\nFix\n\nLayout/Container auf echtes Shell-Layout umstellen (flex/grid):\n\nOuter: flex\n\nSidebar: w-[‚Ä¶] shrink-0\n\nMain: flex-1 min-w-0 + ggf. max-w-full\n\nPr√ºfen, wo die Breite aktuell ‚Äúentkoppelt‚Äù ist (h√§ufig: w-screen, w-full auf falscher Ebene, oder position: fixed/absolute im Main-Container).\n\nAcceptance Criteria\n\nMain-Content beginnt rechts neben der Sidebar und nimmt exakt den verbleibenden Platz ein.\n\nKeine horizontale √úberbreite/Overflow bei 100% Zoom.\n\nResponsives Verhalten bleibt intakt.\n\n3) Header oben rechts: User + ‚ÄúAbmelden‚Äù entfernen\n\nZiel: Oben rechts (z. B. adaefler@‚Ä¶ und ‚ÄûAbmelden‚Äú) entfernen. Logout ist bereits unten links im Sidebar-Profilbereich vorhanden.\n\nFix\n\nHeader-Komponente bzw. Topbar im Clinician Layout anpassen:\n\nUser-Anzeige entfernen\n\nLogout-Link/Button entfernen\n\nFalls das ein globaler Header ist: nur f√ºr Clinician-Layout entfernen (nicht unbedingt f√ºr Admin/Patient, falls dort gew√ºnscht).\n\nAcceptance Criteria\n\nIm Clinician Dashboard ist oben rechts kein User/Logout mehr sichtbar.\n\nLogout bleibt (nur) im Sidebar-Bereich verf√ºgbar.\n\nImplementation Notes (Hinweise zur Code-Orientierung)\n\nRelevante Stellen sind typischerweise:\n\napp/clinician/layout.tsx (oder app/(clinician)/layout.tsx)\n\nShared Layout: app/layout.tsx\n\nSidebar-Komponente: components/sidebar/*\n\nHeader/Topbar-Komponente: components/header/*\n\nTheme Provider: components/theme-provider.tsx oder direkt in Layout\n\nTasks (Checklist)\n\n Config-Datei f√ºr UI-Flags anlegen (enableDarkMode)\n\n Dark-Mode-Handling an Flag koppeln (forced light wenn disabled)\n\n Clinician Layout: Shell-Layout (Sidebar + Main) auf saubere Breitenlogik pr√ºfen/fixen\n\n Topbar im Clinician Dashboard: User/Logout entfernen\n\n Manuell testen: Desktop (1440px), kleiner Viewport (z. B. 1024px), keine horizontalen Scrollbars\n\nDefinition of Done\n\nAlle 3 Fixes umgesetzt\n\nKein Layout-Regression in anderen Rollen (Patient/Admin)\n\nShort before/after Screenshots im PR beschreiben (optional)","labels":[],"number":290,"state":"CLOSED","title":"Clinician Dashboard Layout Fixes + Dark Mode Feature Flag"},{"body":"\nHintergrund\n\nDer gesamte Patientenbereich (Login nach erfolgreichem Einloggen, inkl. Fragebogen, Verlauf/‚ÄûMein Verlauf‚Äú, Info-Cards, Header/Nav) ist aktuell visuell inkonsistent:\n\nUnterschiedliche Hintergr√ºnde (reines Schwarz, sehr helle Fl√§chen, dazwischen einzelne Cards).\n\nInfo-Cards (z. B. ‚ÄûWeitere Informationen‚Äú) sind als schmale ‚ÄûPill‚Äú-Container umgesetzt.\n\nTypografie, Abst√§nde und Card-Stil variieren zwischen den Seiten.\n\nIm Dark Mode werden teilweise #000/bg-black und sehr harte Kontraste verwendet ‚Üí schlecht lesbar, nicht ‚Äûmedizinisch-professionell‚Äú.\n\nDer gesamte Patientenbereich soll auf ein einheitliches, ruhiges Design mit grauem Dark Mode gebracht werden.\n\nScope\n\nPatienten-Start / Dashboard (sofern vorhanden)\n\nFragen-Workflow (alle Schritte des Stress- & Resilienz-Assessments)\n\n‚ÄûMein Verlauf‚Äú / History-Ansicht\n\nInfo-Cards / Content-Teaser (z. B. ‚ÄûWeitere Informationen‚Äú)\n\nPatient-Navigation / Top-Bar / Header im Patientenbereich\n\nNicht im Scope: Admin-/Clinician-Bereich (separates Issue).\n\nSoll-Zustand\n1. Einheitlicher Hintergrund & Dark-Mode-Farben\n\nVerwendung der Design-Tokens (Tailwind + shadcn/ui) im gesamten Patientenbereich:\n\nLight: bg-background, bg-card, text-foreground, text-muted-foreground\n\nDark: .dark verwendet dunkle Graut√∂ne, keine reinen Schwarzwerte\n\nDark-Mode-Palette (Richtwerte):\n\n--background: 17 17 19 (‚âà #111)\n\n--card: 26 26 28 (‚âà #1a1a1c)\n\n--muted: 40 40 45 (‚âà #28282d)\n\n--foreground: helles Grau, gute Lesbarkeit\n\nKeine Verwendung von bg-black, #000 oder grellem Wei√ü in Fl√§chen im Patientenbereich.\n\n2. Konsistentes Layout f√ºr alle Patientenseiten\n\nMaximalbreite und Au√üenabst√§nde einheitlich, z. B.:\n\nWrapper: max-w-5xl mx-auto px-4 md:px-6 py-8 md:py-10\n\nLayout-Prinzip:\n\nFragebogen + Info-Panels in klarer Hierarchie:\n\nHauptinhalt (Fragen) links/oben\n\nSekund√§r-Infos (Cards wie ‚ÄûWeitere Informationen‚Äú) rechts/nebengeordnet oder darunter ‚Äì je nach Breakpoint.\n\nResponsive:\n\ngrid grid-cols-1 md:grid-cols-[minmax(0,3fr)_minmax(0,2fr)] md:gap-8\n\nKein freischwebender, extrem schmaler ‚ÄûPill‚Äú-Container mehr in der Mitte.\n\n3. Cards & Info-Bl√∂cke\n\nAlle Info-Elemente werden als Cards nach Designsystem umgesetzt:\n\nrounded-3xl bg-card text-foreground shadow-sm p-6 md:p-8\n\n√úberschrift: text-base md:text-lg font-semibold\n\nText: text-sm text-muted-foreground leading-relaxed\n\nLinks: text-primary underline underline-offset-2\n\nAuf Mobile: w-full max-w-md mx-auto statt schmaler, hoher S√§ulen.\n\n4. Patient-Navigation / Tabs\n\nTop-Navigation des Patientenbereichs (z. B. ‚ÄûFragebogen‚Äú / ‚ÄûMein Verlauf‚Äú) visuell konsistent:\n\nHintergrund: bg-background\n\nAktiver Tab: bg-card text-foreground font-medium\n\nInaktiv: text-muted-foreground hover:text-foreground\n\nDark Mode:\n\nTabs und Nav-Leiste mit bg-background / bg-card, keine reinen Schwarzfl√§chen.\n\n5. Typografie & Spacing\n\nEinheitliche Typografie im Patientenbereich:\n\nSeitentitel: text-xl md:text-2xl font-semibold\n\nAbschnittstitel: text-lg font-semibold\n\nFlie√ütext: text-sm md:text-base text-muted-foreground\n\nEinheitliche Abst√§nde:\n\nVertikal: space-y-4 / space-y-6 je nach Hierarchie\n\nInnenabst√§nde der Cards: p-6 / md:p-8\n\nTechnische Hinweise\n\nVerwendung der bestehenden Tailwind-/shadcn-Struktur:\n\nHintergrund statt bg-black ‚Üí bg-background\n\nCards statt individueller Boxen ‚Üí bg-card, rounded-3xl, shadow-sm\n\nSekund√§rtext ‚Üí text-muted-foreground\n\nAnpassung der Theme-Tokens in globals.css / tailwind.config.ts, sodass .dark konsequent die graue Palette nutzt.\n\nIm Patientenbereich alle Komponenten kontrollieren (Pages, Layouts, UI-Module) und Hard-Codings wie bg-black, bg-gray-950, text-gray-500, manuelle Pixel-Breiten etc. entfernen oder durch Token ersetzen.\n\nAkzeptanzkriterien\n\n Alle Patienten-Views (Fragebogen, Mein Verlauf, Info-Bereiche, Patient-Header/Nav) nutzen dieselben Hintergrund- und Text-Tokens (bg-background, bg-card, text-foreground, text-muted-foreground).\n\n Im Dark Mode erscheinen keine reinen Schwarzfl√§chen (bg-black / #000) mehr im Patientenbereich; stattdessen werden dunkle Graut√∂ne gem√§√ü Token-Set verwendet.\n\n Der obere Teil des Fragebogens (inkl. ‚ÄûWeitere Informationen‚Äú) wirkt als konsistentes Layout mit dem darunterliegenden Fragebogen ‚Äì keine extrem schmalen, hohen ‚ÄûPill‚Äú-Container, saubere Card-Optik.\n\n Auf Mobile sind alle Patienten-Cards und Info-Bl√∂cke gut lesbar und nutzen sinnvolle Breiten (w-full max-w-md mx-auto o. √§.).\n\n Navigation, Tabs und Cards verhalten sich in Light + Dark Mode visuell konsistent und entsprechen dem RHYTHM-Designsystem.","labels":[],"number":279,"state":"CLOSED","title":"Patientenbereich ‚Äì Konsistentes Layout & Dark-Mode-Redesign (Grau statt Schwarz)"},{"body":"Labels: design-system, mobile, ios, v0.4.1\n\nBeschreibung\n\nBereite das vollst√§ndige RHYTHM Designsystem als exportierbares UI-Kit f√ºr die sp√§tere iOS-App vor (Native / React Native / Expo kompatibel).\n\nScope\n\nExport aller Design Tokens als JSON\n\ncolors\n\ntypography\n\nspacing\n\nradii\n\nshadows\n\nMobile Components exportieren als Referenz SVG/PNG\n\nNaming-Konventionen vereinheitlichen\n\nDoku erstellen:\n/docs/design/ios-style-guide.md\n\nEmpfehlung: Integrationspfad f√ºr Expo + NativeWind\n\nAkzeptanzkriterien\n\nVollst√§ndiger Token-Export in /design/tokens/ios.json\n\nMobile UI-Kit als Bild√ºbersicht\n\nEntwickler k√∂nnen direkt mit React Native oder SwiftUI starten\n\nKonsistenz mit Web-App garantiert","labels":[],"number":277,"state":"CLOSED","title":"5Ô∏è‚É£ Issue: iOS App Style Export ‚Äì UI-Kit f√ºr iOS-Appearance vorbereiten"},{"body":"Labels: frontend, theme, design-system, v0.4.1\n\nBeschreibung\n\nImplementiere vollst√§ndigen Dark Mode Support f√ºr Desktop und Mobile basierend auf dem v0.4 Designsystem.\n\nScope\n\nNeue Tailwind Colors als --color-dark-* Variables\n\nDark Mode aktivieren via class=\"dark\" auf <html>\n\nTokens definieren f√ºr:\n\nBackground Dark\n\nSurface Dark\n\nBorder Dark\n\nText Light\n\nMuted Light\n\nshadcn-theme erweitern\n\nTheme Toggle Component (Desktop + Mobile)\n\nAkzeptanzkriterien\n\nAlle Seiten sind 100 % dark-mode kompatibel\n\nKeine ungestylten Elemente\n\nAnimation: Fade-Transition 150ms\n\nUser-Preference gespeichert via localStorage","labels":[],"number":276,"state":"CLOSED","title":"4Ô∏è‚É£ Issue: Dark Mode Support ‚Äì Global Dark Theme"},{"body":"Labels: frontend, clinician, dashboard, v0.4.1\n\nBeschreibung\n\nImplementiere die neue Clinician Patient Detail Page gem√§√ü dem v0.4 Designsystem.\nDie Seite dient als zentraler Einstiegspunkt f√ºr alle Patienteninformationen.\n\nScope\n\nHeader:\n\nPatient Name\n\nBasic Stats (Alter, Geschlecht, ggf. Patient-ID)\n\nStatus Badges (z. B. HRV Low, Pending Assessment)\n\nTabs oder Sections:\n\nOverview\n\nAssessments (Liste, neueste oben)\n\nAMY Insights\n\nActions (z. B. ‚ÄúStart New Assessment‚Äù)\n\nKomponente: PatientOverviewHeader\n\nKomponente: AssessmentList\n\nDatenintegration: Supabase Query (Patient + Assessments)\n\nAkzeptanzkriterien\n\nDesign entspricht v0.4 durchg√§ngig\n\nPage l√§dt zuverl√§ssig alle Patientendaten\n\nInsights k√∂nnen als ‚ÄûPlaceholder‚Äú gebaut werden\n\nReady f√ºr Erweiterungen in v0.5 (Clinical Report)","labels":[],"number":275,"state":"CLOSED","title":"3Ô∏è‚É£ Issue: Clinician Patient Detail Page ‚Äì Neue Detailansicht"},{"body":"Labels: frontend, mobile, funnel, v0.4.1\n\nBeschreibung\n\nErstelle eine mobile Funnel-Auswahlseite, auf der Patient:innen zwischen mehreren verf√ºgbaren Funnel-Typen w√§hlen k√∂nnen (Stress, Schlaf, Ern√§hrung, AF, Longevity etc.).\n\nScope\n\nGrid/List-Layout mit Funnel Cards\n\nEach Card zeigt:\n\nFunnel Icon\n\nFunnel Name\n\nKurze Beschreibung\n\nOnClick ‚Üí /patient/assessment/[funnel]/welcome\n\nNeue Komponente: FunnelCard\n\nResponsive Layout f√ºr 360‚Äì430px\n\nAkzeptanzkriterien\n\nMobile Funnel Selector ist eigenst√§ndige Seite\n\nVollst√§ndig konsistent mit v0.4 UI\n\nJede Funnel Card ist √ºber Props dynamisch steuerbar\n\nPage ist SEO-neutral (SSR optional)","labels":[],"number":274,"state":"CLOSED","title":"2Ô∏è‚É£ Issue: Mobile Funnel Selector ‚Äì Funnel-Auswahlfl√§che vor Assessment"},{"body":"üß© V0.4.1 ‚Äî Folge-Issues f√ºr UI-Erweiterungen\n\n\nLabels: frontend, mobile, navigation, v0.4.1\n\nBeschreibung\n\nImplementiere die globale mobile Navigationsleiste f√ºr alle /patient/* Seiten.\nDie neue mobile Navigation basiert auf dem UX-Pattern des Mobile Headers:\n\nZur√ºck-Button\n\nPage Title\n\nOptional: Settings / Info Icon\n\nScope\n\nNeue Komponente: MobileHeader (shadcn-basiert)\n\nLayout: Sticky Top (z-index > content), shadow level 1\n\nEinbau in alle Patient-Mobile-Seiten\n\nR√ºckw√§rtsnavigation implementieren (useRouter().back())\n\nOptional Content Header Variants:\n\n‚Äûminimal‚Äú (nur Back)\n\n‚Äûwith title‚Äú\n\n‚Äûwith action‚Äú\n\nAkzeptanzkriterien\n\nAlle mobilen Screens (Welcome, Question, Result, Content) besitzen denselben Header\n\nNavigation funktioniert konsistent\n\nKeine alten Header-Fragmente mehr\n\nBarrierefreiheit: Fokus, Hit-Area ‚â• 44px","labels":[],"number":273,"state":"CLOSED","title":"1Ô∏è‚É£ Issue: Mobile Navigation ‚Äì Globaler Mobile Navigationsheader"},{"body":"Labels: frontend, cleanup, v0.4\n\nBeschreibung\n\nBereinige das Projekt von allen alten UI-Komponenten, CSS-Resten und deprecated Screens.\n\nScope\n\nEntfernen alter Buttons, Inputs, Cards\n\nEntfernen alter Layouts\n\nEntfernen alter Farb-/Typografieklassen\n\nOrdnerstruktur unter /components vereinheitlichen\n\nVeraltete Screens in /clinician l√∂schen\n\nAkzeptanzkriterien\n\nProjekt verwendet ausschlie√ülich v0.4 UI\n\nKeine alten Farbwerte im Code (Suche nach Hex-Werten)\n\nEntwickler k√∂nnen neue Screens ohne Legacy-Konflikte bauen","labels":[],"number":271,"state":"CLOSED","title":"9Ô∏è‚É£ Issue: Cleanup ‚Äì Alte UI entfernen"},{"body":"Labels: frontend, mobile, content, v0.4\n\nBeschreibung\n\nNeue ‚Äûmarkdown content page‚Äú wie in /docs/mobile.\n\nScope\n\nTitle\n\nScrollable text area\n\nSticky bottom CTA\n\nEinheitlicher Abstand + Typographie\n\nAkzeptanzkriterien\n\nMarkdown rendert konsistent\n\nLayout identisch Figma\n\nKeine UI-Reste aus v0.3","labels":[],"number":270,"state":"CLOSED","title":"8Ô∏è‚É£ Issue: Patient Mobile ‚Äì Content Page"},{"body":"Labels: frontend, mobile, ai, v0.4\n\nBeschreibung\n\nUmsetzung des patientenfreundlichen Ergebnis-Screens nach Assessment.\n\nScope\n\nScore Card\n\nInsight Cards\n\nStress Distribution Bar (Placeholder)\n\nFollow Up Actions\n\nPath-Layout f√ºr AMY-Text\n\nAkzeptanzkriterien\n\nResult Screen entspricht 1:1 Mockup\n\nTextbl√∂cke nutzen neue Typo-Styles\n\nKomponenten sauber extrahiert","labels":[],"number":269,"state":"CLOSED","title":"7Ô∏è‚É£ Issue: Patient Mobile ‚Äì Result Screen (AMY Lite)"},{"body":"Labels: frontend, mobile, questionnaire, v0.4\n\nBeschreibung\n\nKompletter Umbau des Fragebogen-Screens.\n\nScope\n\nTop Progress Indicator\n\nQuestion Block\n\nAnswer Components (Buttons 1‚Äì5, Slider, Boolean, Chips)\n\nBottom Action Bar\n\nError Handling\n\nMobile-first Autolayout\n\nAkzeptanzkriterien\n\nJeder Schritt nutzt exakt das neue Layout\n\nBottom Bar ist sticky\n\nTouch-optimiert\n\nKompatibel mit allen Funnel-Fragetypen","labels":[],"number":268,"state":"CLOSED","title":"6Ô∏è‚É£ Issue: Patient Mobile ‚Äì Question Screen (Adaptive Questionnaire)"},{"body":"Labels: frontend, mobile, v0.4\n\nBeschreibung\n\nUmsetzung des neuen Welcome-Screens basierend auf /docs/mobile.\n\nScope\n\nIllustration Placeholder\n\nTitel & Subtitle\n\nBullet points\n\nPrimary CTA\n\nResponsive mobile Layout\n\nEinheitliche Typografie\n\nAkzeptanzkriterien\n\nPixelperfect nach Mockup\n\nKeine alten Mobile-Komponenten mehr\n\nLayout fl√ºssig von 360‚Äì430px","labels":[],"number":267,"state":"CLOSED","title":"5Ô∏è‚É£ Issue: Patient Mobile ‚Äì Welcome Screen"},{"body":"Labels: frontend, dashboard, v0.4\n\nBeschreibung\n\nPixelnahe Umsetzung des Dashboards gem√§√ü Mockups in /docs/clinician_dashboard.\n\nScope\n\nKPI Cards\n\nTabelle ‚ÄûRecent Assessments‚Äú\n\nQuick Actions\n\nSection Titles\n\nGrid-basierter Aufbau\n\nAkzeptanzkriterien\n\nDashboard sieht identisch zum Figma-Design aus\n\nAlle Komponenten folgen Designsystem\n\nTabellen sind barrierefrei (Keyboard, Fokus)","labels":[],"number":266,"state":"CLOSED","title":"4Ô∏è‚É£ Issue: Clinician Dashboard ‚Äì Neue UI vollst√§ndig implementieren"},{"body":"Labels: frontend, v0.4, layout\n\nBeschreibung\n\nImplementierung des neuen Desktop-App-Layouts basierend auf /docs/clinician_dashboard:\n\nScope\n\nNeue Sidebar: Navigation, Icons, aktive Zust√§nde\n\nNeue Topbar: Titel + User Menu\n\nNeue Content Shell: korrekte Abst√§nde, Hintergrund, Typografie\n\nEntfernen aller alten Layout-Fragmente\n\nRouting auf neues Layout umstellen\n\nAkzeptanzkriterien\n\nJede /clinician/* Seite nutzt das neue Layout\n\nKeine alten Header/Sidebars mehr im Projekt\n\nLayout ist responsiv (1250px+, 1024px Mode)","labels":[],"number":265,"state":"CLOSED","title":"3Ô∏è‚É£ Issue: Globales Layout ‚Äì Desktop (Clinician)"},{"body":"Labels: frontend, design-system, v0.4\n\nBeschreibung\n\nNachbauen und standardisieren aller UI-Komponenten auf Basis der UX-Mockups in /docs/mobile und /docs/clinician_dashboard.\n\nScope\n\nButtons (Primary/Secondary/Ghost/Destructive + States)\n\nInputs (Default/Focus/Error)\n\nCards (Base, Section, KPI)\n\nBadges/Status-Tags\n\nProgress Bar (mobile assessment)\n\nMobile Header (Back + Title)\n\nDesktop Sidebar\n\nDesktop Topbar\n\nAkzeptanzkriterien\n\nKomponenten 100% kompatibel mit shadcn/ui\n\nVariants sind sauber implementiert\n\nAlle Seiten verwenden nur neue Komponenten","labels":[],"number":264,"state":"CLOSED","title":"2Ô∏è‚É£ Issue: Designsystem ‚Äì Core Components (Button, Input, Card, Badge, Navigation)"},{"body":"Labels: frontend, design-system, v0.4\n\nBeschreibung\n\nErstelle alle grundlegenden Designsystem-Elemente gem√§√ü UX-Mockups in Figma und √ºbertrage sie in das Code-System (Tailwind + shadcn/ui).\n\nScope\n\nTailwind Colors einrichten\n\nPrimary Teal\n\nBackground\n\nSurface\n\nBorder\n\nNeutral Scale\n\nSemantic Colors\n\nTypografie-Skala definieren (H1, H2, H3, Body, Small)\n\nSpacing-Scale (8/16/24/32 px) implementieren\n\nRadii (4/6/8/12 px) definieren\n\nShadow-System (Elevation 1‚Äì2) definieren\n\nDokumentation unter /docs/design/v0.4/tokens.md\n\nAkzeptanzkriterien\n\nAlle neuen Tokens sind in tailwind.config.js verf√ºgbar\n\nFigma-Tokens decken 100 % der UI ab\n\nKeine Hardcoded-Farben mehr im UI","labels":[],"number":263,"state":"CLOSED","title":"1Ô∏è‚É£ Issue: Designsystem ‚Äì Foundations (Farben, Typografie, Spacing, Radii, Shadows)"},{"body":"\n\nZiel:\nAlle Desktop- (Clinician) und Mobile- (Patient Flow) Screens werden vollst√§ndig durch das neue Design ersetzt, das in\n/docs/clinician_dashboard\n/docs/mobile\nliegt.\nDas beinhaltet: ein neues globales Layout, ein neues Designsystem, Komponenten, Templates und den kompletten Umbau aller Seiten.","labels":[],"number":262,"state":"CLOSED","title":"‚≠ê EPIC (V0.4-E2): Implementierung des neuen RHYTHM v0.4 UI-Designs"},{"body":"Setze ein einfaches Alerting f√ºr AFU-9 auf:\n- CloudWatch Alarme f√ºr: erh√∂hte 5xx Rate am ALB, ungew√∂hnlich hohe CPU/Memory-Nutzung, ECS-Task-Failures.\n- Ausgabe dieser Zust√§nde im Control Center Dashboard (z.B. Health-Indikator auf Rot/Gelb/Gr√ºn).\n- Optional: Simple Benachrichtigungskan√§le (E-Mail oder Slack/Webhook), minimal f√ºr v0.2.\n\n---\nParent Epic: #228\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpyg","name":"observability","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWvbQ","name":"alerting","description":"","color":"ededed"}],"number":251,"state":"CLOSED","title":"Basis-Alerting f√ºr AFU-9 (CloudWatch Alarme + UI-Hinweise) aufsetzen"},{"body":"Implementiere ein zentrales Logging-Konzept:\n- Strukturierte Logs (z.B. JSON) f√ºr AFU-9 Core und die MCP-Server.\n- Anbindung der Container-Logs an CloudWatch Logs.\n- Konventionen f√ºr Log-Level (DEBUG, INFO, WARN, ERROR) definieren.\n- Verkn√ºpfung mit mcp-observability (`logs.search`) und Anzeige relevanter Logs im UI (Fehlersicht).\n\n---\nParent Epic: #228\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpyg","name":"observability","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWvQg","name":"logging","description":"","color":"ededed"}],"number":250,"state":"CLOSED","title":"Logging-Konzept & CloudWatch-Integration implementieren"},{"body":"Implementiere ein sauberes Secret-Management:\n- Speicherung aller sensiblen Daten (GitHub App Keys, LLM-API-Keys, ggf. DB-Passw√∂rter) im AWS Secrets Manager.\n- Zugriff aus ECS Tasks √ºber IAM-Rolle (keine Secrets in Environment-Dateien einchecken).\n- Helper-Layer im Code f√ºr Secret-Loading mit Caching und Fallback-Strategie.\n- Kurze Security-Readme f√ºr das Repo.\n\n---\nParent Epic: #228\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWopA","name":"aws","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":249,"state":"CLOSED","title":"Secret-Management f√ºr GitHub, LLM und interne Keys umsetzen"},{"body":"Definiere und implementiere die IAM-Rollen f√ºr AFU-9:\n- ECS Task Role mit minimal notwendigen Rechten (RDS, CloudWatch Logs, CloudWatch Metrics, ECS Describe/Update, optional S3).\n- Separate Rollen f√ºr Deploy-Tooling, falls n√∂tig.\n- Dokumentation der Berechtigungen und Begr√ºndung (Least Privilege).\n\n---\nParent Epic: #228\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWopA","name":"aws","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":248,"state":"CLOSED","title":"IAM-Rollen & Policies f√ºr AFU-9 definieren"},{"body":"Erstelle eine Settings-Ansicht f√ºr AFU-9:\n- √úberblick √ºber konfigurierte MCP-Server (Name, Endpoint, Status).\n- Verwaltung der registrierten Repositories (Hinzuf√ºgen/Entfernen, Basis-Konfiguration).\n- Anzeige (nicht im Klartext) von verwendeten Integrationen (z.B. GitHub App, verwendete AWS-Region).\n- Hinweis, dass geheime Werte ausschlie√ülich im Secrets Manager liegen und nicht im UI ver√§ndert werden.\n\n---\nParent Epic: #227\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWuaw","name":"settings","description":"","color":"ededed"}],"number":247,"state":"CLOSED","title":"Settings-Ansicht (Tokens, MCP-Server, Repos) implementieren"},{"body":"Implementiere eine Sicht auf die angebundenen Repositories:\n- Liste registrierter Repos (Name, Owner, Default Branch).\n- Anzeige offener PRs, wichtiger Issues und automatisiert erstellter PRs.\n- Link-Out zu GitHub.\n- Optional: Behelfs-Status der letzten Pipelines/Deployments f√ºr ein Repo.\n\n---\nParent Epic: #227\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWsQg","name":"github","description":"","color":"ededed"}],"number":246,"state":"CLOSED","title":"Repository-Ansicht (GitHub-Integration) implementieren"},{"body":"Implementiere UI f√ºr Agenten:\n- Liste aller registrierten Agenten (Name, Typ, verwendete LLMs/Tools).\n- Detailseite pro Agent mit Historie der Runs, Logs, durchschnittlichen Laufzeiten.\n- Optional: M√∂glichkeit, einen Agenten mit Test-Input manuell auszuf√ºhren (Playground).\n\n---\nParent Epic: #227\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":245,"state":"CLOSED","title":"Agenten-√úbersicht & -Detailseiten implementieren"},{"body":"Erstelle eine Workflows-Ansicht im Control Center:\n- Liste definierter Workflows (Name, Beschreibung, letzte Runs).\n- Detailansicht f√ºr einen Workflow (Definition, Historie, Logs).\n- M√∂glichkeit, Workflows manuell zu starten (mit Parametern, z.B. Repo, Issue-Nummer).\n- Anzeige des Step-Fortschritts f√ºr laufende Workflows.\n\n---\nParent Epic: #227\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":244,"state":"CLOSED","title":"Workflows-Ansicht & Trigger-UI umsetzen"},{"body":"Implementiere das AFU-9 Dashboard:\n- Anzeige aktiver und k√ºrzlich beendeter Workflows (Status, letzter Step, Dauer).\n- Kachel f√ºr Agentenaktivit√§t (letzte Runs, Fehlerquote).\n- Kachel f√ºr Infrastruktur-Health (z.B. aus `metrics.getServiceHealth`).\n- Basis-Navigation zu Workflows-, Agent- und Repo-Ansichten.\n\n---\nParent Epic: #227\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":243,"state":"CLOSED","title":"Control Center Dashboard implementieren"},{"body":"Stelle sicher, dass die MCP-Server in der AFU-9 Infrastruktur laufen:\n- Container-Definitionen f√ºr `mcp-github`, `mcp-aws-deploy`, `mcp-observability` in der ECS Task Definition.\n- Interne Kommunikation zwischen AFU-9 Core und MCP-Servern (localhost/Cluster-Intern, Ports und Health Checks).\n- Konfiguration der MCP-Server (z.B. Secrets, Regions, Repos).\n- Health Checks, Logging in CloudWatch f√ºr alle MCP-Server.\n\n---\nParent Epic: #226\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWopA","name":"aws","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpOw","name":"mcp","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqxw","name":"ecs","description":"","color":"ededed"}],"number":242,"state":"CLOSED","title":"MCP-Server als Sidecars im ECS Task deployen"},{"body":"Implementiere einen MCP-Server, der Observability-Funktionen anbietet:\n- Tool `logs.search` (CloudWatch Logs nach Pattern durchsuchen, z.B. ERROR, RequestId, TaskId).\n- Tool `metrics.getServiceHealth` (Basis-Metriken f√ºr ECS Service: CPU, Memory, 5xx Rate am ALB falls verf√ºgbar).\n- Paginierung und Limitierung f√ºr Log-Ergebnisse.\n- Nutzung dieser Tools durch den Observer-Agent und das UI.\n\n---\nParent Epic: #226\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpOw","name":"mcp","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpyg","name":"observability","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":241,"state":"CLOSED","title":"MCP-Server f√ºr Observability (CloudWatch Logs & Metrics) implementieren"},{"body":"Implementiere einen MCP-Server f√ºr Deployments auf AWS ECS:\n- Tools: `deploy.updateService` (Service auf neues Image/Tag setzen), `deploy.getServiceStatus`.\n- Nutzung des AWS SDK mit IAM-Rolle des ECS Tasks.\n- Parametrisierung (Cluster, Service, Container, Image Tag).\n- Geeignetes Logging aller Deploy-Aktionen, inkl. R√ºckgabe von Task-/Event-Informationen.\n\n---\nParent Epic: #226\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWopA","name":"aws","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpOw","name":"mcp","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":240,"state":"CLOSED","title":"MCP-Server f√ºr AWS-Deploy (ECS) implementieren (v0.2)"},{"body":"Implementiere einen MCP-Server, der GitHub-Funktionalit√§t als Tools bereitstellt:\n- Mindestens folgende Tools: `github.getIssue`, `github.listIssues`, `github.createBranch`, `github.commitFileChanges`, `github.createPullRequest`, `github.mergePullRequest`.\n- Authentifizierung via GitHub App oder PAT (konfigurierbar, Secrets Manager).\n- Saubere Fehlerbehandlung (Rate Limits, Invalid Credentials, fehlende Berechtigungen).\n- Kurze Doku, wie neue GitHub-Tools hinzugef√ºgt werden k√∂nnen.\n\n---\nParent Epic: #226\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpOw","name":"mcp","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWsQg","name":"github","description":"","color":"ededed"}],"number":239,"state":"CLOSED","title":"MCP-Server f√ºr GitHub implementieren (v0.2)"},{"body":"Implementiere einen Endpoint f√ºr GitHub Webhooks in AFU-9:\n- Empfang von Events (z.B. Issues, Pull Requests, Check Runs).\n- Validierung der Signatur (Secret).\n- Abbildung relevanter Events auf Workflows (z.B. `issue_opened` ‚Üí optionaler Auto-Workflow).\n- Logging und einfache Debug-Ansicht im UI (welche Webhooks kamen an, wie wurden sie verarbeitet?).\n\n---\nParent Epic: #225\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWsQg","name":"github","description":"","color":"ededed"}],"number":238,"state":"CLOSED","title":"GitHub Webhook-Handler implementieren (Issues, PRs, Checks)"},{"body":"Implementiere einen MCP-Client-Layer im AFU-9 Core:\n- Konfigurationsmodell f√ºr verf√ºgbare MCP-Server (Name, Host, Port, angebotene Tools).\n- Generic `callTool(serverName, toolName, params)`-Funktion mit Fehlerhandling.\n- Unterst√ºtzung f√ºr Timeouts, Retries (einfaches Backoff).\n- Integration in Workflow-Engine und Agent Runner.\n\n---\nParent Epic: #225\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNWpOw","name":"mcp","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":237,"state":"CLOSED","title":"MCP-Client-Layer in AFU-9 Core integrieren"},{"body":"Baue einen Agent Runner, der die eigentlichen Agenten-Logiken kapselt:\n- Einheitliches Interface f√ºr Agenten (Eingabe-Payload, Kontext, gew√ºnschte Tools).\n- Anbindung an LLM-Provider (DeepSeek, Claude, GPT) via Konfiguration.\n- F√§higkeit, im Rahmen eines Agent-Calls MCP-Tools aufzurufen (Tool-Use innerhalb des Agenten).\n- Logging und einfache Metriken (Dauer, Tokenverbrauch falls verf√ºgbar, Erfolg/Fehler).\n\n---\nParent Epic: #225\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWrwg","name":"agent","description":"","color":"ededed"}],"number":236,"state":"CLOSED","title":"Agent Runner f√ºr LLM- und MCP-Aufrufe implementieren"},{"body":"Implementiere die Workflow-Engine:\n- Interpreter, der die Workflow-Definitionen einliest und Step f√ºr Step ausf√ºhrt.\n- Unterst√ºtzung f√ºr einfache Control-Flow-Elemente (Sequenz, `if`-Bedingungen, Variable Assignment).\n- Persistenz des Ausf√ºhrungsstatus, sodass Runs fortgesetzt/rekonstruiert werden k√∂nnen.\n- Logging aller Step-Ausf√ºhrungen (Start, Ende, Erfolg/Fehler, Dauer).\n\n---\nParent Epic: #225\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNWo0Q","name":"engine","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":235,"state":"CLOSED","title":"Workflow-Engine Implementierung (Sequenzen von MCP-Tool-Calls)"},{"body":"Definiere ein generisches Workflow-Modell f√ºr AFU-9:\n- Datenmodell (DB-Schema) f√ºr Workflows, Steps, Ausf√ºhrungsstatus, Inputs/Outputs.\n- JSON-Konventionsformat f√ºr Workflows (z.B. `name`, `steps`, `tool`, `params`, `assign`, `if`).\n- Migrationen in der Datenbank anlegen.\n- Beispiel-Workflows erstellen (z.B. `issue_to_pr`, `fix_deploy_failure`).\n\n---\nParent Epic: #225\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNWo0Q","name":"engine","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":234,"state":"CLOSED","title":"Workflow-Modell und Persistenz f√ºr AFU-9 definieren"},{"body":"Stelle sicher, dass AFU-9 √ºber HTTPS und sprechbare Domain erreichbar ist:\n- ACM-Zertifikat f√ºr die gew√ºnschte Domain/Subdomain (z.B. afu9.example.com) erstellen.\n- ALB mit HTTPS-Listener und Zertifikat konfigurieren.\n- Route53-Eintr√§ge f√ºr die Domain/Subdomain anlegen.\n- Dokumentation der finalen URL(s) und ihrer Zuordnung (UI, API, Webhooks).\n\n---\nParent Epic: #224\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWopA","name":"aws","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWrCQ","name":"networking","description":"","color":"ededed"}],"number":233,"state":"CLOSED","title":"HTTPS & DNS f√ºr AFU-9 Control Center konfigurieren"},{"body":"Implementiere das Deployment von AFU-9 als ECS Fargate Service:\n- ECR Repository f√ºr AFU-9 Images anlegen.\n- Dockerfile f√ºr AFU-9 erstellen/√ºberpr√ºfen (inkl. MCP-Client, API, UI).\n- ECS Task Definition mit mindestens zwei Containern: `afu9-control-center` und `mcp-servers` (oder separate MCP-Container, falls bereits getrennt).\n- ECS Service mit gew√ºnschter Task-Anzahl, Auto-Restart, an ALB angebunden.\n- GitHub Actions Workflow (oder alternative CI/CD) zum Build & Push nach ECR und Update des ECS Service anlegen.\n\n---\nParent Epic: #224\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWopA","name":"aws","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqxw","name":"ecs","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqyg","name":"ecr","description":"","color":"ededed"}],"number":232,"state":"CLOSED","title":"ECR Repository & ECS Service f√ºr AFU-9 + MCP-Sidecars einrichten"},{"body":"Richte eine RDS Postgres Instanz f√ºr AFU-9 ein:\n- Parameter: Region eu-central-1, passende Instance Class (z.B. db.t4g.micro) f√ºr v0.2.\n- Security Group: nur aus ECS-Subnets erreichbar.\n- Initiales Datenbankschema deployen (Migrationsskripte aus dem Repo).\n- Konfiguration in AFU-9 (Connection String via Secrets/Parameter Store).\n- Kurze Anleitung, wie lokal gegen diese DB entwickelt/getestet werden kann.\n\n---\nParent Epic: #224\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWopA","name":"aws","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqfg","name":"database","description":"","color":"ededed"}],"number":231,"state":"CLOSED","title":"RDS Postgres f√ºr AFU-9 bereitstellen und anbinden"},{"body":"Setze die Netzwerk-Grundlage f√ºr AFU-9 auf AWS auf:\n- VPC mit mindestens 2 AZs.\n- Private Subnets f√ºr ECS Tasks, Public Subnets f√ºr ALB.\n- Security Groups f√ºr ALB und ECS Tasks (least privilege, z.B. nur ALB ‚Üí ECS, Bastion/CI ‚Üí RDS).\n- Application Load Balancer mit Target Group f√ºr AFU-9 Service.\n- Basis-Dokumentation der gew√§hlten CIDR- und Port-Strategie.\n\n---\nParent Epic: #224\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWopA","name":"aws","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqOw","name":"infra","description":"","color":"ededed"}],"number":230,"state":"CLOSED","title":"AWS Netzwerk-Basis f√ºr AFU-9 aufsetzen (VPC, Subnets, ALB)"},{"body":"Erstelle eine Architektur-Dokumentation (z.B. als Markdown + Mermaid) f√ºr AFU-9 v0.2:\n- AWS-Komponenten: VPC, Subnets, ALB, ECS Fargate, RDS Postgres, S3, Secrets Manager.\n- Container-Aufteilung: AFU-9 Control Center + MCP-Server (GitHub, Deploy, Observability).\n- MCP-Pattern: AFU-9 als MCP-Client, spezialisierte MCP-Server als Tool-Provider.\n- Einbettung in den Entwicklungs-Workflow (GitHub, CI/CD, Agenten).\n\n---\nParent Epic: #224\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWoow","name":"architecture","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWopA","name":"aws","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWqCw","name":"child-of-epic","description":"","color":"ededed"}],"number":229,"state":"CLOSED","title":"Architektur-√úbersicht f√ºr AFU-9 v0.2 (AWS + MCP) erstellen"},{"body":"Ziel dieses Epics:\n- Logging, Metriken und Grund-Alerting f√ºr AFU-9 etablieren.\n- IAM-Rollen und Secrets-Handling (GitHub, LLM, AWS) sauber aufsetzen.\n- Observability-Daten im Control Center sichtbar machen (mindestens Fehler und einfache Health-Indikatoren).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpyg","name":"observability","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpzA","name":"security","description":"","color":"ededed"}],"number":228,"state":"CLOSED","title":"[AFU-9 v0.2] Observability & Security"},{"body":"Ziel dieses Epics:\n- AFU-9 als nutzbares Control Center UI bereitstellen.\n- Kern-Views: Dashboard, Workflows, Agents, Repositories, Settings.\n- Direkte Ausl√∂sung von Workflows und Einsicht in Logs/Status erm√∂glichen.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpdA","name":"ui","description":"","color":"ededed"}],"number":227,"state":"CLOSED","title":"[AFU-9 v0.2] Control Center UI"},{"body":"Ziel dieses Epics:\n- MCP-Server f√ºr GitHub, AWS Deploy und Observability implementieren.\n- Minimalen, aber praxistauglichen Satz an Tools bereitstellen (Issues/PRs, ECS-Deploy, Logs/Metrics).\n- MCP-Server als Sidecars im gleichen ECS Task lauff√§hig machen und von AFU-9 aus nutzbar machen.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpOw","name":"mcp","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWpPg","name":"integration","description":"","color":"ededed"}],"number":226,"state":"CLOSED","title":"[AFU-9 v0.2] MCP-Server (GitHub, Deploy, Observability)"},{"body":"Ziel dieses Epics:\n- Generische Workflow-Engine f√ºr AFU-9 implementieren, die Workflows als Sequenz von Tool-Calls ausf√ºhrt.\n- Agent Runner implementieren, der LLMs und MCP-Tools einheitlich ansteuert.\n- MCP-Client-Layer integrieren, sodass Workflows MCP-Server (z.B. GitHub, Deploy) nutzen k√∂nnen.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNWo0Q","name":"engine","description":"","color":"ededed"}],"number":225,"state":"CLOSED","title":"[AFU-9 v0.2] Workflow Engine & Agent Runner"},{"body":"Ziel dieses Epics:\n- AFU-9 als Control Center auf AWS deployen (ECS Fargate + ALB + RDS Postgres).\n- MCP als zentrales Architektur-Pattern etablieren (AFU-9 als MCP-Client, spezialisierte MCP-Server f√ºr GitHub, Deploy, Observability).\n- Minimal lauff√§hige und dokumentierte Architektur herstellen, die f√ºr weitere Versionen erweiterbar ist.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWoow","name":"architecture","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNWopA","name":"aws","description":"","color":"ededed"}],"number":224,"state":"CLOSED","title":"[AFU-9 v0.2] AWS & MCP Architektur-Basis"},{"body":"Add minimal logging hooks for key events:\n\n- Assessment start/end\n- Major errors in patient and clinician flows\n- TODO comments/placeholders for future monitoring integration\n\nAcceptance Criteria:\n- [ ] Important events are logged in a structured way (even if only console for now).\n- [ ] There is a documented place to integrate real monitoring later (e.g. Sentry).\n\nParent Epic: #219","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNOAOA","name":"V0.4-E6","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNOAxA","name":"DX","description":"","color":"ededed"}],"number":222,"state":"CLOSED","title":"Add Minimal Logging / Monitoring Hooks"},{"body":"Add basic error and loading handling:\n\n- Custom 404 page for unknown routes.\n- Custom 500/error page for unhandled server errors.\n- Loading indicators for views that fetch data from Supabase / APIs.\n\nAcceptance Criteria:\n- [ ] 404 and 500 pages exist and are styled in line with v0.4.\n- [ ] Long-running views show loading feedback instead of blank screens.\n\nParent Epic: #219","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNOAOA","name":"V0.4-E6","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNOAxA","name":"DX","description":"","color":"ededed"}],"number":221,"state":"CLOSED","title":"Add Error Pages (404/500) and Loading States"},{"body":"Identify all custom form controls (inputs, textareas, selects) across patient/clinician/admin.\n\nTasks:\n- Migrate them to shared components from the v0.4 design system.\n- Remove or deprecate duplicate implementations.\n\nAcceptance Criteria:\n- [ ] Most forms use shared Input/Textarea/Select components.\n- [ ] Duplicate or legacy form components are removed or clearly marked as deprecated.\n\nParent Epic: #219","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNHiA","name":"cleanup","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNOAOA","name":"V0.4-E6","description":"","color":"ededed"}],"number":220,"state":"CLOSED","title":"Consolidate Form Controls Across the App"},{"body":"Epic Goal:\nEnsure v0.4 is stable enough for external test patients with minimal surprises.\n\nScope:\n- Consolidate form controls\n- Add loading and error states\n- Add minimal logging/monitoring hooks for key events","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"}],"number":219,"state":"CLOSED","title":"V0.4-E6 ‚Äî Technical Cleanup & Stability Layer"},{"body":"Define and implement navigation menus for each role (patient, clinician, admin).\n\nRequirements:\n- Sidebar and/or header navigation with clear, non-technical labels.\n- Use v0.4 design system components.\n- Avoid duplicate or confusing entries.\n\nAcceptance Criteria:\n- [ ] Each role has a logical, minimal navigation tree.\n- [ ] Navigation text is clear and aligned with user vocabulary.\n- [ ] Navigation is implemented via shared components where possible.\n\nParent Epic: #216","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN-0w","name":"routing","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN-1Q","name":"V0.4-E5","description":"","color":"ededed"}],"number":218,"state":"CLOSED","title":"Create Unified Navigation Menus per Role"},{"body":"Implement role-based routing so that logged-in users are sent to the right start page.\n\nRequirements:\n- Patient ‚Üí patient home / flow entry\n- Clinician ‚Üí clinician dashboard\n- Admin ‚Üí content admin or admin home\n\nAcceptance Criteria:\n- [ ] Role is detected and routing is automatic after login.\n- [ ] No role sees the wrong landing page.\n\nParent Epic: #216","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN-0g","name":"auth","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN-0w","name":"routing","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN-1Q","name":"V0.4-E5","description":"","color":"ededed"}],"number":217,"state":"CLOSED","title":"Implement Role-Based Entry Routing (Patient/Clinician/Admin)"},{"body":"Epic Goal:\nMake navigation and routing predictable and role-aware for Patient, Clinician and Admin.\n\nScope:\n- Role-based entry routing after login\n- Navigation menus per role (sidebar/header)","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"}],"number":216,"state":"CLOSED","title":"V0.4-E5 ‚Äî Navigation & Role-Based Routing V2"},{"body":"Implement the Clinician Dashboard screen using v0.4 UI components.\n\nRequirements:\n- Use Cards for KPI tiles.\n- Use Table or List for recent assessments.\n- Include at least 1‚Äì2 clear call-to-action buttons.\n\nAcceptance Criteria:\n- [ ] Clinician landing page uses the new dashboard layout instead of table-only views.\n- [ ] Dashboard is readable and responsive on common screen sizes.\n- [ ] Visual style is consistent with the rest of v0.4.\n\nParent Epic: #213","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN9cg","name":"V0.4-E4","description":"","color":"ededed"}],"number":215,"state":"CLOSED","title":"Implement ClinicianDashboard Component"},{"body":"Define what a clinician should see immediately after login:\n\nCandidates:\n- Summary cards (e.g. \"Active patients\", \"Recent assessments\", \"Assessments this week\")\n- List of recent assessments with timestamps and statuses\n- Quick actions (start new stress assessment, view patient list, open content library)\n\nDeliverable:\n- A short dashboard concept (markdown) describing layout and widgets.\n\nAcceptance Criteria:\n- [ ] Dashboard content plan is documented.\n- [ ] Each widget has a clear purpose and target user question it answers.\n\nParent Epic: #213","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF3A","name":"UX","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN9cQ","name":"clinician","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN9cg","name":"V0.4-E4","description":"","color":"ededed"}],"number":214,"state":"CLOSED","title":"Design Clinician Dashboard Layout & KPIs"},{"body":"Epic Goal:\nProvide a modern, informative clinician landing page that helps understand patient status\nand active funnels at a glance.\n\nScope:\n- Define dashboard layout and key widgets (KPIs, lists, quick actions)\n- Implement responsive dashboard using the v0.4 design system.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"}],"number":213,"state":"CLOSED","title":"V0.4-E4 ‚Äî Clinician Dashboard V2"},{"body":"Extend the content admin editor to attach pages to funnels and steps.\n\nUI fields:\n- Funnel: dropdown or select for known funnels (e.g. \"stress\")\n- Flow step: text/select for step identifier (e.g. \"intro-1\", \"between-questions-2\")\n- Optional: order_index for multiple content nodes at the same stage.\n\nAcceptance Criteria:\n- [ ] Admin can define to which funnel a content page belongs.\n- [ ] Admin can define at which flow step the content should appear.\n- [ ] Basic validation prevents obviously invalid configurations.\n\nParent Epic: #208","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNITA","name":"V0.4-E3","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNN82Q","name":"admin","description":"","color":"ededed"}],"number":212,"state":"CLOSED","title":"Add Content‚ÜíFunnel Mapping UI in Admin"},{"body":"Implement a dedicated screen for content pages in the patient flow.\n\nRequirements:\n- Render markdown/content in the same visual style as the rest of the app.\n- Provide a clear \"Continue\" button to move to the next step in the flow.\n- Support longer text with good readability.\n\nAcceptance Criteria:\n- [ ] Content pages can be displayed as part of the patient flow.\n- [ ] Continue behaves consistently with question screens.\n- [ ] No visual glitches when moving from content to question or result screens.\n\nParent Epic: #208","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNITA","name":"V0.4-E3","description":"","color":"ededed"}],"number":211,"state":"CLOSED","title":"Implement Patient Content Screen Renderer"},{"body":"Extend the funnel/flow engine to support a new node type `CONTENT_PAGE`.\n\nRequirements:\n- Node type constant or enum value (e.g. \"CONTENT_PAGE\").\n- For each such node, resolve the referenced content page (slug or ID).\n- Surface enough data for the frontend to render the content properly.\n\nAcceptance Criteria:\n- [ ] Node type `CONTENT_PAGE` is defined alongside other node types.\n- [ ] The engine can return content-node definitions to the frontend.\n- [ ] Existing QUESTION/RESULT handling keeps working without breaking changes.\n\nParent Epic: #208","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNITA","name":"V0.4-E3","description":"","color":"ededed"}],"number":210,"state":"CLOSED","title":"Add CONTENT_PAGE Node Type to Funnel Engine"},{"body":"Extend `content_pages` schema to support mapping into funnels:\n\nAdd columns:\n- `funnel_id TEXT NULL`\n- `flow_step TEXT NULL`\n- Optional: `order_index INT NULL` for ordering content within a step.\n\nTasks:\n- Write migration script (Supabase-compatible).\n- Update schema docs.\n\nAcceptance Criteria:\n- [ ] DB migration script exists and runs successfully (locally and in Supabase).\n- [ ] `content_pages` can be associated with a funnel and a flow step.\n- [ ] The schema changes are documented in the v0.4 architecture docs.\n\nParent Epic: #208","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNISw","name":"db","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNITA","name":"V0.4-E3","description":"","color":"ededed"}],"number":209,"state":"CLOSED","title":"Extend DB Schema for Content Flow Mapping"},{"body":"Epic Goal:\nIntegrate editorial content pages into funnel flows so that content can appear before,\nbetween, or after question blocks.\n\nScope:\n- DB extensions to map content pages to funnels and steps\n- New CONTENT_PAGE node type in the funnel engine\n- Patient content screen renderer\n- Admin UI to attach content pages to funnel steps","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"}],"number":208,"state":"CLOSED","title":"V0.4-E3 ‚Äî Content Flow Engine (CONTENT_PAGE Integration)"},{"body":"Identify old patient demo routes and flows that are no longer part of the intended journey.\n\nTasks:\n- Move legacy demos to a dedicated `/_legacy` area or remove them if not needed.\n- Adjust navigation so no legacy flows are reachable by accident.\n- Update docs to reference only the new Patient Flow V2.\n\nAcceptance Criteria:\n- [ ] No legacy patient demo route is reachable via the normal navigation.\n- [ ] Only Patient Flow V2 is visible and used for the Stress funnel.\n- [ ] Legacy flows (if kept) are clearly marked as such for internal reference.\n\nParent Epic: #203","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF3w","name":"V0.4-E2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNHiA","name":"cleanup","description":"","color":"ededed"}],"number":207,"state":"CLOSED","title":"Clean Up Legacy Patient Demo Pages"},{"body":"Implement modern, mobile-friendly screens for the patient flow:\n\nScreens:\n- Welcome: short explanation, duration, what happens with data, start button.\n- Question: clear questions, scale controls, helper text, validation state.\n- Result: main outcome, AMY summary, short recommendations, optional content links.\n\nDesign:\n- Use design-system components (Buttons, Cards, Typography).\n- Optimize for readability and emotional safety (calm, non-alarming UI).\n\nAcceptance Criteria:\n- [ ] All screens render well on small viewports (phone-size).\n- [ ] Typography hierarchy is clear and consistent with v0.4 design tokens.\n- [ ] Result screen clearly communicates the assessment outcome and suggested next steps.\n\nParent Epic: #203","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF3A","name":"UX","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF3w","name":"V0.4-E2","description":"","color":"ededed"}],"number":206,"state":"CLOSED","title":"Build Responsive Patient Screens (Welcome, Question, Result)"},{"body":"Implement a `PatientFlowRenderer` component that acts as the central entrypoint\nfor the Stress & Resilience assessment.\n\nResponsibilities:\n- Take a funnel/assessment configuration as input.\n- Decide whether the current node is a Question, Content, or Result screen.\n- Manage navigation (Next, Back) and show progress (e.g. step x of y).\n- Integrate with existing backend/funnel data model.\n\nAcceptance Criteria:\n- [ ] There is a single entrypoint for the Stress & Resilience flow (no duplicate flows).\n- [ ] Next/Back navigation works from welcome to result without dead-ends.\n- [ ] Progress is visible and understandable to the patient.\n\nParent Epic: #203","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF3w","name":"V0.4-E2","description":"","color":"ededed"}],"number":205,"state":"CLOSED","title":"Implement PatientFlowRenderer Component"},{"body":"Define the full Stress & Resilience journey from the patient perspective:\n\nScreens (minimum):\n- Welcome / explanation screen\n- Question screens (possibly grouped by theme)\n- Optional content screens (education, explanations)\n- Result screen (summary, AMY text, next steps)\n\nDeliverable:\n- A simple flow description in markdown or diagram form (screens, transitions, purpose of each step).\n\nAcceptance Criteria:\n- [ ] Flow description (screens + transitions) is documented in the repo.\n- [ ] Each screen has a clear purpose and a clear \"next step\".\n- [ ] Mobile behavior is considered from the start (short text, no super-wide forms).\n\nParent Epic: #203","labels":[{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF2w","name":"patient","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF3A","name":"UX","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNF3w","name":"V0.4-E2","description":"","color":"ededed"}],"number":204,"state":"CLOSED","title":"Design Patient Flow V2 Structure (Screens & States)"},{"body":"Epic Goal:\nReplace the prototype patient experience (‚Äúgruselig‚Äù) with a single, clean, modern,\nmobile-friendly flow for the Stress & Resilience assessment.\n\nScope:\n- Unified flow renderer for the Stress funnel\n- Welcome, question, optional content, and result screens\n- Removal or archiving of legacy patient demo flows\n\nNon-goals:\n- Implementing additional funnels (Sleep/Recovery) in v0.4 ‚Äì they can reuse the engine later.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"}],"number":203,"state":"CLOSED","title":"V0.4-E2 ‚Äî Patient Flow V2"},{"body":"Decide on the primary appearance for v0.4 (likely light mode with strong readability)\nand fix all form-related styles.\n\nRequirements:\n- Ensure form backgrounds are white (or very light) and text is black or very dark.\n- Avoid partially implemented dark backgrounds with low contrast text.\n- Make sure placeholders and helper texts are readable.\n\nAcceptance Criteria:\n- [ ] Core forms (Clinician, Admin, Patient) use white or very light backgrounds by default.\n- [ ] Text and labels are dark enough for good contrast.\n- [ ] No view shows unreadable combinations (e.g. dark blue background + dark text).\n- [ ] If any dark sections exist, they are intentional and still readable.\n\nParent Epic: #198","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruQ","name":"V0.4-E1","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"}],"number":202,"state":"CLOSED","title":"Harmonize Color/Theme Behavior Across Forms"},{"body":"Create a small but robust UI component library under `components/ui`:\n\nComponents:\n- Button (variants: primary, secondary, subtle, destructive)\n- Card (with header + body slots, optional footer)\n- Table (or shared table styles for clinician/admin list views)\n- Form controls: Input, Textarea, Select, Label, HelperText, ErrorText\n\nImplementation notes:\n- Use v0.4 design tokens for spacing, colors, typography.\n- Avoid over-engineering; focus on covering 80% of current needs.\n- Gradually replace existing ad-hoc HTML in clinician/admin pages with these components.\n\nAcceptance Criteria:\n- [ ] A documented set of UI components exists under `components/ui`.\n- [ ] Clinician/Admin pages use shared Button and Card components instead of raw HTML buttons/divs.\n- [ ] Default form controls are visually consistent and easy to read.\n- [ ] No random inline styles override the base components without a clear reason.\n\nParent Epic: #198","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruQ","name":"V0.4-E1","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNNERA","name":"components","description":"","color":"ededed"}],"number":201,"state":"CLOSED","title":"Create Core UI Components (Button, Card, Table, Form Controls)"},{"body":"Implement a global layout component for clinician/admin routes using v0.4 design tokens.\n\nParent Epic: #198","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruQ","name":"V0.4-E1","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDsGw","name":"layout","description":"","color":"ededed"}],"number":200,"state":"CLOSED","title":"Implement Global App Layout (Header, Sidebar, Content Shell)"},{"body":"Define core design tokens for v0.4 and document them. See planning docs for details.\n\nParent Epic: #198","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruQ","name":"V0.4-E1","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"}],"number":199,"state":"CLOSED","title":"Define v0.4 Design Tokens (Colors, Typography, Spacing)"},{"body":"Epic Goal:\nEstablish a modern, consistent UI and a small design system (tokens + components) used across\nClinician, Admin, and Patient areas.\n\nWhy:\n- Current UI feels outdated and inconsistent.\n- We need a shared design language to accelerate future work.\n\nScope:\n- Design tokens (colors, typography, spacing)\n- Global layout (header, sidebar, content)\n- Core UI components (Buttons, Cards, Tables, Form controls)\n- Minimal dark/light mode decision for v0.4\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"}],"number":198,"state":"CLOSED","title":"V0.4-E1 ‚Äî Global UI Refresh & Design System"},{"body":"Implement a global layout component for clinician/admin routes using v0.4 design tokens.\n\nParent Epic: #195","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruQ","name":"V0.4-E1","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDsGw","name":"layout","description":"","color":"ededed"}],"number":197,"state":"CLOSED","title":"Implement Global App Layout (Header, Sidebar, Content Shell)"},{"body":"Define core design tokens for v0.4 and document them. See planning docs for details.\n\nParent Epic: #195","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruQ","name":"V0.4-E1","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"}],"number":196,"state":"CLOSED","title":"Define v0.4 Design Tokens (Colors, Typography, Spacing)"},{"body":"Epic Goal:\nEstablish a modern, consistent UI and a small design system (tokens + components) used across\nClinician, Admin, and Patient areas.\n\nWhy:\n- Current UI feels outdated and inconsistent.\n- We need a shared design language to accelerate future work.\n\nScope:\n- Design tokens (colors, typography, spacing)\n- Global layout (header, sidebar, content)\n- Core UI components (Buttons, Cards, Tables, Form controls)\n- Minimal dark/light mode decision for v0.4\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"}],"number":195,"state":"CLOSED","title":"V0.4-E1 ‚Äî Global UI Refresh & Design System"},{"body":"Implement a global layout component for clinician/admin routes using v0.4 design tokens.\n\nParent Epic: #192","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruQ","name":"V0.4-E1","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDsGw","name":"layout","description":"","color":"ededed"}],"number":194,"state":"CLOSED","title":"Implement Global App Layout (Header, Sidebar, Content Shell)"},{"body":"Define core design tokens for v0.4 and document them. See planning docs for details.\n\nParent Epic: #192","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruA","name":"design","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDruQ","name":"V0.4-E1","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDr-Q","name":"child","description":"","color":"ededed"}],"number":193,"state":"CLOSED","title":"Define v0.4 Design Tokens (Colors, Typography, Spacing)"},{"body":"Epic Goal:\nEstablish a modern, consistent UI and a small design system (tokens + components) used across\nClinician, Admin, and Patient areas.\n\nWhy:\n- Current UI feels outdated and inconsistent.\n- We need a shared design language to accelerate future work.\n\nScope:\n- Design tokens (colors, typography, spacing)\n- Global layout (header, sidebar, content)\n- Core UI components (Buttons, Cards, Tables, Form controls)\n- Minimal dark/light mode decision for v0.4\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSNDrcg","name":"v0.4","description":"","color":"ededed"}],"number":192,"state":"CLOSED","title":"V0.4-E1 ‚Äî Global UI Refresh & Design System"},{"body":"**Quelle:** AFU-9 Control Center\n\n## Feature-Briefing\nSchreibe ein Executive Summary der aktuellen Version und nimm dabei die docs als basis. Auf max. 3 A4 Seiten beschreibe wo das Projekt steht\n\n---\n\n## Technische Spezifikation\n# Technische Spezifikation f√ºr das Projekt \"rhythmologicum-connect\"\n\n## 1. Kurzbeschreibung\nDas Projekt \"rhythmologicum-connect\" ist eine moderne Webanwendung, die auf der Next.js-Framework-Technologie basiert und Supabase als Backend-Datenbankl√∂sung verwendet. Ziel der Anwendung ist es, eine benutzerfreundliche Plattform zur Verwaltung und Analyse von rhythmologischen Daten bereitzustellen. Die aktuelle Version fokussiert sich auf die Implementierung grundlegender Funktionalit√§ten wie Benutzerregistrierung, Dateneingabe, -speicherung und -analyse. Die Anwendung ist darauf ausgelegt, eine hohe Benutzerfreundlichkeit sowie Skalierbarkeit zu gew√§hrleisten und wird kontinuierlich weiterentwickelt, um den sich √§ndernden Anforderungen gerecht zu werden.\n\n## 2. Akzeptanzkriterien\n- Erfolgreiche Benutzerregistrierung und -anmeldung.\n- Daten k√∂nnen fehlerfrei eingegeben, gespeichert und abgerufen werden.\n- Echtzeit-Analyse von rhythmologischen Daten ist m√∂glich.\n- Responsives Design, das auf Desktop- und Mobilger√§ten optimal funktioniert.\n- Die Anwendung erf√ºllt die Datenschutzanforderungen (DSGVO).\n- Benutzerfreundliche und intuitive Benutzeroberfl√§che.\n- Ausreichende Performance-Tests zeigen Latenzzeiten unter 2 Sekunden f√ºr kritische Funktionen.\n\n## 3. Technische Hinweise\n### Frontend\n- **Technologie**: Next.js 12+\n- **Frameworks/Bibliotheken**: React, Tailwind CSS f√ºr das Styling, Zustand-Management mit Redux oder Context API.\n- **Routing**: Implementierung von dynamischem Routing f√ºr verschiedene Ansichten (z.B. Dashboard, Benutzerprofil).\n  \n### Backend\n- **Technologie**: Supabase als Backend-as-a-Service (BaaS).\n- **Authentifizierung**: Nutzung von Supabase Auth f√ºr sichere Benutzeranmeldung und -registrierung.\n- **API**: RESTful API zur Interaktion zwischen Frontend und Backend.\n\n### Datenbank\n- **Technologie**: PostgreSQL √ºber Supabase.\n- **Schema**: Nutzung von Tabellen zur Speicherung von Benutzerdaten, rhythmologischen Daten und Analysen.\n\n## 4. Eventuelle DB-√Ñnderungen\n- Erstellung neuer Tabellen zur Speicherung von Analyse-Ergebnissen.\n- Hinzuf√ºgen von Indizes f√ºr h√§ufig abgefragte Daten, um die Abfragegeschwindigkeit zu erh√∂hen.\n- Implementierung von Triggern oder Stored Procedures zur Automatisierung von Datenverarbeitungsprozessen.\n- Anpassungen an bestehenden Tabellen, um neue Datenfelder f√ºr zus√§tzliche Analyseparameter zu integrieren.\n\n## 5. Risiken / Edge Cases\n- **Benutzeranmeldung**: Risiko von Brute-Force-Angriffen; Implementierung von Captcha zur Sicherheit.\n- **Datenintegrit√§t**: M√∂glichkeit von Inkonsistenzen bei gleichzeitigen Daten√§nderungen; Implementierung von Transaktionsmanagement.\n- **Performance**: Hohe Zugriffszahlen k√∂nnten die Serverleistung beeintr√§chtigen; Skalierungsstrategien m√ºssen geplant werden.\n- **Kompatibilit√§tsprobleme**: Verschiedene Browser und Ger√§te k√∂nnten Darstellungsprobleme verursachen; umfassende Tests sind erforderlich.\n- **Datenschutz**: Verletzung von Datenschutzrichtlinien durch unsachgem√§√üe Datenhandhabung; regelm√§√üige Audits und Schulungen f√ºr das Team sind notwendig.\n\nDiese technische Spezifikation gibt einen √úberblick √ºber den aktuellen Stand des Projekts \"rhythmologicum-connect\" und bietet eine Grundlage f√ºr die weitere Entwicklung und Optimierung der Anwendung. Die n√§chsten Schritte umfassen die Implementierung der akzeptierten Kriterien sowie die Durchf√ºhrung von Tests, um die Funktionalit√§t und Benutzerfreundlichkeit sicherzustellen.\n\n---\n*Erstellt durch AFU-9 v0.1*\n*Label: source:afu-9*","labels":[{"id":"LA_kwDOQfuwnc8AAAACSLEbjw","name":"source:afu-9","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSLEbkA","name":"codefactory","description":"","color":"ededed"}],"number":190,"state":"CLOSED","title":"Executive Summary der aktuellen Version"},{"body":"\nZiel\n\nAlle Eingabe- und Textfelder in der Anwendung sollen ein konsistentes, gut lesbares Standard-Theme haben:\n\nHintergrund der Felder: wei√ü\n\nTextfarbe in Feldern: schwarz\n\nDies soll f√ºr alle relevanten Seiten/Forms gelten (z. B. Content-Editor, Metadaten-Formulare, Funnel-Config, etc.).\n\nBeschreibung\n\nAktuell werden in manchen Views (siehe Screenshot ‚ÄûMetadaten / Inhalt (Markdown)‚Äú) Eingabefelder und Textbereiche mit dunkelblauem Hintergrund und heller Schrift dargestellt. Das f√ºhrt zu schlechter Lesbarkeit und wirkt im Gesamtlayout inkonsistent.\n\nAnpassungen:\n\nForm-Felder (Inputs, Textareas, Selects)\n\nHintergrundfarbe: wei√ü (#ffffff)\n\nTextfarbe: schwarz (#000000)\n\nPlaceholder-Texte: dunkles Grau (z. B. #6b7280), gut lesbar\n\nFokuszustand: klar erkennbarer Rand (z. B. leicht abgesetzte Border-Farbe), aber weiterhin wei√ües Feld\n\nLabels, Hilfe-Texte, Fehlermeldungen\n\nLabels: dunkle Textfarbe (schwarz oder sehr dunkles Grau)\n\nHilfetexte: dezentes Grau, aber klar lesbar\n\nFehlermeldungen: rot, auf wei√üem Hintergrund der Felder gut sichtbar\n\nGlobaler Ansatz\n\nDie √Ñnderungen sollen zentral (z. B. √ºber globale Tailwind-Klassen, Komponenten-Styling oder ein Theme-Config) umgesetzt werden, damit alle bestehenden und zuk√ºnftigen Formulare automatisch profitieren.\n\nBestehende Sonder-Styles f√ºr Dark-Mode-Felder pr√ºfen und entfernen/√ºberschreiben, sofern sie die Lesbarkeit verschlechtern.\n\nBetroffene Seiten (mindestens)\n\nContent-Editor (Metadaten + Inhalt/Markdown, Live-Vorschau)\n\nFunnel-/Assessment-Konfiguration\n\nClinician-/Admin-Formulare\n\nAlle sonstigen Views mit Eingabeformularen im Projekt\n\nTechnische Hinweise\n\n√úberpr√ºfen der globalen Form-Komponenten (z. B. Input, Textarea, Select) und Anpassung der Default-Klassen (Tailwind o. √Ñ.).\n\nPr√ºfen, ob ein globaler ‚ÄûDark Mode‚Äú aktiv ist, der Felder dunkel einf√§rbt ‚Äì ggf. explizit √ºberschreiben (bg-white text-black).\n\nSicherstellen, dass die neue Farbgebung responsiv und barrierearm bleibt (Kontrastverh√§ltnis beachten).\n\nAkzeptanzkriterien\n\n Alle Standard-Inputs, Textareas und Selects haben wei√üen Hintergrund und schwarze Schrift ‚Äì unabh√§ngig von der Seite.\n\n Der Content-Editor (Metadaten + Markdown-Bereich) zeigt alle Felder wie gew√ºnscht (wei√ü/schwarz), sowohl links (Editor) als auch rechts (ggf. Eingabefelder in der Live-Vorschau).\n\n Labels, Hilfetexte und Fehlermeldungen sind klar lesbar und farblich konsistent.\n\n Es gibt keine Stellen mehr in der App, an denen Eingabefelder mit dunkelblauem Hintergrund und heller Schrift erscheinen (sofern nicht ausdr√ºcklich als Spezialkomponente gew√ºnscht).\n\n √Ñnderung ist zentral umgesetzt (kein Copy&Paste pro Seite), so dass neue Formulare automatisch das neue Styling nutzen.","labels":[],"number":186,"state":"CLOSED","title":"UI-Styles vereinheitlichen: Form-Felder wei√ü, Text schwarz (global)"},{"body":"Issue: 0.3 Minor Fixes ‚Äì Clinician UI, Content Sections, Input/Buttons, Content Rendering\n\nMilestone: v0.3\nPriority: High (Release-Blocker)\nType: Bugfix + UI Cleanup + Backend Fix\n\nProblem√ºbersicht\n\nVor Abschluss von v0.3 sind mehrere UI- und Backend-Fehler vorhanden, die die Clinician-Ansicht, die Content-Pages und das CMS-Editing beeintr√§chtigen. Insbesondere verhindert ein 500-Fehler das Anlegen von Content-Sections und f√ºhrt dazu, dass Content gar nicht angezeigt wird.\n\nFix-Scope\n1. Clinician Navigation & Title vereinheitlichen\n\nAktuell wechselt der Titel/Navi teils zwischen admin und clinician.\nZiel:\n\nRoute /clinician ‚Üí konsistente Header-Titel: Clinician Dashboard\n\nEinheitliche Navigation links:\n\nDashboard\nFunnels\nContent\n\n\nKein Wechsel auf \"Admin\", keine dynamische √Ñnderung\n\nStyling gem√§√ü App-Standard (shadcn/ui)\n\n2. API-Fehler beim Anlegen einer Section beheben\n\nFehler:\n\nPOST /api/admin/content-pages/{id}/sections ‚Üí 500 Internal Server Error\n\n\nFrontend-Trace:\n\n34c7e896...js ‚Ä¶ af8b3de3...js  \nPOST .../sections 500 (Internal Server Error)\n\n\nWahrscheinliche Ursachen:\n\nfehlende page_id / content_page_id Validierung\n\nPrisma/Supabase Insert schl√§gt fehl (z. B. null slug, null sort, invalid type)\n\nMigration f√ºr sections nicht korrekt ausgerollt\n\nfehlender jsonb Default f√ºr section data\n\nTasks:\n\nServer-Error reproduzieren ‚Üí vollst√§ndige Fehler-Message in Logs pr√ºfen\n\nInsert-Schema f√ºr sections pr√ºfen (API Route + Supabase Tabelle)\n\nSicherstellen, dass folgende Felder korrekt gesetzt werden:\n\npage_id (UUID)\n\ntype (string)\n\nsort (int, default 0 oder next index)\n\ndata (jsonb, default {})\n\nFehlerhandeleung im Route-Handler erg√§nzen (400 vs. 500)\n\n3. Alle Input-Felder ‚Üí schwarze Schrift (nicht grau)\n\nAktuell zeigen mehrere Inputs text-gray-400 oder default-Tailwind-Gray.\nFix:\n\nSofortige Standardisierung aller Textinputs, Textareas, Selects auf:\n\"text-black placeholder-gray-400 dark:text-black\"\n\n√úber shadcn/ui Komponente global √ºberschreiben (/styles/globals.css)\n\nKeine Inline-Farbwerte mehr\n\n4. Alle Buttons sollen gleiche Gr√∂√üe haben\n\nProblem:\n\nButtons in unterschiedlichen Pages haben verschiedene H√∂hen/Breite/Padding\n\nMischung aus size=\"sm\", default, Custom-Tailwind etc.\n\nFix:\n\nEinheitliches Button-Sizing definieren:\nZwei Gr√∂√üen: default und sm, Rest entfernen\n\nKonsistentes Layout:\n\nh-10 px-4 py-2 rounded-md\n\nIcon-Buttons separat, definierte Gr√∂√üe\n\nAlle Buttons im CMS und Clinician-Bereich angleichen\n\nAuch mobile Darstellungen pr√ºfen\n\n5. Content Pages werden nicht angezeigt\n\nSymptome:\n\nContent-Liste leer oder Pages werden nicht gerendert\n\nSehr wahrscheinlich:\n‚Üí fehlende Sections (weil Section-API 500 wirft)\n‚Üí Page-Renderer erwartet mindestens 1 Section\n‚Üí Fehler im getContentPage(id) Query\n\nFix:\n\nSicherstellen, dass Content-Pages ohne Sections eine leere Array zur√ºckgeben, nicht null\n\nNull-Checks in Page-Renderer einbauen\n\nSobald Section-Insert-Bug gefixt ‚Üí Content-Rendering erneut testen\n\nZus√§tzlich pr√ºfen:\n\npublished = true Filter korrekt?\n\nStimmt der Slug?\n\nAI-Seed-Content vorhanden?\n\nAbnahmekriterien (AKs)\nClinician UI\n\n /clinician zeigt immer denselben Titel: ‚ÄûClinician Dashboard‚Äú\n\n Einheitliche Link-Navigation: Dashboard / Funnels / Content\n\n Keine admin-Labels mehr sichtbar\n\nSection-API\n\n POST /sections erzeugt fehlerfrei eine neue Section\n\n Section erscheint sofort im Editor\n\n Keine 500-Errors mehr\n\n Logs enthalten sprechende Fehlermeldungen (bei invalid input)\n\nEingabefelder\n\n Alle Texte in Inputs/Selects/Textareas schwarz\n\n Keine grauen Texte au√üer Placeholder\n\nButtons\n\n Alle Buttons im Clinician-Bereich optisch konsistent\n\n Einheitliche H√∂he + Padding\n\n Mobile Layout korrekt\n\nContent Rendering\n\n Content-Pages erscheinen zuverl√§ssig im Clinician-‚ÄûContent‚Äú Bereich\n\n Pages ohne Sections werden ohne Fehler angezeigt (leere Page)\n\n Section-Erstellung + Rendering funktionieren end-to-end\n\nZusatz\n\nUm 0.3 sauber abzuschlie√üen, werden diese Fixes als ein geb√ºndelter Patch umgesetzt, vor Migration-Deployment und vor Start von 0.4.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":184,"state":"CLOSED","title":"Issue: 0.3 Minor Fixes ‚Äì Clinician UI, Content Sections, Input/Buttons, Content Rendering"},{"body":"Summary\n\nProduction lacks the stress-assessment funnel and the 10 seeded content pages because migrations aren‚Äôt being applied automatically.\nA new workflow [apply-migrations.yml](vscode-file://vscode-app/c:/Users/ADAEFLER/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) was added but hasn‚Äôt been run (or lacks required secrets).\nExisting migration [20251207150000_populate_stress_questions.sql](vscode-file://vscode-app/c:/Users/ADAEFLER/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) creates a funnel with slug stress, while later seeds expect stress-assessment.\nProblems\n\nMigrations from main are not applied to Supabase (no automated [supabase db push](vscode-file://vscode-app/c:/Users/ADAEFLER/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html); previous workflow only dumped schema).\nFunnel slug mismatch (stress vs stress-assessment) prevents downstream seeds from running.\nSeed migration [20251211070000_seed_stress_funnel_base_pages.sql](vscode-file://vscode-app/c:/Users/ADAEFLER/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) (10 pages) isn‚Äôt applied in prod.\nRequired Secrets\n\nSUPABASE_ACCESS_TOKEN (service role token with migration rights)\nSUPABASE_PROJECT_ID (Supabase project ref)\nProposed Fix\n\nSet the above secrets in GitHub repo settings.\nRun the new workflow ‚ÄúApply Supabase migrations‚Äù (manual dispatch on main) to push all pending migrations.\nAdd a corrective migration (or manual SQL) to update the funnel slug to stress-assessment if currently stress, e.g.:\nRe-run [supabase db push](vscode-file://vscode-app/c:/Users/ADAEFLER/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) (via the workflow) after the slug fix.\nVerify seeded pages:\nAcceptance Criteria\n\nWorkflow succeeds on main with migrations applied to the target Supabase project.\n[funnels.slug](vscode-file://vscode-app/c:/Users/ADAEFLER/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) includes stress-assessment (no stale stress slug).\ncontent_pages has the 10 base stress pages (all status published).\nFuture merges to main auto-apply migrations via the workflow.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":180,"state":"CLOSED","title":"Fix Supabase migration deployment and missing stress-assessment funnel/pages"},{"body":"## Kurzbeschreibung\n\nAuf dem Login Screen der Anwendung wird das bisherige einzelne \"R\"-Logo durch den Schriftzug \"RHYTHM\" ersetzt. Dies betrifft die visuelle Darstellung und das Styling des Login-Bereichs, ohne die Funktionalit√§t zu ver√§ndern.\n\n## Akzeptanzkriterien\n- Der Login Screen zeigt anstelle des einzelnen \"R\" den Schriftzug \"RHYTHM\".\n- Der Schriftzug ist gut lesbar und optisch ansprechend in das bestehende Design integriert.\n- Die √Ñnderung wirkt responsiv und passt sich verschiedenen Bildschirmgr√∂√üen an.\n- Die Funktionalit√§t des Login Screens bleibt unver√§ndert.\n- Die √Ñnderung ist in allen unterst√ºtzten Browsern konsistent dargestellt.\n\n## Technische Hinweise\n\n### Frontend\n- Im Next.js-Projekt wird die Komponente, die das \"R\"-Logo rendert, angepasst oder ersetzt.\n- Der Schriftzug \"RHYTHM\" wird als Text-Element (z.B. `<span>`, `<h1>`, o.√§.) mit passendem CSS-Styling dargestellt.\n- Styling soll idealerweise in TypeScript-kompatiblen CSS-Modulen oder Styled Components erfolgen, um Konsistenz mit dem bestehenden Design zu gew√§hrleisten.\n- Responsives Design sicherstellen (z.B. mittels CSS Flexbox/Grid und Media Queries).\n- Eventuell vorhandene SVG-Icons oder Bilddateien f√ºr das \"R\" werden entfernt oder ausgeblendet.\n- Accessibility: Schriftzug sollte semantisch korrekt eingebunden sein (z.B. als √úberschrift) und Screenreader-freundlich.\n\n### Backend / API\n- Keine √Ñnderungen erforderlich, da es sich um eine rein visuelle Anpassung handelt.\n\n### Datenbank\n- Keine √Ñnderungen erforderlich.\n\n## Risiken / Edge Cases\n- Der Schriftzug k√∂nnte auf kleinen Bildschirmen (z.B. Mobilger√§te) zu gro√ü oder zu klein wirken ‚Äì hier ist responsives Styling wichtig.\n- Falls das \"R\"-Logo in anderen Kontexten (z.B. Favicon, Meta-Tags) verwendet wird, muss sichergestellt werden, dass die √Ñnderung nur den Login Screen betrifft.\n- M√∂gliche Abh√§ngigkeiten oder Animationen, die mit dem \"R\" verkn√ºpft sind, m√ºssen √ºberpr√ºft und ggf. angepasst werden.\n- Performance: Schriftzug als Text ist in der Regel performant, aber falls bisher ein SVG verwendet wurde, k√∂nnte sich das Rendering minimal √§ndern.\n- Sicherstellen, dass keine Funktionalit√§t (z.B. Klick-Events auf das Logo) verloren geht, falls vorhanden.","labels":[{"id":"LA_kwDOQfuwnc8AAAACSLEbjw","name":"source:afu-9","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACSLEbkA","name":"codefactory","description":"","color":"ededed"}],"number":177,"state":"CLOSED","title":"Logo"},{"body":"Beschreibung:\nErstelle eine Markdown-Checkliste f√ºr die interne QS vor Release v0.3.\n\nAkzeptanzkriterien:\n\nDatei CONTENT_QA_CHECKLIST.md im Repo\n\nTestliste: Admin-Zugriff, CRUD, Sections, Rendering, Funnel-Integration","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":164,"state":"CLOSED","title":"F12 ‚Äì Content QA Checklist"},{"body":"Beschreibung:\nAutomatisches Einspielen der initialen Markdown-Pages.\n\nAkzeptanzkriterien:\n\n10 Seed-Seiten werden erzeugt (oder aktualisiert, idempotent)\n\nStatus initial published\n\nSlug-Mapping korrekt","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":163,"state":"CLOSED","title":"F11 ‚Äì Seed-Script (10 Basis-Seiten f√ºr Stress-Funnel)"},{"body":"Beschreibung:\nWrite-Operations nur f√ºr Admin/Clinician.\n\nAkzeptanzkriterien:\n\nPOST/PATCH/DELETE ‚Üí nur mit g√ºltiger Rolle\n\nGET ‚Üí Patienten erhalten nur published\n\nUnit-Test f√ºr Rollenpr√ºfung","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":162,"state":"CLOSED","title":"F10 ‚Äì API-Schutz f√ºr Content-CRUD"},{"body":"Beschreibung:\nSch√ºtze alle Admin-Content-Routen √ºber Middleware + Supabase-Role.\n\nAkzeptanzkriterien:\n\nNur Admin/Clinician haben Zugriff\n\nPatienten/Unregistered ‚Üí Redirect / Fehlerseite\n\nLogging optional","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":161,"state":"CLOSED","title":"F9 ‚Äì Admin-Route-Guarding (RBAC f√ºr /admin/content)"},{"body":"Beschreibung:\nErgebnis-Seiten des Stress-Funnels nutzen Content-Bausteine aus DB.\n\nAkzeptanzkriterien:\n\nTextbausteine via Slug laden\n\nScore-spezifische Logik bleibt im Code\n\nMarkdown sauber gerendert","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":160,"state":"CLOSED","title":"F8 ‚Äì Result-Bausteine dynamisch integrieren"},{"body":"Beschreibung:\nSeparate Anzeige dynamischer Info-Seiten (z. B. HRV, Schlaf, Stress-Typen).\n\nAkzeptanzkriterien:\n\nRoute /content/[slug]\n\nSEO-Title und Description optional aus DB\n\n404 f√ºr nicht vorhandene Slugs","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":159,"state":"CLOSED","title":"F7 ‚Äì Info-Pages Rendering unter /content/[slug]"},{"body":"Beschreibung:\nIntro-Seite des Stress-Funnels zeigt nun dynamische Inhalte aus DB.\n\nAkzeptanzkriterien:\n\nRoute l√§dt Page via Content Resolver\n\nLayout bleibt konsistent\n\n√Ñnderungen im Admin-Editor werden sofort sichtbar\n\nund √§ndere alle clinician seiten auf dieses men√º:\n\n<img width=\"367\" height=\"174\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/d8e84f40-6803-4898-a34d-d68b6103335d\" />","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":158,"state":"CLOSED","title":"F6 ‚Äì Intro-Page Integration in Stress-Funnel"},{"body":"Beschreibung:\nZentrales Modul zur Auswahl der passenden Content-Page nach Funnel, Kategorie, Slug.\n\nAkzeptanzkriterien:\n\nAPI: getContentPage(funnel, category, slug?)\n\nFallback auf Default-Pages\n\nFehlerhandling ohne Crash\n\nUnit-Tests vorhanden","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":157,"state":"CLOSED","title":"F5 ‚Äì Content Resolver (Core-Utility f√ºr Funnel Integration)"},{"body":"Beschreibung:\nImplementiere den Content-Status-Workflow.\n\nAkzeptanzkriterien:\n\nStatus-Feld: draft, published, archived\n\nPatienten sehen nur published\n\nAdmin sieht alles\n\nOptional: Soft-Delete (deleted_at)","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":156,"state":"CLOSED","title":"F4 ‚Äì Status Workflow: Draft / Published / Archived"},{"body":"Beschreibung:\nUnterst√ºtzung f√ºr 0‚Äìn Sections je Page.\n\nAkzeptanzkriterien:\n\nSection hinzuf√ºgen / l√∂schen\n\nTitel + Markdown pro Section\n\nReihenfolge per Up/Down\n\nPersistenz in content_page_sections\n\nFrontend rendert Sections in korrekter Reihenfolge","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":155,"state":"CLOSED","title":"F3 ‚Äì Content Sections (mehrteilige Seiten)"},{"body":"Beschreibung:\nImplementiere einen Editor zum Erstellen/Bearbeiten inkl. Markdown-Preview.\n\nAkzeptanzkriterien:\n\nFelder: Titel, Slug, Funnel, Kategorie, Status, Priorit√§t\n\nMarkdown-Editor + Live-Preview\n\nButtons: Speichern (Draft), Ver√∂ffentlichen, Abbrechen\n\nPOST/PATCH API-Anbindung\n\nSlug-Validierung","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":154,"state":"CLOSED","title":"F2 ‚Äì Content Page Editor (Markdown + Preview + CRUD)"},{"body":"Beschreibung:\nErstelle ein Dashboard unter /admin/content, das alle Content-Pages auflistet und Filter-/Suchfunktionen bietet.\n\nAkzeptanzkriterien:\n\nTabelle mit Titel, Slug, Funnel, Kategorie, Status, UpdatedAt\n\nFilter: Funnel, Kategorie, Status\n\nSuche √ºber Titel + Slug\n\nPagination\n\nButton: ‚ÄúNeue Seite anlegen‚Äù\n\nKlick auf Eintrag ‚Üí Editor","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":153,"state":"CLOSED","title":"F1 ‚Äì Admin Content Dashboard (Liste, Filter, Suche)"},{"body":"Aktuelles Verhalten\n\nWenn der Stress-Funnel ohne bestehendes Assessment gestartet wird (z. B. nach L√∂schen aller assessments-Eintr√§ge oder im neuen Browser/Patienten-Kontext), passiert folgendes:\n\nDie Seite versucht, den Assessment-Status zu laden.\n\nIn der Browser-Konsole erscheint:\n\nError loading assessment status: TypeError: Failed to fetch\n    at B (150c07d5af6fba17.js:1:7065)\n    at q (150c07d5af6fba17.js:1:6755)\n\n\nDer Fragebogen wird gar nicht mehr angezeigt ‚Äì weder Step 1 noch sonst etwas.\n\nFr√ºher wurde in diesem Zustand zwar eine (falsche) ‚ÄûAssessment-Status ung√ºltig‚Äú-Meldung mit endpoint:\"funnel-definition\" ausgegeben, aber der Funnel lie√ü sich wenigstens teilweise starten. Jetzt blockiert der harte Fetch-Fehler die komplette UI.\n\nErwartetes Verhalten\n\nWenn noch kein Assessment existiert, soll:\n\nEntweder automatisch ein neues Assessment angelegt werden\nund anschlie√üend der Status f√ºr dieses Assessment geladen werden,\n\noder der Client klar erkennen, dass ‚Äûkein aktives Assessment‚Äú ein eigener Zustand ist und dann:\n\ndie Funnel-Definition laden,\n\nStep 1 des Fragebogens anzeigen,\n\nbeim ersten ‚ÄûWeiter‚Äú-Klick ein neues Assessment anlegen.\n\nIn keinem Fall darf ein ‚ÄûFailed to fetch‚Äú dazu f√ºhren, dass √ºberhaupt kein Formular angezeigt wird.\n\nVermutete Ursache\n\nDer neue Code ruft jetzt konsequent einen Status-Endpunkt auf, z. B.:\n\n/api/funnels/[slug]/assessments/[assessmentId]/status\n\n\nIn der Situation ‚Äûkein Assessment vorhanden‚Äú passiert vermutlich eines der folgenden Dinge:\n\nassessmentId ist undefined/leer ‚Üí Request-URL ist ung√ºltig ‚Üí Next.js-Route schl√§gt fehl ‚Üí fetch wirft TypeError: Failed to fetch.\n\nDer Route-Handler wirft eine ungefangene Exception (z. B. Supabase-Query ohne Ergebnis und kein .single()-Handling) ‚Üí Next.js liefert 500 ohne Response ‚Üí fetch bricht ab.\n\nEs wird gar kein Request gebaut, weil eine Vorbedingung im Client fehlschl√§gt und fetch mit einer falschen URL aufgerufen wird.\n\nDer Client behandelt aktuell jeden Fehler im Status-Fetch (inkl. 404 / invalid assessment) als kritischen Fehler und rendert dann keinen Fallback (keine Definition, kein Step 1).\n\nKonkrete Aufgaben\n1. Backend: Status-Endpunkt robust machen\n\nIm Status-Handler:\n\nif (!assessmentId) {\n  return NextResponse.json(\n    { error: \"No assessment id provided\" },\n    { status: 400 }\n  );\n}\n\n\nSupabase-Query defensiv implementieren:\n\nconst { data: assessment, error } = await supabase\n  .from(\"assessments\")\n  .select(\"id, funnel_id, current_step_index, completed_at\")\n  .eq(\"id\", assessmentId)\n  .maybeSingle(); // oder single() mit sauberem Error-Handling\n\nif (!assessment) {\n  return NextResponse.json(\n    { error: \"Assessment not found\" },\n    { status: 404 }\n  );\n}\n\n// Nur wenn assessment vorhanden ist, Status-Objekt bauen und 200 zur√ºckgeben\n\n\nAlle anderen Fehler (error von Supabase, Exceptions) sauber loggen und als 500 mit JSON-Body zur√ºckgeben:\n\nconsole.error(\"Error loading assessment status\", error);\nreturn NextResponse.json(\n  { error: \"Internal server error\" },\n  { status: 500 }\n);\n\n\nDamit sollte fetch nie mehr mit TypeError: Failed to fetch abbrechen, sondern immer einen HTTP-Status mit JSON erhalten.\n\n2. Frontend: Initialen Zustand ‚Äûkein Assessment‚Äú modellieren\n\nFunktion, die beim √ñffnen/Start des Funnels l√§uft, in etwa:\n\nasync function loadOrCreateAssessment(funnelSlug: string) {\n  // a) versuchen, bestehenden Status zu laden\n  const res = await fetch(\n    `/api/funnels/${funnelSlug}/assessments/current/status`\n  );\n\n  if (res.status === 404) {\n    // Kein aktuelles Assessment ‚Üí neu anlegen\n    const createRes = await fetch(\n      `/api/funnels/${funnelSlug}/assessments`,\n      { method: \"POST\" }\n    );\n    if (!createRes.ok) throw new Error(\"Failed to create assessment\");\n\n    const created = await createRes.json(); // { assessmentId: string, ... }\n\n    return {\n      assessmentId: created.assessmentId,\n      currentStepIndex: 0,\n      isNew: true,\n    };\n  }\n\n  if (!res.ok) {\n    // andere Fehler ‚Üí UI-Fehler anzeigen, aber nicht ‚ÄûFailed to fetch‚Äú durchreichen\n    throw new Error(`Failed to load assessment status: ${res.status}`);\n  }\n\n  const status: AssessmentStatus = await res.json();\n  return { ...status, isNew: false };\n}\n\n\nWichtig:\n\n404 explizit als ‚Äûkein Assessment vorhanden‚Äú behandeln und nicht als generischen Fehler.\n\nErst nach erfolgreicher Status-Ermittlung oder Neuanlage die Definition laden und den richtigen Step anzeigen.\n\n3. Frontend: Fetch-Fehler abfangen und Nutzerfreundliche Anzeige\n\nDie aktuelle Fehlerstelle:\n\ntry {\n  const res = await fetch(statusUrl);\n  // ...\n} catch (err) {\n  console.error(\"Error loading assessment status:\", err);\n  setError(\"Der Fragebogen konnte nicht geladen werden. Bitte sp√§ter erneut versuchen.\");\n}\n\n\nSicherstellen, dass:\n\nsetError einen sichtbaren Hinweis in der UI rendert,\n\nund trotzdem ein ‚ÄûNeu starten‚Äú-Button angeboten wird, der ein neues Assessment anlegt.\n\nAkzeptanzkriterien\n\n Wenn keine assessments-Eintr√§ge existieren:\n\nAufruf des Stress-Funnels zeigt Step 1 des Fragebogens, ohne Console-Error.\n\n Beim ersten ‚ÄûWeiter‚Äú-Klick wird ein neues Assessment angelegt, Status geladen, und der n√§chste Step angezeigt.\n\n Der Status-Endpunkt liefert:\n\n404 mit JSON { error: \"Assessment not found\" } wenn es kein Assessment gibt,\n\n400 mit JSON { error: \"No assessment id provided\" } bei fehlender assessmentId,\n\n500 mit JSON { error: \"Internal server error\" } bei Serverfehlern.\n\n In keinem dieser F√§lle kommt auf Client-Seite noch TypeError: Failed to fetch.\n\n Bei echten Backend-Problemen wird eine klare Nutzerfehlermeldung angezeigt (‚ÄûDer Fragebogen konnte nicht geladen werden‚Ä¶‚Äú), nicht nur ein JS-Fehler in der Konsole.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRLh6WQ","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":149,"state":"CLOSED","title":"Stress-Funnel: Initialer Assessment-Start schl√§gt mit ‚ÄûTypeError: Failed to fetch‚Äú fehl ‚Äì kein Fragebogen angezeigt"},{"body":"### Zusammenfassung\n\nIm aktuellen Deploy von `rhythmologicum-connect` schl√§gt der Stress-Funnel nach dem ersten Schritt weiterhin fehl.\nDer Nutzer sieht eine Fehlermeldung:\n\n> ‚ÄûFehler: Assessment-Status ung√ºltig. Bitte Seite neu laden oder Support kontaktieren.‚Äú\n\nDarunter wird ein Debug-JSON angezeigt, das klar zeigt, dass hier die **Funnel-Definition** (Steps) als ‚ÄûAssessment-Status‚Äú interpretiert wird:\n\n```json\n{\n  \"endpoint\":\"funnel-definition\",\n  \"ok\":true,\n  \"status\":200,\n  \"steps\":[\n    { \"id\":\"23143ad1-6252-43fa-a0c6-77b4dc458aff\",\"type\":\"form\",\"orderIndex\":1 },\n    { \"id\":\"74bccd2a-8de3-4b22-b148-e4053ddd29db\",\"type\":\"form\",\"orderIndex\":2 }\n  ],\n  \"totalSteps\":2\n}\n```\n\nDie Fehlermeldung ist also korrekt ‚Äì nur der falsche Datentyp wird gepr√ºft. Es fehlt ein sauber implementierter und konsumierter **Assessment-Status-Endpoint**.\n\n---\n\n### Reproduktionsschritte\n\n1. `https://rhythmologicum-connect.vercel.app` √∂ffnen.\n2. Stress-Funnel starten (als Patient).\n3. Step 1 des Fragebogens ausf√ºllen.\n4. Auf ‚ÄûWeiter‚Äú klicken.\n\n**Beobachtung:**\n\n* Step 2 wird nicht angezeigt.\n\n* Stattdessen erscheint eine Fehlermeldung:\n\n  ```\n  Fehler: Assessment-Status ung√ºltig.\n  Bitte Seite neu laden oder Support kontaktieren.\n\n  Es wurden keine g√ºltigen Daten vom Server empfangen.\n  Sollte das Problem bestehen, bitte an die Praxis wenden.\n  ```\n\n* Unterhalb wird das oben gezeigte JSON mit `endpoint:\"funnel-definition\"` eingeblendet.\n\n---\n\n### Analyse\n\nEs scheint zwei getrennte Datenstrukturen / Endpoints zu geben:\n\n1. **FunnelDefinition**\n   Endpoint z. B. `GET /api/funnels/[slug]/definition`\n   Payload (vereinfacht):\n\n   ```ts\n   type FunnelDefinition = {\n     steps: Array<{\n       id: string\n       type: 'form' | 'info' | ...\n       orderIndex: number\n     }>\n     totalSteps: number\n   }\n   ```\n\n2. **AssessmentStatus**\n   Erwarteter Endpoint z. B. `GET /api/funnels/[slug]/assessments/[assessmentId]` oder `/status`\n   Erwartete Payload:\n\n   ```ts\n   type AssessmentStatus = {\n     assessmentId: string\n     funnelId: string\n     currentStepId: string | null\n     currentStepIndex: number\n     totalSteps: number\n     isCompleted: boolean\n     // optional: weitere Felder\n   }\n   ```\n\nIm Frontend existiert offenbar eine Funktion/Validierung, die **Assessment-Status** pr√ºft, etwa:\n\n```ts\nfunction validateAssessmentStatus(payload: any) {\n  if (\n    !payload ||\n    typeof payload.currentStepIndex !== \"number\" ||\n    typeof payload.totalSteps !== \"number\"\n  ) {\n    throw new Error(\"Assessment-Status ung√ºltig\");\n  }\n}\n```\n\nAktuell wird aber genau diese Validierung auf das Ergebnis des **Definition-Endpunkts** angewendet:\n\n* `payload.totalSteps` ist vorhanden,\n* `currentStepIndex`, `assessmentId`, `isCompleted` fehlen ‚Üí Validation schl√§gt fehl,\n* die Fehlerkomponente zeigt: ‚ÄûAssessment-Status ung√ºltig‚Äú plus Debug-Dump der letzten Response:\n\n  ```json\n  {\"endpoint\":\"funnel-definition\", ...}\n  ```\n\nDas spricht f√ºr einen der folgenden Fehler:\n\n1. Der ‚ÄûWeiter‚Äú-Flow ruft die **falsche API-Route** auf (Definition statt Status).\n2. Der Status-Endpoint ist (noch) nicht implementiert oder liefert nicht den erwarteten Typ.\n3. Im Client-Code werden Definition und Status miteinander vermischt (z. B. falscher Typ, falsches Mapping).\n\n---\n\n### Technische Aufgaben\n\n#### 1. Typen trennen: `FunnelDefinition` vs. `AssessmentStatus`\n\n* Explizite Typdefinitionen im Frontend anlegen:\n\n  ```ts\n  export type FunnelDefinition = {\n    steps: { id: string; type: string; orderIndex: number }[]\n    totalSteps: number\n  }\n\n  export type AssessmentStatus = {\n    assessmentId: string\n    funnelId: string\n    currentStepId: string | null\n    currentStepIndex: number\n    totalSteps: number\n    isCompleted: boolean\n  }\n  ```\n\n* Sicherstellen, dass:\n\n  * Funktionen, die Definition laden, den Typ `FunnelDefinition` verwenden.\n  * Funktionen, die Status/Progress laden, den Typ `AssessmentStatus` verwenden.\n\n#### 2. Status-Endpoint implementieren oder korrigieren\n\n* Route identifizieren: z. B.\n\n  ```txt\n  app/api/funnels/[funnelSlug]/assessments/[assessmentId]/route.ts\n  ```\n\n* Erwartetes Verhalten:\n\n  ```ts\n  export async function GET(...) {\n    const supabase = createClient();\n\n    const { data: assessment, error } = await supabase\n      .from(\"assessments\")\n      .select(\"id, funnel_id, current_step_index, completed_at\")\n      .eq(\"id\", params.assessmentId)\n      .single();\n\n    if (error || !assessment) {\n      return NextResponse.json(\n        { error: \"Assessment not found\" },\n        { status: 404 }\n      );\n    }\n\n    const totalSteps = // aus funnels/funnel_steps berechnen\n\n    const status: AssessmentStatus = {\n      assessmentId: assessment.id,\n      funnelId: assessment.funnel_id,\n      currentStepId: /* Mapping stepIndex ‚Üí stepId, falls vorhanden */,\n      currentStepIndex: assessment.current_step_index ?? 0,\n      totalSteps,\n      isCompleted: !!assessment.completed_at,\n    };\n\n    return NextResponse.json(status, { status: 200 });\n  }\n  ```\n\n* Edge Cases:\n\n  * Assessment nicht gefunden ‚Üí 404 JSON `{ error: \"Assessment not found\" }`\n  * DB-Fehler ‚Üí 500 JSON `{ error: \"Database error\", details: ... }`\n  * Keine ungefangenen Exceptions im Handler.\n\n#### 3. ‚ÄûWeiter‚Äú-Flow im Frontend korrigieren\n\n* Funktion suchen, die auf den ‚ÄûWeiter‚Äú-Button reagiert, z. B.:\n\n  ```ts\n  const handleNext = async () => {\n    setIsLoading(true);\n    try {\n      // 1. Antworten des aktuellen Steps speichern\n      await saveCurrentStepAnswers(...);\n\n      // 2. Status neu laden (ACHTUNG: Status-, nicht Definition-Endpoint)\n      const res = await fetch(\n        `/api/funnels/${funnelSlug}/assessments/${assessmentId}/status`,\n        { method: \"GET\" }\n      );\n\n      if (!res.ok) {\n        if (res.status === 404) {\n          // Assessment weg ‚Üí sauberer Fehler f√ºr Nutzer\n          throw new Error(\"Assessment wurde nicht gefunden.\");\n        }\n        throw new Error(`Failed to load assessment status: ${res.status}`);\n      }\n\n      const status: AssessmentStatus = await res.json();\n      validateAssessmentStatus(status);\n\n      setCurrentStepIndex(status.currentStepIndex);\n      // ggf. aus status.currentStepId den Step suchen und anzeigen\n    } catch (err) {\n      console.error(\"Error loading assessment status after next:\", err);\n      setError(\"Assessment-Status ung√ºltig oder konnte nicht geladen werden.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  ```\n\n* Wichtig:\n\n  * F√ºr den ‚ÄûWeiter‚Äú-Flow **nicht** einfach erneut `funnel-definition` verwenden.\n  * Definition nur f√ºr die Liste der Schritte verwenden, nicht f√ºr den aktuellen Fortschritt.\n\n#### 4. Validierung anpassen\n\n* `validateAssessmentStatus` nur auf echte `AssessmentStatus`-Responses anwenden.\n\n* Validierung f√ºr Definition separat halten, z. B.:\n\n  ```ts\n  function validateFunnelDefinition(def: any): def is FunnelDefinition {\n    return (\n      def &&\n      Array.isArray(def.steps) &&\n      typeof def.totalSteps === \"number\"\n    );\n  }\n  ```\n\n* Die Fehlerkomponente soll klar zwischen\n\n  * ‚ÄûDefinition ung√ºltig‚Äú\n  * und ‚ÄûStatus ung√ºltig‚Äú\n    unterscheiden.\n\n---\n\n### Akzeptanzkriterien\n\n* [ ] Beim Start eines neuen Stress-Assessments:\n\n  * Funnel-Definition wird korrekt geladen (Steps & `totalSteps`).\n* [ ] Nach dem Ausf√ºllen von Step 1 und Klick auf ‚ÄûWeiter‚Äú:\n\n  * Die Antworten werden gespeichert.\n  * Der **Assessment-Status** wird √ºber den richtigen Endpoint geladen.\n  * `currentStepIndex` wird korrekt erh√∂ht.\n  * Step 2 wird angezeigt, ohne Fehler in der Konsole.\n* [ ] Die Fehlermeldung ‚ÄûFehler: Assessment-Status ung√ºltig‚Äú tritt nicht mehr auf, solange der Status-Endpoint eine valide `AssessmentStatus`-Struktur liefert.\n* [ ] Falls der Status-Endpoint 404 oder 500 zur√ºckgibt:\n\n  * Die UI zeigt eine verst√§ndliche Fehlermeldung (‚ÄûAssessment nicht gefunden‚Äú / ‚ÄûServerfehler‚Äú) und bleibt nicht im Zwischenzustand h√§ngen.\n* [ ] Typen `FunnelDefinition` und `AssessmentStatus` sind im Frontend sauber getrennt und werden nicht mehr vermischt.\n\n---\n\n### Hinweise\n\n* In der Debug-Ausgabe im Frontend wird aktuell das Objekt mit `\"endpoint\":\"funnel-definition\"` angezeigt.\n  Das ist ein klarer Indikator daf√ºr, dass an dieser Stelle **der falsche Endpoint oder der falsche Typ** gepr√ºft wird.\n* Bitte bei der Umsetzung darauf achten, dass zuk√ºnftige Funnel (Sleep, etc.) die gleiche Status-Mechanik nutzen k√∂nnen ‚Äì also m√∂glichst generisch f√ºr alle Funnel implementieren.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRLh6WQ","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":147,"state":"CLOSED","title":"Stress-Funnel: Fehler ‚ÄûAssessment-Status ung√ºltig‚Äú ‚Äì Funnel-Definition wird f√§lschlich als Status behandelt"},{"body":"\nDie Clinician-Ansicht weist mehrere UX-/UI-Probleme auf, die den Gesamteindruck und die Bedienbarkeit beeintr√§chtigen.\nKonkret betrifft dies:\n\nFalsche Textfarbe / Theme-Inkonsistenz\nAuf der Seite\nhttps://rhythmologicum-connect.vercel.app/clinician\nwird die Headline grau gerendert, sollte jedoch schwarz sein (analog zu allen anderen Haupt√ºberschriften im System).\n\nSlug wird roh angezeigt\nAuf der Seite\nhttps://rhythmologicum-connect.vercel.app/clinician/funnels\nwird der Funnel-Slug (z. B. \"stress\") sichtbar angezeigt.\nErwartet wird eine deutsche, benutzerfreundliche Bezeichnung, nicht die interne technische ID.\n\nFunnel-Detailseite zeigt interne Variablen statt editierbarer Texte\nAuf der Funnel-Detailseite (siehe Screenshot/Beispiel) sind:\n\nFeldnamen nicht benutzeroptimiert (interne Variablennamen werden angezeigt),\n\nTexte nicht editierbar, obwohl Redakteure hier Inhalte (Titel, Beschreibung, Step-Benennungen, etc.) anpassen k√∂nnen sollten.\n\nDiese Probleme verhindern eine sinnvolle redaktionelle Nutzung der Clinician-Oberfl√§che.\n\nBetroffene Bereiche\n\nFrontend UI (Tailwind / React / Next.js)\n\nFunnel-Admin-Oberfl√§che (Clinician-View)\n\nLocale-/√úbersetzungssystem (de vs. slug)\n\nRendering der Funnel-Datenmodelle in der UI\n\nErwartete √Ñnderungen / Fixes\n1. Headline-Farben fixen (Clinician-Startseite)\n\nKlassen pr√ºfen, z. B. .text-gray-600 oder .text-muted-foreground\n\nKorrigieren zu .text-black bzw. .text-foreground\n\nSicherstellen, dass die Headline konsistent mit den globalen Typografie-Richtlinien ist.\n\nAkzeptanzkriterium:\n√úberschrift ‚ÄûClinician Dashboard‚Äú erscheint in schwarzer oder prim√§rer Textfarbe, nicht grau.\n\n2. ‚Äûslug‚Äú nicht anzeigen ‚Äì deutsche Funnel-Bezeichnung nutzen\n\nAktuell:\n\nSlug: stress\nSlug: sleep\n...\n\n\nErwartet:\n\nStress & Resilienz\nSchlaf & Regeneration\n‚Ä¶\n\n\nTasks:\n\nIm Funnel-Datenmodell pr√ºfen:\n\nslug ‚Üí technische ID (nicht anzeigen)\n\ndisplay_name oder title ‚Üí UI-Beschriftung\n\nFalls nicht vorhanden:\n\nFeld display_name in DB & API einf√ºhren (Migration),\n\noder Mapping im Frontend definieren (slug ‚Üí Anzeige-String).\n\nAkzeptanzkriterium:\nAuf /clinician/funnels werden nur deutsche, redaktionelle Titel angezeigt.\n\n3. Funnel-Detailseite: Variablennamen ersetzen & Inhalte editierbar machen\n\nProblem:\n\nNamen wie short_title, long_description, step_label werden roh angezeigt.\n\nTexte sind nicht editierbar.\n\nRedaktionelle Inhalte k√∂nnen nicht gepflegt werden.\n\nErwartete L√∂sung:\n\nLabels in der UI √ºbersetzen:\n\nshort_title ‚Üí ‚ÄûKurztitel‚Äú\n\nlong_title ‚Üí ‚ÄûLangtitel‚Äú\n\nshort_description ‚Üí ‚ÄûKurzbeschreibung‚Äú\n\nlong_description ‚Üí ‚ÄûBeschreibung‚Äú\n\nsteps ‚Üí ‚ÄûSchritte‚Äú\n\norderIndex ‚Üí ‚ÄûReihenfolge‚Äú\n\nEingabe-Felder hinzuf√ºgen:\n\nTextfelder f√ºr Titel & Beschreibungen\n\nTextfeld/Editor f√ºr Schrittbeschreibung\n\nSelect oder Input f√ºr Reihenfolge\n\nSave/Update-Call zu API:\n\nPATCH /api/clinician/funnels/[id]\n\nNeuer Content wird in Supabase gespeichert.\n\nOptional (empfohlen):\n\nValidierung hinzuf√ºgen\n\nLive-Preview der Funnel-Texte\n\nAkzeptanzkriterien:\n\nUI zeigt lesbare deutsche Labels statt Variablennamen.\n\nContent-Felder (Titel, Beschreibung, Step-Texte) sind editierbar.\n\n√Ñnderungen werden gespeichert und nach Reload korrekt angezeigt.\n\nKein ‚Äûslug‚Äú-Feld mehr f√ºr Redakteure sichtbar.\n\nZusammenfassung der Anforderungen f√ºr den GitHub-Agenten\n\n Headline-Farbproblem auf /clinician fixen\n\n Funnel-Slug durch deutschsprachigen Titel ersetzen\n\n Funnel-Detailseite refactoren:\n\nVariablenlabels ‚Üí deutsche UI-Labels\n\nredaktionelle Funneltexte editierbar machen\n\nAPI-Update f√ºr Funnel-Content implementieren\n\n UI-Konsistenz & Styling an das globale Design anpassen","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfMbEA","name":"Clinican","description":"","color":"a5f4a5"},{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":145,"state":"CLOSED","title":"Clinician-UI ‚Äì Textlabels, √úbersetzungen & Styling korrigieren Problem√ºbersicht"},{"body":"\n\nZusammenfassung\n\nIm aktuellen Deploy von rhythmologicum-connect ist der Stress-Funnel weiterhin defekt:\n\nNeues Assessment wird angelegt, Step 1 wird korrekt angezeigt.\n\nDer Nutzer kann Step 1 ausf√ºllen.\n\nBeim Klick auf ‚ÄûWeiter‚Äú passiert in der UI nichts ‚Äì der Step wechselt nicht.\n\nIn der Browser-Konsole taucht weiterhin ein Fehler auf:\n\nError loading assessment status: TypeError: Failed to fetch\n\n\nZuvor traten auch serverseitige Fehler auf (‚ÄûFunnel-ID fehlt im Assessment‚Äú, Foreign-Key-Verletzungen √ºber reports ‚Üî patient_measures), die bereits manuell in der DB bereinigt wurden. Das grundlegende Problem im Zusammenspiel aus API-Endpoint, DB-Datenkonsistenz und Frontend-Step-Navigation ist aber noch nicht behoben.\n\nDieses Issue soll den gesamten Zusammenhang (DB + API + Frontend) adressieren.\n\nHistorie / Kontext\n\nSchema-Umstellung\n\nEs wurde von einer einfachen assessments.funnel (TEXT) auf eine funnels-Tabelle mit assessments.funnel_id (FK) migriert.\n\nEs existieren / existierten Legacy-Records, bei denen funnel_id nicht gesetzt war.\n\nErste Fehlerbilder\n\nAPI-Call auf GET /api/funnels/stress/assessments/[assessmentId] lieferte 500 (Internal Server Error).\n\nKonsolen-Fehler:\n\nError loading assessment status: Error: Funnel-ID fehlt im Assessment.\n\n\nDaraus ist klar: Im Backend gibt es eine Logik wie if (!assessment.funnel_id) throw new Error(\"Funnel-ID fehlt im Assessment.\"), ohne vorher sauber zu pr√ºfen, ob assessment √ºberhaupt vorhanden ist bzw. wie mit Legacy-Daten umzugehen ist.\n\nWeitere DB-Probleme (Foreign Keys)\n\nBeim Bereinigen von Reports trat auf DB-Seite auf:\n\nERROR: 23503: update or delete on table \"reports\" violates foreign key constraint \"fk_patient_measures_report\" on table \"patient_measures\"\nDETAIL: Key (id)=(694292ba-3f08-41e9-82f2-398996a2d1fd) is still referenced from table \"patient_measures\".\n\n\nEs existierte z. B. folgender Eintrag in patient_measures:\n\nid            = 41c3fb55-fa1d-4ae6-a9aa-e1b2acbcfa0b\nreport_id     = 694292ba-3f08-41e9-82f2-398996a2d1fd\npatient_id    = 8966cd6e-e537-4179-8359-1855a108c70a\nstress_score  = 19\nsleep_score   = 33\nrisk_level    = low\n\n\nDie verkn√ºpften Daten wurden inzwischen manuell bereinigt (L√∂schen der Eintr√§ge in patient_measures, reports, assessments).\n\nAktueller Stand nach DB-Bereinigung\n\nAlle alten Assessments wurden gel√∂scht.\n\nBeim Starten eines neuen Stress-Funnels wird ein neues Assessment angelegt (sichtbar in Supabase).\n\nStep 1 (Formular) wird korrekt angezeigt, kann ausgef√ºllt werden.\n\nBeim Klick auf ‚ÄûWeiter‚Äú bleibt der Step h√§ngen, der Button hat keine sichtbare Wirkung.\n\nIn der Konsole erscheint weiterhin:\n\nError loading assessment status: TypeError: Failed to fetch\n\n\nDas deutet darauf hin, dass der API-Call, der nach dem Klick auf ‚ÄûWeiter‚Äú erfolgt (Status-/Next-Step-Endpunkt), entweder:\n\nim Route-Handler crasht, bevor eine saubere Response (404/4xx/5xx) gesendet wird, oder\n\neine nicht-OK-Response liefert, die im Frontend nicht robust behandelt wird (z. B. res.json() ohne res.ok-Check).\n\nAktuelles Fehlverhalten (aus Sicht des Nutzers)\n\nNutzer √∂ffnet den Stress-Funnel.\n\nNeues Assessment entsteht im Backend.\n\nStep 1 wird korrekt gerendert (Fragen erscheinen, Eingaben m√∂glich).\n\nKlick auf ‚ÄûWeiter‚Äú:\n\nUI bleibt in Step 1,\n\nkeine visuelle Fehlermeldung,\n\nim Hintergrund wird ein API-Call getriggert, der mit TypeError: Failed to fetch scheitert.\n\nErwartetes Verhalten\n\nNeues Assessment l√§sst sich vollst√§ndig durchlaufen:\n\nStep 1 ‚Üí ‚ÄûWeiter‚Äú ‚Üí Step 2 (oder Zielzustand bei nur 1 Step).\n\nAPI-Endpunkte:\n\nliefern immer eine definierte JSON-Response ({ ... }) mit sinnvollem HTTP-Status (2xx, 4xx oder 5xx),\n\ncraschen nicht (keine ungefangenen Exceptions im Route-Handler).\n\nFrontend:\n\nbehandelt nicht-2xx-Responses kontrolliert (z. B. 404 = ‚ÄûAssessment nicht gefunden oder gel√∂scht‚Äú, 500 = ‚Äûinterner Fehler‚Äú),\n\nzeigt bei Fehlern einen Hinweis und bleibt nicht einfach ‚Äûh√§ngen‚Äú.\n\nVermutete technische Ursachen\n\nRoute-Handler f√ºr Assessment-Status / Next-Step\n\nZugriff auf assessment.funnel_id oder andere Properties, obwohl assessment null ist oder ein DB-Fehler vorliegt.\n\nFehlende Unterscheidung zwischen:\n\n‚ÄûAssessment nicht gefunden‚Äú (404),\n\n‚ÄûLegacy/inkonsistente Daten‚Äú (400),\n\n‚Äûechter Server-/DB-Fehler‚Äú (500).\n\nUnvollst√§ndige Backfill-Migration der Assessments\n\nObwohl alte Assessments manuell gel√∂scht wurden, k√∂nnte weiterer Code noch alte Pfade oder Felder (funnel statt funnel_id) erwarten.\n\nEs ist nicht sichergestellt, dass alle relevanten Tabellen (assessments, reports, patient_measures, ggf. weitere) konform zum neuen Funnel-Schema sind.\n\nFrontend-Fehlerbehandlung im ‚ÄûWeiter‚Äú-Flow\n\nfetch-Ergebnis wird nicht robust gepr√ºft (res.ok, res.status), sondern direkt res.json() aufgerufen oder in einen Wrapper gesteckt, der bei Fehlern einfach einen generischen TypeError: Failed to fetch wirft.\n\nFehler im Status-/Next-Step-Call verhindern das Weiterz√§hlen des Step-Index, der Button bleibt ohne Effekt.\n\nStale Assessment-IDs\n\nDer Client k√∂nnte alte assessmentId-Werte (z. B. aus URL, Router-Params oder Local Storage) nutzen, die nach dem DB-Reset nicht mehr existieren, ohne mit 404 sinnvoll umzugehen.\n\nAufgaben f√ºr die Implementierung\n1. API-Route f√ºr Assessment-Status/Next-Step robust machen\n\nRoute suchen, die von der ‚ÄûWeiter‚Äú-Logik aufgerufen wird, vermutlich so etwas wie:\n\nGET /api/funnels/[funnelSlug]/assessments/[assessmentId]\n\n\noder ein √§hnlicher Status-/Next-Step-Endpunkt.\n\nIm Handler:\n\nsupabase.from(\"assessments\")...single()-Result sauber pr√ºfen:\n\nconst { data: assessment, error } = await supabase\n  .from(\"assessments\")\n  .select(\"id, funnel_id, patient_id, started_at, completed_at\")\n  .eq(\"id\", params.assessmentId)\n  .single();\n\nif (error) {\n  // 404 (Row not found) vs. echte DB-Errors unterscheiden\n  return NextResponse.json(\n    { error: \"Assessment not found\", details: error.message },\n    { status: 404 }\n  );\n}\n\nif (!assessment) {\n  return NextResponse.json(\n    { error: \"Assessment not found\" },\n    { status: 404 }\n  );\n}\n\nif (!assessment.funnel_id) {\n  return NextResponse.json(\n    { error: \"Funnel-ID fehlt im Assessment\" },\n    { status: 400 }\n  );\n}\n\n\nKeine ungefangenen throw new Error(...) im Top-Level verwenden, sondern immer eine JSON-Response mit Status zur√ºckgeben.\n\nZus√§tzlich Logging √ºber console.error(\"Assessment status error\", error) f√ºr Debugging in Vercel-Logs.\n\n2. DB-Konsistenz: Backfill-/Cleanup-Migration erg√§nzen\n\nMigration ins Repo schreiben (statt nur manuelle Einzel-SQLs), z. B.:\n\nAlle Legacy-Assessments ohne funnel_id:\n\nentweder mit der korrekten funnel_id verkn√ºpfen (√ºber funnels.slug = 'stress'),\n\noder (falls nur Testdaten) inklusive zugeh√∂riger reports/patient_measures l√∂schen.\n\nFalls sinnvoll: Foreign Keys auf ON DELETE CASCADE setzen, z. B.:\n\nalter table patient_measures\n  drop constraint fk_patient_measures_report;\n\nalter table patient_measures\n  add constraint fk_patient_measures_report\n  foreign key (report_id)\n  references reports(id)\n  on delete cascade;\n\n\nSicherstellen, dass nach dieser Migration:\n\nkein assessments-Eintrag mehr ohne g√ºltige funnel_id existiert,\n\nkeine verwaisten patient_measures ohne g√ºltigen report existieren.\n\n3. Frontend-Flow f√ºr ‚ÄûWeiter‚Äú-Button h√§rten\n\nFunktion suchen, die auf ‚ÄûWeiter‚Äú reagiert, z. B. in einem Hook oder Component:\n\nconst handleNext = async () => {\n  setIsLoading(true);\n  try {\n    const res = await fetch(`/api/funnels/${funnelSlug}/assessments/${assessmentId}`, { ... });\n\n    if (!res.ok) {\n      if (res.status === 404) {\n        // optional: neuen Assessment-Flow starten oder Fehlermeldung anzeigen\n      }\n      throw new Error(`Failed to load assessment status: ${res.status}`);\n    }\n\n    const data = await res.json();\n    // Step-Index erh√∂hen, UI aktualisieren\n  } catch (err) {\n    console.error(\"Error loading assessment status:\", err);\n    // dem Nutzer eine sichtbare Fehlermeldung anzeigen\n  } finally {\n    setIsLoading(false);\n  }\n};\n\n\nSicherstellen:\n\nDer Step-Index (z. B. currentStepIndex) wird nur bei erfolgreicher Response erh√∂ht.\n\nIm Fehlerfall gibt es zumindest eine sichtbare Meldung in der UI (‚ÄûFehler beim Laden des n√§chsten Schritts‚Äú).\n\n4. Reproduktions- und Abnahme-Szenario definieren\n\nManuelle Tests (am besten in der PR-Beschreibung dokumentieren):\n\nNeue Patient-Session starten, Stress-Funnel aufrufen.\n\nStep 1 vollst√§ndig ausf√ºllen.\n\n‚ÄûWeiter‚Äú klicken.\n\nErwartet: Step 2 (oder Ergebnis-Seite bei nur einem Step) erscheint.\n\nKeine ‚ÄûFailed to fetch‚Äú-Fehler mehr in der Konsole.\n\nSeite neu laden:\n\nErwartet: Assessment-Status wird geladen, korrekter aktueller Step/Status wird angezeigt.\n\nOptional: Abbruch / L√∂schung testen:\n\nAssessment l√∂schen (je nach Feature-Set) und erneut starten ‚Üí kein Crash, kein ‚ÄûFailed to fetch‚Äú.\n\nAkzeptanzkriterien (zusammengefasst)\n\n Kein TypeError: Failed to fetch mehr beim Klick auf ‚ÄûWeiter‚Äú im Stress-Funnel.\n\n API-Route f√ºr Assessment-Status/Next-Step liefert immer eine definierte JSON-Response (2xx/4xx/5xx), kein Crash.\n\n DB-Schema ist konsistent: keine assessments ohne funnel_id, keine verwaisten patient_measures ohne g√ºltigen report.\n\n Frontend reagiert robust auf 404/5xx:\n\nim Normalfall Step-Wechsel,\n\nim Fehlerfall sichtbare Fehlermeldung statt stillem H√§ngenbleiben.\n\n Manuelles Durchklicken eines vollst√§ndigen Stress-Assessments funktioniert im Production-Deploy ohne Fehler.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRLh6WQ","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":143,"state":"CLOSED","title":"Stress-Funnel: ‚ÄûWeiter‚Äú-Button reagiert nicht, Assessment-Status-API bricht mit ‚ÄûFailed to fetch‚Äú ab (inkl. DB-Migration/Backfill)"},{"body":"## Problem\n\nIm aktuellen Deploy von `rhythmologicum-connect` funktioniert der erste Schritt des Stress-Funnels, aber beim Klicken auf **‚ÄûWeiter‚Äú** passiert nichts.\n\nDetails:\n\n- Das Assessment wird neu angelegt (kann in Supabase gesehen werden).\n- Step 1 des Fragebogens wird korrekt gerendert und l√§sst sich ausf√ºllen.\n- Beim Klick auf ‚ÄûWeiter‚Äú passiert in der UI nichts, nur in der Konsole erscheint:\n\n  ```text\n  Error loading assessment status: TypeError: Failed to fetch\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRLh6WQ","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":141,"state":"CLOSED","title":"Bug: ‚ÄûWeiter‚Äú-Button im Stress-Funnel reagiert nicht (Assessment-Status-API bricht mit ‚ÄûFailed to fetch‚Äú ab)"},{"body":"\n\nProblem:\nThe endpoint GET /api/funnels/[funnelSlug]/assessments/[assessmentId] returns 500 for some existing assessments.\n\nIn production, we see:\n- 500 (Internal Server Error) for /api/funnels/stress/assessments/f81be60a-775e-4878-96ff-b96d5e1ca0ae\n- Console error: \"Error loading assessment status: Error: Funnel-ID fehlt im Assessment.\"\n\nThis error is thrown in our backend logic when assessment.funnel_id is missing.\n\nLikely cause:\nWe migrated from a text-based \"funnel\" field to a \"funnels\" table with a \"funnel_id\" foreign key on \"assessments\". Some legacy assessments don't have \"funnel_id\" set yet.\n\nAcceptance criteria:\n- The endpoint should not throw a 500 just because \"funnel_id\" is null for legacy data.\n- Either:\n  - gracefully handle missing funnel_id (return a clear 4xx/404), or\n  - add a small migration/backfill so that all existing assessments have a valid funnel_id.\n- Document the expected behavior for legacy assessments in the code comments.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRLh6WQ","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":138,"state":"CLOSED","title":"Fix assessment status endpoint when funnel_id is missing (legacy data)"},{"body":"ISSUE DESCRIPTION\nProblem\n\nBeim Aufruf eines Funnels wird die Fragen-/Form-Seite nicht geladen.\nStattdessen wird direkt die Result-Page gerendert.\n\nDie API liefert jedoch korrekte Funnel-Steps:\n\n{\n  \"endpoint\": \"funnel-definition\",\n  \"ok\": true,\n  \"status\": 200,\n  \"steps\": [\n    { \"id\": \"23143ad1-6252-43fa-a0c6-77b4dc458aff\", \"type\": \"form\", \"orderIndex\": 1 },\n    { \"id\": \"74bccd2a-8de3-4b22-b148-e4053ddd29db\", \"type\": \"form\", \"orderIndex\": 2 }\n  ],\n  \"totalSteps\": 2\n}\n\nErwartetes Verhalten\n\nDie UI soll den ersten Step (type: \"form\") rendern und Schritt-f√ºr-Schritt durch den Funnel f√ºhren.\n\nTats√§chliches Verhalten\n\nDie App springt sofort zur Result-Seite, ohne dass irgendein Step angezeigt wird.\n\nWahrscheinliche Ursachen (f√ºr Copilot)\n\nBitte pr√ºfe nacheinander:\n\nRenderer-Mapping:\nDer Komponenten-Mapper kennt den Step-Type \"form\" eventuell nicht ‚Üí default redirect.\n\nNavigation-Guards:\ncompleted_at, !currentStep, !assessmentId oder falsches currentIndex l√∂st Redirect aus.\n\nInitialisierung:\ncurrentIndex startet nicht bei 0 oder useSearchParams() liefert unerwartete Werte.\n\nFunnel-State:\nDer Frontend-State f√ºr ein neues Assessment ist eventuell nicht sauber initialisiert.\n\nAkzeptanzkriterien\n\n Funnel Steps werden korrekt angezeigt\n\n Kein automatischer Redirect zur Result-Page\n\n \"form\" Step bekommt eine funktionierende Komponente\n\n Navigation zwischen Step 1 und Step 2 funktioniert\n\n Result-Page wird erst nach Finaleingabe angezeigt\n\n Fehlerhafte Query-Parameter f√ºhren zu einer Fehlermeldung, nicht zu einem Redirect\n\nHinweise f√ºr den GitHub-Agent\n\nCode befindet sich vermutlich in:\n/app/funnel/[funnelId]/[assessmentId]/client.tsx oder √§hnlicher Struktur\n\nBitte sicherstellen, dass das Step-Type-Mapping vollst√§ndig ist.\n\nUnit tests f√ºr Step-Navigation erg√§nzen.","labels":[],"number":136,"state":"CLOSED","title":"Funnel UI: Steps werden nicht gerendert ‚Äì App springt direkt zur Result-Seite"},{"body":"Beschreibung\n\nIm aktuellen Deploy wird bei Aufruf des Stress-Funnels (Fragenseite) nicht der Fragebogen angezeigt, sondern direkt die Ergebnis-Seite. Das Verhalten tritt auf, wenn ich den Flow mobil nutze.\n\nIch habe keine M√∂glichkeit, mobil in die DevTools zu schauen, deshalb liegen keine Console- oder Network-Logs bei. Das Verhalten weicht aber klar vom erwarteten 0.3-Flow ab.\n\nErwartetes Verhalten\n\t‚Ä¢\tBeim Start des Stress-Funnels sollte zuerst die Fragenseite mit allen Fragen geladen werden.\n\t‚Ä¢\tErst nach Absenden des Fragebogens sollte die Result-Seite mit Score und AMY-Text erscheinen.\n\nTats√§chliches Verhalten\n\t‚Ä¢\tBeim Aufruf des Stress-Funnels wird sofort die Ergebnis-Seite gerendert.\n\t‚Ä¢\tDie Fragenseite erscheint gar nicht; es gibt keine sichtbare Fehlermeldung, nur der falsche Screen.\n\nSchritte zum Reproduzieren\n\t1.\tDeploy-URL im Browser √∂ffnen (prod / preview-URL einf√ºgen).\n\t2.\tAuf ‚ÄûStress-Check‚Äú / den entsprechenden Funnel-Link klicken.\n\t3.\tWarten, bis die Seite geladen ist.\n\t4.\tBeobachten: Statt Fragen erscheint direkt das Ergebnis.\n\nKontext / Umgebung\n\t‚Ä¢\tGer√§t: iPhone (mobil)\n\t‚Ä¢\tBrowser: Safari (iOS; ggf. ‚ÄûChrome iOS‚Äú erg√§nzen, falls getestet)\n\t‚Ä¢\tAktuelle App-Version: v0.3 (aktuelles Deploy auf Vercel/Supabase; genaue Commit-ID kann aus dem Deployment entnommen werden)\n\t‚Ä¢\tBackend: Supabase (Postgres, aktuelle Schema-Version aus schema.sql)\n\nVermutete Ursache / Hinweise f√ºr Copilot\n\t‚Ä¢\tM√∂gliche Ursache:\n\t‚Ä¢\tRouting-Logik im Stress-Funnel erkennt f√§lschlich einen vorhandenen Report/Assessment und leitet direkt zur Ergebnis-Ansicht weiter.\n\t‚Ä¢\tQuery-Parameter / Zustand (z. B. assessment_id, report_id oder Session-Status) werden falsch gesetzt oder nicht validiert.\n\t‚Ä¢\tFehler in der Bedingung: ‚ÄûWenn es einen bestehenden Report gibt ‚Üí zeige Result-Seite‚Äú, ohne zu pr√ºfen, ob wirklich ein vollst√§ndiges Assessment durchgef√ºhrt wurde.\n\t‚Ä¢\tBitte pr√ºfen:\n\t1.\tFrontend-Routing/Navigation f√ºr den Stress-Funnel (Fragenseite vs. Result-Seite).\n\t2.\tGuards/Checks in der Client-Komponente der Result-Seite (z. B. Verhalten, wenn report oder scores null sind).\n\t3.\tAPI/DB-Logik: Wird beim ersten √ñffnen des Funnels bereits ein Report/Assessment erzeugt, der die Frontend-Logik triggert?\n\t4.\tUnterschied Verhalten Desktop vs. Mobil (z. B. durch Caching, LocalStorage oder URL-Parameter).\n\nZus√§tzliche Aufgaben f√ºr das Issue\n\t‚Ä¢\tFehler reproduzieren (idealerweise einmal Desktop mit DevTools, einmal mobil im Simulator/Device).\n\t‚Ä¢\tRoot Cause identifizieren (Routing/State/Backend).\n\t‚Ä¢\tFix implementieren: Fragenseite muss immer initial kommen; Result-Seite nur, wenn ein abgeschlossenes Assessment vorliegt.\n\t‚Ä¢\tUnit-/Integration-Tests erg√§nzen (Happy Path + ‚Äûkein bestehender Report‚Äú + ‚Äûbestehender Report‚Äú).\n\t‚Ä¢\tKurzen Kommentar ins Issue mit Ursache und Fix-Beschreibung posten.","labels":[],"number":133,"state":"CLOSED","title":"Bug: Stress-Funnel zeigt direkt Ergebnis-Seite statt Fragenseite im aktuellen Deploy"},{"body":"\n### (Funnel Definition ‚Ä¢ Validation ‚Ä¢ Runtime Backend ‚Ä¢ Frontend Integration ‚Ä¢ Clinician Tools)\n\n## 1. √úberblick\n\nEpic B hatte das Ziel, das gesamte Funnel-System des Rhythmologicum technisch tragf√§hig zu machen ‚Äì von der Datenstruktur √ºber Validierung bis zur Laufzeitlogik.  \nMit den abgeschlossenen Issues B1‚ÄìB5 und den Erg√§nzungen B6‚ÄìB8 ist das Funnel-Framework jetzt:\n\n- vollst√§ndig **datengetrieben**,  \n- klinisch sinnvoll **validierbar**,  \n- serverseitig **kontrolliert**,  \n- und f√ºr Patient:innen wie Clinicians **benutzbar**.\n\nAlle Kernkomponenten eines modernen Funnel-/Assessment-Systems sind damit implementiert.\n\n---\n\n## 2. Ergebnisse von B1‚ÄìB8\n\n### **B1 ‚Äî Funnel Definition (DB & API)**\n- Einheitliches Datenmodell (`funnels`, `funnel_steps`, `funnel_step_questions`, `questions`)\n- FunnelDefinition API (`/api/funnels/{slug}/definition`)\n- Vollst√§ndig parametrisierbar √ºber DB\n- Grundlage f√ºr Runtime, Validation, Clinician UI\n\n### **B2 ‚Äî Required-Validation Layer**\n- Validierung pro Step und full-funnel\n- Nutzung von `is_required` aus DB\n- API: `/api/assessment-validation/validate-step`\n- Fehlerliste + Missing Questions sauber typisiert\n\n### **B2.2 ‚Äî Step-by-Step Flow (Client)**\n- Clientseitiger Step-Flow  \n- Auto-Save pro Frage  \n- Step-validierung + UX (Error-Scroll, Warnbanner)\n\n### **B3/B5 ‚Äî Funnel Runtime Backend**\n(vereint im finalen B5 Stand)\n\n- Start/Resume Assessment  \n  `POST /api/funnels/{slug}/assessments`\n- Status/Current Step  \n  `GET /assessments/{id}`\n- Step Validation  \n  `POST /steps/{stepId}/validate`\n- Answers Save  \n  `POST /assessment-answers/save`\n- Full Completion  \n  `POST /complete`\n- Step-Skipping Prevention  \n- Ownership & Auth Enforcement  \n- Status-Migration + Enum-basierte Struktur\n\n### **B6 ‚Äî Frontend Integration der Runtime**\n- Patientenseite nutzt jetzt Runtime statt lokalen State\n- Reload-fester Step-Flow\n- Navigation 100 % Backend-korreliert\n- Antworten & Validation laufen komplett √ºber B5\n\n### **B7 ‚Äî Clinician Funnel Management UI**\n- `/clinician/funnels`\n- Funnel-Liste\n- Funnel-Details (Steps + Fragen + Required-Flags)\n- Editierbar:\n  - is_active\n  - Required\n  - Step-Reihenfolge\n- Zugriff nur f√ºr Rollen: clinician/admin\n\n### **B8 ‚Äî Runtime Cleanup & API Harmonisierung**\n- Einheitliches Response-Schema\n- Logging-Verbesserungen\n- Konsolidierte Step-Skip-Validierung\n- Save-Endpoint-Harmonisierung\n- Monitoring-Hooks f√ºr Performance\n\n---\n\n## 3. Erf√ºllte Ziele des Epic B\n\n| Zielbereich | Erf√ºllt? | Beschreibung |\n|------------|----------|--------------|\n| **Datengetriebene Funnel** | ‚úîÔ∏è | Definitionen komplett in DB, per API abrufbar |\n| **Validierung** | ‚úîÔ∏è | Required-Validation, Full-Funnel Validation, Missing Questions |\n| **Runtime Backend** | ‚úîÔ∏è | Start/Status/Validate/Save/Complete voll implementiert |\n| **Sicherheit** | ‚úîÔ∏è | Auth, Ownership, Step-Skipping Enforcement, Logging |\n| **Frontend Workflow** | ‚úîÔ∏è | Runtime-basierter Step-Flow, reload-fest |\n| **Clinician Werkzeuge** | ‚úîÔ∏è | Erste Funnel-Pflegeseite live |\n| **Erweiterbarkeit** | ‚úîÔ∏è | Architektur vorbereitet f√ºr Conditional Logic (Epic C) |\n\nEpic B ist damit **vollst√§ndig abgeschlossen**.\n\n---\n\n## 4. Empfehlungen f√ºr sp√§tere Phasen (nicht Bestandteil von Epic B)\n\nDiese Punkte sind\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":129,"state":"CLOSED","title":"B9 -  EPIC B ‚Äî Abschluss & Final Consolidation"},{"body":"## Kontext\n\nNach B5 ist die Runtime funktional vollst√§ndig.  \nEs bleiben jedoch kleine technische Schulden:\n\n- Response-Struktur ist uneinheitlich (`ok`, `success`, `error`).\n- Save-Endpoint ist nicht unter dem Funnel-Pfad.\n- Step-Skipping-Checks sollten in einem zentralen Validator geb√ºndelt werden.\n- Kleine Verbesserungen f√ºr Logging/Monitoring.\n\nDieses Issue schafft Konsistenz & Wartbarkeit.\n\n---\n\n## Ziele\n\n1. Einheitliche API-Response-Konvention:\n   - Jede API antwortet mit:\n     ```json\n     { \"success\": boolean, \"data\": ..., \"error\": { code, message } }\n     ```\n\n2. Harmonisierung der Endpoints:\n   - Optionaler Umzug von `assessment-answers/save`\n     nach `/api/funnels/{slug}/assessments/{id}/answers/save`\n   - Sicherstellen, dass jeder Save request gegen Funnel+Step validiert.\n\n3. Zentralisierung von Step-Skipping Prevention:\n   - Ein Validator, der sowohl f√ºr `validate` als auch f√ºr `save` greift.\n\n4. Logging Improvements:\n   - Einheitliche Errorlogs\n   - Logging von Step-Skipping Attempts\n\n5. Monitoring Hooks vorbereiten:\n   - Platzhalter f√ºr Zeitmessungen (Response Time)\n   - Option f√ºr zuk√ºnftige Metrics-Dashboards\n\n---\n\n## Arbeitspakete (AKs)\n\n### AK1 ‚Äî API Response Normalisierung\n- Konsistentes Schema implementieren.\n- Alte Response-Felder (`ok`, `error`) migrieren.\n- Anpassung im Frontend (B6 abh√§nging).\n\n### AK2 ‚Äî Save-Endpoint Harmonisierung\n- Optional: neuen Pfad einf√ºhren und alten als Legacy aliasen.\n- Strikte Pr√ºfung:\n  - questionId geh√∂rt zu Step?\n  - stepId geh√∂rt zu Funnel?\n\n### AK3 ‚Äî Zentraler Step-Skip Validator\n- Serverseitig eine Utility-Layer:\n  - `ensureStepIsCurrent(assessment, stepId)`\n  - Verwendung in Validate + Save.\n\n### AK4 ‚Äî Logging Refactor\n- Level-basierte Logs (info, warn, error).\n- Strukturierte Logs (JSON).\n- Logging bei:\n  - Unauthorized\n  - Forbidden\n  - Step-Skipping\n  - Failed Validations\n\n### AK5 ‚Äî Vorbereitung Monitoring\n- Wrapper f√ºr jede API, der:\n  - Antwortzeit misst\n  - Fehler typisiert\n\n---\n\n## Akzeptanzkriterien\n\n- [ ] Alle API-Endpunkte nutzen einheitliches Response-Schema.\n- [ ] Save-Endpoint erf√ºllt dieselbe Path- und Validierungslogik wie andere Funnel-APIs.\n- [ ] Step-Skipping-Prevention ist zentral implementiert.\n- [ ] Logging ist einheitlich und strukturiert.\n- [ ] Monitoring-Hooks sind vorbereitet (aber kein Dashboard n√∂tig).\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":128,"state":"CLOSED","title":"B8 ‚Äî API/Response Harmonisierung & Funnel Runtime Cleanup"},{"body":"## Kontext\n\nFunnelDefinition ist datengetrieben in der DB.  \nEs existiert jedoch kein UI f√ºr Clinicians/Admins, um Funnel strukturiert zu verwalten  \n(Required-Flags, Step-Reihenfolge, Aktivierung/Deaktivierung).\n\nB7 liefert eine erste Pflegeseite unter /clinician/funnels.\n\n---\n\n## Ziele\n\n1. √úbersicht aller Funnel f√ºr Clinicians.\n2. Detail-Seite pro Funnel:\n   - Steps + order_index\n   - Fragen pro Step + Required-State\n3. Bearbeiten:\n   - is_active Toggle\n   - Required-Toggle pro Frage\n   - Step-Reihenfolge √§ndern (Up/Down)\n4. Rollen-basierter Zugriffsschutz.\n\n---\n\n## Arbeitspakete (AKs)\n(Details stehen bereits oben, hier verk√ºrzt)\n\n- Routing + Auth-Check\n- Funnel-Liste\n- Funnel-Detailseite\n- Editing-Functions:\n  - is_active\n  - is_required\n  - Step Reordering\n- Save-Endpunkte + Supabase-Updates\n- UI/UX Cleanup\n- Dokumentation + Tests\n\n---\n\n## Akzeptanzkriterien\n\n- [ ] Clinicians sehen Funnel-√úbersicht.\n- [ ] Funnel-Detailseite mit Steps + Fragen ist verf√ºgbar.\n- [ ] Required-Flags editierbar.\n- [ ] Step-Reihenfolge editierbar.\n- [ ] is_active steuerbar.\n- [ ] Zugriff nur f√ºr Rollen clinician/admin.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":127,"state":"CLOSED","title":"B7 ‚Äî Clinician Funnel Management UI"},{"body":"\n\n## Kontext\n\nNach der Implementierung von B5 existiert eine vollst√§ndige Funnel Runtime Backend-Schicht  \n(Start ‚Üí Step-Validierung ‚Üí Antworten speichern ‚Üí Completion).  \nDas aktuelle Frontend nutzt jedoch noch:\n\n- lokalen `currentStepIndex`,\n- direkte Supabase-Upserts,\n- keine persistente Step-State-Abfrage,\n- keinen serverseitigen Step-Schutz,\n- keinen offiziellen Start-/Status-/Completion-Flow.\n\nDieses Issue integriert das Frontend vollst√§ndig mit der Runtime-API, so dass der gesamte Ablauf serverseitig gesteuert wird.\n\n---\n\n## Ziele\n\n1. Frontend nutzt ausschlie√ülich Runtime-API:\n   - Start √ºber `POST /api/funnels/{slug}/assessments`\n   - Status + currentStep √ºber `GET /assessments/{id}`\n   - Step-Validierung nur via Runtime-API\n   - Antworten speichern via `POST /api/assessment-answers/save`\n   - Completion via Runtime-Endpoint\n\n2. Step-Navigation basiert auf Backend-Definition:\n   - kein lokaler Step-Index mehr\n   - Navigation folgt `currentStep` / `nextStep` aus API\n\n3. Reload-fester Flow:\n   - Browser-Refresh f√ºhrt nicht zu Step 1\n   - aktueller Step kommt immer von Runtime\n\n---\n\n## Arbeitspakete (AKs)\n\n### AK1 ‚Äî Assessment Bootstrapping\n- Beim √ñffnen des Stress-Funnels:\n  - Check: existiert ein laufendes Assessment?\n  - Falls nein: neues Assessment starten.\n  - Lade status + currentStep.\n\n### AK2 ‚Äî Step Rendering\n- UI rendert den Step aus API:\n  - Step-ID\n  - Step-Questions\n  - Progress aus `completedSteps` + `totalSteps`.\n\n### AK3 ‚Äî Step Navigation\n- Next:\n  - `validate(stepId)` aufrufen\n  - Bei Erfolg ‚Üí API gibt nextStep ‚Üí navigiere dorthin\n- Back:\n  - Vorherigen Step explizit aus FunnelDefinition ableiten.\n\n### AK4 ‚Äî Answer-Save\n- Ersetze Supabase-Client-Aufrufe durch den neuen Save-Endpoint.\n- Fehlerhandling verbessern (z. B. Offline-Hinweis).\n\n### AK5 ‚Äî Assessment Completion\n- Auf letztem Step:\n  - Button ‚ÄûAbschlie√üen‚Äú ‚Üí `POST /complete`\n  - Erfolg: Weiterleitung zur Result-Page.\n\n### AK6 ‚Äî Edge Cases\n- Assessment bereits `completed` ‚Üí Redirect auf Result-Page.\n- Assessment existiert nicht/invalid ‚Üí Spreche mit B5-Errorcodes.\n\n### AK7 ‚Äî Testing\n- Alle B5-Tests gegen das echte Frontend ausf√ºhren (T1‚ÄìT7).\n- Speziell pr√ºfen:\n  - Loading/Reload\n  - Step-Skipping Prevention\n  - Antworten bleiben nach Refresh vorhanden\n\n---\n\n## Akzeptanzkriterien\n\n- [ ] Frontend hat keine eigene Step-Logik mehr.\n- [ ] Nach Reload landet der Nutzer im korrekten Step.\n- [ ] Navigation basiert vollst√§ndig auf B5-Runtime.\n- [ ] Validierung + Save funktionieren serverseitig.\n- [ ] Assessment kann sauber abgeschlossen werden.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":125,"state":"CLOSED","title":"B6 ‚Äî Frontend-Integration der Funnel Runtime (B5)"},{"body":"## Kontext\n\nMit B1 existiert eine datenbankgetriebene FunnelDefinition (inkl. Steps und Questions).  \nMit B2 existiert eine funktionierende Validierungsebene (required-only).\n\nAktuell fehlt jedoch eine zentrale Backend-Komponente, die den gesamten Funnel-Ablauf serverseitig orchestriert: Assessment-Lifecycle, Step-Navigation, Antwortspeicherung, Validierung und Completion.  \nDiese ‚ÄûFunnel Runtime Engine‚Äú ist die Grundlage daf√ºr, dass Mobile- und Desktop-Apps einen konsistenten Ablauf nutzen k√∂nnen, ohne selbst komplexen State halten zu m√ºssen.\n\n---\n\n## Ziel\n\nEine wiederverwendbare, API-basierte Funnel-Runtime, die:\n\n1. Assessments verwaltet (Start, Fortschritt, Abschluss).\n2. Den aktuellen Step bestimmt und Step-Wechsel serverseitig kontrolliert.\n3. Antworten pro Step speichert (Upsert in assessment_answers).\n4. Validierung pro Step und globaler Validierung vor Completion erm√∂glicht.\n5. Step-Skipping verhindert.\n6. Eine einheitliche Schnittstelle f√ºr Mobile und Desktop bietet.\n\n---\n\n## Scope\n\n### In Scope\n- Backend-Endpunkte f√ºr Starten, Fortsetzen und Abschlie√üen eines Assessments.\n- Speichern von Antworten pro Step.\n- Schrittweise Validierung auf Basis der bestehenden B2-Logik.\n- Serverseitige Bestimmung des aktuellen Steps.\n- Navigation (currentStep, nextStep, prevStep).\n- Dokumentation und Testplan.\n\n### Out of Scope\n- Conditional Required Logik (B4).\n- Funnel-Authoring/Admin-UI.\n- Mehrsprachigkeit.\n\n---\n\n## API-Design\n\n### 1. Neues Assessment starten\n\n**POST /api/funnels/{slug}/assessments**\n\nResponse:\n```json\n{\n  \"assessmentId\": \"uuid\",\n  \"status\": \"in_progress\",\n  \"currentStep\": { /* StepDefinition */ }\n}\n2. Assessment-Status & aktuellen Step abrufen\nGET /api/funnels/{slug}/assessments/{assessmentId}\n\nResponse:\n\njson\nCode kopieren\n{\n  \"assessmentId\": \"uuid\",\n  \"status\": \"in_progress\",\n  \"currentStep\": { /* StepDefinition */ },\n  \"completedSteps\": [],\n  \"totalSteps\": 5\n}\n3. Antworten speichern\nPOST /api/funnels/{slug}/assessments/{assessmentId}/steps/{stepId}/answers\n\nBody:\n\njson\nCode kopieren\n{\n  \"answers\": [\n    { \"questionId\": \"uuid-q1\", \"answerValue\": 3 }\n  ]\n}\nAntworten werden idempotent per Upsert gespeichert.\n\n4. Step validieren & n√§chsten Step bestimmen\nPOST /api/funnels/{slug}/assessments/{assessmentId}/steps/{stepId}/validate\n\nResponse bei Erfolg:\n\njson\nCode kopieren\n{\n  \"ok\": true,\n  \"missingQuestions\": [],\n  \"nextStep\": { /* StepDefinition oder null */ }\n}\nResponse bei Fehler:\n\njson\nCode kopieren\n{\n  \"ok\": false,\n  \"missingQuestions\": [\n    { \"questionId\": \"uuid\", \"label\": \"Frage ...\" }\n  ]\n}\n5. Assessment abschlie√üen\nPOST /api/funnels/{slug}/assessments/{assessmentId}/complete\n\nF√ºhrt vollst√§ndige Funnel-Validierung aus.\n\nSetzt assessment.status = \"completed\" bei Erfolg.\n\nResponse:\n\njson\nCode kopieren\n{\n  \"ok\": true,\n  \"assessmentId\": \"uuid\",\n  \"status\": \"completed\"\n}\nArbeitspakete (AKs)\nAK1 ‚Äî Datenmodell & Konzept\nPr√ºfen, ob assessments alle ben√∂tigten Felder besitzen.\n\nFalls n√∂tig Migrationen erg√§nzen (status-Enum, funnel_id-FK).\n\nKonzept definieren: Wie wird currentStep bestimmt?\n\nexplizit (Feld current_step_index) oder\n\ndynamisch (aus beantworteten Steps ableiten).\n\nAK2 ‚Äî Assessment-Erstellung\nEndpoint POST /api/funnels/{slug}/assessments implementieren.\n\nFunnel laden und pr√ºfen.\n\nPatient √ºber Auth ermitteln.\n\nNeues Assessment anlegen (status = in_progress).\n\nErsten Step bestimmen.\n\nAK3 ‚Äî Assessment-Status-Endpoint\nGET /api/funnels/{slug}/assessments/{assessmentId}.\n\nOwnership pr√ºfen (Assessment geh√∂rt zu eingeloggtem User).\n\nStep ermitteln und zur√ºckgeben.\n\nAK4 ‚Äî Answer-Save\nPOST /steps/{stepId}/answers.\n\nPr√ºfen, dass stepId zum Funnel und Assessment geh√∂rt.\n\nNur Fragen aus funnel_step_questions akzeptieren.\n\nAntworten per Upsert speichern.\n\nFehler bei abgeschlossenem Assessment erzeugen.\n\nAK5 ‚Äî Step-Validierung & Navigation\nValidierungslogik aus B2 wiederverwenden.\n\nMissing Questions strukturiert zur√ºckgeben.\n\nnextStep anhand order_index bestimmen.\n\nStep-Skipping verhindern.\n\nAK6 ‚Äî Assessment Completion\nVollvalidierung (√ºber alle Steps).\n\nBei fehlenden Pflichtfragen 400 mit missingQuestions.\n\nBei Erfolg status = \"completed\".\n\nAK7 ‚Äî Sicherheit & Ownership\nAuth-Pflicht f√ºr alle Endpoints.\n\nOwnership des Assessments pr√ºfen.\n\nKorrekte Fehlercodes: 401/403/404/400.\n\nAK8 ‚Äî Dokumentation\nNeue Datei: docs/B3_FUNNEL_RUNTIME_BACKEND.md.\n\nArchitektur-√úberblick.\n\nSequenzdiagramm Start ‚Üí Antworten ‚Üí Validate ‚Üí Next ‚Üí Complete.\n\nBeispiel-Workflow f√ºr Mobile/Desktop.\n\nAK9 ‚Äî Testplan\nHappy Path: vollst√§ndiger Durchlauf.\n\nFehlerfall: fehlende Pflichtfrage ‚Üí Next blockiert.\n\nZugriff auf fremdes Assessment ‚Üí 403.\n\nSchritte in falscher Reihenfolge ‚Üí 400/403.\n\nSQL-Konsistenztests: answers & assessments.\n\nAkzeptanzkriterien\n Ein Assessment kann serverseitig gestartet, gepr√ºft und abgeschlossen werden.\n\n Der aktuelle Step wird serverseitig korrekt bestimmt.\n\n Step-Validierung blockiert Navigation, wenn Pflichtfragen fehlen.\n\n Step-Skipping wird zuverl√§ssig verhindert.\n\n Mobile & Desktop k√∂nnen denselben Ablauf konsumieren.\n\n answers werden korrekt und idempotent gespeichert.\n\n Dokumentation erkl√§rt Architektur, API-Endpunkte und Testf√§lle.\n\n Backwards-Kompatibilit√§t: bestehende Funktionslogik (B1/B2) bleibt funktionsf√§hig.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":120,"state":"CLOSED","title":"B5  ‚Äî Funnel Runtime Backend (Assessment Lifecycle & Step Navigation)"},{"body":"\nKontext\n\nDie aktuelle Validierung (B2) basiert auf einem einfachen Modell:\n\nfunnel_step_questions.is_required steuert, ob eine Frage Pflicht ist.\n\nEs gibt keine Abh√§ngigkeiten zwischen Fragen (z. B. ‚ÄûPflicht nur, wenn vorherige Frage = Ja‚Äú).\n\nF√ºr komplexere klinische Frageb√∂gen und Funnel-Logik werden dynamische Regeln ben√∂tigt, z. B.:\n\nFrage X ist nur Pflicht, wenn Frage Y eine bestimmte Antwort hat.\n\nFrage Z wird nur angezeigt, wenn eine Kombination von Bedingungen erf√ºllt ist.\n\nBestimmte Bl√∂cke von Fragen werden √ºbersprungen, wenn eine Antwort eine ‚ÄûAbk√ºrzung‚Äú triggert.\n\nDieses Issue erg√§nzt eine flexible, datengetriebene Validierungslogik, ohne das bestehende Grundschema zu brechen.\n\nZiel\n\nEinf√ºhrung einer erweiterbaren, dynamischen Validierungs- und Regel-Engine, die:\n\nConditional Required abbildet\n\nPflichtstatus kann abh√§ngig von anderen Antworten sein.\n\nDatengetrieben arbeitet\n\nRegeln werden aus der Datenbank gelesen, nicht hart im Code verdrahtet.\n\nMit der bestehenden B2-Logik kompatibel bleibt\n\nis_required bleibt als ‚ÄûBasis-Flag‚Äú, dynamische Regeln erg√§nzen/√ºberschreiben dies.\n\nFrontend-taugliche Fehler-/Hinweisstrukturen bereitstellt\n\nUI kann pr√§zise anzeigen, warum eine Frage Pflicht ist bzw. warum sie nicht erf√ºllt ist.\n\nScope\n\nIn Scope:\n\nDesign eines einfachen, aber erweiterbaren Regelmodells (z. B. JSON-basiert) f√ºr:\n\nConditional Required (abh√§ngig von anderen Fragen/Antworten)\n\nOptional: Conditional Visibility (Frage wird nur angezeigt, wenn Bedingungen erf√ºllt sind)\n\nErweiterung der bestehenden Validierung (requiredQuestions.ts) um:\n\nAuswertung dieser Regeln pro Assessment + Step\n\nR√ºckgabe strukturierter Fehler-/Statusobjekte\n\nMinimal-UI-Anpassungen:\n\nSinnvolle Fehlermeldungen bei konditionalen Pflichtverletzungen\n\nOptional: Hinweis im UI, wenn eine Frage ‚Äûcontextual required‚Äú ist\n\nOut of Scope in diesem Issue:\n\nVollwertiger, generischer Regel-Editor im Backend UI\n\nInternationalisierung (i18n) der Fehlertexte\n\nKomplexe Rule-Engine mit verschachtelter Logik, Custom-Skripten etc.\n\nVorschlag Datenmodell (Richtlinie, kein Muss)\n\nBeispielhafte Richtung (kann im Detail abweichen):\n\nNeue Tabelle (oder JSONB-Feld) f√ºr Regeln, z. B. funnel_question_rules:\n\nid\n\nquestion_id\n\nrule_type (z. B. conditional_required, conditional_visible)\n\nrule_payload (JSONB)\n\nBeispiel rule_payload f√ºr ‚ÄûFrage B ist Pflicht, wenn Frage A = 1 oder 2‚Äú:\n\n{\n  \"type\": \"conditional_required\",\n  \"conditions\": [\n    {\n      \"question_id\": \"A\",\n      \"operator\": \"in\",\n      \"values\": [1, 2]\n    }\n  ]\n}\n\nAufgaben (AKs)\n\nKonzept & Datenmodell\n\nKurzkonzept f√ºr die Regel-Engine erstellen (1‚Äì2 Seiten intern//docs).\n\nDatenmodell entwerfen:\n\nWo werden Regeln gespeichert (neue Tabelle vs. JSONB in existierender Tabelle)?\n\nWie werden Regeln einem Funnel/Step/Question eindeutig zugeordnet?\n\nEdge Cases im Konzept abdecken:\n\nMehrere Regeln f√ºr eine Frage (Kombination: AND/OR?)\n\nKonfliktf√§lle (Basis is_required = false, aber Regel sagt ‚Äûrequired‚Äú; oder umgekehrt).\n\nServerseitige Regel-Auswertung\n\nlib/validation/requiredQuestions.ts erweitern:\n\nLaden von Regeln f√ºr alle Fragen eines Steps/Funnels.\n\nLaden der bereits vorhandenen Antworten (assessment_answers).\n\nEvaluierung:\n\nBasis: is_required == true ‚Üí Frage ist Pflicht.\n\nZusatz: Regeln k√∂nnen Pflichtstatus toggeln (z. B. Pflicht nur bei erf√ºllter Bedingung).\n\nR√ºckgabe einer erweiterten Struktur, z. B.:\n\n{\n  ok: boolean;\n  missingQuestions: {\n    questionId: string;\n    reason: 'required' | 'conditional_required';\n    ruleId?: string;\n  }[];\n}\n\n\nSicherstellen, dass die Performance f√ºr normale Funnelgr√∂√üen ausreichend ist:\n\nMinimale Anzahl an DB-Queries (z. B. Batch-Laden von Regeln und Antworten).\n\nIntegration in bestehende Endpoints\n\napp/api/assessment-validation/validate-step/route.ts:\n\nNutzung der erweiterten Validierungslogik.\n\nResponse um ‚Äûreason‚Äú/Rule-Kontext erweitern (optional).\n\nSicherstellen, dass bestehende Clients/Hooks (B2) nicht brechen:\n\nAbw√§rtskompatible Response-Struktur:\n\nZ. B. neue Felder optional machen, default-Werte sinnvoll setzen.\n\nFrontend-Grundintegration (Stress-Check-Page)\n\nUI-Anpassung auf der Stress-Check-Seite:\n\nFehleranzeige unterscheiden k√∂nnen:\n\n‚ÄûPflichtfrage nicht beantwortet‚Äú (Basis-Pflicht)\n\n‚ÄûFrage muss beantwortet werden, weil Ihre fr√ºhere Antwort XYZ war‚Äú (Conditional Required).\n\nOptional: Kennzeichnung im UI f√ºr kontextabh√§ngige Pflicht (‚ÄûPflicht (abh√§ngig von Ihrer Antwort)‚Äú).\n\nSicherstellen, dass Fehlermeldungen weiterhin verst√§ndlich und nicht √ºberladen sind.\n\nDokumentation\n\nNeue Datei: /docs/B4_DYNAMIC_VALIDATION_RULES.md:\n\n√úberblick √ºber Regeltypen (z. B. conditional_required, conditional_visible).\n\nStruktur des JSON-Payloads mit Beispielen.\n\nBeispiele f√ºr typische medizinische Use Cases (z. B. Screening-Fragen).\n\nUpdate des bestehenden B2-Docs:\n\nHinweis, dass B4 die Logik erweitert, aber B2-Basis weiterhin gilt.\n\nTesting\n\nTestplan f√ºr dynamische Regeln:\n\nSzenario: Frage B Pflicht, wenn A = 1; A = 1, B unbeantwortet ‚Üí Fehler.\n\nSzenario: A ‚â† 1 ‚Üí B darf unbeantwortet bleiben, kein Fehler.\n\nSzenario: Mehrere Bedingungen (z. B. A = 1 UND C ‚â• 3).\n\nSzenario: Keine Regeln ‚Üí Verhalten exakt wie B2.\n\nAPI-Tests:\n\nUnit-Tests f√ºr Regel-Evaluierung (schmale, gezielte Tests).\n\nIntegrationstests (API-Call mit beispielhaftem Assessment).\n\nOptional: Kleine Demo-Testdaten in docs dokumentieren.\n\nAkzeptanzkriterien\n\n F√ºr eine Frage kann der Pflichtstatus abh√§ngig von anderen Antworten gesteuert werden (Conditional Required).\n\n Regellogik ist vollst√§ndig datengetrieben (keine hart kodierten Spezialf√§lle pro Frage im Code).\n\n Bestehende B2-Validierung bleibt funktionsf√§hig, wenn keine Regeln hinterlegt sind (Backwards-Kompatibilit√§t).\n\n API-Response kann Missing-Questions mit Grund (reason) ausgeben.\n\n Stress-Check-UI zeigt sinnvolle Fehlermeldungen f√ºr konditionale Pflichtfragen.\n\n Dokumentation erkl√§rt das Regelmodell so, dass weitere Funnel/Frageb√∂gen ohne Developer-Hilfe konfiguriert werden k√∂nnen (zumindest auf Datenbankebene).","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":118,"state":"CLOSED","title":"B4 ‚Äî Erweiterte Validierungsregeln (Conditional Required & dynamische Logik)"},{"body":"Kurzbeschreibung:\nDie in B2 implementierte Validierung ist step-basiert, aber der mobile/desktop Flow navigiert derzeit question-basiert.\nDieses Issue f√ºhrt die Validierung vollst√§ndig in den neuen FunnelDefinition-Step-Flow √ºber (echte Steps ‚Üí echte Weiter-/Zur√ºck-Navigation ‚Üí vollst√§ndiger Block von Steps bei offenen Pflichtfragen).\n\nWesentliche Aufgaben (AKs):\n\nStep-Definition aus FunnelDefinition laden\n\nStep-Navigation (forward/back) implementieren\n\nVor jedem Step-Wechsel validateStep() aufrufen\n\nStep nur freigeben, wenn keine offenen Pflichtfragen\n\nFehlermeldung + Scroll-to-missing implementieren\n\nKompatibilit√§t zu assess¬≠ment_answers sicherstellen\n\nMobile und Desktop nutzen denselben Flow\n\nTesting-Szenarien definieren\n\nWarum n√∂tig?\nWeil Copilot korrekt implementiert hat, aber explizit darauf hinweist:\n\n‚ÄûMobile/Desktop components are designed for single-question navigation but current validation is step-level.‚Äú\n‚Üí Das bedeutet: Die Logik ist fertig, aber nicht verdrahtet.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":117,"state":"CLOSED","title":"B2.2 ‚Äî Step-by-Step Navigation mit Validierungsintegration (FunnelDefinition)"},{"body":"Im vergangen issue war die Aufgabe:\n\nFrage + Hilfetext kommen aus questions, nicht aus Hardcoding.\n\nDas ist nicht umgesetzt. √úbertrage die Fragen aus dem Code in die tabelle \"questions\" und baue die Fragenseite so um das die Fragen dynamisch daraus gezogen werden.\nDie Anzahl der Fragen f√ºr diesen Funnel determinieren das Layout bzw. soll  so konstruiert sein, das neue Fragen erkannt und angezeigt werden.","labels":[],"number":109,"state":"CLOSED","title":"Fix Question Source"},{"body":"**Labels:** `epic:E`, `performance`, `frontend`, `v0.3`\n\n**Beschreibung:**  \nPerformanceoptimierung f√ºr den Funnel-Flow und das Rendering von Content-Pages, insbesondere auf Mobilger√§ten.\n\n**Aufgaben:**  \n- Metriken erfassen (z. B. Lighthouse, Web Vitals) auf typischen Funnel-Seiten.  \n- Swipe-Performance und Reaktionszeiten der Navigation (Next/Previous) √ºberpr√ºfen.  \n- Optimierungen:  \n  - Lazy Loading f√ºr nicht sofort ben√∂tigte Komponenten/Content.  \n  - Memoization f√ºr h√§ufig gerenderte Komponenten (Fragen, Answer Buttons).  \n  - Supabase-Queries pr√ºfen (z. B. sinnvolle Selects, keine Overfetches).  \n- Nachmessung und Dokumentation der Verbesserungen.\n\n**Acceptance Criteria:**  \n- Subjektiv fl√ºssige Navigation durch den Funnel auf Mittelklasse-Smartphones.  \n- Keine auff√§lligen Layout-Shifts beim Wechsel zwischen Question- und Content-Views.  \n- Wichtige Funnel-Seiten erreichen akzeptable LCP-Werte (z. B. < 2,5 s, abh√§ngig von Hosting/Netz).\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":108,"state":"CLOSED","title":"E3 ‚Äî Performance Optimization (Funnel & Content)"},{"body":"**Labels:** `epic:E`, `qa`, `ux`, `v0.3`\n\n**Beschreibung:**  \nDer Funnel muss robust gegen√ºber Unterbrechungen sein. Nutzer sollen ein begonnenes Assessment sp√§ter fortsetzen k√∂nnen, basierend auf den Daten in `assessments` und `assessment_answers`.\n\n**Aufgaben:**  \n- Testf√§lle definieren:\n  - Browser/Tab schlie√üen und sp√§ter wieder √∂ffnen.  \n  - Seite w√§hrend des Ausf√ºllens neu laden.  \n  - Netzwerk kurz unterbrechen und wiederherstellen.  \n- Mechanismus implementieren/pr√ºfen, der f√ºr ein offenes `assessment` die ‚Äûaktuelle‚Äú Position aus den bisherigen Antworten ermittelt.  \n- Sicherstellen, dass bei ‚ÄûResume‚Äú der richtige Step geladen wird (z. B. erste unbeantwortete oder explizit gespeicherte Position).\n\n**Acceptance Criteria:**  \n- Nutzer verlieren bei Reload / Tab-Wechsel nicht ihren Fortschritt im laufenden `assessment`.  \n- Wiederaufnahme eines unvollst√§ndigen `assessments` f√ºhrt in einen sinnvollen Zustand (nicht zur√ºck ganz zum Anfang, wenn das nicht gewollt ist).  \n- Es gibt keine Endlosschleifen oder Dead-Ends im Resume-Flow.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":107,"state":"CLOSED","title":"E2 ‚Äî Recovery & Resume (assessments-basiert)"},{"body":"**Labels:** `epic:E`, `qa`, `testing`, `mobile`, `v0.3`\n\n**Beschreibung:**  \nSystematisches Testen der neuen Mobile-Funnel-UI (inkl. Navigation, Save-on-Tap, Content-Pages) auf g√§ngigen mobilen Endger√§ten.\n\n**Aufgaben:**  \n- Testmatrix definieren:  \n  - iPhone SE + aktuelles iPhone-Modell (Safari)  \n  - Android (aktuelles Samsung oder vergleichbar, Chrome)  \n- End-to-End Flows testen:  \n  - Funnel starten (Neues `assessment` in `assessments` angelegt).  \n  - Fragen beantworten (`assessment_answers`).  \n  - Ergebnis ansehen (`reports`, ggf. `patient_measures`).  \n  - Content-Pages √∂ffnen (aus `content_pages`).  \n- Auff√§lligkeiten dokumentieren (Screenshots, kurze Beschreibung, ggf. Log-Ausz√ºge).\n\n**Acceptance Criteria:**  \n- Alle kritischen Flows sind auf den getesteten Ger√§ten durchspielbar.  \n- Es gibt kein UI-Blocking durch unhandled Errors.  \n- Gefundene Bugs sind entweder gefixt oder als Folge-Issues dokumentiert.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":106,"state":"CLOSED","title":"E1 ‚Äî Device Testing (iPhone & Android)"},{"body":"**Labels:** `epic:D`, `backend`, `content`, `funnel`, `v0.3`\n\n**Beschreibung:**  \nContent-Pages sollen sinnvoll im Kontext eines Funnels platziert werden k√∂nnen (z. B. als ‚ÄûIntro zum Funnel‚Äú, ‚ÄûMehr √ºber Stress‚Äú, ‚ÄûErgebnis-Erkl√§rung‚Äú). Es wird dabei das bestehende Schema genutzt: `content_pages.funnel_id` verkn√ºpft die Pages mit dem jeweiligen Funnel.\n\n**Aufgaben:**  \n- Konvention definieren, wie Content-Pages logisch einsortiert werden (z. B. anhand von `layout` oder `slug`-Naming, etwa `intro`, `outro`, `info_*`).  \n- Mechanismus implementieren, der abh√§ngig vom Funnel (`funnels.id`/`slug`) relevante Content-Pages ausw√§hlt und z. B.:\n  - vor Start des Fragebogens anbietet (‚ÄûIntro-Seite aufrufen‚Äú)  \n  - im Ergebnis-Bereich (`reports` / `patient_measures`) verlinkt (‚ÄûMehr erfahren‚Äú).  \n- UI-Hooks in Start-/Ergebnis-Views einbauen (Buttons/Links zu relevantem Content).  \n- Option vorbereiten, sp√§ter Content-Pages enger mit Steps zu verbinden (z. B. Step vom Typ `info_step`, der eine bestimmte `content_pages.slug` referenziert), ohne schon zwingend Schema√§nderungen zu brauchen.\n\n**Acceptance Criteria:**  \n- Funnels k√∂nnen redaktionelle Inhalte aus `content_pages` im UI kontextuell anzeigen (z. B. Intro/Info/Ergebnis-Exkurs).  \n- Die Auswahl der Content-Pages basiert ausschlie√ülich auf dem bestehenden Schema (`funnel_id`, `status`, `slug`, `layout`).  \n- Es ist klar dokumentiert, wie ein Redakteur eine neue Seite anlegen muss (z. B. `funnel_id`, `status = 'published'`, sinnvoller `slug`), damit sie im gew√ºnschten Kontext auftaucht.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":105,"state":"CLOSED","title":"D2 ‚Äî Integration von `content_pages` in den Funnel-Kontext"},{"body":"**Labels:** `epic:D`, `content`, `frontend`, `v0.3`\n\n**Beschreibung:**  \nDie Tabelle `content_pages` stellt redaktionelle Inhalte bereit, die im Kontext eines Funnels angezeigt werden k√∂nnen. Die Inhalte liegen in `body_markdown` und sind einem Funnel √ºber `content_pages.funnel_id` zugeordnet. v0.3 soll diese Inhalte im Frontend anzeigen k√∂nnen.\n\n**Aufgaben:**  \n- Datenmodell aus `content_pages` verstehen: `slug`, `title`, `excerpt`, `body_markdown`, `status`, `layout`, `funnel_id`.  \n- Query/Loader implementieren, der Content-Pages eines Funnels l√§dt (Filtern nach `funnel_id` und `status = 'published'` o. √§.).  \n- Renderer f√ºr `body_markdown` implementieren (Markdown ‚Üí HTML/React), inklusive Typografie-Styling.  \n- Routen definieren, z. B.:  \n  - `/funnel/[slug]/content/[pageSlug]` oder  \n  - Separate ‚ÄûInfo‚Äú-Seiten im Kontext des Funnels.  \n- Mobile-optimiertes Layout (Lesbarkeit, Zeilenl√§nge, Abst√§nde, Scroll-Verhalten).\n\n**Acceptance Criteria:**  \n- F√ºr einen Funnel k√∂nnen zugeh√∂rige Content-Pages aus `content_pages` geladen und im UI angezeigt werden.  \n- `body_markdown` wird korrekt und vollst√§ndig als HTML/React gerendert.  \n- Nur Pages mit passendem Status (z. B. ‚Äûpublished‚Äú) sind im Frontend sichtbar.  \n- Layout ist auf Mobile gut lesbar und bricht nicht.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":104,"state":"CLOSED","title":"D1 ‚Äî Rendering von `content_pages` im Frontend"},{"body":"**Labels:** `epic:C`, `frontend`, `ui`, `design-system`, `v0.3`\n\n**Beschreibung:**  \nNeue Basis-Komponenten f√ºr Mobile aufbauen (z. B. `<MobileCard />`, `<MobileProgress />`), die die Tokens aus C1 nutzen und die Funnel-Mobilansicht vereinheitlichen.\n\n**Aufgaben:**  \n- `<MobileCard />` als Wrapper f√ºr mobile Inhalte (Card-Look, Padding, Radius, Schatten).  \n- `<MobileProgress />` (z. B. Fortschrittsbalken, Steps-Indicator), der aus der Anzahl von `funnel_steps` und der Position des aktuellen Steps berechnet wird.  \n- `<MobileSectionTitle />` o. √§. f√ºr √úberschriften in Funnel-/Content-Kontext.  \n- Komponenten so bauen, dass sie in anderen Screens wiederverwendbar sind (nicht nur im Stress-Funnel).\n\n**Acceptance Criteria:**  \n- Die Mobile-Funnel-Ansicht nutzt durchg√§ngig diese Komponenten.  \n- √Ñnderungen an Tokens schlagen sich konsistent in den Mobile-Components nieder.  \n- Komponenten sind einfach wiederverwendbar und gut typisiert.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":103,"state":"CLOSED","title":"C2 ‚Äî Mobile UI Components (auf Tokens basierend)"},{"body":"**Labels:** `epic:C`, `design-system`, `frontend`, `v0.3`\n\n**Beschreibung:**  \nEin globales Design-Token-Set f√ºr Abst√§nde, Typografie und Bewegungen einf√ºhren, das von der Funnel-UI (Desktop & Mobile) verwendet wird. So kann u. a. `funnels.default_theme` sp√§ter einfacher genutzt werden, um Varianten (z. B. Stress vs. Sleep) zu gestalten.\n\n**Aufgaben:**  \n- Bestehende Styles analysieren (Tailwind-Config, Components).  \n- Token-Sets definieren: Spacing, Font-Sizes, Radii, Shadows, Motion-Duration/Easing.  \n- Tailwind-Konfiguration anpassen, sodass Tokens an zentraler Stelle gepflegt werden.  \n- Wichtige Funnel-Components (MobileQuestionCard, Answer Buttons, Cards) auf Tokens migrieren.\n\n**Acceptance Criteria:**  \n- Es existiert eine dokumentierte √úbersicht der wichtigsten Tokens.  \n- UI-√Ñnderungen (z. B. Abstand, Basistypografie) k√∂nnen zentral angepasst werden, in einer separaten paramterdatei \n- Mobile Funnel-UI nutzt die Tokens anstatt verstreuter Magic Numbers.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":102,"state":"CLOSED","title":"C1 ‚Äî Global Design Tokens (Spacing, Typography, Motion)"},{"body":"**Labels:** `epic:B`, `backend`, `performance`, `v0.3`\n\n**Beschreibung:**  \nNavigation (Next/Previous) und Wiederaufnahme (‚ÄûResume‚Äú) eines Funnels sollen performant und robust √ºber die Tabelle `assessments` und die vorhandenen Beziehungen gel√∂st sein.\n\n**Aufgaben:**  \n- Mechanismus implementieren, der f√ºr ein `assessment` ermittelt:\n  - welcher `funnel` (`assessments.funnel_id`)  \n  - welcher `funnel_step` aktuell ist (z. B. √ºber letzte beantwortete Frage in `assessment_answers`).  \n- Endpunkte/Logik f√ºr:\n  - ‚ÄûNext Step‚Äú (basierend auf Step-Reihenfolge & Antworten)  \n  - ‚ÄûPrevious Step‚Äú  \n  - ‚ÄûResume Assessment‚Äú (wieder einsteigen in laufenden Funnel).  \n- Performance pr√ºfen: Queries so bauen, dass sie auf `assessments`, `funnel_steps`, `assessment_answers` performant laufen (ggf. Indizes nutzen, wenn n√∂tig).\n\n**Acceptance Criteria:**  \n- F√ºr ein beliebiges `assessment` ist klar definiert, welcher Step beim √ñffnen angezeigt wird.  \n- Navigation reagiert schnell (subjektiv ‚Äûsnappy‚Äú; Ziel: Serverzeit < 200ms).  \n- Es gibt keine Race Conditions oder Doppel-Navigation bei schneller Folge von Requests (z. B. durch Swipes).\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":100,"state":"CLOSED","title":"B3 ‚Äî Navigation & Resume √ºber `assessments` optimieren"},{"body":"**Labels:** `epic:B`, `backend`, `validation`, `v0.3`\n\n**Beschreibung:**  \nDie Required-Logik f√ºr Fragen soll sich an der Spalte `funnel_step_questions.is_required` orientieren. Ein Step mit Pflichtfragen darf nicht abgeschlossen werden, wenn diese Fragen in `assessment_answers` noch keinen Eintrag haben.\n\n**Aufgaben:**  \n- Pr√ºf-Logik implementieren, die f√ºr eine gegebene `assessment_id` und einen Step alle `is_required = true` Fragen abgleicht mit vorhandenen `assessment_answers`.  \n- Diese Logik sowohl im Desktop- als auch im Mobile-Flow verwenden (z. B. beim Versuch, zur n√§chsten Frage / zum n√§chsten Step zu navigieren).  \n- Serverseitige Absicherung: Bei API-Requests f√ºr ‚Äûnext step‚Äú sicherstellen, dass Pflichtfragen beantwortet sind.  \n- Optional: Benutzerfreundliche Fehlermeldungen f√ºr UI generieren (z. B. ‚ÄûBitte beantworten Sie alle Pflichtfragen.‚Äú).\n\n**Acceptance Criteria:**  \n- Es ist nicht m√∂glich, einen Step mit offenen Pflichtfragen ‚Äûunbemerkt‚Äú zu √ºberspringen.  \n- Die Validierung nutzt ausschlie√ülich das vorhandene Schema (`funnel_step_questions.is_required`, `assessment_answers`).  \n- Desktop- und Mobile-Verhalten sind einheitlich.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":99,"state":"CLOSED","title":"B2 ‚Äî Answer Validation v2 (Required-Logik aus `funnel_step_questions`)"},{"body":"**Labels:** `epic:B`, `backend`, `funnel`, `v0.3`\n\n**Beschreibung:**  \nDie Funnel Engine soll ihr ‚ÄûKonfigurationsmodell‚Äú nicht aus statischem JSON, sondern aus den bestehenden Tabellen aufbauen:\n\n- `funnels` (Meta: Titel, Untertitel, Beschreibung, Theme via `default_theme`)  \n- `funnel_steps` (Reihenfolge & Typ der Schritte √ºber `order_index`, `type`, `title`, `description`)  \n- `funnel_step_questions` (Zuordnung Fragen ‚Üî Schritte)  \n- `questions` (Inhalt & Typ der Fragen).\n\nZiel: Auf Basis dieser Tabellen eine klar strukturierte interne `FunnelDefinition` erzeugen, die sowohl Desktop- als auch Mobile-UI konsumieren.\n\n**Aufgaben:**  \n- Backend- oder Frontendlayer implementieren, der aus `funnels`, `funnel_steps`, `funnel_step_questions`, `questions` eine sortierte Liste von ‚ÄûSteps‚Äú erzeugt.  \n- `funnel_steps.type` nutzen, um zu unterscheiden: z. B. `\"question_step\"`, `\"info_step\"`, `\"other\"`.  \n- Pro ‚ÄûQuestion Step‚Äú die zugeordneten `questions` anhand `funnel_step_questions` + `questions` aufl√∂sen.  \n- Sicherstellen, dass die Reihenfolge √ºber `order_index` eindeutig und stabil ist.  \n- Das Modell so strukturieren, dass es leicht an Mobile & Desktop weitergegeben werden kann.\n\n**Acceptance Criteria:**  \n- F√ºr einen gegebenen `funnel` (via `funnels.slug` oder `assessments.funnel_id`) kann eine vollst√§ndige Step-Sequenz erzeugt werden.  \n- Die Steps enthalten alle Informationen, die f√ºr UI und Navigation ben√∂tigt werden (Fragen, Titel, Beschreibungen, Step-Typ).  \n- Es existiert keine harte Abh√§ngigkeit mehr von separaten JSON-Dateien f√ºr die Funnelstruktur.\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":98,"state":"CLOSED","title":"B1 ‚Äî Funnel Definition aus DB-Tabellen zusammensetzen"},{"body":"**Labels:** `epic:A`, `mobile`, `backend`, `funnel`, `v0.3`\n\n**Beschreibung:**  \nIn der mobilen Ansicht sollen Antworten direkt beim Tippen in `assessment_answers` gespeichert werden. Die Tabellenstruktur ist vorgegeben:\n- `assessments.id` als Fremdschl√ºssel in `assessment_answers.assessment_id`\n- `assessment_answers.question_id` (Text, entspricht `questions.key` oder einer Frontend-Mapping-Konvention)\n- `assessment_answers.answer_value` (Integer).\n\n**Aufgaben:**  \n- Save-on-Tap: Beim Ausw√§hlen einer Antwort einen Insert/Upsert in `assessment_answers` ausf√ºhren.  \n- Mapping sicherstellen: welcher Wert von der UI in `answer_value` gespeichert wird (z. B. die Skala 0‚Äì4 bei Stressfragen).  \n- Error Handling: Netzwerkfehler / Supabase-Fehler sauber im UI anzeigen; Option zum Retry.  \n- Kein Doppel-Insert bei mehrfachem Tippen (Upsert nach `assessment_id` + `question_id` oder App-seitige Sperre).  \n- Sicherstellen, dass sp√§tere Reports (`reports.assessment_id`) weiterhin korrekt √ºber die gespeicherten Antworten generiert werden k√∂nnen.\n\n**Acceptance Criteria:**  \n- Jede Auswahl in der mobilen UI erzeugt (oder aktualisiert) genau einen Datensatz in `assessment_answers`.  \n- Es entstehen keine doppelten Antworten pro `assessment_id` + `question_id`.  \n- Fehlermeldungen sind verst√§ndlich (nicht nur ‚Äû500‚Äú o. √§.).  \n- Reports und `patient_measures` k√∂nnen wie bisher aus den gespeicherten Antworten abgeleitet werden.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":97,"state":"CLOSED","title":"A5 ‚Äî Mobile Funnel Integration (Save-on-Tap √ºber `assessment_answers`)"},{"body":"**Labels:** `epic:A`, `frontend`, `responsive`, `v0.3`\n\n**Beschreibung:**  \nImplementiere einen Mechanismus, der abh√§ngig von der Viewport-Breite zwischen Desktop-Funnel-UI und Mobile-Funnel-UI umschaltet. Beide Varianten nutzen dieselben Daten aus `assessments` / `funnels` / `funnel_steps` / `questions`.\n\n**Aufgaben:**  \n- Custom Hook `useIsMobile()` implementieren (z. B. anhand von `window.matchMedia(\"(max-width: 640px)\")`).  \n- Oberhalb der Frage-Komponenten eine ‚ÄûRouter‚Äú-Komponente etablieren, die je nach `isMobile` entweder Desktop- oder Mobile-View rendert.  \n- Sicherstellen, dass der Wechsel (z. B. durch Resizing oder Device-Rotation) keine inkonsistenten UI-States erzeugt.\n\n**Acceptance Criteria:**  \n- <640px ‚Üí Mobile Question UI, ‚â•640px ‚Üí Desktop Question UI.  \n- Es wird niemals Desktop & Mobile UI gleichzeitig f√ºr dieselbe Frage angezeigt.  \n- Der Funnel-Status (aktuelle Frage, gegebene Antworten) bleibt beim Wechsel erhalten.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":96,"state":"CLOSED","title":"A4 ‚Äî Responsive Layout Switcher (`useIsMobile()`)"},{"body":"**Labels:** `epic:A`, `mobile`, `ui`, `design-system`, `v0.3`\n\n**Beschreibung:**  \nErstelle ein Set mobiler Antwort-Komponenten, das unterschiedliche `questions.question_type` sauber abbildet (z. B. Skala 0‚Äì4, Ja/Nein, Single-Choice), basierend auf Werten aus `questions.min_value` / `questions.max_value`.\n\n**Aufgaben:**  \n- `MobileAnswerButton` Basis-Komponente erstellen.  \n- Varianten implementieren:\n  - Skala (z. B. von `min_value` bis `max_value`).  \n  - Binary (Ja/Nein bzw. zwei Werte).  \n  - Single-Choice mit mehreren diskreten Optionen (Mapping in Code nach `questions.key`).  \n- Visuelle Zust√§nde: idle, hover (Desktop), active/pressed, disabled.  \n- Mikroanimation (z. B. Scale-Effekt, Farbtransition) beim Tap.  \n- Props so gestalten, dass die Komponente aus den DB-Daten (`questions`) + etwas Frontend-Mapping generiert werden kann.\n\n**Acceptance Criteria:**  \n- Alle relevanten Frage-Typen k√∂nnen mit diesen Komponenten dargestellt werden.  \n- Touch Targets erf√ºllen mindestens 44x44px.  \n- Aktive Auswahl ist klar von inaktiven Optionen unterscheidbar.  \n- Komponenten sind in `<MobileQuestionCard />` integriert und kollidieren nicht mit Layout.","labels":[{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":95,"state":"CLOSED","title":"A3 ‚Äî Mobile Answer Buttons (Variantenbibliothek)"},{"body":"**Labels:** `epic:A`, `mobile`, `motion`, `frontend`, `v0.3`\n\n**Beschreibung:**  \nMobile Nutzer sollen per Swipe zwischen Fragen navigieren k√∂nnen. Die Reihenfolge der Fragen ergibt sich aus den bestehenden Tabellen:\n- `funnels` ‚Üí `funnel_steps` (per `funnel_steps.funnel_id`, `order_index`)\n- `funnel_steps` ‚Üí `funnel_step_questions` ‚Üí `questions`.\n\n**Aufgaben:**  \n- Framer Motion oder eine √§hnliche Bibliothek f√ºr Animations-States integrieren.  \n- Swipe left ‚Üí n√§chste Frage (n√§chster `funnel_step` bzw. `funnel_step_question`).  \n- Swipe right ‚Üí vorige Frage.  \n- Enter-/Exit-/Snap-back-Animationen definieren.  \n- Swipe-Eingaben w√§hrend laufender Animation sperren (kein Double Trigger).  \n- Fallback: Buttons ‚ÄûZur√ºck‚Äú/‚ÄûWeiter‚Äú f√ºr Barrierefreiheit und Devices ohne Swipe.\n\n**Acceptance Criteria:**  \n- Swipes f√ºhren konsistent zum n√§chsten/vorherigen Schritt gem√§√ü `funnel_steps.order_index`.  \n- Unvollst√§ndige Swipes werden sauber zur√ºckgeschnappt.  \n- Keine doppelten Navigationsereignisse durch mehrfaches Swipen.  \n- Animationen laufen auf Mittelklasse-Smartphones fl√ºssig (Target ca. 60 FPS).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"}],"number":94,"state":"CLOSED","title":"A2 ‚Äî Swipe Navigation (Framer Motion)"},{"body":"**Beschreibung:**  \nImplementiere eine neue, mobil-optimierte Frage-Komponente `<MobileQuestionCard />`, die eine einzelne Funnel-Frage im Card-Stack-Design anzeigt. Das UI liest seine Daten aus dem bestehenden Funnelmodell:\n- aktuelles `assessment` (aus `assessments`)\n- zugeh√∂riger `funnel` (via `assessments.funnel_id` ‚Üí `funnels.id`)\n- aktuelle Frage (√ºber `funnel_steps` + `funnel_step_questions` + `questions`).\n\n**Aufgaben:**  \n- Neue React-Komponente `<MobileQuestionCard />` erstellen.  \n- Layout: Header (Funnel-Titel aus `funnels.title`), Progress-Anzeige, Frage-Text (`questions.label`), optional `questions.help_text`, Antwortbereich.  \n- Mobile Typografie (gr√∂√üer, gute Zeilenh√∂he), ausreichendes Padding und Spacing.  \n- State-Management: aktuell gew√§hlte Antwort, Laden/Speichern, Fehlerzust√§nde.  \n- Integration in bestehenden Funnel-Flow: Ermittlung der ‚Äûaktiven‚Äú Frage anhand der Reihenfolge `funnel_steps.order_index` + `funnel_step_questions.order_index`.\n\n**Acceptance Criteria:**  \n- Bei Viewports <640px wird `<MobileQuestionCard />` standardm√§√üig f√ºr Fragen verwendet.  \n- Frage + Hilfetext kommen aus `questions`, nicht aus Hardcoding.  \n- UI ist thumb-friendly (mindestens 44px hohe Interaktionselemente).  \n- Funktioniert auf iPhone & Android ohne Layout-Br√ºche.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACR0mQsA","name":"v0.3","description":"","color":"0e4a9a"},{"id":"LA_kwDOQfuwnc8AAAACR0mZug","name":"mobile","description":"","color":"55ec7b"}],"number":93,"state":"CLOSED","title":"A1 ‚Äî Mobile Question Component (Core Layout)"},{"body":"- beim login aendere die farbe der schrift (email und passwort) zu schwarz, man kann das schlecht lesen\n- die antwortbuttons wieder kleiner machen, responsive","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":86,"state":"CLOSED","title":"Some UI Fixes"},{"body":"Configure instructions for this repository as documented in [Best practices for Copilot coding agent in your repository](https://gh.io/copilot-coding-agent-tips).\n\n<Onboard this repo>","labels":[],"number":72,"state":"CLOSED","title":"‚ú® Set up Copilot instructions"},{"body":"Die Login-Seite des Projekts soll erweitert werden, um die Commit-ID sowie das zugeh√∂rige Datum und die Uhrzeit des letzten Commits anzuzeigen. Ziel dieser Erg√§nzung ist es, die Transparenz zur genutzten Version direkt f√ºr den Nutzer sichtbar zu machen.","labels":[],"number":53,"state":"CLOSED","title":"Repo ID"},{"body":"## Beschreibung\nKurzanleitung (1 Seite), die erkl√§rt, wie √Ñrzt:innen das Dashboard nutzen und die Daten interpretieren.\n\n## Akzeptanzkriterien\n- Erkl√§rt Dashboard-Funktionen klar und einfach.  \n- Erkl√§rt Scores, RiskLevels und AMY-Texte (‚ÄûWas bedeuten sie?‚Äú).  \n- Screenshots enthalten.  \n- Orientierungshilfe bei technischen Problemen.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"}],"number":47,"state":"CLOSED","title":"Z3 Clinician Dashboard ‚Äì Kurzanleitung f√ºr √Ñrzt:innen"},{"body":"## Beschreibung\nEine kompakte Checkliste, um den Start des Remote-Piloten vorzubereiten (inkl. Anleitungen und Testhinweisen).\n\n## Akzeptanzkriterien\n- Liste deckt Setup, Accounts, Tests und Onboarding ab.  \n- Aufgaben verst√§ndlich f√ºr nicht-technisches Personal.  \n- Enth√§lt E2E-Testschritte.  \n- Download- oder PDF-Version verf√ºgbar.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"}],"number":46,"state":"CLOSED","title":"Z2 Pilot Readiness Checkliste"},{"body":"## Beschreibung\nErstelle ein professionelles Executive-Summary-Dokument f√ºr Thomas (und die Pilotpraxis) mit Zielen, Funktionen, Grenzen und Screenshots.\n\n## Akzeptanzkriterien\n- Klar verst√§ndliches 1‚Äì2 Seiten Dokument.  \n- Erkl√§rt: Was kann v0.2? Was nicht?  \n- Screenshots der wichtigsten Screens enthalten.  \n- Fokus auf klinischen Einsatz & Pilotkontext.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"}],"number":45,"state":"CLOSED","title":"Z1 Executive Summary v0.2 f√ºr Thomas"},{"body":"## Beschreibung\nDer gesamte Patientenfluss soll logisch, einfach und friktionsfrei sein: Fragebogen ‚Üí Auswertung ‚Üí Verlauf ‚Üí ggf. weiterer Check.\n\n## Akzeptanzkriterien\n- ‚ÄûWeiter‚Äú-Fl√ºsse funktionieren ohne Br√ºche.  \n- Zur√ºck-Navigation f√ºhrt nicht zu doppelten Saves.  \n- Alle Seiten haben konsistente Header/Footer.  \n- Keine Sackgassen oder undefinierten Zust√§nde.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":44,"state":"CLOSED","title":"F3 Patient Journey Flow (Check ‚Üí Ergebnis ‚Üí Verlauf)"},{"body":"## Beschreibung\nDie Result Page zeigt Score-Werte, RiskLevel und den AMY-Text (oder Fallback) gut lesbar an. Bei Ausf√§llen wird ein beruhigender Fehlerhinweis angezeigt.\n\n## Akzeptanzkriterien\n- StressScore, SleepScore, RiskLevel werden korrekt angezeigt.  \n- AMY-Text inkl. Zeilenumbr√ºche.  \n- Loading-States sind eindeutig.  \n- Error-State zeigt klaren Hinweis (‚ÄûAuswertung aktuell nicht verf√ºgbar‚Äú).  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":43,"state":"CLOSED","title":"F2 Result Page (Scores + Risk-Level + AMY)"},{"body":"## Beschreibung\nDer Stress-Check muss klar, mobilfreundlich und fehlerrobust sein. Fokus auf Zielgruppe 50+: gro√üe Buttons, klare Texte, verst√§ndliche Skalen.\n\n## Akzeptanzkriterien\n- Progress-Anzeige (‚ÄûFrage X von Y‚Äú).  \n- Validierung aller Fragen.  \n- Gro√üe klickbare Fl√§chen (touch-optimiert).  \n- Fehlerf√§lle erkl√§ren verst√§ndlich, was fehlt.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":42,"state":"CLOSED","title":"F1 Stress-Fragebogen UX & Validierung"},{"body":"## Beschreibung\nEine kurze Checkliste stellt sicher, dass alle kritischen Flows funktionieren: Login ‚Üí Fragebogen ‚Üí Auswertung ‚Üí Verlauf ‚Üí Clinician Dashboard.\n\n## Akzeptanzkriterien\n- Liste deckt alle Kernfl√ºsse ab.  \n- Jeder Testpunkt ist klar wiederholbar.  \n- Pilotpraxis kann damit selbst testen.  \n- Testdokumentation liegt in Repo oder Notion.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"}],"number":41,"state":"CLOSED","title":"E4 Smoke Test f√ºr End-to-End Pilot-Flow"},{"body":"## Beschreibung\nv0.2 soll stabil auf Vercel laufen. Alle ENV-Variablen werden korrekt dokumentiert und sind zwischen lokal, Preview und Prod konsistent.\n\n## Akzeptanzkriterien\n- Alle ENV-Variablen (Supabase, Anthropic, Flags) korrekt gesetzt.  \n- Deploy funktioniert ohne Fehlermeldungen.  \n- Dokumentation: ENV-Guide f√ºr Thomas & interne Nutzung.  \n- Smoke-Test nach Deployment erf√ºllt alle Kernfunktionen.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"}],"number":40,"state":"CLOSED","title":"E3 Deployment auf Vercel inkl. ENV-Dokumentation"},{"body":"## Beschreibung\nEinf√ºhrung zentraler Feature Flags zur einfachen Aktivierung/Deaktivierung bestimmter Funktionen.\n\n## Akzeptanzkriterien\n- Flags wie `AMY_ENABLED`, `CLINICIAN_DASHBOARD_ENABLED`, `CHARTS_ENABLED`.  \n- Flags √ºber ENV steuerbar.  \n- Flags werden frontendseitig korrekt ausgewertet.  \n- Disabled Features sind unsichtbar oder klar deaktiviert. ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"}],"number":39,"state":"CLOSED","title":"E2 Feature Flags implementieren"},{"body":"## Beschreibung\nAlle zentralen Ereignisse (Score-Berechnung, AMY-Requests, Fehler) werden sauber geloggt, um Stabilit√§t im Pilotbetrieb sicherzustellen.\n\n## Akzeptanzkriterien\n- AMY-Requestdauer wird geloggt.  \n- Fehlerf√§lle (Timeout, Rate Limit, JSON) erkennbar.  \n- Score-Berechnung schreibt Log-Eintr√§ge.  \n- Logs sind √ºber Supabase oder Vercel einsehbar.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfPISA","name":"OPS","description":"","color":"c6e110"}],"number":38,"state":"CLOSED","title":"E1 Logging zentraler technischer Parameter"},{"body":"## Beschreibung\nRLS (Row-Level Security) regelt, dass Patient:innen ausschlie√ülich ihre eigenen Daten sehen und √Ñrzt:innen Zugriff auf Pilotpatienten haben.\n\n## Akzeptanzkriterien\n- Patient sieht nur eigene Reports & Measures.  \n- Clinician sieht alle Pilotpatienten, aber keine ‚ÄûFremddaten‚Äú.  \n- Tests f√ºr verbotene Zugriffe (should-fail) implementiert.  \n- Logging bei RLS-Verst√∂√üen.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":37,"state":"CLOSED","title":"D4 RLS vollst√§ndig aktivieren"},{"body":"## Beschreibung\nErstelle eine Datenschutzseite, die Zweck, Datennutzung, Speicherort (Supabase), RLS und Pilotkontext klar erkl√§rt.\n\n## Akzeptanzkriterien\n- Seite enth√§lt alle wichtigen Hinweise in klarer Sprache.  \n- Footer-Link zu ‚ÄûDatenschutz‚Äú.  \n- Kompatibel mit Consent Screen.  \n- Keine externen Tracker, kein Analytics.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":36,"state":"CLOSED","title":"D3 Datenschutz-/Datennutzung-Seite"},{"body":"## Beschreibung\nSpeichere Consent-Annahmen in einer eigenen Tabelle, inklusive Versionierung des Consent-Texts und Timestamp.\n\n## Akzeptanzkriterien\n- Tabelle `consents`: patient_id, text_version, timestamp.  \n- Consent wird pro Patient exakt einmal pro Version gespeichert.  \n- API kann Consent-Status sicher abrufen.  \n- RLS verhindert Zugriff auf fremde Consent-Daten. ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":35,"state":"CLOSED","title":"D2 Speicherung von Consent-Daten in Supabase"},{"body":"## Beschreibung\nEin verpflichtender Consent-Screen erscheint bei der ersten Nutzung. Nutzer:innen m√ºssen aktiv zustimmen, bevor sie den Stress-Check beginnen k√∂nnen.\n\n## Akzeptanzkriterien\n- Consent erscheint automatisch beim ersten Besuch.  \n- Ohne Zustimmung ‚Üí kein Zugriff auf Fragebogen.  \n- Consent-Text ist verst√§ndlich, gut lesbar, mobil optimiert.  \n- Best√§tigung speichert Version + Timestamp.  \n- Bei sp√§teren Text√§nderungen wird erneut Consent abgefragt.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":34,"state":"CLOSED","title":"D1 Consent Screen vor Nutzung"},{"body":"## Beschreibung\nDas Clinician Dashboard soll auf iPad/Tablet optimal nutzbar sein (Quer- und Hochformat).\n\n## Akzeptanzkriterien\n- Tabellenlayout skaliert sauber auf iPad-Viewport.  \n- Detailseiten (Charts + AMY) sind ohne horizontales Scrollen sichtbar.  \n- Buttons, Tabs, Text sind touch-freundlich (> 40 px).  \n- Mobile-Navigation funktioniert ohne Layoutspr√ºnge.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfMbEA","name":"Clinican","description":"","color":"a5f4a5"}],"number":33,"state":"CLOSED","title":"C4 Dashboard: Mobile-Optimierung (iPad/Tablet)"},{"body":"## Beschreibung\nDetaillierte Ansicht eines einzelnen Patienten mit Stress-/Schlaf-Verlauf, allen AMY-Texten und Rohdaten f√ºr √§rztliche Vorbereitung.\n\n## Akzeptanzkriterien\n- Charts f√ºr Stress und Schlaf werden korrekt geladen.  \n- AMY-Texte erscheinen chronologisch.  \n- Rohdaten (JSON) k√∂nnen optional angezeigt werden.  \n- Keine Daten ‚Üí klarer, beruhigender Hinweis.  \n- Performance: Seite l√§dt vollst√§ndig innerhalb < 1.2 Sekunden.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfMbEA","name":"Clinican","description":"","color":"a5f4a5"}],"number":32,"state":"CLOSED","title":"C3 Dashboard: Patientendetail (Verlauf + AMY)"},{"body":"## Beschreibung\nErstelle eine Tabelle, die alle Pilotpatient:innen mit relevanten Metadaten listet: letzter StressScore, RiskLevel, Zeitpunkt der letzten Messung.  \nSortierung nach Risikostufen.\n\n## Akzeptanzkriterien\n- Tabelle zeigt Name/ID, StressScore, RiskLevel und Timestamp.  \n- Sortierung nach RiskLevel und Datum m√∂glich.  \n- Klick auf Patienten √∂ffnet Detailansicht.  \n- Ladezeit der Tabelle < 1 Sekunde bei < 20 Patient:innen.  \n- Leere Liste zeigt freundliche \"Noch keine Messungen\" Nachricht.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfMbEA","name":"Clinican","description":"","color":"a5f4a5"}],"number":31,"state":"CLOSED","title":"C2 Dashboard: Patienten√ºbersicht (List View)"},{"body":"## Beschreibung\nImplementiere einen gesch√ºtzten Bereich `/clinician`, der ausschlie√ülich f√ºr √Ñrzt:innen zug√§nglich ist.  \nZugriff wird √ºber Supabase Auth (Rolle: `clinician`) gesteuert.  \nFalls unberechtigt, klare Fehlermeldung oder Redirect.\n\n## Akzeptanzkriterien\n- Nutzer:innen ohne Clinician-Rolle erhalten keinen Zugriff.  \n- Clinician sieht nach Login die Dashboard-√úbersicht ohne Fehler.  \n- Auth-Zustand wird korrekt gehalten (Persistenz via Supabase).  \n- Routing funktioniert auf Desktop und mobilen Ger√§ten.  \n- Log f√ºr unerlaubte Zugriffsversuche vorhanden.  ","labels":[{"id":"LA_kwDOQfuwnc8AAAACRfMbEA","name":"Clinican","description":"","color":"a5f4a5"}],"number":30,"state":"CLOSED","title":"C1 Authentifizierung & Routing f√ºr /clinician"},{"body":"## Beschreibung\n\nPilotpatient:innen sollen ihre Verlaufsdaten als JSON exportieren k√∂nnen (z. B. f√ºr sp√§tere Auswertung).\n\n## Akzeptanzkriterien\n\n- Endpoint oder Button f√ºr JSON-Export vorhanden.\n- Export enth√§lt alle relevanten Felder (Scores, RiskLevel, Zeitstempel, AMY-Ausz√ºge).\n- Nur authentifizierte Patient:innen k√∂nnen ihren eigenen Export ziehen.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":29,"state":"CLOSED","title":"B4 JSON-Export der Verlaufsdaten"},{"body":"## Beschreibung\n\nErstelle eine Seite/Section, in der Patient:innen ihre Score-Verl√§ufe und zugeh√∂rige AMY-Texte sehen.\n\n## Akzeptanzkriterien\n\n- Anzeigen von:\n  - StressScore-Verlauf (Chart oder Liste)\n  - SleepScore-Verlauf\n  - AMY-Texte chronologisch.\n- Eintrag enth√§lt Datum & Uhrzeit der Messung.\n- UX ist auch f√ºr Zielgruppe 50+ verst√§ndlich.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":28,"state":"CLOSED","title":"B3 Verlaufssicht f√ºr Patient:innen"},{"body":"## Beschreibung\n\nBeim Abschluss des Fragebogens wird automatisch ein Eintrag in `patient_measures` erzeugt.\n\n## Akzeptanzkriterien\n\n- Eine abgeschlossene Messung wird genau einmal gespeichert.\n- Idempotente Logik: Wiederholtes Ausl√∂sen derselben Assessment-ID f√ºhrt nicht zu Duplikaten.\n- Fehler beim Speichern werden geloggt und ans Frontend gemeldet.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":27,"state":"CLOSED","title":"B2 Save-Logic f√ºr neue Messungen"},{"body":"## Beschreibung\n\nErstelle eine Tabelle `patient_measures`, um jede abgeschlossene Messung (Stress/Schlaf + RiskLevel + AMY-Referenz) zu speichern.\n\n## Akzeptanzkriterien\n\n- Tabelle enth√§lt:\n  - `id`\n  - `patient_id`\n  - `stress_score`\n  - `sleep_score`\n  - `risk_level`\n  - optional: `report_id`\n  - `created_at`.\n- FK zu Patienten/Reports ist korrekt gesetzt.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":26,"state":"CLOSED","title":"B1 Supabase: Verlaufsdatenbank f√ºr Messungen"},{"body":"## Beschreibung\n\nDie Result-Seite zeigt den AMY-Text (oder Fallback) auf eine gut lesbare Art an. Zielgruppe sind u.a. Frauen 50+.\n\n## Akzeptanzkriterien\n\n- Result-Seite zeigt:\n  - StressScore\n  - SleepScore\n  - RiskLevel (Badge)\n  - AMY-Text (oder Fallback).\n- AMY-Text wird mit Zeilenumbr√ºchen und guter Lesbarkeit angezeigt (kein Textblock).\n- Loading-State und Error-State sind klar erkennbar.\n- Bei fehlendem AMY-Text wird ein klarer, beruhigender Hinweis angezeigt (‚ÄûAuswertung folgt / aktuell nicht verf√ºgbar‚Äú).","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":25,"state":"CLOSED","title":"A4 AMY-Text in Result Page integrieren"},{"body":"## Beschreibung\n\nDie von AMY erzeugten Kurzinterpretationen und zugeh√∂rigen Scores werden in einer `reports`-Tabelle in Supabase persistiert.\n\n## Akzeptanzkriterien\n\n- Tabelle `reports` (oder bestehende Tabelle erweitert) enth√§lt:\n  - `id`\n  - `assessment_id`\n  - `score_numeric` (StressScore)\n  - `risk_level`\n  - `report_text_short`\n  - `created_at`, `updated_at`\n  - optional: `sleep_score`.\n- Jede neue Auswertung erzeugt einen Datensatz (oder aktualisiert, je nach Modell).\n- Daten sind √ºber FK mit Patient/Assessment verkn√ºpft.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"}],"number":24,"state":"CLOSED","title":"A3 Speicherung von AMY-Reports in Supabase"},{"body":"## Beschreibung\n\nBei Ausfall der AMY-LLM-Integration sollen Patient:innen einen beruhigenden, generischen Fallback-Text erhalten, der keine klinische Entscheidung suggeriert, aber Orientierung gibt.\n\n## Akzeptanzkriterien\n\n- Definierte Fallback-Texte f√ºr:\n  - low Risiko\n  - moderate Risiko\n  - high Risiko\n  - unbekannter Status.\n- Bei LLM-Fehlern wird Fallback-Text genutzt, Response bleibt formal g√ºltig.\n- Frontend unterscheidet nicht zwischen ‚Äûechter AMY‚Äú und Fallback ‚Äì nur der Text ist anders.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"}],"number":23,"state":"CLOSED","title":"[AMY] Fallback-Mechanismus f√ºr AMY-Ausf√§lle"},{"body":"## Beschreibung\n\nBei Ausfall der AMY-LLM-Integration sollen Patient:innen einen beruhigenden, generischen Fallback-Text erhalten, der keine klinische Entscheidung suggeriert, aber Orientierung gibt.\n\n## Akzeptanzkriterien\n\n- Definierte Fallback-Texte f√ºr:\n  - low Risiko\n  - moderate Risiko\n  - high Risiko\n  - unbekannter Status.\n- Bei LLM-Fehlern wird Fallback-Text genutzt, Response bleibt formal g√ºltig.\n- Frontend unterscheidet nicht zwischen ‚Äûechter AMY‚Äú und Fallback ‚Äì nur der Text ist anders.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"}],"number":22,"state":"CLOSED","title":"A2 Fallback-Mechanismus f√ºr AMY-Ausf√§lle"},{"body":"## Beschreibung\n\nImplementiere eine Edge Function (z. B. `/api/amy/stress-summary`), die auf Basis von StressScore, SleepScore und RiskLevel eine Kurzinterpretation (~200 W√∂rter) erzeugt.\n\n## Akzeptanzkriterien\n\n- Input: StressScore, SleepScore, RiskLevel (z. B. aus Supabase-Report).\n- Aufruf von Anthropic (oder vergleichbarem LLM) mit geeignetem Prompt.\n- Output enth√§lt:\n  - `report_text_short` (string)\n  - ggf. wiederholte `risk_level`-Best√§tigung\n  - optional strukturierte Empfehlungen.\n- Fehler (API down, Rate-Limit, Parsing-Fehler) werden als klarer Fehlerstatus zur√ºckgegeben (kein 500 ohne Erkl√§rung).\n\n## Technische Hinweise\n\n- Typisierte Response in TypeScript.\n- Logging der LLM-Requestdauer und Fehlertypen.","labels":[{"id":"LA_kwDOQfuwnc8AAAACRewTgg","name":"AMY","description":"","color":"f519b5"}],"number":21,"state":"CLOSED","title":"A1 Edge Function: AMY Stress/Schlaf Kurzinterpretation"},{"body":"Formatierung (Abs√§tze, Lesbarkeit f√ºr 50+)\n\nBeruhigender Text, wenn AMY fehlt\n\nEinheitliche Risk-Badge Logik","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":19,"state":"CLOSED","title":"1.2 Frontend: AMY-Text in der Result Page anzeigen"},{"body":"Implementiere Edge Function amy/stress-summary\n\nInput: StressScore, SleepScore, RiskLevel\n\nOutput: ~200 W√∂rter empathischer Text\n\nEvidenzbasierte Tonalit√§t\n\nFallback erzeugen, wenn Anthropic nicht erreichbar","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":17,"state":"CLOSED","title":"1.1 Backend: AMY-Interpretation generieren (Stress/Schlaf)"},{"body":"ÔªøBeschreibung\r\n- Kurze, verstaendliche Zusammenfassung von Scope und Status des v0.2-MVP fuer Thomas.\r\n- Fokus: Was funktioniert? Was ist bewusst noch offen? Wie geht es mit v0.3 weiter?\r\n\r\nAkzeptanzkriterien\r\n- Markdown/PDF mit Executive Summary, Featureliste und bekannten Limitierungen\r\n- Im Repo verlinkt, z. B. unter docs/releases/v0.2.md\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"}],"number":16,"state":"CLOSED","title":"Dokumentation: v0.2 Release-Uebersicht fuer Thomas"},{"body":"ÔªøBeschreibung\r\n- Fehler im AMY-Endpunkt und im Patient-Flow sollen besser sichtbar sein.\r\n- Mindestens Konsolen-Logging mit klaren Prefixes, optional Vorbereitung fuer externes Monitoring.\r\n\r\nAkzeptanzkriterien\r\n- Alle kritischen Pfade (Supabase-Queries, AMY-Call, Insert/Update in stress_reports) loggen Errors mit erkennbarem Prefix\r\n- README enthaelt kurzen Abschnitt: \"Troubleshooting / wo sehe ich Fehler?\"\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":15,"state":"CLOSED","title":"Monitoring & Logging: Basis-Fehler-Transparenz"},{"body":"ÔªøBeschreibung\r\n- Laufender Deploy von v0.2 (gleicher Stand wie lokal funktionierender MVP).\r\n- Alle benoetigten Env-Variablen fuer Supabase + Anthropic sind dokumentiert.\r\n\r\nAkzeptanzkriterien\r\n- Produktiv-URL ist erreichbar und zeigt den v0.2 MVP-Flow\r\n- env.local / Vercel-Env sind konsistent dokumentiert (README oder docs/deploy.md)\r\n- Check: AMY-Endpoint funktioniert auch in der Deploy-Umgebung (oder Fallback greift sauber)\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"}],"number":14,"state":"CLOSED","title":"DevOps: Deploy v0.2 auf Vercel inkl. ENV-Dokumentation"},{"body":"ÔªøBeschreibung\r\n- Ergebnisseite zeigt Datum, Stress-Score, Schlaf-Score, Risk-Level und AMY-Text.\r\n- Fallback-Texte bei Backend-/AMY-Fehlern sind verstaendlich und beruhigend formuliert.\r\n\r\nAkzeptanzkriterien\r\n- Bereich \"Dein Stress & Resilienz-Report\" zeigt Score-Werte an, wenn verfuegbar\r\n- Wenn kein Report vorhanden: sinnvoller \"noch nicht verfuegbar\"-Hinweis\r\n- Loading- und Error-State klar erkennbar\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":13,"state":"CLOSED","title":"Frontend: Stress-Result-Seite (Scores, AMY-Text, Fallbacks)"},{"body":"ÔªøBeschreibung\r\n- Cleanes, ruhiges UI fuer den Stress-Check (Fragen, Likert-Skala etc.).\r\n- Fokus auf Verstaendlichkeit und geringe kognitive Belastung fuer 50+ Zielgruppe.\r\n\r\nAkzeptanzkriterien\r\n- Alle relevanten Stress- & Schlaf-Fragen sind im UI sichtbar und bedienbar\r\n- Pflichtfragen sind validiert, der Nutzer kann nicht mit unvollstaendigem Formular weiter\r\n- Responsive Darstellung auf Desktop/Tablet\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":12,"state":"CLOSED","title":"Frontend: Stress-Check-Formular UX (Fragen, Skalen, Validierung)"},{"body":"ÔªøBeschreibung\r\n- Einfache, MVP-taugliche Login-Loesung (z. B. E-Mail + Magic Link oder einfacher Token).\r\n- Patientenprofil wird in patient_profiles gespeichert und mit Assessments verknuepft.\r\n\r\nAkzeptanzkriterien\r\n- Ein Patient kann sich wiederkehrend identifizieren (kein anonymer Zufallsnutzer)\r\n- Assessments sind eindeutig einem patient_profile zugeordnet\r\n- Minimal-Datenstruktur (kein Overengineering, nur das Noetigste)\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":11,"state":"CLOSED","title":"Backend: Auth & einfache Patient-Identifikation fuer MVP"},{"body":"ÔªøBeschreibung\r\n- /api/amy/stress-report als stabiler Endpunkt fuer den Stress & Resilienz Report.\r\n- Supabase-Abfrage aus assessment_answers\r\n- Berechnung von stressScore, sleepScore und riskLevel\r\n- Speicherung/Update in stress_reports inkl. report_text_short (AMY-Text)\r\n\r\nAkzeptanzkriterien\r\n- Endpunkt gibt bei gueltigem assessmentId-Input ein JSON mit Scores + Report zurueck\r\n- Bei fehlendem Anthropic-Key wird ein sinnvoller Fallback-Text erzeugt\r\n- Fehler werden geloggt, aber das System crasht nicht\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":10,"state":"CLOSED","title":"Backend: Stabiler AMY-Stress-Report-Endpunkt (Supabase + Anthropic)"},{"body":"ÔªøBeschreibung\r\n- Vollstaendiger Flow: Login -> Stress-Check -> Speicherung der Antworten -> AMY-Auswertung -> Ergebnisanzeige\r\n- Ziel: Funktionierender, stabiler MVP-Flow, den Thomas fachlich reviewen kann.\r\n\r\nAkzeptanzkriterien\r\n- Patient kann sich mit einer simplen ID/E-Mail einloggen\r\n- Stress-Check-Fragebogen durchlaufen und Antworten werden in Supabase gespeichert\r\n- AMY generiert einen Kurz-Report (stressScore, sleepScore, riskLevel, report_text_short)\r\n- Stress-Result-Seite zeigt Score + AMY-Text konsistent an\r\n- Fehlerzustaende werden sinnvoll gehandhabt (Fallback-Texte, wenn AMY nicht laeuft)\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX0_Q","name":"epic","description":"","color":"ededed"}],"number":9,"state":"CLOSED","title":"v0.2 EPIC: Stress & Resilienz MVP - kompletter Patient-Flow"},{"body":"ÔªøBeschreibung\r\n- Kurze, verstaendliche Zusammenfassung von Scope und Status des v0.2-MVP fuer Thomas.\r\n- Fokus: Was funktioniert? Was ist bewusst noch offen? Wie geht es mit v0.3 weiter?\r\n\r\nAkzeptanzkriterien\r\n- Markdown/PDF mit Executive Summary, Featureliste und bekannten Limitierungen\r\n- Im Repo verlinkt, z. B. unter docs/releases/v0.2.md\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1rA","name":"docs","description":"","color":"ededed"}],"number":8,"state":"CLOSED","title":"Dokumentation: v0.2 Release-Uebersicht fuer Thomas"},{"body":"ÔªøBeschreibung\r\n- Fehler im AMY-Endpunkt und im Patient-Flow sollen besser sichtbar sein.\r\n- Mindestens Konsolen-Logging mit klaren Prefixes, optional Vorbereitung fuer externes Monitoring.\r\n\r\nAkzeptanzkriterien\r\n- Alle kritischen Pfade (Supabase-Queries, AMY-Call, Insert/Update in stress_reports) loggen Errors mit erkennbarem Prefix\r\n- README enthaelt kurzen Abschnitt: \"Troubleshooting / wo sehe ich Fehler?\"\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":7,"state":"CLOSED","title":"Monitoring & Logging: Basis-Fehler-Transparenz"},{"body":"ÔªøBeschreibung\r\n- Laufender Deploy von v0.2 (gleicher Stand wie lokal funktionierender MVP).\r\n- Alle benoetigten Env-Variablen fuer Supabase + Anthropic sind dokumentiert.\r\n\r\nAkzeptanzkriterien\r\n- Produktiv-URL ist erreichbar und zeigt den v0.2 MVP-Flow\r\n- env.local / Vercel-Env sind konsistent dokumentiert (README oder docs/deploy.md)\r\n- Check: AMY-Endpoint funktioniert auch in der Deploy-Umgebung (oder Fallback greift sauber)\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"},{"id":"LA_kwDOQfuwnc8AAAACRTX1kA","name":"devops","description":"","color":"ededed"}],"number":6,"state":"CLOSED","title":"DevOps: Deploy v0.2 auf Vercel inkl. ENV-Dokumentation"},{"body":"ÔªøBeschreibung\r\n- Ergebnisseite zeigt Datum, Stress-Score, Schlaf-Score, Risk-Level und AMY-Text.\r\n- Fallback-Texte bei Backend-/AMY-Fehlern sind verstaendlich und beruhigend formuliert.\r\n\r\nAkzeptanzkriterien\r\n- Bereich \"Dein Stress & Resilienz-Report\" zeigt Score-Werte an, wenn verfuegbar\r\n- Wenn kein Report vorhanden: sinnvoller \"noch nicht verfuegbar\"-Hinweis\r\n- Loading- und Error-State klar erkennbar\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":5,"state":"CLOSED","title":"Frontend: Stress-Result-Seite (Scores, AMY-Text, Fallbacks)"},{"body":"ÔªøBeschreibung\r\n- Cleanes, ruhiges UI fuer den Stress-Check (Fragen, Likert-Skala etc.).\r\n- Fokus auf Verstaendlichkeit und geringe kognitive Belastung fuer 50+ Zielgruppe.\r\n\r\nAkzeptanzkriterien\r\n- Alle relevanten Stress- & Schlaf-Fragen sind im UI sichtbar und bedienbar\r\n- Pflichtfragen sind validiert, der Nutzer kann nicht mit unvollstaendigem Formular weiter\r\n- Responsive Darstellung auf Desktop/Tablet\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1Xw","name":"frontend","description":"","color":"ededed"}],"number":4,"state":"CLOSED","title":"Frontend: Stress-Check-Formular UX (Fragen, Skalen, Validierung)"},{"body":"ÔªøBeschreibung\r\n- Einfache, MVP-taugliche Login-Loesung (z. B. E-Mail + Magic Link oder einfacher Token).\r\n- Patientenprofil wird in patient_profiles gespeichert und mit Assessments verknuepft.\r\n\r\nAkzeptanzkriterien\r\n- Ein Patient kann sich wiederkehrend identifizieren (kein anonymer Zufallsnutzer)\r\n- Assessments sind eindeutig einem patient_profile zugeordnet\r\n- Minimal-Datenstruktur (kein Overengineering, nur das Noetigste)\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":3,"state":"CLOSED","title":"Backend: Auth & einfache Patient-Identifikation fuer MVP"},{"body":"ÔªøBeschreibung\r\n- /api/amy/stress-report als stabiler Endpunkt fuer den Stress & Resilienz Report.\r\n- Supabase-Abfrage aus assessment_answers\r\n- Berechnung von stressScore, sleepScore und riskLevel\r\n- Speicherung/Update in stress_reports inkl. report_text_short (AMY-Text)\r\n\r\nAkzeptanzkriterien\r\n- Endpunkt gibt bei gueltigem assessmentId-Input ein JSON mit Scores + Report zurueck\r\n- Bei fehlendem Anthropic-Key wird ein sinnvoller Fallback-Text erzeugt\r\n- Fehler werden geloggt, aber das System crasht nicht\r\n","labels":[{"id":"LA_kwDOQfuwnc8AAAACRTX03g","name":"v0.2","description":"","color":"ededed"},{"id":"LA_kwDOQfuwnc8AAAACRTX1KA","name":"backend","description":"","color":"e5c2f6"}],"number":2,"state":"CLOSED","title":"Backend: Stabiler AMY-Stress-Report-Endpunkt (Supabase + Anthropic)"}]
