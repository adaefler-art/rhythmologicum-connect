name: PR Size Guardrail

on:
  pull_request:

jobs:
  pr-size:
    name: PR Size Guardrail
    runs-on: ubuntu-latest
    steps:
      - name: Enforce PR file change limits
        uses: actions/github-script@v7
        with:
          script: |
            const labels = context.payload.pull_request.labels.map((label) => label.name)
            const changedFiles = context.payload.pull_request.changed_files
            const maxDefault = 100
            const maxUiFix = 50
            const maxFiles = labels.includes('ui-fix') ? maxUiFix : maxDefault

            core.info(`Changed files: ${changedFiles}. Limit: ${maxFiles}. Labels: ${labels.join(', ')}`)

            if (changedFiles > maxFiles) {
              core.setFailed(
                `PR modifies ${changedFiles} files, which exceeds the limit of ${maxFiles}. ` +
                  `Split the PR or remove the 'ui-fix' label for the higher limit.`
              )
            }
